// JayData 1.1.1
// Dual licensed under MIT and GPL v2
// Copyright JayStack Technologies (http://jaydata.org/licensing)
//
// JayData is a standards-based, cross-platform Javascript library and a set of
// practices to access and manipulate data from various online and offline sources.
//
// Credits:
//     Hajnalka Battancs, Dániel József, János Roden, László Horváth, Péter Nochta
//     Péter Zentai, Róbert Bónay, Szabolcs Czinege, Viktor Borza, Viktor Lázár,
//     Zoltán Gyebrovszki
//
// More info: http://jaydata.org
(function(){"undefined"===typeof window&&(window=this);$data=window.$data||(window.$data={})})(this);"undefined"===typeof console&&(console={warn:function(){},error:function(){},log:function(){},dir:function(){},time:function(){},timeEnd:function(){}});console.warn||(console.warn=function(){});console.error||(console.error=function(){});(function(a){a.__namespace=true;a.version="JayData 1.1.1";a.versionNumber="1.1.1";a.root={}})($data);
Guard={requireValue:function(a,b){(typeof b==="undefined"||b===null)&&Guard.raise(a+" requires a value other than undefined or null")},requireType:function(a,b,c){return(c instanceof Array?c:[c]).some(function(c){switch(typeof c){case "string":return typeof b===c;case "function":return b instanceof c;default:Guard.raise("Unknown type format : "+typeof c+" for: "+a)}})},raise:function(a){if(typeof intellisense==="undefined"){a instanceof Exception?console.error(a.name+":",a.message+"\n",a):console.error(a);
throw a;}}};Object.isNullOrUndefined=function(a){return a===void 0||a===null};
(function(){if(!Object.getOwnPropertyNames)Object.getOwnPropertyNames=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b};if(!Object.create)Object.create=function(a){function b(){}arguments.length>1&&Guard.raise(Error("Object.create implementation only accepts the first parameter."));b.prototype=a;return new b};if(!Object.keys){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty",
"isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;Object.keys=function(e){(typeof e!=="object"&&typeof e!=="function"||e===null)&&Guard.raise(new TypeError("Object.keys called on non-object"));var i=[],g;for(g in e)a.call(e,g)&&i.push(g);if(b)for(g=0;g<d;g++)a.call(e,c[g])&&i.push(c[g]);return i}}if(!Object.defineProperty)Object.defineProperty=function(a,b,c){a[b]=c.value||{}};if(!Object.defineProperties)Object.defineProperties=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=
b[c].value||{})};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;c<d;c++)b?a.call(b,this[c],c,this):a(this[c],c,this)};if(!Array.prototype.filter)Array.prototype.filter=function(a,b){for(var c=[],d=0,m=this.length;d<m;d++)(b?a.call(b,this[d],d,this):a(this[d],d,this))===true&&c.push(this[d]);return c};if(!Array.prototype.map)Array.prototype.map=function(a,b){for(var c=[],d=0,m=this.length;d<m;d++){var r=b?a.call(b,this[d],d,this):a(this[d],d,this);c.push(r)}return c};
if(!Array.prototype.some)Array.prototype.some=function(a,b){for(var c=0,d=this.length;c<d;c++)if(b?a.call(b,this[c],c,this):a(this[c],c,this))return true;return false};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1}})();
JAYLINT=function(){function a(){return this}function b(){}function c(a){return Db[a]||"\\u"+("0000"+a.charCodeAt().toString(16)).slice(-4)}function d(a){Object.keys(a).forEach(function(b){Q[b]=a[b]})}function e(){if(!k.safe){if(k.rhino){d(Eb);k.rhino=false}if(k.devel){d(Fb);k.devel=false}if(k.browser){d(Gb);k.browser=false}if(k.windows){d(Hb);k.windows=false}if(k.node){d(Ib);k.node=false;La=true}if(k.widget){d(Jb);k.widget=false}}}function i(a,b,c){throw{name:"JSLintError",line:b,character:c,message:H.scanned_a_b.supplant({a:a,
b:Math.floor(b/za.length*100)})};}function g(a,b,c,d,g,e){var j,m,b=b||f;m=b.line||0;j=b.from||0;a={id:"(error)",raw:H[a]||a,evidence:za[m-1]||"",line:m,character:j,a:c||b.value,b:d,c:g,d:e};a.reason=a.raw.supplant(a);JAYLINT.errors.push(a);k.passfail&&i(H.stopping,m,j);Ma=Ma+1;Ma>=k.maxerr&&i(H.too_many,m,j);return a}function j(a,b,c,d,f,e,j){return g(a,{line:b,from:c},d,f,e,j)}function m(a,b,c,d,f,e){a=g(a,b,c,d,f,e);i(H.stopping,a.line,a.character)}function r(a,b,c,d,g,f,e){return m(a,{line:b,
from:c},d,g,f,e)}function o(a){!k.white&&f.from!==a&&g("expected_a_at_b_c",f,f.value,a,f.from)}function z(a,b,c){if(a[b]!==c){g("expected_a_b",a,c,a[b]);return true}return false}function C(a,b,c){c=c||a.value;if(q===X){k.safe&&g("adsafe_a",a,c);if(typeof X[c]!=="string"){a.writeable=typeof Q[c]==="boolean"?Q[c]:true;a.funct=q;Aa[c]=a}b==="becoming"&&(b="var")}else if(typeof q[c]==="string")if(q[c]==="undef"){k.undef||g("used_before_a",a,c);b="var"}else g("already_defined",a,c);else{a.funct=q;a.writeable=
true;E[c]=a}q[c]=b}function s(a){for(var b,c=0,a=a||0;c<=a;){(b=Ba[c])||(b=Ba[c]=Ca.token());c=c+1}return b}function l(a){a=a||n;if(a.comments){for(var b=a.prev;b.comments===null;)b=b.prev;b.comments=b.comments?b.comments.concat(a.comments):a.comments}a.comments=null}function h(a,b){if(v){if(ea&&f.line!==n.line){if((ea!==v||!f.edge)&&f.from===v.at-(f.edge?k.indent:0)){for(var c=v;;){c.at=c.at-k.indent;if(c===ea)break;c=c.was}c.open=false}ea=null}if(v.open)if(f.edge)f.edge==="label"?o(1):f.edge===
"case"?o(v.at-k.indent):(v.mode!=="array"||f.line!==n.line)&&o(v.at);else{if(f.line!==n.line){f.from<v.at+(v.mode==="expression"?0:k.indent)&&o(v.at+k.indent);v.wrap=true}}else if(f.line!==n.line)if(f.edge)o(v.at);else{v.wrap=true;v.mode==="statement"||v.mode==="var"?o(v.at+k.indent):f.from<v.at+(v.mode==="expression"?0:k.indent)&&o(v.at+k.indent)}}switch(n.id){case "(number)":f.id==="."&&g("trailing_decimal_a");break;case "-":(f.id==="-"||f.id==="--")&&g("confusing_a");break;case "+":(f.id==="+"||
f.id==="++")&&g("confusing_a")}if(n.id==="(string)"||n.identifier)$a=n.value;a&&f.id!==a&&(b?g("expected_a_b_from_c_d",f,a,b.id,b.line,f.value):(!f.identifier||f.value!==a)&&g("expected_a_b",f,a,f.value));U=n;n=f;f=Ba.shift()||Ca.token();n.id==="(end)"&&l()}function fa(){if(k.adsafe)k.safe=true;if(k.safe){k.browser=k["continue"]=k.css=k.debug=k.devel=k.evil=k.forin=k.newcap=k.nomen=k.on=k.rhino=k.sloppy=k.sub=k.undef=k.widget=k.windows=false;delete Q.Array;delete Q.Date;delete Q.Function;delete Q.Object;
delete Q.eval;d({ADSAFE:false,lib:false})}}function ga(){var a=this.id,b=Da;f.line===n.line&&f.from===n.thru&&g("missing_space_a_b",f,n.value,f.value);Da=true;k.white=true;(Ba.length>0||f.comments)&&g("unexpected_a",this);switch(a){case "/*properties":case "/*property":case "/*members":case "/*member":a:for(ha||(ha={});;){if(f.id!=="(string)"&&!f.identifier)break a;ha[f.value]=true;h();if(f.id!==",")break a;h(",")}break;case "/*jslint":for(k.safe&&g("adsafe_a",this);f.id==="(string)"||f.identifier;){a=
f.value;h();f.id!==":"&&m("expected_a_b",f,":",f.value);h(":");switch(a){case "indent":a=+f.value;(typeof a!=="number"||!isFinite(a)||a<0||Math.floor(a)!==a)&&m("expected_small_a");k.indent=a;break;case "maxerr":a=+f.value;(typeof a!=="number"||!isFinite(a)||a<=0||Math.floor(a)!==a)&&m("expected_small_a",f);k.maxerr=a;break;case "maxlen":a=+f.value;(typeof a!=="number"||!isFinite(a)||a<0||Math.floor(a)!==a)&&m("expected_small_a");k.maxlen=a;break;default:f.id==="true"?k[a]=true:f.id==="false"?k[a]=
false:m("unexpected_a");if(a==="adsafe"){k.adsafe=k.safe=true;fa()}else a==="safe"&&fa()}h();f.id===","&&h(",")}e();break;case "/*globals":case "/*global":k.safe&&g("adsafe_a",this);a:for(var c;;){if(f.id!=="(string)"&&!f.identifier)break a;a=f.value;h();c=false;if(f.id===":"){h(":");switch(f.id){case "true":c=Q[a]!==false;h("true");break;case "false":h("false");break;default:m("unexpected_a")}}Q[a]=c;if(f.id!==",")break a;h(",")}break;default:m("unpexpected_a",this)}Da=b;h("*/")}function x(a){f.edge=
!v||v.open&&(a||true)}function K(a){var b,c;if(typeof a==="number")v={at:a,open:true,was:c};else if(v){c=v;b=a==="var"||f.line!==n.line&&a!=="statement";v={at:(b||a==="control"?c.at+k.indent:c.at)+(c.wrap?k.indent:0),mode:a,open:b,was:c};a==="var"&&b&&(ea=v)}else v={at:1,mode:"statement",open:true}}function A(a,b){if(a){if(v&&v.open){v.at=v.at-k.indent;x()}h(a,b)}if(v)v=v.was}function y(a,b){b=b||f;b.id!=="(end)"&&!k.white&&(n.line!==b.line||n.thru+1!==b.from)&&g("expected_space_a_b",b,n.value,b.value)}
function ua(a,b){a=a||n;b=b||f;b.id!=="(end)"&&(a.line!==b.line||!k.white&&a.thru+1!==b.from)&&g("expected_space_a_b",b,a.value,b.value)}function u(a,b){a=a||n;b=b||f;(!k.white||t==="styleproperty"||t==="style")&&a.thru!==b.from&&a.line===b.line&&g("unexpected_space_a_b",b,a.value,b.value)}function B(a,b){a=a||n;b=b||f;b.id!=="(end)"&&(a.line!==b.line||!k.white&&a.thru!==b.from)&&g("unexpected_space_a_b",b,a.value,b.value)}function J(a,b){if(!k.white){a=a||n;b=b||f;a.thru===b.from&&a.line===b.line&&
g("missing_space_a_b",b,a.value,b.value)}}function G(){if(f.id!==",")j("expected_a_b",n.line,n.thru,",",f.value);else{k.white||B();h(",");l();J()}}function V(){if(f.id!==";")j("expected_a_b",n.line,n.thru,";",f.value);else{k.white||B();h(";");l();Kb[f.id]!==true&&J()}}function Na(){if(f.value==="use strict"){na&&g("unnecessary_use");x();h();V();na=true;k.newcap=false;k.undef=false;return true}return false}function S(a,b){if(a===b)return true;if(Array.isArray(a)){if(Array.isArray(b)&&a.length===b.length){var c;
for(c=0;c<a.length;c=c+1)if(!S(a[c],b[c]))return false;return true}return false}if(Array.isArray(b))return false;if(a.arity===b.arity&&a.value===b.value)switch(a.arity){case "prefix":case "suffix":case void 0:return a.id===b.id&&S(a.first,b.first);case "infix":return S(a.first,b.first)&&S(a.second,b.second);case "ternary":return S(a.first,b.first)&&S(a.second,b.second)&&S(a.third,b.third);case "function":case "regexp":break;default:return true}else{if(a.id==="."&&b.id==="["&&b.arity==="infix")return a.second.value===
b.second.value&&b.second.id==="(string)";if(a.id==="["&&a.arity==="infix"&&b.id===".")return a.second.value===b.second.value&&a.second.id==="(string)"}return false}function w(a,b){var c;f.id==="(end)"&&m("unexpected_a",n,f.id);h();k.safe&&E[n.value]&&E[n.value]===Aa[n.value]&&f.id!=="("&&f.id!=="."&&g("adsafe",n);if(b){$a="anonymous";q["(verb)"]=n.value}if(b===true&&n.fud)c=n.fud();else{if(n.nud)c=n.nud();else{if(f.id==="(number)"&&n.id==="."){g("leading_decimal_a",n,f.value);h();return n}m("expected_identifier_a",
n,n.id)}for(;a<f.lbp;){h();n.led?c=n.led(c):m("expected_operator_a",n,n.id)}}return c}function Ea(a,b){var c=Y[a];if(!c||typeof c!=="object")Y[a]=c={id:a,lbp:b,value:a};return c}function M(a){return Ea(a,0)}function oa(a){a.postscript=true;return a}function ab(a){var b=Ea(a,0);b.from=1;b.thru=1;b.line=0;b.edge=true;a.value=a;return oa(b)}function R(a,b){var c=M(a);c.identifier=c.reserved=true;c.fud=b;return c}function Oa(a,b){R(a,b).labeled=true}function Pa(a,b){R(a,b).disrupt=true}function rb(a){var b=
a.id.charAt(0);if(b>="a"&&b<="z"||b>="A"&&b<="Z")a.identifier=a.reserved=true;return a}function P(a,b,c){var d=Ea(a,150);rb(d);d.nud=typeof b==="function"?b:function(){a==="typeof"?y():B();this.first=w(150);this.arity="prefix";if(this.id==="++"||this.id==="--")k.plusplus?(!this.first.identifier||this.first.reserved)&&this.first.id!=="."&&this.first.id!=="["&&g("bad_operand",this):g("unexpected_a",this);this.type=c;return this};return d}function ia(a,b,c){a=M(a);a.arity=a.type=b;if(c)a.nud=c;return a}
function bb(a){return(a=a.identifier&&E[a.value]||a)&&a.type}function L(a,b,c){var d="",f,e,j;if(typeof a!=="string"){e=a.identifier&&E[a.value]||a;a=e.type}j=b.identifier&&E[b.value]||b;f=j.type;if(a)f?a===f?d=a:k.type||g("type_inconsistency_a_b",c||b,a,f):j.type=d=a;else if(f){if(e)e.type=f;d=f}return d}function F(a,b){var c=M(a);c.identifier=c.reserved=true;if(typeof b==="function")c.nud=b;return c}function va(b,c,d){b=F(b);b.type=c;b.value=d;b.nud=a;return b}function cb(a,b){return F(a,function(){typeof b===
"function"&&b(this);return this})}function N(a,b,c,d,f){a=Ea(a,b);rb(a);a.led=function(a){this.arity="infix";if(!f){J(U,n);J()}!k.bitwise&&this.bitwise&&g("unexpected_a",this);if(typeof c==="function")return c(a,this);this.first=a;this.second=w(b);return this};if(d)a.type=d;return a}function aa(a,b){a.assign&&g(b||H.conditional_assignment,a);return a}function ba(a,b){switch(a.id){case "[":case "-":a.arity!=="infix"&&g(b||H.weird_condition,a);break;case "false":case "function":case "Infinity":case "NaN":case "null":case "true":case "undefined":case "void":case "(number)":case "(regexp)":case "(string)":case "{":g(b||
H.weird_condition,a);break;case "(":a.first.id==="."&&Lb[a.first.second.value]===true&&g(b||H.weird_condition,a)}return a}function sb(a){switch(a.arity){case "prefix":switch(a.id){case "{":case "[":g("unexpected_a",a);break;case "!":g("confusing_a",a)}break;case "function":case "regexp":g("unexpected_a",a);break;default:a.id==="NaN"&&g("isnan",a)}return a}function ka(a,b){return N(a,100,function(a,c){sb(a);b&&!k.eqeq&&g("expected_a_b",c,b,c.id);var d=w(100);(S(a,d)||(a.id==="(string)"||a.id==="(number)")&&
(d.id==="(string)"||d.id==="(number)"))&&g("weird_relation",c);c.first=a;c.second=sb(d);L(a,c.second,c);return c},"boolean")}function Z(a,b){var c=N(a,20,function(a,b){var c;b.first=a;if(a.identifier)E[a.value]?E[a.value].writeable===false&&g("read_only",a):m("read_only");else if(k.safe){c=a;do{typeof Q[c.value]==="boolean"&&g("adsafe",c);c=c.first}while(c)}a===Y["function"]&&g("identifier_function",n);if(a.id==="."||a.id==="["){(!a.first||a.first.value==="arguments")&&g("bad_assignment",b);b.second=
w(19);b.id==="="&&S(b.first,b.second)&&g("weird_assignment",b)}else if(a.identifier&&!a.reserved){q[a.value]==="exception"&&g("assign_exception",a);b.second=w(19);b.id==="="&&S(b.first,b.second)&&g("weird_assignment",b);if(b.type){L(a,b);L(b,b.second,b)}else L(a,b.second,b)}return b});c.assign=true;if(b){if(Y[b].type)c.type=Y[b].type;if(Y[b].bitwise)c.bitwise=true}return c}function wa(a,b){var c=N(a,b,"number");c.bitwise=true;return c}function tb(a){a=Ea(a,150);a.led=function(a){B(U,n);k.plusplus?
(!a.identifier||a.reserved)&&a.id!=="."&&a.id!=="["&&g("bad_operand",this):g("unexpected_a",this);this.first=a;this.arity="suffix";return this};return a}function pa(){if(f.identifier){h();k.safe&&Qa[n.value]?g("adsafe_a",n):n.reserved&&!k.es5&&g("expected_identifier_a_reserved",n);return n.value}}function db(){var a,b=E;if(f.id===";"){g("unexpected_a");V()}else{if(f.identifier&&!f.reserved&&s().id===":"){x("label");a=f;h();l();h(":");l();E=Object.create(b);C(a,"label");f.labeled!==true?g("label_a_b",
f,a.value,f.value):eb.test(a.value+":")?g("url",a):q===X&&m("unexpected_a",n);f.label=a}x();K("statement");if(a=w(0,true))if(a.arity==="statement")a.id==="switch"||a.block&&a.id!=="do"?J():V();else{a.id==="("?a.first.id==="new"&&g("bad_new"):!a.assign&&a.id!=="delete"&&a.id!=="++"&&a.id!=="--"&&g("assignment_function_expression",n);V()}A();E=b;return a}}function qa(){for(var a=[],b,c;f.postscript!==true;)if(f.id===";"){g("unexpected_a",f);V()}else{if(f.value==="use strict"){(!La||q!==X||a.length>
0)&&g("function_strict");Na()}if(b){g("unreachable_a_b",f,f.value,b.value);b=null}if(c=db()){a.push(c);if(c.disrupt){b=c;a.disrupt=true}}}return a}function ca(a){var b,c=f,d=Fa,e=E,j=na;Fa=a;E=Object.create(E);J();if(f.id==="{"){h("{");K();!a&&!Na()&&!j&&!k.sloppy&&q["(context)"]===X&&g("missing_use_strict");b=qa();na=j;A("}",c);l()}else if(a){g("expected_a_b",f,"{",f.value);b=[db()];b.disrupt=b[0].disrupt}else m("expected_a_b",f,"{",f.value);q["(verb)"]=null;E=e;Fa=d;a&&b.length===0&&g("empty_block");
return b}function Ra(a){ha&&typeof ha[a]!=="boolean"&&g("unexpected_property_a",n,a);ra[a]=typeof ra[a]==="number"?ra[a]+1:1}function fb(){var a=pa(true);if(!a)if(f.id==="(string)"){a=f.value;k.safe&&(Qa[a]?g("adsafe_a"):(a.charAt(0)==="_"||a.charAt(a.length-1)==="_")&&g("dangling_a"));h()}else if(f.id==="(number)"){a=f.value.toString();h()}return a}function I(a){var b=0;if(a)if(Array.isArray(a))a.forEach(function(a){b=b+I(a)});else switch(a.arity){case "statement":switch(a.id){case "if":b=b+(I(a.first)+
I(a.block)+I(a["else"])+1);break;case "while":case "do":a.first.id!=="true"&&a.first.value!==1&&(b=b+1);b=b+(I(a.first)+I(a.block));break;case "for":a.second!==void 0&&a.second.id!=="true"&&a.second.value!==1&&(b=b+1);b=b+(I(a.first)+I(a.second)+I(a.third)+I(a.block));break;case "switch":b=b+(I(a.first)+I(a.second)+a.second.length);a.second[a.second.length-1].id==="default"&&(b=b-1);break;case "try":a.second&&(b=b+1);a.third&&(b=b+1);b=b+(I(a.first)+I(a.second)+I(a.third)+I(a.block))}break;case "prefix":b=
b+I(a.first);break;case "case":case "infix":b=b+(I(a.first)+I(a.second));if(a.id==="&&"||a.id==="||")b=b+1;break;case "ternary":b=b+(I(a.first)+I(a.second)+I(a.third))}return b}function Sa(a,b){var d=q,g=k,e=ha,j=E;q={"(name)":b||"'"+($a||"").replace(ub,c)+"'","(line)":f.line,"(context)":d,"(breakage)":0,"(loopage)":0,"(scope)":E,"(token)":a};ha=e&&Object.create(e);k=Object.create(g);E=Object.create(j);Ta.push(q);(a.name=b)&&C(a,"function",b);a.writeable=false;var i=q,m;a:{var r=f,o=[];h("(");K();
l();u();if(f.id===")"){u();A(")",r);l();m=void 0}else for(;;){x();pa();o.push(n);C(n,k.unparam?"parameter":"unparam");if(f.id===",")G();else{u();A(")",r);l();m=o;break a}}}a.first=i["(params)"]=m;a.type="function";y();a.block=ca(false);q["(complexity)"]=I(a.block)+1;q=d;k=g;ha=e;E=j}function gb(){function a(){var b=f,c={};h("{");if(f.id!=="}")for(;f.id!=="(end)";){for(;f.id===",";){g("unexpected_a",f);G()}f.id!=="(string)"&&g("expected_string_a");c[f.value]===true?g("duplicate_a"):f.value==="__proto__"?
g("dangling_a"):c[f.value]=true;h();h(":");gb();if(f.id!==",")break;G();if(f.id==="}"){g("unexpected_a",n);break}}h("}",b)}function b(){var a=f;h("[");if(f.id!=="]")for(;f.id!=="(end)";){for(;f.id===",";){g("unexpected_a",f);G()}gb();if(f.id!==",")break;G();if(f.id==="]"){g("unexpected_a",n);break}}h("]",a)}switch(f.id){case "{":a();break;case "[":b();break;case "true":case "false":case "null":case "(number)":case "(string)":h();break;case "-":h("-");B();h("(number)");break;default:m("unexpected_a")}}
function hb(){if(f.identifier){h();return true}}function Ua(){if(f.id==="-"){h("-");B()}if(f.id==="(number)"){h("(number)");return true}}function ib(){if(f.id==="(string)"){h();return true}}function ja(){var a,b,c,d;if(f.identifier){d=f.value;if(d==="rgb"||d==="rgba"){h();c=f;h("(");for(a=0;a<3;a=a+1){a&&G();b=f.value;if(f.id!=="(string)"||b<0){g("expected_positive_a",f);h()}else{h();if(f.id==="%"){h("%");b>100&&g("expected_percent_a",n,b)}else b>255&&g("expected_small_a",n,b)}}if(d==="rgba"){G();
b=+f.value;(f.id!=="(string)"||b<0||b>1)&&g("expected_fraction_a",f);h();if(f.id==="%"){g("unexpected_a");h("%")}}h(")",c);return true}if(Mb[f.value]===true){h();return true}}else if(f.id==="(color)"){h();return true}return false}function D(){if(f.id==="-"){h("-");B()}if(f.id==="(number)"){h();if(f.id!=="(string)"&&vb[f.value]===true){B();h()}else+n.value!==0&&g("expected_linear_a");return true}return false}function xa(){if(f.identifier)switch(f.value){case "thin":case "medium":case "thick":h();return true}else return D()}
function Ga(){if(f.identifier){if(f.value==="auto"){h();return true}}else return D()}function sa(){var a,b;if(f.identifier&&f.value==="url"){f=Ca.range("(",")");b=f.value;a=b.charAt(0);if(a==='"'||a==="'")if(b.slice(-1)!==a)g("bad_url");else{b=b.slice(1,-1);b.indexOf(a)>=0&&g("bad_url")}b||g("missing_url");k.safe&&wb.test(b)&&m("adsafe_a",f,b);Ha.push(b);h();return true}return false}function jb(a){var b=0,c,d,g,e=0;switch(typeof a){case "function":return a();case "string":if(f.identifier&&f.value===
a){h();return true}return false}for(;;){if(b>=a.length)return false;g=a[b];b=b+1;if(typeof g==="boolean")break;else if(typeof g==="number"){c=g;g=a[b];b=b+1}else c=1;for(d=false;c>0;)if(jb(g)){d=true;c=c-1}else break;if(d)return true}e=b;for(c=[];;){g=false;for(b=e;b<a.length;b=b+1)if(!c[b]&&jb(Va[a[b]])){g=d=true;c[b]=true;break}if(!g)return d}}function xb(){for(var a;;){if(f.id==="}"||f.id==="(end)"||T&&f.id===T)break;for(;f.id===";";){g("unexpected_a");V()}for(a=void 0;f.id==="*"||f.id==="#"||
f.value==="_";){k.css||g("unexpected_a");h()}if(f.id==="-"){k.css||g("unexpected_a");h("-");f.identifier||g("expected_nonstandard_style_attribute");h();a=kb}else{if(f.identifier)if(Object.prototype.hasOwnProperty.call(Va,f.value))a=Va[f.value];else{a=kb;k.css||g("unrecognized_style_attribute_a")}else g("expected_style_attribute");h()}h(":");if(f.identifier&&f.value==="inherit")h();else if(!jb(a)){g("unexpected_a");h()}if(f.id==="!"){h("!");B();f.identifier&&f.value==="important"?h():g("expected_a_b",
f,"important",f.value)}f.id==="}"||f.id===T?g("expected_a_b",f,";",f.value):V()}}function lb(){if(f.identifier){Object.prototype.hasOwnProperty.call(mb,k.cap?f.value.toLowerCase():f.value)||g("expected_tagname_a");h()}else switch(f.id){case ">":case "+":h();lb();break;case ":":h(":");switch(f.value){case "active":case "after":case "before":case "checked":case "disabled":case "empty":case "enabled":case "first-child":case "first-letter":case "first-line":case "first-of-type":case "focus":case "hover":case "last-child":case "last-of-type":case "link":case "only-of-type":case "root":case "target":case "visited":h();
break;case "lang":h();h("(");f.identifier||g("expected_lang_a");h(")");break;case "nth-child":case "nth-last-child":case "nth-last-of-type":case "nth-of-type":h();h("(");if(f.id==="(number)"){h();if(f.value==="n"&&f.identifier){B();h();if(f.id==="+"){B();h("+");B();h("(number)")}}}else f.identifier&&(f.value==="odd"||f.value==="even")?h():g("unexpected_a");h(")");break;case "not":h();h("(");f.id===":"&&s(0).value==="not"&&g("not");lb();h(")");break;default:g("expected_pseudo_a")}break;case "#":h("#");
f.identifier||g("expected_id_a");h();break;case "*":h("*");break;case ".":h(".");f.identifier||g("expected_class_a");h();break;case "[":h("[");f.identifier||g("expected_attribute_a");h();if(f.id==="="||f.value==="~="||f.value==="$="||f.value==="|="||f.id==="*="||f.id==="^="){h();f.id!=="(string)"&&g("expected_string_a");h()}h("]");break;default:m("expected_selector_a")}}function yb(){for(;f.id!=="</"&&f.id!=="(end)";){a:for(f.id==="{"&&g("expected_style_pattern");;){lb();if(f.id==="</"||f.id==="{"||
f.id==="(end)")break a;f.id===","&&G()}t="styleproperty";if(f.id===";")V();else{h("{");xb();t="style";h("}")}}}function zb(){for(;f.id==="@";){s();h("@");if(f.identifier)switch(f.value){case "import":h();if(!sa()){g("expected_a_b",f,"url",f.value);h()}V();break;case "media":for(h();;){(!f.identifier||Ab[f.value]===true)&&m("expected_media_a");h();if(f.id!==",")break;G()}h("{");yb();h("}");break;default:g("expected_at_a")}else g("expected_at_a")}yb()}var W,Ia,Ja,la,$a,Wa,Nb={"<":true,"<=":true,"==":true,
"===":true,"!==":true,"!=":true,">":true,">=":true,"+":true,"-":true,"*":true,"/":true,"%":true},Qa={arguments:true,callee:true,caller:true,constructor:true,eval:true,prototype:true,stack:true,unwatch:true,valueOf:true,watch:true},nb,Gb={clearInterval:false,clearTimeout:false,document:false,event:false,frames:false,history:false,Image:false,localStorage:false,location:false,name:false,navigator:false,Option:false,parent:false,screen:false,sessionStorage:false,setInterval:false,setTimeout:false,Storage:false,
window:false,XMLHttpRequest:false},H={a_label:"'{a}' is a statement label.",a_not_allowed:"'{a}' is not allowed.",a_not_defined:"'{a}' is not defined.",a_scope:"'{a}' used out of scope.",adsafe:"ADsafe violation.",adsafe_a:"ADsafe violation: '{a}'.",adsafe_autocomplete:"ADsafe autocomplete violation.",adsafe_bad_id:"ADSAFE violation: bad id.",adsafe_div:"ADsafe violation: Wrap the widget in a div.",adsafe_fragment:"ADSAFE: Use the fragment option.",adsafe_go:"ADsafe violation: Misformed ADSAFE.go.",
adsafe_html:"Currently, ADsafe does not operate on whole HTML documents. It operates on <div> fragments and .js files.",adsafe_id:"ADsafe violation: id does not match.",adsafe_id_go:"ADsafe violation: Missing ADSAFE.id or ADSAFE.go.",adsafe_lib:"ADsafe lib violation.",adsafe_lib_second:"ADsafe: The second argument to lib must be a function.",adsafe_missing_id:"ADSAFE violation: missing ID_.",adsafe_name_a:"ADsafe name violation: '{a}'.",adsafe_placement:"ADsafe script placement violation.",adsafe_prefix_a:"ADsafe violation: An id must have a '{a}' prefix",
adsafe_script:"ADsafe script violation.",adsafe_source:"ADsafe unapproved script source.",adsafe_subscript_a:"ADsafe subscript '{a}'.",adsafe_tag:"ADsafe violation: Disallowed tag '{a}'.",already_defined:"'{a}' is already defined.",and:"The '&&' subexpression should be wrapped in parens.",assign_exception:"Do not assign to the exception parameter.",assignment_function_expression:"Expected an assignment or function call and instead saw an expression.",attribute_case_a:"Attribute '{a}' not all lower case.",
avoid_a:"Avoid '{a}'.",bad_assignment:"Bad assignment.",bad_color_a:"Bad hex color '{a}'.",bad_constructor:"Bad constructor.",bad_entity:"Bad entity.",bad_html:"Bad HTML string",bad_id_a:"Bad id: '{a}'.",bad_in_a:"Bad for in variable '{a}'.",bad_invocation:"Bad invocation.",bad_name_a:"Bad name: '{a}'.",bad_new:"Do not use 'new' for side effects.",bad_number:"Bad number '{a}'.",bad_operand:"Bad operand.",bad_type:"Bad type.",bad_url:"Bad url string.",bad_wrap:"Do not wrap function literals in parens unless they are to be immediately invoked.",
combine_var:"Combine this with the previous 'var' statement.",conditional_assignment:"Expected a conditional expression and instead saw an assignment.",confusing_a:"Confusing use of '{a}'.",confusing_regexp:"Confusing regular expression.",constructor_name_a:"A constructor name '{a}' should start with an uppercase letter.",control_a:"Unexpected control character '{a}'.",css:"A css file should begin with @charset 'UTF-8';",dangling_a:"Unexpected dangling '_' in '{a}'.",dangerous_comment:"Dangerous comment.",
deleted:"Only properties should be deleted.",duplicate_a:"Duplicate '{a}'.",empty_block:"Empty block.",empty_case:"Empty case.",empty_class:"Empty class.",es5:"This is an ES5 feature.",evil:"eval is evil.",expected_a:"Expected '{a}'.",expected_a_b:"Expected '{a}' and instead saw '{b}'.",expected_a_b_from_c_d:"Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'.",expected_at_a:"Expected an at-rule, and instead saw @{a}.",expected_a_at_b_c:"Expected '{a}' at column {b}, not column {c}.",
expected_attribute_a:"Expected an attribute, and instead saw [{a}].",expected_attribute_value_a:"Expected an attribute value and instead saw '{a}'.",expected_class_a:"Expected a class, and instead saw .{a}.",expected_fraction_a:"Expected a number between 0 and 1 and instead saw '{a}'",expected_id_a:"Expected an id, and instead saw #{a}.",expected_identifier_a:"Expected an identifier and instead saw '{a}'.",expected_identifier_a_reserved:"Expected an identifier and instead saw '{a}' (a reserved word).",
expected_linear_a:"Expected a linear unit and instead saw '{a}'.",expected_lang_a:"Expected a lang code, and instead saw :{a}.",expected_media_a:"Expected a CSS media type, and instead saw '{a}'.",expected_name_a:"Expected a name and instead saw '{a}'.",expected_nonstandard_style_attribute:"Expected a non-standard style attribute and instead saw '{a}'.",expected_number_a:"Expected a number and instead saw '{a}'.",expected_operator_a:"Expected an operator and instead saw '{a}'.",expected_percent_a:"Expected a percentage and instead saw '{a}'",
expected_positive_a:"Expected a positive number and instead saw '{a}'",expected_pseudo_a:"Expected a pseudo, and instead saw :{a}.",expected_selector_a:"Expected a CSS selector, and instead saw {a}.",expected_small_a:"Expected a small number and instead saw '{a}'",expected_space_a_b:"Expected exactly one space between '{a}' and '{b}'.",expected_string_a:"Expected a string and instead saw {a}.",expected_style_attribute:"Excepted a style attribute, and instead saw '{a}'.",expected_style_pattern:"Expected a style pattern, and instead saw '{a}'.",
expected_tagname_a:"Expected a tagName, and instead saw {a}.",for_if:"The body of a for in should be wrapped in an if statement to filter unwanted properties from the prototype.",function_block:"Function statements should not be placed in blocks. Use a function expression or move the statement to the top of the outer function.",function_eval:"The Function constructor is eval.",function_loop:"Don't make functions within a loop.",function_statement:"Function statements are not invocable. Wrap the whole function invocation in parens.",
function_strict:"Use the function form of 'use strict'.",html_confusion_a:"HTML confusion in regular expression '<{a}'.",html_handlers:"Avoid HTML event handlers.",identifier_function:"Expected an identifier in an assignment and instead saw a function invocation.",implied_evil:"Implied eval is evil. Pass a function instead of a string.",infix_in:"Unexpected 'in'. Compare with undefined, or use the hasOwnProperty method instead.",insecure_a:"Insecure '{a}'.",isNaN:"Use the isNaN function to compare with NaN.",
label_a_b:"Label '{a}' on '{b}' statement.",lang:"lang is deprecated.",leading_decimal_a:"A leading decimal point can be confused with a dot: '.{a}'.",missing_a:"Missing '{a}'.",missing_a_after_b:"Missing '{a}' after '{b}'.",missing_option:"Missing option value.",missing_property:"Missing property name.",missing_space_a_b:"Missing space between '{a}' and '{b}'.",missing_url:"Missing url.",missing_use_strict:"Missing 'use strict' statement.",mixed:"Mixed spaces and tabs.",move_invocation:"Move the invocation into the parens that contain the function.",
move_var:"Move 'var' declarations to the top of the function.",name_function:"Missing name in function statement.",nested_comment:"Nested comment.",not:"Nested not.",not_a_constructor:"Do not use {a} as a constructor.",not_a_defined:"'{a}' has not been fully defined yet.",not_a_function:"'{a}' is not a function.",not_a_label:"'{a}' is not a label.",not_a_scope:"'{a}' is out of scope.",not_greater:"'{a}' should not be greater than '{b}'.",parameter_a_get_b:"Unexpected parameter '{a}' in get {b} function.",
parameter_set_a:"Expected parameter (value) in set {a} function.",radix:"Missing radix parameter.",read_only:"Read only.",redefinition_a:"Redefinition of '{a}'.",reserved_a:"Reserved name '{a}'.",scanned_a_b:"{a} ({b}% scanned).",slash_equal:"A regular expression literal can be confused with '/='.",statement_block:"Expected to see a statement and instead saw a block.",stopping:"Stopping. ",strange_loop:"Strange loop.",strict:"Strict violation.",subscript:"['{a}'] is better written in dot notation.",
tag_a_in_b:"A '<{a}>' must be within '<{b}>'.",too_long:"Line too long.",too_many:"Too many errors.",trailing_decimal_a:"A trailing decimal point can be confused with a dot: '.{a}'.",type:"type is unnecessary.",type_inconsistency_a_b:"Type inconsistency: {a} and {b}.",unclosed:"Unclosed string.",unclosed_comment:"Unclosed comment.",unclosed_regexp:"Unclosed regular expression.",unescaped_a:"Unescaped '{a}'.",unexpected_a:"Unexpected '{a}'.",unexpected_char_a_b:"Unexpected character '{a}' in {b}.",
unexpected_comment:"Unexpected comment.",unexpected_property_a:"Unexpected /*property*/ '{a}'.",unexpected_space_a_b:"Unexpected space between '{a}' and '{b}'.",unnecessary_initialize:"It is not necessary to initialize '{a}' to 'undefined'.",unnecessary_use:"Unnecessary 'use strict'.",unreachable_a_b:"Unreachable '{a}' after '{b}'.",unrecognized_style_attribute_a:"Unrecognized style attribute '{a}'.",unrecognized_tag_a:"Unrecognized tag '<{a}>'.",unsafe:"Unsafe character.",url:"JavaScript URL.",use_array:"Use the array literal notation [].",
use_braces:"Spaces are hard to count. Use {{a}}.",use_charAt:"Use the charAt method.",use_object:"Use the object literal notation {}.",use_or:"Use the || operator.",use_param:"Use a named parameter.",used_before_a:"'{a}' was used before it was defined.",var_a_not:"Variable {a} was not declared correctly.",weird_assignment:"Weird assignment.",weird_condition:"Weird condition.",weird_new:"Weird construction. Delete 'new'.",weird_program:"Weird program.",weird_relation:"Weird relation.",weird_ternary:"Weird ternary.",
wrap_immediate:"Wrap an immediate function invocation in parentheses to assist the reader in understanding that the expression is the result of a function, and not the function itself.",wrap_regexp:"Wrap the /regexp/ literal in parens to disambiguate the slash operator.",write_is_wrong:"document.write can be a form of eval."},Da,Va,kb,Mb={aliceblue:true,antiquewhite:true,aqua:true,aquamarine:true,azure:true,beige:true,bisque:true,black:true,blanchedalmond:true,blue:true,blueviolet:true,brown:true,
burlywood:true,cadetblue:true,chartreuse:true,chocolate:true,coral:true,cornflowerblue:true,cornsilk:true,crimson:true,cyan:true,darkblue:true,darkcyan:true,darkgoldenrod:true,darkgray:true,darkgreen:true,darkkhaki:true,darkmagenta:true,darkolivegreen:true,darkorange:true,darkorchid:true,darkred:true,darksalmon:true,darkseagreen:true,darkslateblue:true,darkslategray:true,darkturquoise:true,darkviolet:true,deeppink:true,deepskyblue:true,dimgray:true,dodgerblue:true,firebrick:true,floralwhite:true,
forestgreen:true,fuchsia:true,gainsboro:true,ghostwhite:true,gold:true,goldenrod:true,gray:true,green:true,greenyellow:true,honeydew:true,hotpink:true,indianred:true,indigo:true,ivory:true,khaki:true,lavender:true,lavenderblush:true,lawngreen:true,lemonchiffon:true,lightblue:true,lightcoral:true,lightcyan:true,lightgoldenrodyellow:true,lightgreen:true,lightpink:true,lightsalmon:true,lightseagreen:true,lightskyblue:true,lightslategray:true,lightsteelblue:true,lightyellow:true,lime:true,limegreen:true,
linen:true,magenta:true,maroon:true,mediumaquamarine:true,mediumblue:true,mediumorchid:true,mediumpurple:true,mediumseagreen:true,mediumslateblue:true,mediumspringgreen:true,mediumturquoise:true,mediumvioletred:true,midnightblue:true,mintcream:true,mistyrose:true,moccasin:true,navajowhite:true,navy:true,oldlace:true,olive:true,olivedrab:true,orange:true,orangered:true,orchid:true,palegoldenrod:true,palegreen:true,paleturquoise:true,palevioletred:true,papayawhip:true,peachpuff:true,peru:true,pink:true,
plum:true,powderblue:true,purple:true,red:true,rosybrown:true,royalblue:true,saddlebrown:true,salmon:true,sandybrown:true,seagreen:true,seashell:true,sienna:true,silver:true,skyblue:true,slateblue:true,slategray:true,snow:true,springgreen:true,steelblue:true,tan:true,teal:true,thistle:true,tomato:true,turquoise:true,violet:true,wheat:true,white:true,whitesmoke:true,yellow:true,yellowgreen:true,activeborder:true,activecaption:true,appworkspace:true,background:true,buttonface:true,buttonhighlight:true,
buttonshadow:true,buttontext:true,captiontext:true,graytext:true,highlight:true,highlighttext:true,inactiveborder:true,inactivecaption:true,inactivecaptiontext:true,infobackground:true,infotext:true,menu:true,menutext:true,scrollbar:true,threeddarkshadow:true,threedface:true,threedhighlight:true,threedlightshadow:true,threedshadow:true,window:true,windowframe:true,windowtext:true},ya,ob,vb={"%":true,cm:true,em:true,ex:true,"in":true,mm:true,pc:true,pt:true,px:true},Ab,Xa,Ob={b:"\u0008",t:"\t",n:"\n",
f:"\u000c",r:"\r",'"':'"',"/":"/","\\":"\\"},Fb={alert:false,confirm:false,console:false,Debug:false,opera:false,prompt:false},Db={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r","'":"\\'",'"':'\\"',"/":"\\/","\\":"\\\\"},q,Ka=["closure","exception","global","label","outer","undef","unused","var"],Ta,X,Aa,mb={a:{},abbr:{},acronym:{},address:{},applet:{},area:{empty:true,parent:" map "},article:{},aside:{},audio:{},b:{},base:{empty:true,parent:" head "},bdo:{},big:{},blockquote:{},body:{parent:" html noframes "},
br:{empty:true},button:{},canvas:{parent:" body p div th td "},caption:{parent:" table "},center:{},cite:{},code:{},col:{empty:true,parent:" table colgroup "},colgroup:{parent:" table "},command:{parent:" menu "},datalist:{},dd:{parent:" dl "},del:{},details:{},dialog:{},dfn:{},dir:{},div:{},dl:{},dt:{parent:" dl "},em:{},embed:{},fieldset:{},figure:{},font:{},footer:{},form:{},frame:{empty:true,parent:" frameset "},frameset:{parent:" html frameset "},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},head:{parent:" html "},
header:{},hgroup:{},hr:{empty:true},"hta:application":{empty:true,parent:" head "},html:{parent:"*"},i:{},iframe:{},img:{empty:true},input:{empty:true},ins:{},kbd:{},keygen:{},label:{},legend:{parent:" details fieldset figure "},li:{parent:" dir menu ol ul "},link:{empty:true,parent:" head "},map:{},mark:{},menu:{},meta:{empty:true,parent:" head noframes noscript "},meter:{},nav:{},noframes:{parent:" html body "},noscript:{parent:" body head noframes "},object:{},ol:{},optgroup:{parent:" select "},
option:{parent:" optgroup select "},output:{},p:{},param:{empty:true,parent:" applet object "},pre:{},progress:{},q:{},rp:{},rt:{},ruby:{},samp:{},script:{empty:true,parent:" body div frame head iframe p pre span "},section:{},select:{},small:{},span:{},source:{},strong:{},style:{parent:" head ",empty:true},sub:{},sup:{},table:{},tbody:{parent:" table "},td:{parent:" tr "},textarea:{},tfoot:{parent:" table "},th:{parent:" tr "},thead:{parent:" table "},time:{},title:{parent:" head "},tr:{parent:" table tbody thead tfoot "},
tt:{},u:{},ul:{},"var":{},video:{}},Ya,Fa,v,da,ma,Ca,za,Ba,ra,Ib={Buffer:false,clearInterval:false,clearTimeout:false,console:false,exports:false,global:false,module:false,process:false,querystring:false,require:false,setInterval:false,setTimeout:false,__dirname:false,__filename:false},La,Lb={indexOf:true,lastIndexOf:true,search:true},f,ta,k,Q,pb,U,ha,Pb={g:true,i:true,m:true},Eb={defineClass:false,deserialize:false,gc:false,help:false,load:false,loadClass:false,print:false,quit:false,readFile:false,
readUrl:false,runCommand:false,seal:false,serialize:false,spawn:false,sync:false,toint32:false,version:false},E,Kb={";":true,'"':true,"'":true,")":true},qb,O,Qb={Array:false,Boolean:false,Date:false,decodeURI:false,decodeURIComponent:false,encodeURI:false,encodeURIComponent:false,Error:false,eval:false,EvalError:false,Function:false,isFinite:false,isNaN:false,JSON:false,Math:false,Number:false,Object:false,parseInt:false,parseFloat:false,RangeError:false,ReferenceError:false,RegExp:false,String:false,
SyntaxError:false,TypeError:false,URIError:false},Rb={E:true,LN2:true,LN10:true,LOG2E:true,LOG10E:true,MAX_VALUE:true,MIN_VALUE:true,NEGATIVE_INFINITY:true,PI:true,POSITIVE_INFINITY:true,SQRT1_2:true,SQRT2:true},na,Y={},Za,n,Ha,ea,Ma,Jb={alert:true,animator:true,appleScript:true,beep:true,bytesToUIString:true,Canvas:true,chooseColor:true,chooseFile:true,chooseFolder:true,closeWidget:true,COM:true,convertPathToHFS:true,convertPathToPlatform:true,CustomAnimation:true,escape:true,FadeAnimation:true,
filesystem:true,Flash:true,focusWidget:true,form:true,FormField:true,Frame:true,HotKey:true,Image:true,include:true,isApplicationRunning:true,iTunes:true,konfabulatorVersion:true,log:true,md5:true,MenuItem:true,MoveAnimation:true,openURL:true,play:true,Point:true,popupMenu:true,preferenceGroups:true,preferences:true,print:true,prompt:true,random:true,Rectangle:true,reloadWidget:true,ResizeAnimation:true,resolvePath:true,resumeUpdates:true,RotateAnimation:true,runCommand:true,runCommandInBg:true,saveAs:true,
savePreferences:true,screen:true,ScrollBar:true,showWidgetPreferences:true,sleep:true,speak:true,Style:true,suppressUpdates:true,system:true,tellWidget:true,Text:true,TextArea:true,Timer:true,unescape:true,updateNow:true,URL:true,Web:true,widget:true,Window:true,XMLDOM:true,XMLHttpRequest:true,yahooCheckLogin:true,yahooLogin:true,yahooLogout:true},Hb={ActiveXObject:false,CScript:false,Debug:false,Enumerator:false,System:false,VBArray:false,WScript:false},t,T,Sb=/@cc|<\/?|script|\]\s*\]|<\s*!|&lt/i,
Tb=/\r/g,Ub=/\r\n/g,Vb=/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,Wb=/[\[\]\/\\"'*<>.&:(){}+=#]/,Bb=/^\s*(['"=>\/&#]|<(?:\/|\!(?:--)?)?|[a-zA-Z][a-zA-Z0-9_\-:]*|[0-9]+|--)/,Cb=/^([a-zA-Z_$][a-zA-Z0-9_$]*)$/,eb=/^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i,Xb=/\*\/|\/\*/,ub=/[\u0000-\u001f'\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
Yb=/[>&]|<[\/!]?|--/,Zb=/[^a-zA-Z0-9+\-_\/ ]/,$b=/^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jslint|properties|property|members?|globals?)?|=|\/)?|\*[\/=]?|\+(?:=|\++)?|-(?:=|-+)?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/,wb=/&|\+|\u00AD|\.\.|\/\*|%[^;]|base64|url|expression|data|mailto/i,ac={outer:Bb,html:Bb,style:/^\s*([{:#%.=,>+\[\]@()"';]|\*=?|\$=|\|=|\^=|~=|[a-zA-Z_][a-zA-Z0-9_\-]*|[0-9]+|<\/|\/\*)/,
styleproperty:/^\s*([@#!"'};:\-%.=,+\[\]()*_]|[a-zA-Z][a-zA-Z0-9._\-]*|\/\*?|\d+(?:\.\d+)?|<\/)/};if(typeof Array.prototype.filter!=="function")Array.prototype.filter=function(a){var b,c=this.length,d=[],g;for(b=0;b<c;b=b+1)try{g=this[b];a(g)&&d.push(g)}catch(f){}return d};if(typeof Array.prototype.forEach!=="function")Array.prototype.forEach=function(a){var b,c=this.length;for(b=0;b<c;b=b+1)try{a(this[b])}catch(d){}return[]};if(typeof Array.isArray!=="function")Array.isArray=function(a){return Object.prototype.toString.apply(a)===
"[object Array]"};if(!Object.prototype.hasOwnProperty.call(Object,"create"))Object.create=function(a){b.prototype=a;return new b};if(typeof Object.keys!=="function")Object.keys=function(a){var b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b};if(typeof String.prototype.entityify!=="function")String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};if(typeof String.prototype.isAlpha!=="function")String.prototype.isAlpha=
function(){return this>="a"&&this<="z\uffff"||this>="A"&&this<="Z\uffff"};if(typeof String.prototype.isDigit!=="function")String.prototype.isDigit=function(){return this>="0"&&this<="9"};if(typeof String.prototype.supplant!=="function")String.prototype.supplant=function(a){return this.replace(/\{([^{}]*)\}/g,function(b,c){var d=a[c];return typeof d==="string"||typeof d==="number"?d:b})};Ca=function(){function a(b,c,d,e){c={comment:b,quote:c,at:e,line:d};Da||qb||t&&t!=="script"&&t!=="style"&&t!=="styleproperty"?
j("unexpected_comment",d,f):t==="script"&&/<\//i.test(l)?j("unexpected_a",d,f,"</"):k.safe&&Sb.test(b)&&j("dangerous_comment",d,e);ta.comments?ta.comments.push(c):ta.comments=[c];JAYLINT.comments.push(c)}function b(){var a;if(h>=za.length)return false;f=1;l=za[h];h=h+1;a=l.search(/ \t/);a>=0&&j("mixed",h,a+1);l=l.replace(/\t/g,Za);a=l.search(Vb);a>=0&&j("unsafe",h,a);k.maxlen&&k.maxlen<l.length&&j("too_long",h,l.length);return true}function c(a,b,d){var e;(a==="(string)"||a==="(range)")&&eb.test(b)&&
j("url",h,i);e=Object.create(Y[a==="(punctuator)"||a==="(identifier)"&&Object.prototype.hasOwnProperty.call(Y,b)?b:a]||Y["(error)"]);if(a==="(identifier)"){e.identifier=true;b==="__iterator__"||b==="__proto__"?r("reserved_a",h,i,b):!k.nomen&&(b.charAt(0)==="_"||b.charAt(b.length-1)==="_")&&j("dangling_a",h,i,b)}if(b!==void 0)e.value=b;if(d)e.quote=d;e.line=h;e.from=i;e.thru=f;e.prev=ta;pb=(a=e.id)&&("(,=:[!&|?{};".indexOf(a.charAt(a.length-1))>=0||a==="return");return ta=ta.next=e}function d(a){function e(a){var b=
parseInt(l.substr(p+1,a),16);p=p+a;b>=32&&b<=126&&b!==34&&b!==92&&b!==39&&j("unexpected_a",h,f,"\\");f=f+a;g=String.fromCharCode(b)}var g,p,m="";ma&&a!=='"'&&j("expected_a",h,f,'"');if(T===a||t==="scriptstring"&&!T)return c("(punctuator)",a);for(p=0;;){for(;p>=l.length;){p=0;(t!=="html"||!b())&&r("unclosed",h,i)}g=l.charAt(p);if(g===a){f=f+1;l=l.slice(p+1);return c("(string)",m,a)}if(g<" "){if(g==="\n"||g==="\r")break;j("control_a",h,f+o,l.slice(0,o))}else if(g===T)j("bad_html",h,f+p);else if(g===
"<")k.safe&&t==="html"?j("adsafe_a",h,f+o,g):l.charAt(o+1)==="/"&&(t||k.safe)?j("expected_a_b",h,f,"<\\/","</"):l.charAt(o+1)==="!"&&(t||k.safe)&&j("unexpected_a",h,f,"<!");else if(g==="\\")if(t==="html")k.safe&&j("adsafe_a",h,f+o,g);else if(t==="styleproperty"){p=p+1;f=f+1;g=l.charAt(p);g!==a&&j("unexpected_a",h,f,"\\")}else{p=p+1;f=f+1;g=l.charAt(p);switch(g){case "":k.es5||j("es5",h,f);b();p=-1;break;case T:j("bad_html",h,f+p);break;case "'":ma&&j("unexpected_a",h,f,"\\'");break;case "u":e(4);
break;case "v":ma&&j("unexpected_a",h,f,"\\v");g="\v";break;case "x":ma&&j("unexpected_a",h,f,"\\x");e(2);break;default:g=Ob[g];typeof g!=="string"&&j("unexpected_a",h,f,"\\")}}m=m+g;f=f+1;p=p+1}}function g(){for(var a,b,d=0,p=0;;){a=true;e=l.charAt(p);p=p+1;switch(e){case "":r("unclosed_regexp",h,i);return;case "/":d>0&&j("unescaped_a",h,i+p,"/");e=l.slice(0,p-1);for(d=Object.create(Pb);d[l.charAt(p)]===true;){d[l.charAt(p)]=false;p=p+1}l.charAt(p).isAlpha()&&r("unexpected_a",h,i,l.charAt(p));f=
f+p;l=l.slice(p);p=l.charAt(0);(p==="/"||p==="*")&&r("confusing_regexp",h,i);return c("(regexp)",e);case "\\":e=l.charAt(p);e<" "?j("control_a",h,i+p,""+e):e==="<"&&j(H.unexpected_a,h,i+p,"\\");p=p+1;break;case "(":d=d+1;a=false;if(l.charAt(p)==="?"){p=p+1;switch(l.charAt(p)){case ":":case "=":case "!":p=p+1;break;default:j(H.expected_a_b,h,i+p,":",l.charAt(p))}}break;case "|":a=false;break;case ")":d===0?j("unescaped_a",h,i+p,")"):d=d-1;break;case " ":for(o=1;l.charAt(p)===" ";){p=p+1;o=o+1}o>1&&
j("use_braces",h,i+p,o);break;case "[":e=l.charAt(p);if(e==="^"){p=p+1;k.regexp?l.charAt(p)==="]"&&r("unescaped_a",h,i+p,"^"):j("insecure_a",h,i+p,e)}b=false;if(e==="]"){j("empty_class",h,i+p-1);b=true}a:do{e=l.charAt(p);p=p+1;switch(e){case "[":case "^":j("unescaped_a",h,i+p,e);b=true;break;case "-":if(b)b=false;else{j("unescaped_a",h,i+p,"-");b=true}break;case "]":b||j("unescaped_a",h,i+p-1,"-");break a;case "\\":e=l.charAt(p);e<" "?j(H.control_a,h,i+p,""+e):e==="<"&&j(H.unexpected_a,h,i+p,"\\");
p=p+1;b=true;break;case "/":j("unescaped_a",h,i+p-1,"/");b=true;break;case "<":if(t==="script"){e=l.charAt(p);(e==="!"||e==="/")&&j(H.html_confusion_a,h,i+p,e)}b=true;break;default:b=true}}while(e);break;case ".":k.regexp||j("insecure_a",h,i+p,e);break;case "]":case "?":case "{":case "}":case "+":case "*":j("unescaped_a",h,i+p,e);break;case "<":if(t==="script"){e=l.charAt(p);(e==="!"||e==="/")&&j(H.html_confusion_a,h,i+p,e)}}if(a)switch(l.charAt(p)){case "?":case "+":case "*":p=p+1;l.charAt(p)===
"?"&&(p=p+1);break;case "{":p=p+1;e=l.charAt(p);(e<"0"||e>"9")&&j(H.expected_number_a,h,i+p,e);p=p+1;for(b=+e;;){e=l.charAt(p);if(e<"0"||e>"9")break;p=p+1;b=+e+b*10}a=b;if(e===","){p=p+1;a=Infinity;e=l.charAt(p);if(e>="0"&&e<="9"){p=p+1;for(a=+e;;){e=l.charAt(p);if(e<"0"||e>"9")break;p=p+1;a=+e+a*10}}}l.charAt(p)!=="}"?j(H.expected_a_b,h,i+p,"}",e):p=p+1;l.charAt(p)==="?"&&(p=p+1);b>a&&j(H.not_greater,h,i+p,b,a)}}e=l.slice(0,p-1);f=f+p;l=l.slice(p);return c("(regexp)",e)}var f,e,i,m,h,o,l;return{init:function(a){za=
typeof a==="string"?a.replace(Ub,"\n").replace(Tb,"\n").split("\n"):a;h=0;b();i=1},range:function(a,b){var d,e="";i=f;for(l.charAt(0)!==a&&r("expected_a_b",h,f,a,l.charAt(0));;){l=l.slice(1);f=f+1;d=l.charAt(0);switch(d){case "":r("missing_a",h,f,d);break;case b:l=l.slice(1);f=f+1;return c("(range)",e);case T:case "\\":j("unexpected_a",h,f,d)}e=e+d}},token:function(){for(var o,k,s;;){for(;!l;)if(!b())return c("(end)");for(;t==="outer";){k=l.search(Yb);if(k===0)break;else if(k>0){f=f+1;l=l.slice(k);
break}else if(!b())return c("(end)","")}o=(ac[t]||$b).exec(l);s=void 0;if(o){m=o[0].length;s=o[1];e=s.charAt(0);l=l.slice(m);i=f+m-s.length;f=f+m}else s=void 0;if(s){o=s.charAt(0);if(o.isAlpha()||o==="_"||o==="$")return c("(identifier)",s);if(o.isDigit()){k=s;o=void 0;t!=="style"&&t!=="styleproperty"&&l.charAt(0).isAlpha()&&j("expected_space_a_b",h,f,e,l.charAt(0));if(e==="0"){o=k.charAt(1);o.isDigit()?n.id!=="."&&t!=="styleproperty"&&j("unexpected_a",h,f,k):ma&&(o==="x"||o==="X")&&j("unexpected_a",
h,f,"0x")}k.slice(k.length-1)==="."&&j("trailing_decimal_a",h,f,k);if(t!=="style"){o=+k;isFinite(o)||j("bad_number",h,f,k);k=o}return c("(number)",k)}switch(s){case '"':case "'":return d(s);case "//":a(l,"//",h,f);l="";break;case "/*":for(o="/*";;){k=l.search(Xb);if(k>=0)break;a(l,o,h,f);o="";b()||r("unclosed_comment",h,f)}a(l.slice(0,k),o,f,h);f=f+(k+2);l.charAt(k)==="/"&&r("nested_comment",h,f);l=l.slice(k+2);break;case "":break;case "/":n.id==="/="&&r(H.slash_equal,h,i);return pb?g():c("(punctuator)",
s);case "<\!--":for(m=h;;){k=l.indexOf("--");if(k>=0)break;k=l.indexOf("<!");k>=0&&r("nested_comment",h,f+k);b()||r("unclosed_comment",m,o)}m=l.indexOf("<!");m>=0&&m<k&&r("nested_comment",h,f+m);f=f+k;l.charAt(k+2)!==">"&&r("expected_a",h,f,"--\>");f=f+3;l=l.slice(k+3);break;case "#":if(t==="html"||t==="styleproperty"){for(;;){o=l.charAt(0);if((o<"0"||o>"9")&&(o<"a"||o>"f")&&(o<"A"||o>"F"))break;f=f+1;l=l.slice(1);s=s+o}s.length!==4&&s.length!==7&&j("bad_color_a",h,i+m,s);return c("(color)",s)}return c("(punctuator)",
s);default:if(t==="outer"&&o==="&"){f=f+1;for(l=l.slice(1);;){o=l.charAt(0);f=f+1;l=l.slice(1);if(o===";")break;o>="0"&&o<="9"||o>="a"&&o<="z"||o==="#"||r("bad_entity",h,i+m,f)}break}return c("(punctuator)",s)}}else{for(;l&&l<"!";)l=l.slice(1);if(l){if(t==="html")return c("(error)",l.charAt(0));r("unexpected_a",h,f,l.charAt(0))}}}}}}();Y["(identifier)"]={lbp:0,identifier:true,nud:function(){var a=this.value,b=E[a];if(typeof b!=="object"){b=Q[a];if(typeof b==="boolean"){Aa[a]=b={value:a,writeable:b,
funct:X};X[a]="var"}else{k.undef||g("used_before_a",n);E[a]=b={value:a,writeable:true,funct:q};q[a]="undef"}}b=b.funct;if(q===b)switch(q[a]){case "becoming":g("unexpected_a",n);q[a]="var";break;case "unused":q[a]="var";break;case "unparam":q[a]="parameter";break;case "unction":q[a]="function";break;case "label":g("a_label",n,a)}else switch(q[a]){case "closure":case "function":case "var":case "unused":g("a_scope",n,a);break;case "label":g("a_label",n,a);break;case "outer":case "global":break;default:switch(b[a]){case "function":case "unction":case "var":case "unused":case "becoming":case "closure":case "parameter":b[a]=
"closure";q[a]=b===X?"global":"outer";break;case "unparam":b[a]="parameter";q[a]="outer";break;case "undef":q[a]="undef";break;case "label":g("a_label",n,a)}}return this},led:function(){m("expected_operator_a")}};ia("(array)","array");ia("(color)","color");ia("(function)","function");ia("(number)","number",a);ia("(object)","object");ia("(string)","string",a);ia("(boolean)","boolean",a);ia("(range)","range");ia("(regexp)","regexp",a);ab("(begin)");ab("(end)");ab("(error)");oa(M("</"));M("<!");M("<\!--");
M("--\>");oa(M("}"));M(")");M("]");oa(M('"'));oa(M("'"));M(";");M(":");M(",");M("#");M("@");M("*/");oa(F("case"));F("catch");oa(F("default"));F("else");F("finally");cb("arguments",function(a){na&&q===X?g("strict",a):k.safe&&g("adsafe",a)});cb("eval",function(a){k.safe&&g("adsafe",a)});va("false","boolean",false);va("Infinity","number",Infinity);va("NaN","number",NaN);va("null","",null);cb("this",function(a){na&&(q["(statement)"]&&q["(name)"].charAt(0)>"Z"||q===X)?g("strict",a):k.safe&&g("adsafe",
a)});va("true","boolean",true);va("undefined","",void 0);N("?",30,function(a,b){b.first=ba(aa(a));b.second=w(0);J();var c=f;h(":");l();J();b.third=w(10);b.arity="ternary";b.type=L(b.second,b.third);S(b.second,b.third)?g("weird_ternary",c):S(b.first,b.second)&&g("use_or",b);return b});N("||",40,function(a,b){function c(a){a.id==="&&"&&!a.paren&&g("and",a);return a}b.first=c(ba(aa(a)));b.second=c(aa(w(40)));S(b.first,b.second)&&g("weird_condition",b);return b});N("&&",50,function(a,b){b.first=ba(aa(a));
b.second=aa(w(50));S(b.first,b.second)&&g("weird_condition",b);return b});P("void",function(){this.first=w(0);if(this.first.id!=="(number)"||this.first.value){g("unexpected_a",this);return this}this.type="undefined";return this});wa("|",70);wa("^",80);wa("&",90);ka("==","===");ka("===");ka("!=","!==");ka("!==");ka("<");ka(">");ka("<=");ka(">=");wa("<<",120);wa(">>",120);wa(">>>",120);N("in",120,function(a,b){g("infix_in",b);b.left=a;b.right=w(130);return b},"boolean");N("instanceof",120,null,"boolean");
N("+",130,function(a,b){a.value||(a.id==="(number)"?g("unexpected_a",a):a.id==="(string)"&&g("expected_a_b",a,"String","''"));var c=w(130);c.value||(c.id==="(number)"?g("unexpected_a",c):c.id==="(string)"&&g("expected_a_b",c,"String","''"));if(a.id===c.id&&(a.id==="(string)"||a.id==="(number)")){a.value=a.value+c.value;a.thru=c.thru;a.id==="(string)"&&eb.test(a.value)&&g("url",a);l(c);l(b);return a}b.first=a;b.second=c;b.type=L(a,c,b);return b});P("+","num");P("+++",function(){g("confusing_a",n);
this.first=w(150);this.arity="prefix";return this});N("+++",130,function(a){g("confusing_a",n);this.first=a;this.second=w(130);return this});N("-",130,function(a,b){(a.id==="(number)"&&a.value===0||a.id==="(string)")&&g("unexpected_a",a);var c=w(130);(c.id==="(number)"&&c.value===0||c.id==="(string)")&&g("unexpected_a",a);if(a.id===c.id&&a.id==="(number)"){a.value=a.value-c.value;a.thru=c.thru;l(c);l(b);return a}b.first=a;b.second=c;return b},"number");P("-");P("---",function(){g("confusing_a",n);
this.first=w(150);this.arity="prefix";return this});N("---",130,function(a){g("confusing_a",n);this.first=a;this.second=w(130);return this});N("*",140,function(a,b){(a.id==="(number)"&&(a.value===0||a.value===1)||a.id==="(string)")&&g("unexpected_a",a);var c=w(140);(c.id==="(number)"&&(c.value===0||c.value===1)||c.id==="(string)")&&g("unexpected_a",c);if(a.id===c.id&&a.id==="(number)"){a.value=a.value*c.value;a.thru=c.thru;l(c);l(b);return a}b.first=a;b.second=c;return b},"number");N("/",140,function(a,
b){(a.id==="(number)"&&a.value===0||a.id==="(string)")&&g("unexpected_a",a);var c=w(140);(c.id==="(number)"&&(c.value===0||c.value===1)||c.id==="(string)")&&g("unexpected_a",c);if(a.id===c.id&&a.id==="(number)"){a.value=a.value/c.value;a.thru=c.thru;l(c);l(b);return a}b.first=a;b.second=c;return b},"number");N("%",140,function(a,b){(a.id==="(number)"&&(a.value===0||a.value===1)||a.id==="(string)")&&g("unexpected_a",a);var c=w(140);(c.id==="(number)"&&c.value===0||c.id==="(string)")&&g("unexpected_a",
c);if(a.id===c.id&&a.id==="(number)"){a.value=a.value%c.value;a.thru=c.thru;l(c);l(b);return a}b.first=a;b.second=c;return b},"number");tb("++");P("++");tb("--");P("--");P("delete",function(){y();var a=w(0);(!a||a.id!=="."&&a.id!=="[")&&g("deleted");this.first=a;return this});P("~",function(){B();k.bitwise||g("unexpected_a",this);w(150);return this},"number");P("!",function(){B();this.first=ba(w(150));this.arity="prefix";Nb[this.first.id]===true&&g("confusing_a",this);return this},"boolean");P("typeof",
null,"string");P("new",function(){y();var a=w(160),b;this.first=a;if(a.id!=="function")if(a.identifier)switch(a.value){case "Object":g("use_object",n);break;case "Array":if(f.id==="("){b=f;b.first=this;h("(");if(f.id!==")"){b.second=w(0);if(b.second.id!=="(string)"||!b.second.value){ba(b.second,H.use_array);a=false}else a=true;for(;f.id!==")"&&f.id!=="(end)";){if(a){g("use_array",b);a=false}h()}}else g("use_array",n);h(")",b);l();return b}g("use_array",n);break;case "Number":case "String":case "Boolean":case "Math":case "JSON":g("not_a_constructor",
a);break;case "Function":k.evil||g("function_eval");break;case "Date":case "RegExp":break;default:if(a.id!=="function"){a=a.value.charAt(0);!k.newcap&&(a<"A"||a>"Z")&&g("constructor_name_a",n)}}else a.id!=="."&&a.id!=="["&&a.id!=="("&&g("bad_constructor",n);else g("weird_new",this);f.id!=="("&&g("missing_a",f,"()");return this});N("(",160,function(a,b){v&&v.mode==="expression"?u(U,n):B(U,n);!a.immed&&a.id==="function"&&g("wrap_immediate");var c=[];if(a){L("function",a);a.identifier?a.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/)&&
a.value!=="Number"&&a.value!=="String"&&a.value!=="Boolean"&&a.value!=="Date"&&(a.value==="Math"||a.value==="JSON"?g("not_a_function",a):a.value==="Object"?g("use_object",n):(a.value==="Array"||!k.newcap)&&g("missing_a",a,"new")):a.id==="."&&(k.safe&&a.first.value==="Math"&&a.second==="random"?g("adsafe",a):a.second.value==="split"&&a.first.id==="(string)"&&g("use_array",a.second))}K();if(f.id!==")")for(u();;){x();c.push(w(10));if(f.id!==",")break;G()}u();A(")",b);if(typeof a==="object"){a.value===
"parseInt"&&c.length===1&&g("radix",a);k.evil||(a.value==="eval"||a.value==="Function"||a.value==="execScript"?g("evil",a):c[0]&&c[0].id==="(string)"&&(a.value==="setTimeout"||a.value==="setInterval")&&g("implied_evil",a));!a.identifier&&a.id!=="."&&a.id!=="["&&a.id!=="("&&a.id!=="&&"&&a.id!=="||"&&a.id!=="?"&&g("bad_invocation",a)}b.first=a;b.second=c;if(!k.type)if(a.id===".")if(a.second.value==="charAt"||a.second.value==="substring"){L("string",b);L("string",a.first);c.forEach(function(a){L("number",
a)})}else(a.second.value==="toString"||a.second.value==="stringify")&&L("string",b);else a.identifier&&a.value==="String"&&L("string",b);return b},"",true);P("(",function(){K("expression");l();u();x();if(f.id==="function")f.immed=true;var a=w(0);a.paren=true;u();A(")",this);l();a.id==="function"&&(f.id==="("?g("move_invocation"):g("bad_wrap",this));return a});N(".",170,function(a,b){u(U,n);u();var c=pa();typeof c==="string"&&Ra(c);b.first=a;b.second=n;if(a&&a.value==="arguments"&&(c==="callee"||c===
"caller"))g("avoid_a",a,"arguments."+c);else if(!k.evil&&a&&a.value==="document"&&(c==="write"||c==="writeln"))g("write_is_wrong",a);else if(k.adsafe){if(!Ja&&a.value==="ADSAFE")if(c==="id"||c==="lib")g("adsafe",b);else if(c==="go"){t!=="script"?g("adsafe",b):(la||f.id!=="("||s(0).id!=="(string)"||s(0).value!==W||s(1).id!==",")&&m("adsafe_a",b,"go");la=true;Ia=false}Ja=false}if(!k.evil&&(c==="eval"||c==="execScript"))g("evil");else if(k.safe)for(;;){Qa[c]===true&&g("adsafe_a",n,c);if(typeof Q[a.value]!==
"boolean"||f.id==="(")break;if(Rb[c]===true){f.id==="."&&g("adsafe",b);break}if(f.id!=="."){g("adsafe",b);break}h(".");n.first=b;n.second=c;b=n;c=pa();typeof c==="string"&&Ra(c)}c==="length"&&L("number",b);return b},"",true);N("[",170,function(a,b){var c=bb(a),d;B(U,n);u();K();x();d=w(0);switch(bb(d)){case "number":d.id==="(number)"&&a.id==="arguments"&&g("use_param",a);c||L("array",a);break;case "string":if(d.id==="(string)"){if(k.safe&&(Qa[d.value]||d.value.charAt(0)==="_"||d.value.slice(-1)===
"_"))g("adsafe_subscript_a",d);else if(!k.evil&&(d.value==="eval"||d.value==="execScript"))g("evil",d);else if(!k.sub&&Cb.test(d.value)){c=Y[d.value];(!c||!c.reserved)&&g("subscript",d)}Ra(d.value)}else k.safe&&d.id!=="typeof"&&g("adsafe_subscript_a",d);L("object",a);break;case void 0:switch(bb(a)){case "array":L("number",d);break;case "object":L("string",d);break;case "string":k.type||g("use_charAt",b);b.type="string"}k.safe&&g("adsafe_subscript_a",d);break;default:k.safe?g("adsafe_subscript_a",
d):g("bad_type")}A("]",b);l();u(U,n);b.first=a;b.second=d;return b},"",true);P("[",function(){this.arity="prefix";this.first=[];this.type="array";for(K("array");f.id!=="(end)";){for(;f.id===",";){g("unexpected_a",f);h(",");l()}if(f.id==="]")break;v.wrap=false;x();this.first.push(w(10));if(f.id===","){G();if(f.id==="]"&&!k.es5){g("unexpected_a",n);break}}else break}A("]",this);l();return this},170);Z("=");Z("+=","+");Z("-=","-");Z("*=","*");Z("/=","/").nud=function(){m("slash_equal")};Z("%=","%");
Z("&=","&");Z("|=","|");Z("^=","^");Z("<<=","<<");Z(">>=",">>");Z(">>>=",">>>");P("{",function(){var a,b,c,d,e,j={};this.arity="prefix";this.first=[];this.type="object";for(K();f.id!=="}";){v.wrap=false;x();if(f.value==="get"&&s().id!==":"){k.es5||g("es5");a=f;h("get");ua();d=f;(b=fb())||m("missing_property");a.value="";Sa(a);q["(loopage)"]&&g("function_loop",a);(c=a.first)&&g("parameter_a_get_b",c[0],c[0].value,b);G();e=f;e.value="";J();x();h("set");ua();c=fb();b!==c&&m("expected_a_b",n,b,c||f.value);
Sa(e);c=e.first;!c||c.length!==1?m("parameter_set_a",e,"value"):c[0].value!=="value"&&m("expected_a_b",c[0],"value",c[0].value);d.first=[a,e]}else{d=f;b=fb();typeof b!=="string"&&m("missing_property");h(":");l();J();d.first=w(10)}this.first.push(d);j[b]===true&&g("duplicate_a",f,b);j[b]=true;Ra(b);if(f.id!==",")break;for(;;){G();if(f.id!==",")break;g("unexpected_a",f)}f.id==="}"&&!k.es5&&g("unexpected_a",n)}A("}",this);l();return this});R("{",function(){l();g("statement_block");this.arity="statement";
this.block=qa();this.disrupt=this.block.disrupt;h("}",this);l();return this});R("/*global",ga);R("/*globals",ga);R("/*jslint",ga);R("/*member",ga);R("/*members",ga);R("/*property",ga);R("/*properties",ga);R("var",function(){var a,b,c;q["(vars)"]&&!k.vars?g("combine_var"):q!==X&&(q["(vars)"]=true);this.arity="statement";this.first=[];for(K("var");;){c=f;b=pa();C(c,"becoming");if(f.id==="="){a=f;a.first=c;J();h("=");J();f.id==="undefined"&&g("unnecessary_initialize",n,b);s(0).id==="="&&f.identifier&&
m("var_a_not");a.second=w(0);a.arity="infix";this.first.push(a);if(a.second.type)c.type=a.second.type}else this.first.push(c);q[b]==="becoming"&&(q[b]="unused");if(f.id!==",")break;G();v.wrap=false;if(ea&&f.line===n.line&&this.first.length===1){ea=null;v.open=false;v.at=v.at-k.indent}J();x()}ea=null;A();return this});R("function",function(){y();Fa&&g("function_block",n);var a=f,b=pa();C(a,"unction");u();Sa(this,b);f.id==="("&&f.line===n.line&&m("function_statement");this.arity="statement";return this});
P("function",function(){y();var a=pa();a?u():a="";Sa(this,a);q["(loopage)"]&&g("function_loop");this.arity="function";return this});R("if",function(){var a=f;y();h("(");K("control");l();u();x();this.arity="statement";this.first=ba(aa(w(0)));u();A(")",a);l();y();this.block=ca(true);if(f.id==="else"){y();h("else");l();y();this["else"]=f.id==="if"||f.id==="switch"?db(true):ca(true);if(this["else"].disrupt&&this.block.disrupt)this.disrupt=true}return this});R("try",function(){var a,b,c;k.adsafe&&g("adsafe_a",
this);y();this.arity="statement";this.block=ca(false);if(f.id==="catch"){y();h("catch");l();y();c=f;h("(");K("control");l();u();x();b=E;E=Object.create(b);this.first=a=f.value;f.identifier?C(f,"exception"):g("expected_identifier_a",f);h();u();A(")",c);l();y();this.second=ca(false);E=b}if(f.id==="finally"){l();y();h("finally");l();y();this.third=ca(false)}else this.second||m("expected_a_b",f,"catch",f.value);return this});Oa("while",function(){y();var a=f;q["(breakage)"]=q["(breakage)"]+1;q["(loopage)"]=
q["(loopage)"]+1;h("(");K("control");l();u();x();this.arity="statement";this.first=aa(w(0));this.first.id!=="true"&&ba(this.first,H.unexpected_a);u();A(")",a);l();y();this.block=ca(true);this.block.disrupt&&g("strange_loop",U);q["(breakage)"]=q["(breakage)"]-1;q["(loopage)"]=q["(loopage)"]-1;return this});F("with");Oa("switch",function(){var a,b=f,c=true;q["(breakage)"]=q["(breakage)"]+1;y();h("(");l();u();K();this.arity="statement";this.first=ba(aa(w(0)));u();A(")",b);l();y();h("{");K();for(this.second=
[];f.id==="case";){b=f;b.first=[];b.arity="case";J();x("case");for(h("case");;){y();a=w(0);b.first.push(a);a.id==="NaN"&&g("unexpected_a",a);B();h(":");l();if(f.id!=="case")break;J();x("case");h("case");l()}J();b.second=qa();if(b.second&&b.second.length>0){a=b.second[b.second.length-1];a.disrupt?a.id==="break"&&(c=false):g("missing_a_after_b",f,"break","case")}else g("empty_case");this.second.push(b)}this.second.length===0&&g("missing_a",f,"case");if(f.id==="default"){J();b=f;b.arity="case";x("case");
h("default");l();B();h(":");l();J();b.second=qa();if(b.second&&b.second.length>0){a=b.second[b.second.length-1];if(c&&a.disrupt&&a.id!=="break")this.disrupt=true}this.second.push(b)}q["(breakage)"]=q["(breakage)"]-1;J();A("}",this);return this});R("debugger",function(){k.debug||g("unexpected_a",this);this.arity="statement";return this});Oa("do",function(){q["(breakage)"]=q["(breakage)"]+1;q["(loopage)"]=q["(loopage)"]+1;y();this.arity="statement";this.block=ca(true);this.block.disrupt&&g("strange_loop",
U);y();h("while");l();var a=f;y();h("(");K();l();u();x();this.first=ba(aa(w(0)),H.unexpected_a);u();A(")",a);l();q["(breakage)"]=q["(breakage)"]-1;q["(loopage)"]=q["(loopage)"]-1;return this});Oa("for",function(){var a,b,c=false;a=f;var d;this.arity="statement";q["(breakage)"]=q["(breakage)"]+1;q["(loopage)"]=q["(loopage)"]+1;h("(");K("control");l();J(this,a);u();f.id==="var"&&m("move_var");x();if(s(0).id==="in"){b=f;switch(q[b.value]){case "unused":q[b.value]="var";break;case "closure":case "var":break;
default:g("bad_in_a",b)}L("string",b);h();d=f;h("in");d.first=b;d.second=w(20);L("object",d.second);A(")",a);l();this.first=d;a=ca(true);if(!k.forin){if(a.length===1&&typeof a[0]==="object"&&a[0].value==="if"&&!a[0]["else"]){for(b=a[0].first;b.id==="&&";)b=b.first;switch(b.id){case "===":case "!==":c=b.first.id==="["?b.first.first.value===d.second.value&&b.first.second.value===d.first.value:b.first.id==="typeof"&&b.first.first.id==="["&&b.first.first.first.value===d.second.value&&b.first.first.second.value===
d.first.value;break;case "(":c=b.first.id==="."&&(b.first.first.value===d.second.value&&b.first.second.value==="hasOwnProperty"&&b.second[0].value===d.first.value||b.first.first.value==="ADSAFE"&&b.first.second.value==="has"&&b.second[0].value===d.second.value&&b.second[1].value===d.first.value||b.first.first.id==="."&&b.first.first.first.id==="."&&b.first.first.first.first.value==="Object"&&b.first.first.first.second.value==="prototype"&&b.first.first.second.value==="hasOwnProperty"&&b.first.second.value===
"call"&&b.second[0].value===d.second.value&&b.second[1].value===d.first.value)}}c||g("for_if",this)}}else{if(f.id!==";"){x();for(this.first=[];;){this.first.push(w(0,"for"));if(f.id!==",")break;G()}}V();if(f.id!==";"){x();this.second=aa(w(0));this.second.id!=="true"&&ba(this.second,H.unexpected_a)}V(n);f.id===";"&&m("expected_a_b",f,")",";");if(f.id!==")"){this.third=[];for(x();;){this.third.push(w(0,"for"));if(f.id!==",")break;G()}}u();A(")",a);l();y();a=ca(true)}a.disrupt&&g("strange_loop",U);this.block=
a;q["(breakage)"]=q["(breakage)"]-1;q["(loopage)"]=q["(loopage)"]-1;return this});Pa("break",function(){var a=f.value;this.arity="statement";q["(breakage)"]===0&&g("unexpected_a",this);if(f.identifier&&n.line===f.line){ua();q[a]!=="label"?g("not_a_label",f):E[a].funct!==q&&g("not_a_scope",f);this.first=f;h()}return this});Pa("continue",function(){k["continue"]||g("unexpected_a",this);var a=f.value;this.arity="statement";q["(breakage)"]===0&&g("unexpected_a",this);if(f.identifier&&n.line===f.line){ua();
q[a]!=="label"?g("not_a_label",f):E[a].funct!==q&&g("not_a_scope",f);this.first=f;h()}return this});Pa("return",function(){this.arity="statement";if(f.id!==";"&&f.line===n.line){ua();(f.id==="/"||f.id==="(regexp)")&&g("wrap_regexp");this.first=w(20)}return this});Pa("throw",function(){this.arity="statement";ua();this.first=w(20);return this});F("class");F("const");F("enum");F("export");F("extends");F("import");F("super");F("let");F("yield");F("implements");F("interface");F("package");F("private");
F("protected");F("public");F("static");kb=[sa,function(){for(;;)if(f.identifier)switch(f.value.toLowerCase()){case "url":sa();break;case "expression":g("unexpected_a");h();break;default:h()}else{if(f.id===";"||f.id==="!"||f.id==="(end)"||f.id==="}")return true;h()}}];ya=["none","dashed","dotted","double","groove","hidden","inset","outset","ridge","solid"];ob=["auto","always","avoid","left","right"];Ab={all:true,braille:true,embossed:true,handheld:true,print:true,projection:true,screen:true,speech:true,
tty:true,tv:true};Xa=["auto","hidden","scroll","visible"];Va={background:[true,"background-attachment","background-color","background-image","background-position","background-repeat"],"background-attachment":["scroll","fixed"],"background-color":["transparent",ja],"background-image":["none",sa],"background-position":[2,[D,"top","bottom","left","right","center"]],"background-repeat":["repeat","repeat-x","repeat-y","no-repeat"],border:[true,"border-color","border-style","border-width"],"border-bottom":[true,
"border-bottom-color","border-bottom-style","border-bottom-width"],"border-bottom-color":ja,"border-bottom-style":ya,"border-bottom-width":xa,"border-collapse":["collapse","separate"],"border-color":["transparent",4,ja],"border-left":[true,"border-left-color","border-left-style","border-left-width"],"border-left-color":ja,"border-left-style":ya,"border-left-width":xa,"border-right":[true,"border-right-color","border-right-style","border-right-width"],"border-right-color":ja,"border-right-style":ya,
"border-right-width":xa,"border-spacing":[2,D],"border-style":[4,ya],"border-top":[true,"border-top-color","border-top-style","border-top-width"],"border-top-color":ja,"border-top-style":ya,"border-top-width":xa,"border-width":[4,xa],bottom:[D,"auto"],"caption-side":["bottom","left","right","top"],clear:["both","left","none","right"],clip:[function(){var a;if(f.identifier&&f.value==="rect"){h();h("(");for(a=0;a<4;a=a+1)if(!D()){g("expected_number_a");break}h(")");return true}return false},"auto"],
color:ja,content:["open-quote","close-quote","no-open-quote","no-close-quote",ib,sa,function(){if(f.identifier&&f.value==="counter"){h();h("(");h();if(f.id===","){G();f.id!=="(string)"&&g("expected_string_a");h()}h(")");return true}if(f.identifier&&f.value==="counters"){h();h("(");f.identifier||g("expected_name_a");h();if(f.id===","){G();f.id!=="(string)"&&g("expected_string_a");h()}if(f.id===","){G();f.id!=="(string)"&&g("expected_string_a");h()}h(")");return true}return false},function(){if(f.identifier&&
f.value==="attr"){h();h("(");f.identifier||g("expected_name_a");h();h(")");return true}return false}],"counter-increment":[hb,"none"],"counter-reset":[hb,"none"],cursor:[sa,"auto","crosshair","default","e-resize","help","move","n-resize","ne-resize","nw-resize","pointer","s-resize","se-resize","sw-resize","w-resize","text","wait"],direction:["ltr","rtl"],display:["block","compact","inline","inline-block","inline-table","list-item","marker","none","run-in","table","table-caption","table-cell","table-column",
"table-column-group","table-footer-group","table-header-group","table-row","table-row-group"],"empty-cells":["show","hide"],"float":["left","none","right"],font:["caption","icon","menu","message-box","small-caption","status-bar",true,"font-size","font-style","font-weight","font-family"],"font-family":function(){for(;f.id!==";";){!hb()&&!ib()&&g("expected_name_a");if(f.id!==",")return true;G()}},"font-size":["xx-small","x-small","small","medium","large","x-large","xx-large","larger","smaller",D],"font-size-adjust":["none",
Ua],"font-stretch":["normal","wider","narrower","ultra-condensed","extra-condensed","condensed","semi-condensed","semi-expanded","expanded","extra-expanded"],"font-style":["normal","italic","oblique"],"font-variant":["normal","small-caps"],"font-weight":["normal","bold","bolder","lighter",Ua],height:[D,"auto"],left:[D,"auto"],"letter-spacing":["normal",D],"line-height":["normal",function(){if(f.id==="-"){h("-");B()}if(f.id==="(number)"){h();if(f.id!=="(string)"&&vb[f.value]===true){B();h()}return true}return false}],
"list-style":[true,"list-style-image","list-style-position","list-style-type"],"list-style-image":["none",sa],"list-style-position":["inside","outside"],"list-style-type":["circle","disc","square","decimal","decimal-leading-zero","lower-roman","upper-roman","lower-greek","lower-alpha","lower-latin","upper-alpha","upper-latin","hebrew","katakana","hiragana-iroha","katakana-oroha","none"],margin:[4,Ga],"margin-bottom":Ga,"margin-left":Ga,"margin-right":Ga,"margin-top":Ga,"marker-offset":[D,"auto"],
"max-height":[D,"none"],"max-width":[D,"none"],"min-height":D,"min-width":D,opacity:Ua,outline:[true,"outline-color","outline-style","outline-width"],"outline-color":["invert",ja],"outline-style":["dashed","dotted","double","groove","inset","none","outset","ridge","solid"],"outline-width":xa,overflow:Xa,"overflow-x":Xa,"overflow-y":Xa,padding:[4,D],"padding-bottom":D,"padding-left":D,"padding-right":D,"padding-top":D,"page-break-after":ob,"page-break-before":ob,position:["absolute","fixed","relative",
"static"],quotes:[8,ib],right:[D,"auto"],"table-layout":["auto","fixed"],"text-align":["center","justify","left","right"],"text-decoration":["none","underline","overline","line-through","blink"],"text-indent":D,"text-shadow":["none",4,[ja,D]],"text-transform":["capitalize","uppercase","lowercase","none"],top:[D,"auto"],"unicode-bidi":["normal","embed","bidi-override"],"vertical-align":["baseline","bottom","sub","super","top","text-top","middle","text-bottom",D],visibility:["visible","hidden","collapse"],
"white-space":["normal","nowrap","pre","pre-line","pre-wrap","inherit"],width:[D,"auto"],"word-spacing":["normal",D],"word-wrap":["break-word","normal"],"z-index":["auto",Ua]};da=function(a,b){var c,j,i;JAYLINT.comments=[];JAYLINT.errors=[];JAYLINT.tree="";nb=ta=U=n=f=Object.create(Y["(begin)"]);Q={};d(Qb);if(b){k=Object.create(b);if(j=k.predef)if(Array.isArray(j))for(c=0;c<j.length;c=c+1)Q[j[c]]=true;else typeof j==="object"&&d(j);fa()}else k={};k.indent=+k.indent||0;k.maxerr=k.maxerr||50;W="";Ia=
Ja=la=false;Wa={};if(k.approved)for(c=0;c<k.approved.length;c=c+1)Wa[k.approved[c]]=k.approved[c];else Wa.test="test";Za="";for(c=0;c<k.indent;c=c+1)Za=Za+" ";Aa=E={};X=q={"(scope)":E,"(breakage)":0,"(loopage)":0};Ta=[q];Da=false;Ya={};Fa=false;v=null;ma=false;Ba=[];ra={};La=false;ha=null;pb=true;qb=false;O=null;na=false;Ha=[];ea=null;Ma=0;t="";Ca.init(a);e();try{h();if(f.id==="(number)")m("unexpected_a");else if(f.value.charAt(0)==="<"){a:{var o,l,r,s,C=k.white,y,B,A,w;t="html";T="";for(O=null;;){switch(f.value){case "<":t=
"html";h("<");l={};B=f;B.identifier||g("bad_name_a",B);s=B.value;k.cap&&(s=s.toLowerCase());B.name=s;h();if(!O){O=[];c=s;c!=="html"&&!k.fragment&&(c==="div"&&k.adsafe?m("adsafe_fragment"):m("expected_a_b",n,"html",c));if(k.adsafe){c==="html"&&m("adsafe_html",n);k.fragment?c!=="div"&&m("adsafe_div",n):m("adsafe_fragment",n)}k.browser=true}A=mb[s];typeof A!=="object"&&m("unrecognized_tag_a",B,s);r=A.empty;for(B.type=s;;){if(f.id==="/"){h("/");f.id!==">"&&g("expected_a_b",f,">",f.value);break}if(f.id&&
f.id.charAt(0)===">")break;if(!f.identifier){(f.id==="(end)"||f.id==="(error)")&&g("expected_a_b",f,">",f.value);g("bad_name_a")}k.white=false;J();o=f.value;k.white=C;h();!k.cap&&o!==o.toLowerCase()&&g("attribute_case_a",n);o=o.toLowerCase();T="";Object.prototype.hasOwnProperty.call(l,o)&&g("duplicate_a",n,o);if(o.slice(0,2)==="on"){k.on||g("html_handlers");t="scriptstring";h("=");y=f.id;y!=='"'&&y!=="'"&&m("expected_a_b",f,'"',f.value);T=y;w=k.white;k.white=true;h(y);Na();qa();k.white=w;f.id!==y&&
m("expected_a_b",f,y,f.value);t="html";T="";h(y);A=false}else if(o==="style"){t="scriptstring";h("=");y=f.id;y!=='"'&&y!=="'"&&m("expected_a_b",f,'"',f.value);t="styleproperty";T=y;h(y);xb();t="html";T="";h(y);A=false}else if(f.id==="="){h("=");A=f.value;!f.identifier&&f.id!=='"'&&f.id!=="'"&&f.id!=="(string)"&&f.id!=="(string)"&&f.id!=="(color)"&&g("expected_attribute_value_a",n,o);h()}else A=true;l[o]=A;c=o;j=A;var u=i=void 0;if(c==="id"){i=typeof j==="string"?j.toUpperCase():"";Ya[i]===true&&g("duplicate_a",
f,j);if(/^[A-Za-z][A-Za-z0-9._:\-]*$/.test(j)){if(k.adsafe)if(W)j.slice(0,W.length)!==W?g("adsafe_prefix_a",f,W):/^[A-Z]+_[A-Z]+$/.test(j)||g("adsafe_bad_id");else{W=j;/^[A-Z]+_$/.test(j)||g("adsafe_bad_id")}}else g("bad_id_a",f,j);u=j.search(Wb);u>=0&&g("unexpected_char_a_b",n,j.charAt(u),c);Ya[i]=true}else if(c==="class"||c==="type"||c==="name"){u=j.search(Zb);u>=0&&g("unexpected_char_a_b",n,j.charAt(u),c);Ya[i]=true}else if(c==="href"||c==="background"||c==="content"||c==="data"||c.indexOf("src")>=
0||c.indexOf("url")>=0){k.safe&&wb.test(j)&&m("bad_url",f,j);Ha.push(j)}else c==="for"?k.adsafe&&(W?j.slice(0,W.length)!==W?g("adsafe_prefix_a",f,W):/^[A-Z]+_[A-Z]+$/.test(j)||g("adsafe_bad_id"):g("adsafe_bad_id")):c==="name"&&k.adsafe&&j.indexOf("_")>=0&&g("adsafe_name_a",f,j)}c=s;j=l;i=void 0;var D=mb[c],F=u=void 0;qb=false;D||m(H.unrecognized_tag_a,f,c===c.toLowerCase()?c:c+" (capitalization error)");if(O.length>0){c==="html"&&m("unexpected_a",n,c);if(F=D.parent)F.indexOf(" "+O[O.length-1].name+
" ")<0&&m("tag_a_in_b",n,c,F);else if(!k.adsafe&&!k.fragment){i=O.length;do{i<=0&&m("tag_a_in_b",n,c,"body");i=i-1}while(O[i].name!=="body")}}switch(c){case "div":k.adsafe&&O.length===1&&!W&&g("adsafe_missing_id");break;case "script":t="script";h(">");j.lang&&g("lang",n);k.adsafe&&O.length!==1&&g("adsafe_placement",n);if(j.src){k.adsafe&&(!Ia||!Wa[j.src])&&g("adsafe_source",n);j.type&&g("type",n)}else{K(f.from);x();Na();Ja=true;u=qa();if(k.adsafe){la&&m("adsafe_script",n);(u.length!==1||z(u[0],"id",
"(")||z(u[0].first,"id",".")||z(u[0].first.first,"value","ADSAFE")||z(u[0].second[0],"value",W))&&m("adsafe_id_go");switch(u[0].first.second.value){case "id":(Ia||la||u[0].second.length!==1)&&m("adsafe_id",f);Ia=true;break;case "go":la&&m("adsafe_go");(u[0].second.length!==2||z(u[0].second[1],"id","function")||!u[0].second[1].first||u[0].second[1].first.length!==2||z(u[0].second[1].first[0],"value","dom")||z(u[0].second[1].first[1],"value","lib"))&&m("adsafe_go",f);la=true;break;default:m("adsafe_id_go")}}v=
null}t="html";h("</");!f.identifier&&f.value!=="script"&&g("expected_a_b",f,"script",f.value);h();t="outer";break;case "style":t="style";h(">");zb();t="html";h("</");!f.identifier&&f.value!=="style"&&g("expected_a_b",f,"style",f.value);h();t="outer";break;case "input":switch(j.type){case "radio":case "checkbox":case "button":case "reset":case "submit":break;case "text":case "file":case "password":case "file":case "hidden":case "image":k.adsafe&&j.autocomplete!=="off"&&g("adsafe_autocomplete");break;
default:g("bad_type")}break;case "applet":case "body":case "embed":case "frame":case "frameset":case "head":case "iframe":case "noembed":case "noframes":case "object":case "param":k.adsafe&&g("adsafe_tag",f,c)}r||O.push(B);t="outer";h(">");break;case "</":t="html";h("</");f.identifier||g("bad_name_a");s=f.value;k.cap&&(s=s.toLowerCase());h();O||m("unexpected_a",f,"</"+s+">");(B=O.pop())||m("unexpected_a",f,"</"+s+">");B.name!==s&&m("expected_a_b",f,"</"+B.name+">","</"+s+">");f.id!==">"&&m("expected_a_b",
f,">",f.value);t="outer";h(">");break;case "<!":k.safe&&g("adsafe_a");for(t="html";;){h();if(f.id===">"||f.id==="(end)")break;f.value.indexOf("--")>=0&&m("unexpected_a",f,"--");f.value.indexOf("<")>=0&&m("unexpected_a",f,"<");f.value.indexOf(">")>=0&&m("unexpected_a",f,">")}t="outer";h(">");break;case "(end)":break a;default:f.id==="(end)"?m("missing_a",f,"</"+O[O.length-1].value+">"):h()}if(O&&O.length===0&&(k.adsafe||!k.fragment||f.id==="(end)"))break}f.id!=="(end)"&&m("unexpected_a")}k.adsafe&&
!la&&g("adsafe_go",this)}else switch(f.id){case "{":case "[":ma=true;gb();break;case "@":case "*":case "#":case ".":case ":":t="style";h();(n.id!=="@"||!f.identifier||f.value!=="charset"||n.line!==1||n.from!==1)&&m("css");h();f.id!=="(string)"&&f.value!=="UTF-8"&&m("css");h();V();zb();break;default:k.adsafe&&k.fragment&&m("expected_a_b",f,"<div>",f.value);K(1);f.id===";"&&!La&&V();Ja=true;i=qa();nb.first=i;JAYLINT.tree=nb;k.adsafe&&(i.length!==1||z(i[0],"id","(")||z(i[0].first,"id",".")||z(i[0].first.first,
"value","ADSAFE")||z(i[0].first.second,"value","lib")||i[0].second.length!==2||i[0].second[0].id!=="(string)"||z(i[0].second[1],"id","function"))&&m("adsafe_lib");i.disrupt&&g("weird_program",U)}v=null;h("(end)")}catch(G){G&&JAYLINT.errors.push({reason:G.message,line:G.line||f.line,character:G.character||f.from},null)}return JAYLINT.errors.length===0};da.data=function(){var a={functions:[]},b,c,d,f,e,g=[],j=[];if(da.errors.length)a.errors=da.errors;if(ma)a.json=true;if(Ha.length>0)a.urls=Ha;b=Object.keys(Aa).filter(function(a){return a.charAt(0)!==
"("?a:void 0});if(b.length>0)a.globals=b;for(c=1;c<Ta.length;c=c+1){e=Ta[c];b={};for(d=0;d<Ka.length;d=d+1)b[Ka[d]]=[];for(f in e)if(Object.prototype.hasOwnProperty.call(e,f)&&f.charAt(0)!=="("){d=e[f];if(d==="unction"||d==="unparam")d="unused";if(Array.isArray(b[d])){b[d].push(f);d==="unused"?j.push({name:f,line:e["(line)"],"function":e["(name)"]}):d==="undef"&&g.push({name:f,line:e["(line)"],"function":e["(name)"]})}}for(d=0;d<Ka.length;d=d+1)b[Ka[d]].length===0&&delete b[Ka[d]];b.name=e["(name)"];
b.param=e["(params)"];b.line=e["(line)"];b["(complexity)"]=e["(complexity)"];a.functions.push(b)}if(j.length>0)a.unused=j;if(g.length>0)a.undef=g;for(f in ra)if(typeof ra[f]==="number"){a.member=ra;break}return a};da.report=function(a){function b(a,c){var d,f;if(Array.isArray(c)){h.push("<div><i>"+a+"</i> ");c=c.sort().forEach(function(a){if(a!==f){f=a;h.push((d?", ":"")+f);d=true}});h.push("</div>")}else c&&h.push("<div><i>"+a+"</i> "+c+"</div>")}var d=da.data(),f,e,g,j;e="";var i,h=[];if(d.errors||
d.unused||d.undef){f=true;h.push("<div id=errors><i>Error:</i>");if(d.errors)for(g=0;g<d.errors.length;g=g+1)if(j=d.errors[g]){e=j.evidence||"";h.push("<p>Problem"+(isFinite(j.line)?" at line "+j.line+" character "+j.character:"")+": "+j.reason.entityify()+"</p><p class=evidence>"+(e&&(e.length>80?e.slice(0,77)+"...":e).entityify())+"</p>")}if(d.undef){e=[];for(g=0;g<d.undef.length;g=g+1)e[g]="<code><u>"+d.undef[g].name+"</u></code>&nbsp;<i>"+d.undef[g].line+" </i> <small>"+d.undef[g]["function"]+
"</small>";h.push("<p><i>Undefined variable:</i> "+e.join(", ")+"</p>")}if(d.unused){e=[];for(g=0;g<d.unused.length;g=g+1)e[g]="<code><u>"+d.unused[g].name+"</u></code>&nbsp;<i>"+d.unused[g].line+" </i> <small>"+d.unused[g]["function"]+"</small>";h.push("<p><i>Unused variable:</i> "+e.join(", ")+"</p>")}d.json&&h.push("<p>JSON: bad.</p>");h.push("</div>")}if(!a){h.push("<br><div id=functions>");d.urls&&b("URLs<br>",d.urls,"<br>");t==="style"?h.push("<p>CSS.</p>"):d.json&&!f?h.push("<p>JSON: good.</p>"):
d.globals?h.push("<div><i>Global</i> "+d.globals.sort().join(", ")+"</div>"):h.push("<div><i>No new global variables introduced.</i></div>");for(g=0;g<d.functions.length;g=g+1){f=d.functions[g];a=[];if(f.param)for(e=0;e<f.param.length;e=e+1)a[e]=f.param[e].value;h.push("<br><div class=function><i>"+f.line+"</i> "+f.name.entityify()+"("+a.join(", ")+")</div>");b("<big><b>Undefined</b></big>",f.undef);b("<big><b>Unused</b></big>",f.unused);b("Closure",f.closure);b("Variable",f["var"]);b("Exception",
f.exception);b("Outer",f.outer);b("Global",f.global);b("Label",f.label);b("Complexity",f["(complexity)"])}if(d.member){f=Object.keys(d.member);if(f.length){f=f.sort();e="<br><pre id=properties>/*properties ";j=13;for(g=0;g<f.length;g=g+1){a=f[g];i=Cb.test(a)?a:"'"+a.entityify().replace(ub,c)+"'";if(j+i.length>72){h.push(e+"<br>");e="    ";j=1}j=j+(i.length+2);d.member[a]===1&&(i="<i>"+i+"</i>");g<f.length-1&&(i=i+", ");e=e+i}h.push(e+"<br>*/</pre>")}h.push("</div>")}}return h.join("")};da.jslint=
da;da.edition="2012-05-01";return da}();
(function(a,b){function c(a,b){this.kind=i.property;Object.defineProperty(this,"definedBy",{value:b,enumerable:false,configurable:false,writable:false});if(a){if(typeof a==="function"){this.method=a;this.kind=i.method}else{this.configurable=this.enumerable=true;if(typeof a==="number"){this.value=a;this.dataType="integer"}else if(typeof a==="string"){this.value=a;this.dataType=typeof a}else for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c])}this.type!==void 0?this.dataType=this.dataType||this.type:
this.type=this.dataType}}function d(){}function e(){this.classNames={}}function i(){}function g(a,b){this.definedBy=a;this.initfunc=b}c.prototype.createPropertyDescriptor=function(a,b){var c=this,d={enumerable:this.enumerable==void 0?true:this.enumerable,configurable:this.configurable==void 0?true:this.configurable};if(this.set&&this.get){d.set=this.set;d.get=this.get}else if("value"in this||b){d.value=b||this.value;d.writable=true}else{d.set=function(a){this.storeProperty(c,a)};d.get=function(){return this.retrieveProperty(c)}}return d};
c.prototype.createStorePropertyDescriptor=function(a){return{enumerable:false,writable:true,configurable:this.configurable,value:a}};c.prototype.createGetMethod=function(){var a=this;return{enumerable:false,writable:false,configurable:false,value:function(b){return this.getProperty(a,b)}}};c.prototype.createSetMethod=function(){var a=this;return{enumerable:false,writable:false,configurable:false,value:function(b,c){return this.setProperty(a,b,c)}}};c.prototype.toJSON=function(){var a={},b;for(b in this)b!==
"defineBy"&&b!=="storageModel"&&(a[b]=this[b]);return a};a.MemberDefinition=window.MemberDefinition=c;d.prototype={clearCache:function(){this.propByTypeCache=this.keyPropsCache=this.pubMapPropsCache=this.arrayCache=void 0},asArray:function(){if(!this.arrayCache){this.arrayCache=[];for(var a in this)a.indexOf("$")===0&&this.arrayCache.push(this[a])}return this.arrayCache},getPublicMappedProperties:function(){if(!this.pubMapPropsCache){this.pubMapPropsCache=[];for(var a in this)a.indexOf("$")===0&&
this[a].kind=="property"&&!this[a].notMapped&&this[a].enumerable&&this.pubMapPropsCache.push(this[a])}return this.pubMapPropsCache},getPublicMappedPropertyNames:function(){if(!this.pubMapPropNamesCache){this.pubMapPropNamesCache=[];for(var a in this)a.indexOf("$")===0&&this[a].kind=="property"&&!this[a].notMapped&&this[a].enumerable&&this.pubMapPropNamesCache.push(this[a].name)}return this.pubMapPropNamesCache},getKeyProperties:function(){if(!this.keyPropsCache){this.keyPropsCache=[];for(var a in this)a.indexOf("$")===
0&&this[a].kind=="property"&&this[a].key&&this.keyPropsCache.push(this[a])}return this.keyPropsCache},getPropertyByType:function(a){if(!this.propByTypeCache){this.propByTypeCache=[];for(var b in this)b.indexOf("$")===0&&this[b].dataType==a&&this.propByTypeCache.push(this[b])}return this.propByTypeCache},getMember:function(a){return this["$"+a]},setMember:function(a){this["$"+a.name]=a}};d.prototype.constructor=d;a.MemberDefinitionCollection=window.MemberDefinitionCollection=d;eval("function Base() { };");
a.Base=Base;a.Base.fullName="$data.Base";if(!a.Base.name)a.Base.name="Base";a.Base.prototype.storeProperty=function(a,b){var c="_"+a.name;this[c]?this[c]=b:Object.defineProperty(this,c,a.createStorePropertyDescriptor(b))};a.Base.prototype.retrieveProperty=function(a){return this["_"+a.name]};a.Base.prototype.setProperty=function(a,b,c){this[a.name]=b;c()};a.Base.prototype.getProperty=function(a,b){b.apply(this,[this[a.name]])};a.Base.extend=function(b,c,d){return a.Class.define(b,null,null,c,d)};
i.__enum=true;i.method="method";i.property="property";i.navProperty="navProperty";i.complexProperty="complexProperty";i.field="field";a.MemberTypes=i;g.constructor="constructor";g.classConstructor="classConstructor";g.mixin="mixin";g.propagation="propagation";e.prototype={getClass:function(){},getProperties:function(a){return a.propertyDefinitions},define:function(a,b,c,d,e){return this.defineEx(a,[{type:b}],c,d,e)},defineEx:function(b,c,d,e,g){if(c.length==0)c.push({type:a.Base});else if(c.length>
0&&!c[0].type)c[0].type=a.Base;var d=b.split("."),i=d.splice(d.length-1,1)[0],s=window;d.forEach(function(a){s[a]||(s[a]={__namespace:true});s=s[a]});var l=null,l=this.classFunctionBuilder(i,c,g,e);l.fullName=b;l.namespace=d.join(".");this.buildType(l,c,e,g);l.name=i;Container.registerType(b,l);typeof intellisense!=="undefined"&&e&&e.constructor&&intellisense.annotate(l,e.constructor);return s[i]=this.classNames[b]=l},classFunctionBuilder:function(a,b,c,d){return(new Function("base","classDefinition",
"instanceDefinition","return function "+a+" (){ "+this.bodyBuilder(b,c,d)+" \n}; "))(b,c,d)},bodyBuilder:function(a,b,c){for(var d=b="",e="",g=0,i=a.length;g<i;g++){var l=a[g],h=g;if(h==0){if(l&&l.type){d=d+("    var baseArguments = $data.typeSystem.createCtorParams(arguments, base["+h+"].params, this); \n");d=d+("    "+l.type.fullName+".apply(this, baseArguments); \n")}}else if(l&&l.type&&l.propagateTo){e=e+("    "+(!e?"var ":"")+"propagationArguments = $data.typeSystem.createCtorParams(arguments, base["+
h+"].params, this); \n");e=e+('    this["'+l.propagateTo+'"] =  Object.create('+l.type.fullName+".prototype); \n    "+l.type.fullName+'.apply(this["'+l.propagateTo+'"], propagationArguments); \n')}else l&&l.type&&l.type.memberDefinitions&&l.type.memberDefinitions.$constructor&&!l.propagateTo&&(b=b+("    "+l.type.fullName+".memberDefinitions.$constructor.method.apply(this); \n"))}c&&c.constructor!=Object&&(d=d+"    instanceDefinition.constructor.apply(this, arguments); \n");return"\n    //mixins \n"+
b+"\n    //construction \n"+d+"\n    //propagations \n"+e},buildType:function(b,c,e,g){var i=c[0].type;if(b.inheritsFrom=i){b.prototype=Object.create(i.prototype);b.memberDefinitions=Object.create(i.memberDefinitions||new d);b.memberDefinitions.clearCache();var C=i.staticDefinitions;if(C)if(C=C.asArray())for(var s=0;s<C.length;s++)this.buildMember(b,C[s],void 0,"staticDefinitions");b.baseTypes=(i.baseTypes||[]).concat(c.map(function(a){return a.type}));b.isAssignableTo||Object.defineProperty(b,"isAssignableTo",
{value:function(a){return this===a||this.baseTypes.indexOf(a)>=0},writable:false,enumerable:false,configurable:false})}if(g){this.buildStaticMembers(b,g);if(g.constructor)b.classConstructor=g.constructor}e&&this.buildInstanceMembers(b,e);c=[].concat(c);c.shift();Object.keys(c).length>0&&this.buildInstanceMixins(b,c);b.__class=true;b.prototype.constructor=b;Object.defineProperty(b.prototype,"getType",{value:function(){return b},writable:false,enumerable:false,configurable:false});b.extend=function(c,
d,e){return a.Class.define(c,b,null,d,e)};Object.defineProperty(b,"getMemberDefinition",{value:function(a){return b.memberDefinitions.getMember(a)}})},addMethod:function(a,b,c,d){a[b]=!d||typeof intellisense!=="undefined"?c:function(){return c.apply(this[d],arguments)}},addProperty:function(a,b,c,d){if(d){c.configurable=true;if(c.get){var e=c.get;c.get=function(){this[d]||Guard.raise(new Exception("not inicialized"));return e.apply(this[d],arguments)}}if(c.set){var g=c.set;c.set=function(){this[d]||
Guard.raise(new Exception("not inicialized"));g.apply(this[d],arguments)}}}Object.defineProperty(a,b,c)},addField:function(){Guard.raise("not implemented")},buildMethod:function(a,b,c){this.addMethod(b.classMember?a:a.prototype,b.name,b.method,c)},buildProperty:function(a,b,c){var d=b.classMember?a:a.prototype,e=b.createPropertyDescriptor(a);this.addProperty(d,b.name,e,c);if(!b.classMember&&a.__setPropertyfunctions==true){a=b.createGetMethod();this.addProperty(d,"get_"+b.name,a,c);a=b.createSetMethod();
this.addProperty(d,"set_"+b.name,a,c)}},buildMember:function(a,b,c,e){e=e||"memberDefinitions";a[e]=a[e]||new d;a[e].setMember(b);switch(b.kind){case i.method:this.buildMethod(a,b,c);break;case i.navProperty:case i.complexProperty:case i.property:this.buildProperty(a,b,c);break;default:Guard.raise("Unknown member type: "+b.kind+","+b.name)}},buildStaticMembers:function(a,b){for(var d in b)if(b.hasOwnProperty(d)){var e=new c(b[d],a);e.name=d;e.classMember=true;this.buildMember(a,e,void 0,"staticDefinitions")}},
buildInstanceMembers:function(a,b){for(var d in b)if(b.hasOwnProperty(d)){var e=new c(b[d],a);e.name=d;this.buildMember(a,e)}},copyMembers:function(a,b){Object.keys(a.prototype).forEach(function(c){if(c!=="constructor"&&c!=="toString"){typeof intellisense!=="undefined"&&intellisense.logMessage("copying item:"+c);b.prototype[c]=a[c]}})},buildInstanceMixins:function(a,b){a.mixins=a.mixins||[];a.propagations=a.propagations||[];for(var c=0;c<b.length;c++){var d=b[c];if(d.propagateTo){this.buildInstancePropagation(a,
d);a.propagations.push(d);a.propagations[d.type.name]=true}else{this.buildInstanceMixin(a,d);a.mixins.push(d);a.mixins[d.type.name]=true}}},buildInstanceMixin:function(a,b){for(var c=b.type.memberDefinitions.asArray(),d=0,e=c.length;d<e;d++){var g=c[d].name;g!=="constructor"&&!a.memberDefinitions.getMember(g)&&this.buildMember(a,c[d])}},buildInstancePropagation:function(a,b){for(var c=b.type.memberDefinitions.asArray(),d=0,e=c.length;d<e;d++){var g=c[d].name;g!=="constructor"&&!a.memberDefinitions.getMember(g)&&
this.buildMember(a,c[d],b.propagateTo)}}};a.Class=Class=new e;(function(b){a.Number=typeof Number!=="undefined"?Number:function(){};a.Integer=typeof Integer!=="undefined"?Integer:function(){};a.Date=typeof Date!=="undefined"?Date:function(){};a.String=typeof String!=="undefined"?String:function(){};a.Boolean=typeof Boolean!=="undefined"?Boolean:function(){};a.Blob=function(){};a.Array=typeof Array!=="undefined"?Array:function(){};a.Object=typeof Object!=="undefined"?Object:function(){};a.ObjectID=
typeof ObjectID!=="undefined"?ObjectID:function(){};a.Function=Function;b.Container=a.Container=b=b.C$=new function(){var b={},c=[],d=[];this.classNames=b;this.consolidatedClassNames=c;this.classTypes=d;var e=[];this.mappedTo=e;var g=this;this.holder=null;this.mapType=function(a,b){Guard.requireValue("aliasType",a);Guard.requireValue("realType",b);var c=this.getType(a),g=this.getType(b),c=d.indexOf(c),g=d.indexOf(g);e[c]=g};this.resolve=function(a,b){return new (this.resolveType(a,b))(b)};this.resolveName=
function(a){a=this.resolveType(a);a=d.indexOf(a);return c[a]};this.isPrimitiveType=function(b){b=this.resolveType(b);return b===Number||b===String||b===Date||b===String||b===Boolean||b===Array||b===Object||b===a.Number||b===a.String||b===a.Date||b===a.String||b===a.Boolean||b===a.Array||b===a.Object};this.resolveType=function(a){var a=this.getType(a),b=d.indexOf(a);return typeof e[b]==="undefined"?a:d[e[b]]};this.getTypes=function(){return Object.keys(b).map(function(a){return{name:a,type:d[b[a]],
toString:function(){return this.name}}})};this.getTypeName=function(a){switch(typeof a){case "object":if(a==null)return"$data.Object";if(a instanceof Array)return"$data.Array";if(a.getType)return a.getType().fullName;if(a instanceof Date)return"$data.Date";default:return typeof a}};this.isTypeRegistered=function(a){return typeof a==="function"?d.indexOf(a)>-1:a in b};this.unregisterType=function(){Guard.raise("Unimplemented")};this.getType=function(a){Guard.requireValue("typeOrName",a);if(typeof a===
"function")return a;a in b||Guard.raise(new Exception("Unable to resolve type:"+a));return d[b[a]]};this.getName=function(a){var b=this.getType(a),b=d.indexOf(b);b==-1&&Guard.raise("unknown type to request name for: "+a);return c[b]};this.getDefault=function(b){switch(this.resolveType(b)){case a.Number:return 0;case a.Integer:return 0;case a.String:return"";case a.Boolean:return false;default:return null}};this.registerType=function(a,e,i){if(a){typeof e==="string"&&(e=g.resolveType(e));if(typeof a===
"string"){var j=[];j.push(a);a=j}for(j=0;j<a.length;j++){var z=a[j].split("."),x={};x.shortName=z[z.length-1];x.fullName=a[j];a[j]=x}z=function(){var a=arguments,b=g.resolveType(e),c=Object.create(b.prototype);b.apply(c,a);return c};typeof intellisense!=="undefined"&&intellisense.annotate(z,e);for(var j=0,K=a.length;j<K;j++){x=a[j];"create"+x.shortName in g?console&&console.warn("warning: short names overlap:"+x.shortName+", Container.create"+x.shortName+" has not been updated"):g["create"+x.shortName]=
typeof i==="function"?i:z;var A=d.indexOf(e);if(A==-1){A=d.push(e)-1;c[A]=x.fullName}x.fullName in b&&console.warn("warning:!!! This typename has already been registered:"+x.fullName);b[x.fullName]=A}if(!e.name)e.name=a[0].shortName}}};b.registerType(["$data.Number","number","float","real","decimal","JayNumber"],a.Number);b.registerType(["$data.Integer","int","integer","int16","int32","int64","JayInteger"],a.Integer);b.registerType(["$data.String","string","text","character","JayString"],a.String);
b.registerType(["$data.Array","array","Array","[]","JayArray"],a.Array,function(){return a.Array.apply(void 0,arguments)});b.registerType(["$data.Date","datetime","date","JayDate"],a.Date);b.registerType(["$data.Boolean","bool","boolean","JayBoolean"],a.Boolean);b.registerType(["$data.Blob","blob","JayBlob"],a.Blob);b.registerType(["$data.Object","Object","object","{}","JayObject"],a.Object);b.registerType(["$data.Function","Function","function"],a.Function);b.registerType(["$data.ObjectID","ObjectID",
"objectId","objectid","ID","Id","id","JayObjectID"],a.ObjectID)})(window);b.$C=function(){Class.define.apply(Class,arguments)};a.Class.ConstructorParameter=ConstructorParameter=a.Class.define("ConstructorParameter",null,null,{constructor:function(a){this.paramIndex=a},paramIndex:{}})})($data,window);$data.defaultErrorCallback=function(){Guard.raise(new Exception("DEFAULT ERROR CALLBACK!","DefaultError",arguments))};$data.defaultSuccessCallback=function(){console.log("DEFAULT SUCCES CALLBACK")};
$data.defaultNotifyCallback=function(){console.log("DEFAULT NOTIFY CALLBACK")};
$data.typeSystem={__namespace:!0,extend:function(a){typeof a!=="object"&&typeof a!=="function"&&Guard.raise("Target must be object or function");for(var b=1;b<arguments.length;b++){var c=arguments[b];if(!(c===null||typeof c==="undefined"))for(key in c)a[key]=c[key]}return a},createCallbackSetting:function(a,b){var c={success:$data.defaultSuccessCallback,error:$data.defaultErrorCallback,notify:$data.defaultNotifyCallback};b!=void 0&&b!=null&&(c=b);return a==null||a==void 0?c:typeof a=="function"?this.extend(c,
{success:a}):this.extend(c,a)},createCtorParams:function(a,b,c){if(b){for(var d=[],e=0,i=b.length;e<i;e++){var g=e;b[g]instanceof ConstructorParameter?d.push(a[b[g].paramIndex]):typeof b[g]==="function"?d.push(b[g].apply(c)):d.push(b[g])}return d}return a},writePropertyValues:function(a){a&&a.getType&&a.getType().memberDefinitions&&this.writeProperties(a,a.getType().memberDefinitions.asArray().filter(function(a){return(a.kind=="property"||a.kind=="navProperty"||a.kind=="complexProperty")&&!a.prototypeProperty}))},
writeProperties:function(a,b){for(var c={},d=0,e=b.length;d<e;d++){var i=b[d];c[i.name]=i.createPropertyDescriptor(null,i.value)}Object.defineProperties(a,c)},writeProperty:function(a,b,c){if(b=typeof b==="string"?a.getType().memberDefinitions.getMember(b):b){c=b.createPropertyDescriptor(null,c);Object.defineProperty(a,b.name,c)}}};$data.ASTNode=function(){};$data.FunctionASTNode=function(){};$data.FunctionASTNode.prototype=new $data.ASTNode;$data.ParameterASTNode=function(){};
$data.MemberAccessASTNode=function(){};$data.MemberAccessASTNode.prototype=new $data.ASTNode;$data.ConstantASTNode=function(){};$data.ASTParserResult=function(a,b,c){this.success=b!="";this.result=a;this.tree=b;this.errors=c};$data.ASTParser=function(){};
$data.ASTParser.parseCode=function(a){var b;if(!a||(b=a.toString())==="")return new $data.ASTParserResult(false,null,null);typeof JAYLINT==="undefined"&&Guard.raise(new Exception("JAYLINT is required","Not Found!"));a=JAYLINT(b);return new $data.ASTParserResult(a,JAYLINT.tree,JAYLINT.errors)};
$data.Class.define("$data.Expressions.ExpressionType",null,null,{},{Constant:"constant",Variable:"variable",MemberAccess:"memberAccess",Call:"call",Equal:"equal",NotEqual:"notEqual",EqualTyped:"equalTyped",NotEqualTyped:"notEqualTyped",GreaterThen:"greaterThan",LessThen:"lessThan",GreaterThenOrEqual:"greaterThanOrEqual",LessThenOrEqual:"lessThenOrEqual",Or:"or",OrBitwise:"orBitwise",And:"and",AndBitwise:"andBitwise",In:"in",Add:"add",Divide:"divide",Multiply:"multiply",Subtract:"subtract",Modulo:"modulo",
ArrayIndex:"arrayIndex",New:"new",Positive:"positive",Negative:"negative",Increment:"increment",Decrement:"decrement",Not:"not",This:"this",LambdaParameterReference:"lambdaParameterReference",LambdaParameter:"lambdaParameter",Parameter:"parameter",ArrayLiteral:"arrayLiteral",ObjectLiteral:"objectLiteral",ObjectField:"objectField",Function:"Function",Unknown:"UNKNOWN",EntitySet:"EntitySet",ServiceOperation:"ServiceOperation",EntityField:"EntityField",EntityContext:"EntityContext",Entity:"Entity",Filter:"Filter",
First:"First",Count:"Count",Single:"Single",Some:"Some",Every:"Every",ToArray:"ToArray",ForEach:"ForEach",Projection:"Projection",EntityMember:"EntityMember",EntityFieldOperation:"EntityFieldOperation",FrameOperation:"FrameOperation",EntityBinary:"EntityBinary",Code:"Code",ParametricQuery:"ParametricQuery",MemberInfo:"MemberInfo",QueryParameter:"QueryParameter",ComplexEntityField:"ComplexEntityField",Take:"Take",Skip:"Skip",OrderBy:"OrderBy",OrderByDescending:"OrderByDescending",Include:"Include",
Count:"Count"});$data.BinaryOperator=function(){};
$data.binaryOperators=[{operator:"==",expressionType:$data.Expressions.ExpressionType.Equal,type:"boolean",implementation:function(a,b){return a==b}},{operator:"===",expressionType:$data.Expressions.ExpressionType.EqualTyped,type:"boolean",implementation:function(a,b){return a===b}},{operator:"!=",expressionType:$data.Expressions.ExpressionType.NotEqual,type:"boolean",implementation:function(a,b){return a!=b}},{operator:"!==",expressionType:$data.Expressions.ExpressionType.NotEqualTyped,type:"boolean",
implementation:function(a,b){return a!==b}},{operator:">",expressionType:$data.Expressions.ExpressionType.GreaterThen,type:"boolean",implementation:function(a,b){return a>b}},{operator:">=",expressionType:$data.Expressions.ExpressionType.GreaterThenOrEqual,type:"boolean",implementation:function(a,b){return a>=b}},{operator:"<=",expressionType:$data.Expressions.ExpressionType.LessThenOrEqual,type:"boolean",implementation:function(a,b){return a<=b}},{operator:"<",expressionType:$data.Expressions.ExpressionType.LessThen,
type:"boolean",implementation:function(a,b){return a<b}},{operator:"&&",expressionType:$data.Expressions.ExpressionType.And,type:"boolean",implementation:function(a,b){return a&&b}},{operator:"||",expressionType:$data.Expressions.ExpressionType.Or,type:"boolean",implementation:function(a,b){return a||b}},{operator:"&",expressionType:$data.Expressions.ExpressionType.AndBitwise,type:"number",implementation:function(a,b){return a&b}},{operator:"|",expressionType:$data.Expressions.ExpressionType.OrBitwise,
type:"number",implementation:function(a,b){return a|b}},{operator:"+",expressionType:$data.Expressions.ExpressionType.Add,type:"number",implementation:function(a,b){return a+b}},{operator:"-",expressionType:$data.Expressions.ExpressionType.Subtract,type:"number",implementation:function(a,b){return a-b}},{operator:"/",expressionType:$data.Expressions.ExpressionType.Divide,type:"number",implementation:function(a,b){return a/b}},{operator:"%",expressionType:$data.Expressions.ExpressionType.Modulo,type:"number",
implementation:function(a,b){return a%b}},{operator:"*",expressionType:$data.Expressions.ExpressionType.Multiply,type:"number",implementation:function(a,b){return a*b}},{operator:"[",expressionType:$data.Expressions.ExpressionType.ArrayIndex,type:"number",implementation:function(a,b){return a[b]}},{operator:"in",expressionType:$data.Expressions.ExpressionType.In,type:"boolean",implementation:function(a,b){return a in b}}];
$data.binaryOperators.resolve=function(a){if($data.binaryOperators.filter(function(b){return b.operator==a}).length>0)return a};$data.binaryOperators.contains=function(a){return $data.binaryOperators.some(function(b){return b.operator==a})};$data.binaryOperators.getOperator=function(a){var b=$data.binaryOperators.filter(function(b){return b.operator==a});b.length<1&&Guard.raise("Unknown operator: "+a);return b[0]};
$data.unaryOperators=[{operator:"+",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Positive,type:"number",implementation:function(a){return+a}},{operator:"-",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Negative,type:"number",implementation:function(a){return-a}},{operator:"++",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(a){return++a}},{operator:"--",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Decrement,
type:"number",implementation:function(a){return--a}},{operator:"++",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(a){return a++}},{operator:"!",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Not,type:"boolean",implementation:function(a){return!a}},{operator:"--",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(a){return a--}}];
$data.unaryOperators.resolve=function(a){if($data.unaryOperators.filter(function(b){return b.operator==a}).length>0)return a};$data.unaryOperators.contains=function(a){return $data.unaryOperators.some(function(b){return b.operator==a})};$data.unaryOperators.getOperator=function(a,b){var c=$data.unaryOperators.filter(function(c){return c.operator==a&&(!b||c.arity==b)});c.length<1&&Guard.raise("Unknown operator: "+a);return c[0]};
$data.timeIt=function(a,b){b=b||1;console.time("!");for(var c=0;c<b;c++)a();console.timeEnd("!")};$data.Expressions.OperatorTypes={UNARY:"UNARY",INCDEC:"INCDEC",DECISION:"DECISION",METHODCALL:"METHODCALL",NEW:"NEW",JSONASSIGN:"JSONASSIGN",ARRAYACCESS:"ARRAYACCESS",UNKNOWN:"UNKNOWN"};$data.executable=!0;function jsonify(a){return JSON.stringify(a,null,"\t")}
$C("$data.Expressions.ExpressionNode",$data.Entity,null,{constructor:function(){this.expressionType=this.constructor},getJSON:function(){return jsonify(this)},expressionType:{value:void 0,set:function(a){var b;Object.defineProperty(this,"expressionType",{set:function(a){typeof a==="string"&&(a=Container.resolveType(a));b=a},get:function(a){return arguments.callee.caller==jsonify||arguments.callee.caller==JSON.stringify?Container.resolveName(b):b},enumerable:true});this.expressionType=a},get:function(){},
enumerable:!0},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:!1},type:{},isTerminated:{value:!1},toString:function(){return this.value}},null);$C("$data.Expressions.UnaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d){this.operand=a;this.operator=b;this.nodeType=c;this.resolution=d},operator:{value:void 0,writable:!0},operand:{value:void 0,writable:!0},nodeType:{value:void 0,writable:!0}});
$C("$data.Expressions.ArrayLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.items=a||[]},nodeType:{value:$data.Expressions.ExpressionType.ArrayLiteral,writable:!0},items:{value:void 0,dataType:Array,elementType:$data.Expressions.ExpressionNode},toString:function(){return"["+this.items.map(function(a){return a.toString()}).join(",")+"]"}},null);
$C("$data.Expressions.CallExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.expression=a;this.member=b;this.args=c},nodeType:{value:$data.Expressions.ExpressionType.Call},expression:{value:void 0,dataType:$data.Expressions.ExpressionNode,writable:!0},member:{value:void 0,dataType:$data.MemberDefinition,writable:!0},type:{value:void 0,writable:!0},implementation:{get:function(){return function(a,b,c){typeof b!=="function"&&(b=a[b]);Guard.requireType("method",b,Function);
return b.apply(a,c)}},set:function(){Guard.raise("Property can not be set")}},toString:function(){return this.object.toString()+"."+this.member.toString()+"()"}});
$C("$data.Expressions.CodeParser",null,null,{constructor:function(a){this.scopeContext=a;this.lambdaParams=[]},log:function(a){this.scopeContext&&this.scopeContext.log(a)},parseExpression:function(a){typeof a==="object"&&(a="");var b={success:true,errorMessage:"",errorDetails:""},a=$data.ASTParser.parseCode(a);this.log({event:"AST",data:a});if(!a.success)return{success:false,error:"ASTParser error",errorMessage:a.errors?JSON.stringify(a.errors):"could not get code"};return b={success:true,expression:this.Build2(a.tree.first[0]),
errors:a.errors}},createExpression:function(a,b){var c=this.parseExpression(a,b);c.success||Guard.raise("ExpressionParserError: "+c.errorMessage);return c.expression},Build2:function(a){var b;switch(a.arity){case "number":case "string":b=this.BuildConstant(a);break;case "prefix":switch(a.value){case "{":b=this.BuildObjectLiteral(a);break;case "[":b=this.BuildArrayLiteral(a);break;case $data.unaryOperators.resolve(a.value):b=this.BuildUnary(a)}break;case "suffix":switch(a.value){case $data.unaryOperators.resolve(a.value):b=
this.BuildUnary(a);break;default:Guard.raise("Unknown suffix: "+a.value)}break;case "infix":switch(a.value){case "[":b=this.BuildArray(a);break;case $data.binaryOperators.resolve(a.value):b=this.BuildSimpleBinary(a);break;case "function":Guard.raise("Unexpected function arity");case "(":b=this.BuildCall(a);break;case ".":b=this.BuildProperty(a);break;default:debugger}break;case "statement":switch(a.value){case "function":b=this.BuildFunction(a)}break;default:switch(a.value){case "function":b=this.BuildFunction(a);
break;case "true":case "false":case "null":b=this.BuildConstant(a);break;case "this":b=this.BuildThis(a);break;default:b=this.BuildParameter(a)}}return b},BuildThis:function(){return Container.createThisExpression()},BuildConstant:function(a){var b=a.value,c=a.type;if(a.reserved===true)switch(a.value){case "true":b=true;c="boolean";break;case "false":b=false;c="boolean";break;case "null":b=null;c="object"}return new $data.Expressions.ConstantExpression(b,c)},BuildFunctionParameter:function(){},BuildArray:function(a){switch(a.second.type){case "string":return this.BuildProperty(a);
default:return this.BuildSimpleBinary(a)}},BuildParameter:function(a){var b=a.funct?$data.Expressions.ExpressionType.LambdaParameter:this.lambdaParams.indexOf(a.value)>-1?$data.Expressions.ExpressionType.LambdaParameterReference:$data.Expressions.ExpressionType.Parameter,c=new $data.Expressions.ParameterExpression(a.value,null,b);if(b==$data.Expressions.ExpressionType.LambdaParameterReference)c.paramIndex=this.lambdaParams.indexOf(a.value);return c},BuildArrayLiteral:function(a){var b=this,a=a.first.map(function(a){return b.Build2(a)});
return new $data.Expressions.ArrayLiteralExpression(a)},BuildObjectLiteral:function(a){var b=this,a=a.first.map(function(a){var d=b.Build2(a.first);return new $data.Expressions.ObjectFieldExpression(a.value,d)});return new $data.Expressions.ObjectLiteralExpression(a)},BuildFunction:function(a){var b=this,c=a.first&&a.first.map(function(a){this.lambdaParams.push(a.value);return b.BuildParameter(a)},this),c=c||[],d=a.block.length==0?false:a.block[0].value==="return"?true:false,d=a.block.length>0?this.Build2(d?
a.block[0].first:a.block[0]):null;[].forEach(function(){this.lambdaParams.pop()},this);var e=new $data.Expressions.FunctionExpression(a.value,c,d);c.forEach(function(a){Object.defineProperty(a,"owningFunction",{value:e,enumerable:false})});e.name=a.name;return e},BuildCall:function(a){var b=this,c=b.Build2(a.first),a=a.second.map(function(a){return b.Build2(a)}),d,e;switch(true){case c instanceof $data.Expressions.PropertyExpression:e=c.expression;d=c.member;break;case c instanceof $data.Expressions.ParameterExpression:e=
Container.createConstantExpression(null,"object");d=c}return Container.createCallExpression(e,d,a)},BuildProperty:function(a){var b=this.Build2(a.first),a=a.second.identifier?new $data.Expressions.ConstantExpression(a.second.value,"string"):this.Build2(a.second);return new $data.Expressions.PropertyExpression(b,a)},BuildUnary:function(a){var b=$data.unaryOperators.getOperator(a.value,a.arity),c=b.expressionType,a=this.Build2(a.first);return new $data.Expressions.UnaryExpression(a,b,c)},BuildSimpleBinary:function(a){var b=
$data.binaryOperators.getOperator(a.value),c=b.expressionType,d=this.Build2(a.first||a.left),e=this.Build2(a.second||a.right);return new $data.Expressions.SimpleBinaryExpression(d,e,c,a.value,b.type)}});
$C("$data.Expressions.ConstantExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.value=a;this.type=Container.getTypeName(a);this.name=c},nodeType:{value:$data.Expressions.ExpressionType.Constant,enumerable:!0},type:{value:Object,writable:!0},value:{value:void 0,writable:!0},toString:function(){return this.value.toString()}});
$C("$data.Expressions.FunctionExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.parameters=b||[];this.name=a;this.body=c},toString:function(a){var b=this.parameters.map(function(a){return a.toString()}),b=b.join(","),a=this.body?this.body.toString(a):"";return"function "+this.name+"("+b+") { "+a+"}"},nodeType:{value:$data.Expressions.ExpressionType.Function,writable:!0},parameters:{value:void 0,dataType:Array,elementType:$data.Expressions.ParameterExpression},body:{value:void 0,
dataType:$data.Expressions.ExpressionNode},type:{}},null);$C("$data.Expressions.ObjectFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.fieldName=a;this.expression=b},nodeType:{value:$data.Expressions.ExpressionType.ObjectField,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.ObjectLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.members=a},nodeType:{value:$data.Expressions.ExpressionType.ObjectLiteral,writable:!0},toString:function(){return"unimplemented"},implementation:{get:function(){return function(a){var b={};a.forEach(function(a){b[a.name]=a.value});return b}},set:function(){}}},null);
$C("$data.Expressions.PagingExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a;this.amount=b;this.nodeType=c},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.ParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.nodeType=c||$data.Expressions.ExpressionType.Parameter;this.name=a;this.type=b||"unknown"},owningFunction:{value:void 0,enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.Parameter,writable:!0},name:{value:void 0,dataType:String,writable:!0},type:{value:void 0,dataType:"object",writable:!0},toString:function(a){a=a?this.type+" ":"";return a=a+this.name}},null);
$C("$data.Expressions.PropertyExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Object.defineProperty(this,"expression",{value:a,enumerable:true});Object.defineProperty(this,"member",{value:b,enumerable:true});this.type=b.dataType},nodeType:{value:$data.Expressions.ExpressionType.MemberAccess},expression:{value:void 0,dataType:$data.Expressions.ExpressionNode,writable:!0},implementation:{get:function(){return function(a,b){a[b]===void 0&&Guard.raise(new Exception("Parameter '"+
b+"' not found in context","Property not found!"));return a[b]}},set:function(){}},member:{value:void 0,dataType:$data.MemberDefinition,writable:!0},type:{value:void 0,writable:!0},toString:function(){return this.expression.toString()+"."+this.member.toString()}});
$C("$data.Expressions.SimpleBinaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d,e,i){this.left=a;this.right=b;this.nodeType=c;this.operator=d;this.type=e;this.resolution=i},implementation:{get:function(){return $data.binaryOperators.getOperator(this.operator).implementation},set:function(){}},type:{value:"number",writable:!0}});$C("$data.Expressions.ThisExpression",$data.Expressions.ExpressionNode,null,{nodeType:{value:$data.Expressions.ExpressionType.This}});
$C("$data.Expressions.ExpressionVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(a,b){if(!a)return a;var c=null;switch(a.expressionType){case $data.Expressions.ParameterExpression:c=this.VisitParameter(a,b);break;case $data.Expressions.ConstantExpression:c=this.VisitConstant(a,b);break;case $data.Expressions.FunctionExpression:c=this.VisitFunction(a,b);break;case $data.Expressions.CallExpression:c=this.VisitCall(a,b);break;case $data.Expressions.SimpleBinaryExpression:c=this.VisitBinary(a,
b);break;case $data.Expressions.PropertyExpression:c=this.VisitProperty(a,b);break;case $data.Expressions.ThisExpression:c=this.VisitThis(a,b);break;case $data.Expressions.ObjectLiteralExpression:c=this.VisitObjectLiteral(a,b);break;case $data.Expressions.ObjectFieldExpression:c=this.VisitObjectField(a,b);break;case $data.Expressions.ArrayLiteralExpression:c=this.VisitArrayLiteral(a,b);break;case $data.Expressions.UnaryExpression:c=this.VisitUnary(a,b);break;default:debugger}this._deep=this._deep-
1;return c},VisitArrayLiteral:function(a,b){var c=this,d=a.items.map(function(a){return c.Visit(a,b)});return Container.createArrayLiteralExpression(d)},VisitObjectLiteral:function(a,b){var c=this,d=a.members.map(function(a){return c.Visit(a,b)});return Container.createObjectLiteralExpression(d)},VisitObjectField:function(a,b){var c=this.Visit(a.expression,b);return Container.createObjectFieldExpression(a.fieldName,c)},VisitThis:function(a){return a},VisitCall:function(a,b){var c=a.args.map(function(a){return this.Visit(a,
b)},this),d=this.Visit(a.expression,b),e=this.Visit(a.member,b);return new $data.Expressions.CallExpression(d,e,c)},VisitParameter:function(a){return a},VisitConstant:function(a){return a},VisitFunction:function(a,b){var c=this,d=a.parameters.map(function(a){return c.Visit(a,b)}),e=c.Visit(a.body,b);return new $data.Expressions.FunctionExpression(a.name,d,e)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return new $data.Expressions.SimpleBinaryExpression(c,d,a.nodeType,
a.operator,a.type)},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);return new $data.Expressions.PropertyExpression(c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:new $data.Expressions.UnaryExpression(c,a.operator,a.nodeType)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,
c,d,e)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,c)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,c,d)},VisitArray:function(a,b){for(var c=[],d=true,e=0;e<a.length;e++){c[e]=this.Visit(a[e],b);d=d&&c[e]===a[e]}return d?a:c},GetMemberChain:function(a,
b){if(a.expression.type==MEMBERACCESS){var c=this.GetMemberChain(a.expression,b);c.push(a.member);return c}return[a.expression,a.member]}},{});
$C("$data.Expressions.ParameterProcessor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},Visit:function(a,b){if((a instanceof $data.Expressions.ParameterExpression||a instanceof $data.Expressions.ThisExpression)&&this.canResolve(a)){var c=this.resolve(a,b);if(c!==a)c.resolvedBy=this.constructor.name;return c}return a},canResolve:function(){Guard.raise("Pure method")},resolve:function(){Guard.raise("Pure method")}});
$C("$data.Expressions.GlobalContextProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(a){this.global=a},canResolve:function(a){return a.nodeType==$data.Expressions.ExpressionType.Parameter&&a.name in this.global},resolve:function(a){var b=this.global[a.name];return Container.createConstantExpression(b,typeof b,a.name)}});
$C("$data.Expressions.ConstantValueResolver",$data.Expressions.ParameterProcessor,null,{constructor:function(a,b){this.globalResolver=Container.createGlobalContextProcessor(b);this.paramsObject=a},canResolve:function(a){return a.nodeType==$data.Expressions.ExpressionType.This&&this.paramsObject?true:this.globalResolver.canResolve(a)},resolve:function(a){return a.nodeType==$data.Expressions.ExpressionType.This?Container.createConstantExpression(this.paramsObject,typeof this.paramsObject,"this"):this.globalResolver.resolve(a)}});
$C("$data.Expressions.LocalContextProcessor",$data.Expressions.GlobalContextProcessor,null,{constructor:function(a){this.canResolve=function(b){return b.nodeType==$data.Expressions.ExpressionType.Parameter&&a("typeof "+b.name)!=="undefined"};this.resolve=function(b){b=a(b.name);return Container.createConstantExpression(b,typeof b)}}});
$C("$data.Expressions.LambdaParameterProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(a){var b={};this.canResolve=function(c){if(c.nodeType==$data.Expressions.ExpressionType.LambdaParameter){var d=c.owningFunction.parameters;if(d.length==1&&c.name==d[0].name){b[c.name]=a[0];return true}for(var e=0;e<d.length;e++)if(d[e].name==c.name){b[c.name]=a[e];return true}}return false};this.resolve=function(a){var d=Container.createParameterExpression(a.name,b[a.name],$data.Expressions.ExpressionType.LambdaParameter);
Object.defineProperty(d,"owningFunction",{value:a.owningFunction,enumerable:false});return d}}});
$C("$data.Expressions.ParameterResolverVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){this.lambdaParamCache={}},Visit:function(a,b){return $data.Expressions.ExpressionVisitor.prototype.Visit.call(this,a,b)},VisitArrayLiteral:function(a,b){var c=this,d=a.items.map(function(a){return c.Visit(a,b)});if(d.every(function(a){return a instanceof $data.Expressions.ConstantExpression})){d=d.map(function(a){return a.value});return Container.createConstantExpression(d,"array")}return Container.createArrayLiteralExpression(d)},
VisitObjectLiteral:function(a,b){var c=this,d=a.members.map(function(a){return c.Visit(a,b)});if(d.every(function(a){return a.expression instanceof $data.Expressions.ConstantExpression})){d=d.map(function(a){return{name:a.fieldName,value:a.expression.value}});return Container.createConstantExpression(a.implementation(d))}return Container.createObjectLiteralExpression(d)},VisitThis:function(a,b){return b.Visit(a,b)},VisitParameter:function(a,b){var c;switch(a.nodeType){case $data.Expressions.ExpressionType.Parameter:case $data.Expressions.ExpressionType.LambdaParameter:c=
b.Visit(a,b);c.nodeType==$data.Expressions.ExpressionType.LambdaParameter&&(this.lambdaParamCache[c.name]=c);return c;case $data.Expressions.ExpressionType.LambdaParameterReference:if(c=this.lambdaParamCache[a.name]){c=Container.createParameterExpression(a.name,c.type,$data.Expressions.ExpressionType.LambdaParameterReference);c.paramIndex=a.paramIndex;return c}}return a},VisitConstant:function(a){return a},VisitFunction:function(a,b){var c=this,d=a.parameters.map(function(a){return c.Visit(a,b)}),
e=c.Visit(a.body,b);return new $data.Expressions.FunctionExpression(a.name,d,e)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b),e=$data.Expressions;if(c instanceof e.ConstantExpression&&d instanceof e.ConstantExpression){c=a.implementation(c.value,d.value);return Container.createConstantExpression(c)}return new Container.createSimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);if(c instanceof $data.Expressions.ConstantExpression){c=
a.operator.implementation(c.value);return Container.createConstantExpression(c)}return new Container.createUnaryExpression(c,a.operator,a.nodeType)},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b),e;if(c instanceof $data.Expressions.ConstantExpression&&d instanceof $data.Expressions.ConstantExpression){e=a.implementation(c.value,d.value);return Container.createConstantExpression(e,typeof e,c.name+"$"+d.value)}if(c===a.expression&&d===a.member)return a;return e=
Container.createPropertyExpression(c,d)},VisitCall:function(a,b){var c=$data.Expressions.ExpressionVisitor.prototype.VisitCall.apply(this,arguments),d=c.expression,e=c.member,i=c.args;if(function(a,b,c){return b instanceof $data.Expressions.ConstantExpression&&(!c||c instanceof $data.Expressions.ConstantExpression)&&a.every(function(a){return a instanceof $data.Expressions.ConstantExpression})}(i,e,d)){c=e.value;typeof c==="string"&&d.value&&(c=d.value[c]);typeof c!=="function"&&Guard.raise("Constant expression is not a method...");
d=a.implementation(d.value,c,i);return new $data.Expressions.ConstantExpression(d)}return c}},{});$C("$data.Expressions.AggregatedVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(a){this.Visit=function(b,c){for(var d=0;d<a.length;d++){var e=a[d].Visit(b,c);if(e!==b)return e}return b}}});
$C("$data.Expressions.LogicalSchemaBinderVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b),e=b.memberResolver.resolve(c.type,d.value);d.type=e;return Container.createPropertyExpression(c,d)}},{});
$data.Class.define("$data.Expressions.ExpTreeVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(a,b){this._deep=this._deep+1;var c=null;switch(a.type){case LITERAL:c=this.VisitLiteral(a,b);break;case VARIABLE:c=this.VisitVariable(a,b);break;case MEMBERACCESS:c=this.VisitMember(a,b);break;case BINARY:c=this.VisitBinary(a,b);break;case UNARY:c=this.VisitUnary(a,b);break;case INCDEC:c=this.VisitIncDec(a,b);break;case EQUALITY:c=this.VisitEquality(a,b);break;case DECISION:c=this.VisitDecision(a,
b);break;case METHODCALL:c=this.VisitMethodCall(a,b);break;case NEW:c=this.VisitNew(a,b);break;case JSONASSIGN:c=this.VisitJsonAssign(a,b);break;case ARRAYACCESS:c=this.VisitArrayAccess(a,b);break;default:Guard.raise("Type isn't implemented: "+a.type)}this._deep=this._deep-1;return c},VisitLiteral:function(a){return a},VisitVariable:function(a){return a},VisitMember:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);return c===a.expression&&d===a.member?a:$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(a.executable,
c,d)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right?a:$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(a.executable,a.operator,c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(a.executable,a.operator,c)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(a.executable,
a.operator,c,a.suffix)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right?a:$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(a.executable,a.operator,c,d)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e)},VisitMethodCall:function(a,
b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);return c===a.object&&d===a.args?a:$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(a.executable,c,a.method,d)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,c)},VisitJsonAssign:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(c===a.left&&d===a.right)return a;c.JSONASSIGN=true;d.JSONASSIGN=
true;return $data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true,c,d)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,c,d)},VisitArray:function(a,b){for(var c=[],d=true,e=0;e<a.length;e++){c[e]=this.Visit(a[e],b);d=d&&c[e]===a[e]}return d?a:c},GetMemberChain:function(a,b){if(a.expression.type==MEMBERACCESS){var c=this.GetMemberChain(a.expression,
b);c.push(a.member);return c}return[a.expression,a.member]}},{});
$data.Class.define("$data.Expressions.SetExecutableVisitor",$data.Expressions.ExpTreeVisitor,null,{Visit:function(a,b){switch(a.type){case LITERAL:return this.VisitLiteral(a,b);case VARIABLE:return this.VisitVariable(a,b);case MEMBERACCESS:return this.VisitMember(a,b);case BINARY:return this.VisitBinary(a,b);case UNARY:return this.VisitUnary(a,b);case INCDEC:return this.VisitIncDec(a,b);case EQUALITY:return this.VisitEquality(a,b);case DECISION:return this.VisitDecision(a,b);case METHODCALL:return this.VisitMethodCall(a,
b);case NEW:return this.VisitNew(a,b);case JSONASSIGN:return this.VisitJsonAssign(a,b);case ARRAYACCESS:return this.VisitArrayAccess(a,b);default:Guard.raise("Type isn't implemented: "+a.type)}},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right&&c.executable&&d.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(c.executable&&d.executable,a.operator,c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,
b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(c.executable,a.operator,c)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(c.executable,a.operator,c,a.suffix)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right&&c.executable&&d.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(c.executable&&
d.executable,a.operator,c,d)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right&&d.executable&&e.executable&&c.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(d.executable&&e.executable&&c.executable,c,d,e)},VisitMethodCall:function(a,b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);return c===a.object&&d===a.args&&(c==null?
true:c.executable)==a.executable?a:$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(c==null?true:c.executable,c,a.method,d)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,c)},VisitJsonAssign:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(c===a.left&&d===a.right)return a;c.JSONASSIGN=true;d.JSONASSIGN=true;return $data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true,
c,d)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,c,d)},VisitArray:function(a,b){for(var c=[],d=true,e=0;e<a.length;e++){c[e]=this.Visit(a[e],b);d=d&&c[e]===a[e]}return d?a:c},VisitLiteral:function(a){return{type:a.type,executable:true,value:a.value,valueType:a.valueType}},VisitVariable:function(a,b){typeof b.paramContext[a.name]==void 0&&Guard.raise("Variable is not defined in the paramContext: "+
a.name);return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(true,"Math","GLOBALOBJECT")},VisitMember:function(a,b){var c=this.GetMemberChain(a)[0].name,d=b.lambdaParams.indexOf(c)>=0,e=c==b.paramsName;!e&&!d&&Guard.raise("Variable is not defined in the paramContext or the lambda parameters: "+c);return $data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(e,a.expression,a.member)}},null);
$data.Class.define("$data.Expressions.ExecutorVisitor",$data.Expressions.ExpTreeVisitor,null,{VisitVariable:function(a,b){if(!a.executable)return a;var c=a.name==b.paramsName?b.paramContext:window[a.name];typeof c=="undefined"&&Guard.raise(new Exception("Unknown variable in '"+b.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+a.name+"'.","InvalidOperation",{operationName:b.operation,missingParameterName:a.name}));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,
typeof c,c)},VisitMember:function(a,b){if(!a.executable)return a;for(var c=this.GetMemberChain(a),d,e=0;e<c.length;e++)d=e==0?b.paramContext:d[c[e].name];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof d,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);c!==a.operand&&(a=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(a.executable,a.operator,c));if(!a.executable)return a;eval("value = "+a.operator+" "+(c.valueType=="string"?"'"+c.value+
"'":c.value));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);c!==a.operand&&(a=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(a.executable,a.operator,c,a.suffix));if(!a.executable)return a;c=a.suffix?a.operator=="++"?c.value++:c.value--:a.operator=="++"?++c.value:--c.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof c,c)},VisitBinary:function(a,
b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(c!==a.left||d!==a.right)a=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(a.executable,a.operator,c,d);if(!a.executable)return a;eval("value = "+(c.valueType=="string"?"'"+c.value+"'":c.value)+" "+a.operator+" "+(d.valueType=="string"?"'"+d.value+"'":d.value));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,
b);if(c!==a.left||d!==a.right)a=$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(a.executable,a.operator,c,d);if(!a.executable)return a;eval("value = "+(c.valueType=="string"?"'"+c.value+"'":c.value)+" "+a.operator+" "+(d.valueType=="string"?"'"+d.value+"'":d.value));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);if(c!==
a.expression||d!==a.left||e!==a.right)a=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e);if(!a.executable)return a;c=c.value?d.value:e.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof c,c)},VisitMethodCall:function(a,b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);if(c!==a.object||d!=a.args)a=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(a.executable,c,a.method,d);if(!a.executable)return a;
for(var e=[],i=0;i<d.length;i++){var g=d[i];e.push(typeof g.value=="string"?"'"+g.value+"'":g.value)}c=c?"value = object.value[eNode.method]("+e.join(",")+");":"value = "+a.method+"("+e.join(",")+");";eval(c);return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b),c=c.value[d.value];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof c,c)}},
null);
$data.Class.define("$data.Expressions.ExpressionBuilder",null,null,{constructor:function(a){this.context=a},_isLambdaParam:function(a){for(var b=this.context.lambdaParams,c=0;c<b.length;c++)if(b[c]==a)return true;return false},_isParam:function(a){return this.context.paramContext[a]!=void 0},_isParamRoot:function(a){return this.context.paramsName==a},Build:function(a,b){var c;switch(a.arity){case "infix":"("==a.value?c=this.BuildMethodCall(a,b):"."==a.value?c=this.BuildMember(a,b):["===","==","!==",
"!=",">","<",">=","<="].indexOf(a.value)>=0?c=this.BuildEquality(a,b):["&&","||"].indexOf(a.value)>=0?c=this.BuildBinary(a,b):["+","-","*","/","%"].indexOf(a.value)>=0?c=this.BuildBinary(a,b):"["==a.value?c=this.BuildArrayAccess(a,b):Guard.raise("Value of infix node isn't implemented: "+a.value);break;case "prefix":["+","-","!"].indexOf(a.value)>=0?c=this.BuildUnary(a,b):["++","--"].indexOf(a.value)>=0?c=this.BuildIncDec(a,b):"{"==a.value?c=this.BuildNewExpression(a,b):Guard.raise("Value of prefix node isn't implemented: "+
a.value);break;case "suffix":["++","--"].indexOf(a.value)>=0?c=this.BuildIncDec(a,b):Guard.raise("Value of suffix node isn't implemented: "+a.value);break;case "string":case "number":c=this.BuildLiteral(a,b);break;case "ternary":a.value=="?"?c=this.BuildDecision(a,b):Guard.raise("Value of ternary node isn't implemented: "+a.value);break;case null:case void 0:c=a.type=="boolean"&&(a.value=="true"||a.value=="false")?this.BuildBoolLiteral(a,b):this.BuildVariable(a,b);break;default:Guard.raise("Arity isn't implemented: "+
a.arity)}return c},BuildNewExpression:function(a){for(var b=$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,[]),a=a.first,c=0;c<a.length;c++)b.values.push(this.Build(a[c],b));return b},BuildLiteral:function(a){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,a.arity,a.value)},BuildBoolLiteral:function(a){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,a.type,a.value=="true"?true:false)},BuildVariable:function(a,b){if(!a.first){if(b.type==
MEMBERACCESS){var c;c=this._isLambdaParam(a.value)?"LAMBDAPARAM":this._isParamRoot(a.value)?"PARAMETERROOT":this._isParam(a.value)?"PARAMETER":"PROPERTY"}else this._isLambdaParam(a.value)?c="LAMBDAPARAM":this._isParamRoot(a.value)?c="PARAMETERROOT":this._isParam(a.value)?c="PARAMETER":window[a.value]!=void 0?c="GLOBALOBJECT":Guard.raise(new Exception("Unknown variable in '"+this.context.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+
a.value+"'.","InvalidOperation",{operationName:this.context.operation,missingParameterName:a.value}));return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(true,a.value,c)}c=$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"name",a.value);var d=$data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true),e=this.Build(a.first,d);d.left=c;d.right=e;c.JSONASSIGN=true;e.JSONASSIGN=true;return d},BuildMember:function(a){if(a.value!="."||a.arity!=
"infix")return a.type=="string"?$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,a.arity,a.value):$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(true,null,a.value);var b=$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(true),c=this.Build(a.first,b),a=this.Build(a.second,b);b.expression=c;b.member=a;return b},BuildUnary:function(a){var b=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(true,a.value);b.operand=this.Build(a.first,
b);return b},BuildIncDec:function(a){var b=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(true,a.value,null,a.arity=="suffix");b.operand=this.Build(a.first,b);return b},BuildBinary:function(a){a.first||Guard.raise("Cannot build binary: node.first is null");a.second||Guard.raise("Cannot build binary: node.second is null");var b=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(true,a.value);b.left=this.Build(a.first,b);b.right=this.Build(a.second,b);return b},BuildEquality:function(a){var b=
$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(true,a.value);b.left=this.Build(a.first,b);b.right=this.Build(a.second,b);return b},BuildDecision:function(a){var b=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(true);b.expression=this.Build(a.first,b);b.left=this.Build(a.second,b);b.right=this.Build(a.third,b);return b},BuildMethodCall:function(a){var b=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(true);if(a.first.type=="function"){b.object=
this.Build(a.first.first,b);b.method=a.first.second.value}else{a.first.type!=null&&Guard.raise("Cannot build MethodCall because type is "+type);b.object=null;b.method=a.first.value}for(var a=a.second,c=[],d=0;d<a.length;d++)c[d]=this.Build(a[d],b);b.args=c;return b},BuildArrayAccess:function(a){var b=$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true);b.array=this.Build(a.first,b);b.index=this.Build(a.second,b);return b}},null);
$C("$data.Expressions.AssociationInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.associationInfo=a},nodeType:{value:$data.Expressions.ExpressionType.AssociationInfo,enumerable:!0}});
$C("$data.Expressions.CodeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Container.resolveType(Container.getTypeName(a))==$data.String&&a.replace(/^[\s\xA0]+/,"").match("^function")!="function"&&(a="function (it) { return "+a+"; }");this.source=a;this.parameters=b},nodeType:{value:$data.Expressions.ExpressionType.Code,enumerable:!0}});
$C("$data.Expressions.CodeToEntityConverter",$data.Expressions.ExpressionVisitor,null,{constructor:function(a){this.scopeContext=a;this.parameters=[]},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b),e=this.scopeContext.resolveBinaryOperator(a.nodeType,a,b.frameType);return Container.createSimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type,e)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b),d=this.scopeContext.resolveUnaryOperator(a.nodeType,a,b.frameType);
return Container.createUnaryExpression(c,a.operator,a.nodeType,d)},VisitParameter:function(a,b){Guard.requireValue("context",b);var c=$data.Expressions.ExpressionType;switch(a.nodeType){case c.LambdaParameterReference:return Container.createEntityExpression(b.lambdaParameters[a.paramIndex],{lambda:a.name});case c.LambdaParameter:break;default:Guard.raise("Global parameter "+a.name+" not found. For query parameters use 'this.field' notation")}},VisitThis:function(a,b){var c=this.parameters.push({name:"",
value:void 0})-1;return Container.createQueryParameterExpression("",c,b.queryParameters,void 0)},VisitFunction:function(a,b){return $data.Expressions.ExpressionVisitor.prototype.VisitFunction.apply(this,arguments).body},VisitCall:function(a,b){var c=this,d=this.Visit(a.expression,b),e=this.Visit(a.member,b),i=a.args.map(function(a){return c.Visit(a,b)});switch(true){case d instanceof $data.Expressions.QueryParameterExpression:i=i.map(function(a){return a.value});i=a.implementation(d.value,e.value,
i);return Container.createQueryParameterExpression(d.name+"$"+e.value,d.index,i,typeof i);case d instanceof $data.Expressions.EntityFieldExpression:case d instanceof $data.Expressions.EntityFieldOperationExpression:var g=this.scopeContext.resolveFieldOperation(e.value,d,b.frameType);g||Guard.raise("Unknown entity field operation: "+e.getJSON());e=Container.createMemberInfoExpression(g);return i=Container.createEntityFieldOperationExpression(d,e,i);case d instanceof $data.Expressions.EntitySetExpression:(g=
this.scopeContext.resolveSetOperations(e.value,d,b.frameType))||Guard.raise("Unknown entity field operation: "+e.getJSON());e=Container.createMemberInfoExpression(g);return i=Container.createFrameOperationExpression(d,e,i);default:Guard.raise("VisitCall: Only fields can have operations: "+a.getType().name)}},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);Guard.requireType("member",d,$data.Expressions.ConstantExpression);switch(c.expressionType){case $data.Expressions.EntityExpression:var e=
c.getMemberDefinition(d.value);e||Guard.raise(new Exception("Unknown member: "+d.value,"MemberNotFound"));switch(e.storageModel.PhysicalType.memberDefinitions.getMember(e.name).kind){case "property":d=Container.createMemberInfoExpression(e);return c=Container.createEntityFieldExpression(c,d);case "navProperty":d=e.storageModel.Associations[e.name];c=Container.createEntitySetExpression(c,Container.createAssociationInfoExpression(d));return d.ToMultiplicity!=="*"?Container.createEntityExpression(c,
{}):c;case "complexProperty":d=Container.createMemberInfoExpression(e);return c=Container.createComplexTypeExpression(c,d)}case $data.Expressions.ComplexTypeExpression:(e=c.getMemberDefinition(d.value))||Guard.raise("Unknown member "+d.value+" on "+c.entityType.name);d=Container.createMemberInfoExpression(e);if(Container.isPrimitiveType(Container.resolveType(e.dataType)))return c=Container.createEntityFieldExpression(c,d);return c=Container.createComplexTypeExpression(c,d);case $data.Expressions.QueryParameterExpression:e=
a.implementation(c.value,d.value);this.parameters[c.index].name=this.parameters[c.index].name+("$"+d.value);this.parameters[c.index].value=e;return Container.createQueryParameterExpression(c.name+"$"+d.value,c.index,e,Container.getTypeName(e));case $data.Expressions.EntityFieldExpression:case $data.Expressions.EntityFieldOperationExpression:(e=this.scopeContext.resolveFieldOperation(d.value,c,b.frameType))||Guard.raise("Unknown entity field operation: "+d.getJSON());d=Container.createMemberInfoExpression(e);
return c=Container.createEntityFieldOperationExpression(c,d,[]);default:Guard.raise("Unknown expression type to handle: "+c.expressionType.name)}}});
$C("$data.Expressions.ComplexTypeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Guard.requireType("source",a,[$data.Expressions.EntityExpression,$data.Expressions.ComplexTypeExpression]);Guard.requireType("selector",b,[$data.Expressions.EntityExpression,$data.Expressions.MemberInfoExpression]);this.source=a;this.selector=b;var c=a.entityType.getMemberDefinition(b.memberName).dataType;this.entityType=Container.resolveType(c)},getMemberDefinition:function(a){return this.entityType.getMemberDefinition(a)},
nodeType:{value:$data.Expressions.ExpressionType.Com}});$C("$data.Expressions.EntityContextExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){Object.defineProperty(this,"instance",{value:a,enumerable:false})},nodeType:{value:$data.Expressions.ExpressionType.EntityContext,enumerable:!0}});
$C("$data.Expressions.EntityExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Guard.requireValue("source",a);Guard.requireValue("selector",b);!(a instanceof $data.Expressions.EntitySetExpression)&&!(a instanceof $data.Expressions.ServiceOperationExpression)&&Guard.raise("Only EntitySetExpressions can be the source for an EntityExpression");this.source=a;this.selector=b;this.entityType=this.source.elementType;this.storageModel=this.source.storageModel;Guard.requireValue("entityType",
this.entityType);Guard.requireValue("storageModel",this.storageModel)},getMemberDefinition:function(a){var b=this.entityType.getMemberDefinition(a);b||Guard.raise(new Exception("Unknown member "+a+" on type "+this.entityType.name,"MemberNotFound"));b.storageModel=this.storageModel;return b},nodeType:{value:$data.Expressions.ExpressionType.Entity}});
$C("$data.Expressions.EntityExpressionVisitor",null,null,{constructor:function(){this.lambdaTypes=[]},canVisit:function(a){return a instanceof $data.Expressions.ExpressionNode},Visit:function(a,b){if(!this.canVisit(a))return a;var c="Visit"+a.getType().name;if(c in this){c=this[c].call(this,a,b);return typeof c==="undefined"?a:c}return a},VisitToArrayExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createToArrayExpression(c):a},VisitForEachExpression:function(a,
b){var c=this.Visit(a.source,b);return c!==a.source?Container.createForEachExpression(c):a},VisitMemberInfoExpression:function(a){return a},VisitSingleExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createSingleExpression(c):a},VisitFirstExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createFirstExpression(c):a},VisitSomeExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createSomeExpression(c):
a},VisitEveryExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createEveryExpression(c):a},VisitCountExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createCountExpression(c):a},VisitObjectLiteralExpression:function(a,b){for(var c=a.members.map(function(a){return this.Visit(a,b)},this),d=true,e=0;e<a.members.length;e++)d=d&&a.members[e]===c[e];return!d?Container.createObjectLiteralExpression(c):a},VisitObjectFieldExpression:function(a,
b){var c=this.Visit(a.expression,b);return a.expression!==c?Container.createObjectFieldExpression(a.fieldName,c):a},VisitIncludeExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createIncludeExpression(c,a.selector):a},VisitUnaryExpression:function(a,b){var c=this.Visit(a.operand,b);return a.operand!==c?Container.createUnaryExpression(c,a.operator,a.nodeType,a.resolution):a},VisitSimpleBinaryExpression:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,
b);return c!==a.left||d!==a.right?new $data.Expressions.SimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type,a.resolution):a},VisitEntityContextExpression:function(a){return a},VisitCodeExpression:function(a){return a},VisitComplexTypeExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createComplexTypeExpression(c,d):a},VisitEntityExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==
a.source||d!==a.selector?Container.createEntityExpression(c,d):a},VisitEntityFieldExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createEntityFieldExpression(c,d):a},VisitEntityFieldOperationExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.operation,b),e=a.parameters.map(function(a){return this.Visit(a)},this);return Container.createEntityFieldOperationExpression(c,d,e)},VisitParametricQueryExpression:function(a,
b){var c=this.Visit(a.expression,b),d=a.parameters.map(function(a){return this.Visit(a)},this);return Container.createParametricQueryExpression(c,d)},VisitEntitySetExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createEntitySetExpression(c,d,a.params,a.instance):a},VisitFilterExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createFilterExpression(c,
d,a.params,a.instance):a},VisitProjectionExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createProjectionExpression(c,d,a.params,a.instance):a},VisitOrderExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createOrderExpression(c,d,a.nodeType):a},VisitPagingExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.amount,b);return c!==
a.source||d!==a.amount?Container.createPagingExpression(c,d,a.nodeType):a}});$C("$data.Expressions.EntityFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.selector=b;this.source=a;if(this.selector instanceof $data.Expressions.MemberInfoExpression||this.selector.name)this.memberName=this.selector.name},nodeType:{value:$data.Expressions.ExpressionType.EntityField}});
$C("$data.Expressions.EntityFieldOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a;this.operation=b;this.parameters=c},nodeType:{value:$data.Expressions.ExpressionType.EntityFieldOperation}});
$C("$data.Expressions.EntitySetExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d){Guard.requireType("source",a,[$data.Expressions.EntityContextExpression,$data.Expressions.EntitySetExpression]);Guard.requireType("selector",a,[$data.Expressions.MemberInfoExpression,$data.Expressions.CodeExpression,$data.Expressions.ParametricQueryExpression]);Object.defineProperty(this,"source",{value:a,enumerable:true,writable:true});Object.defineProperty(this,"selector",{value:b,enumerable:true,
writable:true});Object.defineProperty(this,"params",{value:c,enumerable:true,writable:true});Object.defineProperty(this,"instance",{value:d,enumerable:false,writable:true});this.storage_type={};a:{for(;a;){if(a instanceof $data.Expressions.EntityContextExpression)break a;a=a.source}a=void 0}switch(true){case this.source instanceof $data.Expressions.EntityContextExpression:Guard.requireType("selector",b,$data.Expressions.MemberInfoExpression);this.elementType=b.memberDefinition.elementType;this.storageModel=
a.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntityExpression:Guard.requireType("selector",b,$data.Expressions.AssociationInfoExpression);this.elementType=b.associationInfo.ToType;this.storageModel=a.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntitySetExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;case this.source instanceof
$data.Expressions.ServiceOperationExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;default:Guard.raise("Unknown source type for EntitySetExpression: "+this.source.getType().name)}},nodeType:{value:$data.Expressions.ExpressionType.EntitySet,enumerable:!0}});$C("$data.Expressions.FrameOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a;this.operation=b;this.parameters=c},nodeType:{value:$data.Expressions.ExpressionType.FrameOperation}});
$C("$data.Expressions.FilterExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.Filter,enumerable:!0}});$C("$data.Expressions.FrameOperator",$data.Expressions.ExpressionNode,null,{constructor:function(){this.isTerminated=true}});
$C("$data.Expressions.CountExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Integer},nodeType:{value:$data.Expressions.ExpressionType.Count,enumerable:!0}});$C("$data.Expressions.SingleExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Single,enumerable:!0}});
$C("$data.Expressions.FirstExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.First,enumerable:!0}});$C("$data.Expressions.ForEachExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ForEach,enumerable:!0}});
$C("$data.Expressions.ToArrayExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ToArray,enumerable:!0}});$C("$data.Expressions.SomeExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Some,enumerable:!0}});
$C("$data.Expressions.EveryExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Every,enumerable:!0}});$C("$data.Expressions.IncludeExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.Include,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.MemberInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.memberDefinition=a;this.memberName=a.name},nodeType:{value:$data.Expressions.ExpressionType.MemberInfo,enumerable:!0}});$C("$data.Expressions.OrderExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(a,b,c){this.nodeType=c},nodeType:{value:$data.Expressions.ExpressionType.OrderBy,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.ParametricQueryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.expression=a;this.parameters=b},nodeType:{value:$data.Expressions.ExpressionType.ParametricQuery,enumerable:!0}});$C("$data.Expressions.ProjectionExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.Projection,enumerable:!0}});
$C("$data.Expressions.QueryExpressionCreator",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){Guard.requireValue("scopeContext",a);this.scopeContext=a},VisitEntitySetExpression:function(a){a.source instanceof $data.Expressions.EntityContextExpression&&this.lambdaTypes.push(a);return a},VisitServiceOperationExpression:function(a){a.source instanceof $data.Expressions.EntityContextExpression&&this.lambdaTypes.push(a);return a},VisitCodeExpression:function(a,b){var c=a.source.toString(),
c=Container.createCodeParser(this.scopeContext).createExpression(c);this.scopeContext.log({event:"JSCodeExpression",data:c});var d=Container.createConstantValueResolver(a.parameters,window),c=Container.createParameterResolverVisitor().Visit(c,d);this.scopeContext.log({event:"JSCodeExpressionResolved",data:c});d=Container.createCodeToEntityConverter(this.scopeContext);c=d.Visit(c,{queryParameters:a.parameters,lambdaParameters:this.lambdaTypes,frameType:b.frameType});d=Container.createParametricQueryExpression(c,
d.parameters);this.scopeContext.log({event:"EntityExpression",data:c});return d},VisitFilterExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createFilterExpression(c,d,a.params,a.instance):a},VisitProjectionExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createProjectionExpression(c,
d,a.params,a.instance):a},VisitOrderExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createOrderExpression(c,d,a.nodeType):a}});$C("$data.Expressions.QueryParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.name=a;this.index=b;this.value=c;this.type=Container.getTypeName(c)},nodeType:{value:$data.Expressions.ExpressionType.QueryParameter,writable:!1}});
$C("$data.Expressions.RepresentationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(){},getMemberDefinition:function(a){return this.entityType.getMemberDefinition(a)},nodeType:{value:$data.Expressions.ExpressionType.Entity}});
$C("$data.Expressions.ServiceOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d){Guard.requireType("source",a,[$data.Expressions.EntityContextExpression]);Guard.requireType("selector",a,[$data.Expressions.MemberInfoExpression]);Object.defineProperty(this,"source",{value:a,enumerable:true,writable:true});Object.defineProperty(this,"selector",{value:b,enumerable:true,writable:true});Object.defineProperty(this,"params",{value:c,enumerable:true,writable:true});Object.defineProperty(this,
"cfg",{value:d,enumerable:false,writable:true});a:{for(;a;){if(a instanceof $data.Expressions.EntityContextExpression)break a;a=a.source}a=void 0}switch(true){case this.source instanceof $data.Expressions.EntityContextExpression:this.elementType=d.elementType?Container.resolveType(d.elementType):Container.resolveType(d.returnType);this.storageModel=d.elementType?a.instance._storageModel.getStorageModel(Container.resolveType(d.elementType)):null;break;default:Guard.raise("Unknown source type for EntitySetExpression: "+
this.source.getType().name)}},nodeType:{value:$data.Expressions.ExpressionType.ServiceOperation,enumerable:!0}});$data.Class.define("$data.Validation.ValidationError",null,null,{constructor:function(a,b,c){this.Message=a;this.PropertyDefinition=b;this.Type=c},Type:{dataType:"string"},Message:{dataType:"string"},PropertyDefinition:{dataType:$data.MemberDefinition}},null);
$data.Class.define("$data.Validation.EntityValidationBase",null,null,{ValidateEntity:function(){return[]},ValidateEntityField:function(){return[]},getValidationValue:function(){Guard.raise("Pure class")},getValidationMessage:function(){Guard.raise("Pure class")}},null);$data.Validation=$data.Validation||{};$data.Validation.Entity=new $data.Validation.EntityValidationBase;
$data.Class.define("$data.Validation.EntityValidation",$data.Validation.EntityValidationBase,null,{ValidateEntity:function(a){var b=[];a.getType().memberDefinitions.getPublicMappedProperties().forEach(function(c){b=b.concat(this.ValidateEntityField(a,c,void 0,true))},this);return b},ValidateEntityField:function(a,b,c,d){var e=[],i=Container.resolveName(Container.resolveType(b.dataType));this.fieldValidate(a,b,!d?c:a[b.name],e,i);return e},getValidationValue:function(a,b){return a[b]&&a[b].value?a[b].value:
a[b]},getValidationMessage:function(a,b,c){if(typeof a[b]=="object"&&a[b].message)c=a[b].message;else if(a.errorMessage)c=a.errorMessage;return c},createValidationError:function(a,b,c){return new $data.Validation.ValidationError(this.getValidationMessage(a,b,c),a,b)},supportedValidations:{value:{"$data.Number":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true},minValue:function(a,b){return Object.isNullOrUndefined(a)||
a>=b},maxValue:function(a,b){return Object.isNullOrUndefined(a)||a<=b}},"$data.Integer":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true},minValue:function(a,b){return Object.isNullOrUndefined(a)||a>=b},maxValue:function(a,b){return Object.isNullOrUndefined(a)||a<=b}},"$data.String":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||
typeof b=="function"?b(a):true},minLength:function(a,b){return Object.isNullOrUndefined(a)||a.length>=b},maxLength:function(a,b){return Object.isNullOrUndefined(a)||a.length<=b},length:function(a,b){return Object.isNullOrUndefined(a)||a.length==b},regex:function(a,b){return Object.isNullOrUndefined(a)||a.match(b)}},"$data.Date":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true},minValue:function(a,
b){return Object.isNullOrUndefined(a)||a>=b},maxValue:function(a,b){return Object.isNullOrUndefined(a)||a<=b}},"$data.Boolean":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true}},"$data.Array":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true},length:function(a,b){return Object.isNullOrUndefined(a)||
a.length==b}},"$data.Object":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true}}}},fieldValidate:function(a,b,c,d,e){if(!(a.entityState==$data.EntityState.Modified&&a[b.name]==void 0)){var i=this.supportedValidations[e];i&&Object.keys(i).forEach(function(e){b[e]&&i[e]&&!i[e].call(a,c,this.getValidationValue(b,e))&&d.push(this.createValidationError(b,e,"Validation error!"))},this)}}},null);
$data.Validation.Entity=new $data.Validation.EntityValidation;$data.Class.define("$data.Notifications.ChangeDistributorBase",null,null,{distributeData:function(){Guard.raise("Pure class")}},null);
$data.Class.define("$data.Notifications.ChangeCollectorBase",null,null,{buildData:function(){Guard.raise("Pure class")},processChangedData:function(a){this.Distrbutor&&this.Distrbutor.distributeData&&this.Distrbutor.distributeData(this.buildData(a))},Distrbutor:{enumerable:!1,dataType:$data.Notifications.ChangeDistributorBase,storeOnObject:!0}},null);
$data.Class.define("$data.Notifications.ChangeDistributor",$data.Notifications.ChangeDistributorBase,null,{constructor:function(a){this.broadcastUrl=a},distributeData:function(a){$data.ajax({url:this.broadcastUrl,type:"POST",data:"data="+JSON.stringify(a),succes:this.success,error:this.error})},broadcastUrl:{dataType:"string"},success:function(){},error:function(){}},null);
$data.Class.define("$data.Notifications.ChangeCollector",$data.Notifications.ChangeCollectorBase,null,{buildData:function(a){var b=[];a.forEach(function(a){var d={entityState:a.data.entityState,typeName:a.data.getType().name},e=[];switch(a.data.entityState){case $data.EntityState.Added:e=a.data.getType().memberDefinitions.getPublicMappedProperties();break;case $data.EntityState.Modified:e=a.data.changedProperties;break;case $data.EntityState.Deleted:e=a.data.getType().memberDefinitions.getKeyProperties()}e.forEach(function(b){d[b.name]=
a.data[b.name]});b.push(d)});return b}},null);
$data.Class.define("$data.Access",null,null,{},{isAuthorized:function(a,b,c,d){console.log("isAuthorized",arguments);var e;a||(e="Access undefined");typeof a!=="number"&&(e="Invalid access type");b||(b={});if(!b.roles)b.roles={};c||(c={});c instanceof Array||typeof c==="object"||(e="Invald roles type");var i=new $data.PromiseHandler,g=i.createCallback(d),i=i.getPromise();if(e){g.error(e,"Access authorization");return i}if(b.roles instanceof Array){e={};for(var j=0;j<b.roles.length;j++)typeof b.roles[j]===
"string"&&(e[b.roles[j]]=true);b.roles=e}if(c instanceof Array){e={};for(j=0;j<c.length;j++)typeof c[j]==="string"&&(e[c[j]]=true);c=e}var m=arguments,r=function(a){a?g.success(a):g.error("Authorization failed",m)},o=Object.getOwnPropertyNames(c),j=0,z=function(d){d&&r(d);if(typeof c[o[j]]==="boolean"&&c[o[j]])if(b.roles[o[j]])r(true);else{j++;j<o.length?z():r(false)}else if(typeof c[o[j]]==="function"){d=c[o[j]].call(b);if(typeof d==="function")d.call(b,j<o.length?z:r);else if(d)r(true);else{j++;
j<o.length?z():r(false)}}else if(typeof c[o[j]]==="number")if((typeof b.roles[o[j]]==="number"&&b.roles[o[j]]&a||typeof b.roles[o[j]]!=="number"&&b.roles[o[j]])&&c[o[j]]&a)b.roles[o[j]]&&r(true);else{j++;j<o.length?z():r(false)}};z();return i},None:0,Create:1,Read:2,Update:4,Delete:8,Execute:16});
$data.Class.define("$data.Promise",null,null,{always:function(){Guard.raise(new Exception("$data.Promise.always","Not implemented!"))},done:function(){Guard.raise(new Exception("$data.Promise.done","Not implemented!"))},fail:function(){Guard.raise(new Exception("$data.Promise.fail","Not implemented!"))},isRejected:function(){Guard.raise(new Exception("$data.Promise.isRejected","Not implemented!"))},isResolved:function(){Guard.raise(new Exception("$data.Promise.isResolved","Not implemented!"))},pipe:function(){Guard.raise(new Exception("$data.Promise.pipe",
"Not implemented!"))},progress:function(){Guard.raise(new Exception("$data.Promise.progress","Not implemented!"))},promise:function(){Guard.raise(new Exception("$data.Promise.promise","Not implemented!"))},state:function(){Guard.raise(new Exception("$data.Promise.state","Not implemented!"))},then:function(){Guard.raise(new Exception("$data.Promise.then","Not implemented!"))}},null);
$data.Class.define("$data.PromiseHandlerBase",null,null,{constructor:function(){},createCallback:function(a){a=$data.typeSystem.createCallbackSetting(a);return cbWrapper={success:a.success,error:a.error,notify:a.notify}},getPromise:function(){return new $data.Promise}},null);$data.PromiseHandler=$data.PromiseHandlerBase;var EventSubscriber=$data.Class.define("EventSubscriber",null,null,{constructor:function(a,b,c){this.handler=a;this.state=b;this.thisArg=c},handler:{},state:{},thisArg:{}});
$data.Event=Event=$data.Class.define("$data.Event",null,null,{constructor:function(a,b){function c(a,b){a.forEach(function(c,d){c.handler==b&&a.splice(d,1)})}var d=null;this.attach=function(a,c,g){d||(d=[]);d.push(new EventSubscriber(a,c,g||b))};this.detach=function(a){c(d,a)};this.fire=function(c,i){var g=i||b||this;c.eventName=a;d&&d.forEach(function(a){a.handler.call(a.thisArg,g,c,a.state)})}}});
var eventData=$data.Class.define("EventData",null,null,{eventName:{}}),PropertyChangeEventData=$data.Class.define("PropertyChangeEventData",EventData,null,{constructor:function(a,b,c){this.propertyName=a;this.oldValue=b;this.newValue=c},propertyName:{},oldValue:{},newValue:{}}),PropertyValidationEventData=$data.Class.define("PropertyValidationEventData",EventData,null,{constructor:function(a,b,c,d){this.propertyName=a;this.oldValue=b;this.newValue=c;this.errors=d;this.cancel=false},propertyName:{},
oldValue:{},newValue:{},errors:{},cancel:{}});
$data.Entity=Entity=$data.Class.define("$data.Entity",null,null,{constructor:function(a){this.getType().__copyPropertiesToInstance&&$data.typeSystem.writePropertyValues(this);Object.defineProperty(this,"initData",{enumerable:false,configurable:true,writable:true,value:{}});var b=null;Object.defineProperty(this,"context",{enumerable:false,configurable:false,get:function(){return b},set:function(a){b=a}});if(arguments.length==1&&typeof a==="object"){var c=this.getType().memberDefinitions,d=c.getPublicMappedPropertyNames();
this.initData={};for(var e in a)d.indexOf(e)>-1&&(this.initData[e]=Container.resolveType(c.getMember(e).type)===$data.Date&&typeof a[e]==="string"?new Date(a[e]):a[e]);this.entityState=this.changedProperties=void 0}},toString:function(){return this.getType().fullName+"("+(this.Id||this.Name||"")+")"},toJSON:function(){var a={},b=this;this.getType().memberDefinitions.getPublicMappedProperties().forEach(function(c){a[c.name]=b[c.name]});return a},equals:function(a){if(a.getType()!==this.getType())return false;
for(var b=this.getType().memberDefinitions.getKeyProperties(),c=0;c<b.length;c++)if(this[b[c].name]==a[b[c].name])return true;return false},propertyChanging:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){var a=this.getType().memberDefinitions.getMember("propertyChanging");if(a){delete this.propertyChanging;delete a.get;delete a.set;Object.defineProperty(this,"propertyChanging",a.createPropertyDescriptor());return this.propertyChanging=
new Event("propertyChanging",this)}},set:function(){}},propertyChanged:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){var a=this.getType().memberDefinitions.getMember("propertyChanged");if(a){delete this.propertyChanged;delete a.get;delete a.set;Object.defineProperty(this,"propertyChanged",a.createPropertyDescriptor());return this.propertyChanged=new Event("propertyChanged",this)}},set:function(){}},propertyValidationError:{dataType:$data.Event,
storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){var a=this.getType().memberDefinitions.getMember("propertyValidationError");if(a){delete this.propertyValidationError;delete a.get;delete a.set;Object.defineProperty(this,"propertyValidationError",a.createPropertyDescriptor());return this.propertyValidationError=new Event("propertyValidationError",this)}},set:function(){}},storeProperty:function(a,b){var c=null;if(a.monitorChanges!=false&&(this._propertyChanging||
this._propertyChanged||"instancePropertyChanged"in this.constructor)){var d=this[a.name],c=new PropertyChangeEventData(a.name,d,b);this._propertyChanging&&this.propertyChanging.fire(c)}if(a.monitorChanges!=false&&(this._propertyValidationError||"instancePropertyValidationError"in this.constructor)){var e=$data.Validation.Entity.ValidateEntityField(this,a,b);if(e.length>0){d=this[a.name];d=new PropertyValidationEventData(a.name,d,b,e);this._propertyValidationError&&this.propertyValidationError.fire(d);
"instancePropertyValidationError"in this.constructor&&this.constructor.instancePropertyValidationError.fire(d,this);if(d.cancel==true)return}}if(a.storeOnObject==true){d="_"+a.name;this[d]?this[d]=b:Object.defineProperty(this,d,a.createStorePropertyDescriptor(b))}else this.initData[a.name]=b;this.isValidated=false;if(a.monitorChanges!=false&&this.entityState==$data.EntityState.Unchanged)this.entityState=$data.EntityState.Modified;if(a.monitorChanges!=false){if(!this.changedProperties)this.changedProperties=
[];this.changedProperties.some(function(b){return b.name==a.name})||this.changedProperties.push(a);this._propertyChanged&&this.propertyChanged.fire(c);"instancePropertyChanged"in this.constructor&&this.constructor.instancePropertyChanged.fire(c,this)}},retrieveProperty:function(a){return a.storeOnObject==true?this["_"+a.name]:this.initData[a.name]},getProperty:function(a,b){if(this[a.name]!=void 0)b(this[a.name]);else{this.context||Guard.raise(new Exception("Entity not in context","Invalid operation"));
return this.context.loadItemProperty(this,a,b)}},setProperty:function(a,b,c){this[a.name]=b;c()},isValid:function(){if(!this.isValidated){this.ValidationErrors=$data.Validation.Entity.ValidateEntity(this);this.isValidated=true}return this.ValidationErrors.length==0},isValidated:{dataType:"bool",storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,value:!1},ValidationErrors:{dataType:Array,elementType:$data.Validation.ValidationError,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1},
resetChanges:function(){delete this._changedProperties},changedProperties:{dataType:Array,elementType:window.MemberDefinition,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1},entityState:{dataType:"integer",storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1}},{__setPropertyfunctions:{value:!0,notMapped:!0,enumerable:!1,storeOnObject:!0},__copyPropertiesToInstance:{value:!1,notMapped:!0,enumerable:!1,storeOnObject:!0}});
$data.Class.define("$data.StorageModel",null,null,{constructor:function(){this.ComplexTypes=[];this.Associations=[]},LogicalType:{},LogicalTypeName:{},PhysicalType:{},PhysicalTypeName:{},EventHandlers:{},Roles:{},TableName:{},ComplexTypes:{},Associations:{},EntitySetReference:{}},null);
$data.Class.define("$data.Association",null,null,{constructor:function(a){if(a){this.From=a.From;this.FromType=a.FromType;this.FromMultiplicity=a.FromMultiplicity;this.FromPropertyName=a.FromPropertyName;this.To=a.To;this.ToType=a.ToType;this.ToMultiplicity=a.ToMultiplicity;this.ToPropertyName=a.ToPropertyName}},From:{},FromType:{},FromMultiplicity:{},FromPropertyName:{},To:{},ToType:{},ToMultiplicity:{},ToPropertyName:{},ReferentialConstraint:{}},null);
$data.Class.define("$data.ComplexType",$data.Association,null,{},null);
$data.Class.define("$data.EntityContext",null,null,{constructor:function(a,b){this.trackChanges=this.lazyLoad=false;this._entitySetReferences={};this._storageModel=[];var c=this;this._storageModel.getStorageModel=function(a){var b=Container.resolveType(a);return c._storageModel.filter(function(a){return a.LogicalType===b})[0]};if(typeof a.name==="string")a.name=[a.name];var d=[].concat(a.name),e=$data.typeSystem.createCallbackSetting({success:this._successInitProvider});$data.StorageProviderLoader.load(d,
{success:function(d){c.storageProvider=new d(a,c);c.storageProvider.setContext(c);c.stateManager=new $data.EntityStateManager(c);if(a.name in c.getType()._storageModelCache)c._storageModel=c.getType()._storageModelCache[a.name];else{c._initializeStorageModel();c.getType()._storageModelCache[a.name]=c._storageModel}c._initializeEntitySets(c.constructor);c._user=a&&a.user||b;c._isOK=false;c.storageProvider&&c.storageProvider.initializeStore(e)},error:function(){e.error("Provider fallback failed!")}})},
getDataType:function(a){if(typeof a=="string"){var b=this[a];if(b===void 0||b===null)b=eval(a);return b}return a},_initializeEntitySets:function(a){a.inheritsFrom!==null&&a.inheritsFrom!==void 0&&this._initializeEntitySets(a.inheritsFrom);this._storageModel.forEach(function(a){this[a.ItemName]=new $data.EntitySet(a.LogicalType,this,a.ItemName,a.EventHandlers,a.Roles);this[a.ItemName].name=a.ItemName;this[a.ItemName].tableName=a.TableName;this[a.ItemName].eventHandlers=a.EventHandlers;this._entitySetReferences[a.LogicalType.name]=
this[a.ItemName];a.EntitySetReference=this[a.ItemName]},this)},_initializeStorageModel:function(){this.getType().memberDefinitions.asArray().forEach(function(a){if("dataType"in a){var b=Container.resolveType(a.dataType);if(b&&b.isAssignableTo&&b.isAssignableTo($data.EntitySet)){b=new $data.StorageModel;b.TableName=a.tableName||a.name;b.ItemName=a.name;b.LogicalType=Container.resolveType(a.elementType);b.LogicalTypeName=b.LogicalType.name;b.PhysicalTypeName=$data.EntityContext._convertLogicalTypeNameToPhysical(b.LogicalTypeName);
b.EventHandlers={beforeCreate:a.beforeCreate,beforeRead:a.beforeRead,beforeUpdate:a.beforeUpdate,beforeDelete:a.beforeDelete,afterCreate:a.afterCreate,afterRead:a.afterRead,afterUpdate:a.afterUpdate,afterDelete:a.afterDelete};var a=a.roles,c={};if(a instanceof Array)for(var d=0;d<a.length;d++)typeof a[d]==="string"&&(c[a[d]]=true);else c=a;b.Roles=c;this._storageModel.push(b)}}},this);typeof intellisense==="undefined"&&this._storageModel.forEach(function(a){var b={};a.Associations=a.Associations||
[];a.ComplexTypes=a.ComplexTypes||[];a.LogicalType.memberDefinitions.getPublicMappedProperties().forEach(function(c){var e=Container.resolveType(c.dataType);if(this.storageProvider.supportedDataTypes.indexOf(e)>-1&&Object.isNullOrUndefined(c.inverseProperty)){var i=JSON.parse(JSON.stringify(c));i.dataType=e;b[c.name]=i}else{this._buildDbType_navigationPropertyComplite(c,e,a);if((e===$data.Array||e.isAssignableTo&&e.isAssignableTo($data.EntitySet))&&c.inverseProperty&&c.inverseProperty!=="$$unbound")this._buildDbType_Collection_OneManyDefinition(b,
a,e,c);else if(c.inverseProperty)if(c.inverseProperty==="$$unbound")e===$data.Array?this._buildDbType_Collection_OneManyDefinition(b,a,e,c):this._buildDbType_ElementType_OneManyDefinition(b,a,e,c);else(i=e.memberDefinitions.getMember(c.inverseProperty))?i.elementType?Container.resolveType(i.elementType)===a.LogicalType?this._buildDbType_ElementType_OneManyDefinition(b,a,e,c):typeof intellisense==="undefined"&&Guard.raise(new Exception("Inverse property not valid, refereed item element type not match: "+
a.LogicalTypeName,", property: "+c.name)):this._buildDbType_ElementType_OneOneDefinition(b,a,e,c):typeof intellisense==="undefined"&&Guard.raise(new Exception("Inverse property not valid"));else this._buildDbType_addComplexTypePropertyDefinition(b,a,e,c)}},this);this._buildDbType_modifyInstanceDefinition(b,a,this);var c={};c.convertTo=this._buildDbType_generateConvertToFunction(a,this);this._buildDbType_modifyClassDefinition(c,a,this);a.PhysicalType=$data.Class.define(a.PhysicalTypeName,$data.Entity,
null,b,c)},this)},_buildDbType_navigationPropertyComplite:function(a,b,c){if(a.inverseProperty){e=null;e=b===$data.Array||b.isAssignableTo&&b.isAssignableTo($data.EntitySet)?this._storageModel.getStorageModel(Container.resolveType(a.elementType)):this._storageModel.getStorageModel(b);if(b=e.LogicalType.memberDefinitions.getMember(a.inverseProperty))b.inverseProperty?b.inverseProperty!=a.name&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Inverse property mismatch")):b.inverseProperty=
a.name}else{var d=null;if(b===$data.Array||b.isAssignableTo&&b.isAssignableTo($data.EntitySet)){var e=this._storageModel.getStorageModel(Container.resolveType(a.elementType));e&&(d=e.LogicalType.memberDefinitions.getPublicMappedProperties().filter(function(b){return b.inverseProperty==a.name&&Container.resolveType(b.dataType)===Container.resolveType(c.LogicalType)}))}else(e=this._storageModel.getStorageModel(b))&&(d=e.LogicalType.memberDefinitions.getPublicMappedProperties().filter(function(b){return b.elementType?
b.inverseProperty==a.name&&Container.resolveType(b.elementType)===c.LogicalType:b.inverseProperty==a.name&&Container.resolveType(b.dataType)===c.LogicalType}));if(d){d.length>1&&typeof intellisense!=="undefined"&&Guard.raise(new Exception("More than one inverse property refer to this member definition: "+a.name+", type: "+Container.resolveName(c.LogicalType)));if(b=d.pop())a.inverseProperty=b.name}}},_buildDbType_generateConvertToFunction:function(){return function(a){return a}},_buildDbType_modifyInstanceDefinition:function(){},
_buildDbType_modifyClassDefinition:function(){},_buildDbType_addComplexTypePropertyDefinition:function(a,b,c,d){this._addNavigationPropertyDefinition(a,d,d.name,$data.MemberTypes.complexProperty);a=this._createComplexElement(b.LogicalType,"",d.name,c,"","");b.ComplexTypes[d.name]=a;b.ComplexTypes.push(a)},_buildDbType_Collection_OneManyDefinition:function(a,b,c,d){var e=Container.resolveType(d.elementType);(e===void 0||e===null)&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Element type definition error",
"Field definition",d));(c=this._storageModel.filter(function(a){return a.LogicalType===e})[0])||typeof intellisense==="undefined"&&Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",d));this._addNavigationPropertyDefinition(a,d,d.name);a=this._addAssociationElement(b.LogicalType,d.inverseProperty==="$$unbound"?"$$unbound":"0..1",d.name,c.LogicalType,"*",d.inverseProperty);b.Associations[d.name]=a;b.Associations.push(a)},_buildDbType_ElementType_OneManyDefinition:function(a,
b,c,d){var e=Container.resolveType(d.dataType);(e===void 0||e===null)&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",d));(c=this._storageModel.filter(function(a){return a.LogicalType===e})[0])||typeof intellisense==="undefined"&&Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",d));this._addNavigationPropertyDefinition(a,d,d.name);a=this._addAssociationElement(b.LogicalType,d.inverseProperty===
"$$unbound"?"$$unbound":"*",d.name,c.LogicalType,"0..1",d.inverseProperty);b.Associations[d.name]=a;b.Associations.push(a)},_buildDbType_ElementType_OneOneDefinition:function(a,b,c,d){var e=Container.resolveType(d.dataType);(e===void 0||e===null)&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",d));(c=this._storageModel.filter(function(a){return a.LogicalType===e})[0])||typeof intellisense==="undefined"&&Guard.raise(new Exception("No EntitySet definition following element type",
"Field definition",d));!c.LogicalType.memberDefinitions.getMember(d.inverseProperty).required&&!d.required&&typeof intellisense==="undefined"&&typeof intellisense==="undefined"&&Guard.raise(new Exception("In one to one connection, one side must required!","One to One connection",d));this._addNavigationPropertyDefinition(a,d,d.name);association=this._addAssociationElement(b.LogicalType,d.required?"0..1":"1",d.name,c.LogicalType,d.required?"1":"0..1",d.inverseProperty);b.Associations[d.name]=association;
b.Associations.push(association)},_addNavigationPropertyDefinition:function(a,b,c,d){var e=JSON.parse(JSON.stringify(b));e.dataType=$data.EntitySet;e.notMapped=true;e.kind=d?d:$data.MemberTypes.navProperty;e.association=c;a[b.name]=e},_addAssociationElement:function(a,b,c,d,e,i){return new $data.Association({From:a.name,FromType:a,FromMultiplicity:b,FromPropertyName:c,To:d.name,ToType:d,ToMultiplicity:e,ReferentialConstraint:[],ToPropertyName:i})},_createComplexElement:function(a,b,c,d,e,i){return new $data.ComplexType({From:a.name,
FromType:a,FromMultiplicity:b,FromPropertyName:c,To:d.name,ToType:d,ToMultiplicity:e,ReferentialConstraint:[],ToPropertyName:i})},_successInitProvider:function(a){if(a!=void 0&&a._isOK!=void 0){a._isOK=true;if(a.onReadyFunction)a.onReadyFunction(a)}},onReady:function(a){var b=new $data.PromiseHandler,a=b.createCallback(a);this.onReadyFunction=a.success;this._isOK&&a.success(this);return b.getPromise()},getEntitySetFromElementType:function(a){var b=this._entitySetReferences[a];if(!b)try{b=this._entitySetReferences[eval(a).name]}catch(c){}return b},
executeQuery:function(a,b){var c=new $data.Query(a.expression,a.defaultType,this),b=$data.typeSystem.createCallbackSetting(b),d=this,e={success:function(a){a.buildResultSet(d);var c;if(a.expression.nodeType===$data.Expressions.ExpressionType.Single||a.expression.nodeType===$data.Expressions.ExpressionType.Count||a.expression.nodeType===$data.Expressions.ExpressionType.Some||a.expression.nodeType===$data.Expressions.ExpressionType.Every){if(a.result.length!==1){b.error(new Exception("result count failed"));
return}c=a.result[0]}else if(a.expression.nodeType===$data.Expressions.ExpressionType.First){if(a.result.length===0){b.error(new Exception("result count failed"));return}c=a.result[0]}else c=a.result;var e=function(){b.success(c)},g=0,i=a.getEntitySets(),j=function(){var b=i[g];if(b.afterRead){g++;b=b.afterRead.call(this,c,i,a);typeof b==="function"?b.call(this,g<i.length?j:e,c,i,a):g<i.length?j():e()}else e()};i.length?j():e()}};e.error=b.error;var i=c.getEntitySets(),g=true,j=this,m=function(a){a===
false&&(g=false);if(g)j.storageProvider.executeQuery(c,e);else{c.rawDataList=[];c.result=[];e.success(c)}},r=0,o=function(a){a===false&&(g=false);a=i[r];if(a.beforeRead){r++;a=a.beforeRead.call(this,i,c);if(typeof a==="function")a.call(this,r<i.length&&g?o:m,i,c);else{a===false&&(g=false);r<i.length&&g?o():m()}}else m()};i.length?o():m()},saveChanges:function(a){for(var b=[],c=this.stateManager.trackedEntities,d=new $data.PromiseHandler,e=d.createCallback(a),a=d.getPromise(),i=[];c.length>0;){var g=
[];c.forEach(function(a){var b=this._storageModel.getStorageModel(a.data.getType());if(a.data.entityState==$data.EntityState.Unchanged){a.skipSave=true;i.push(a.data)}else if(a.data.entityState==$data.EntityState.Modified&&a.data.changedProperties&&!a.data.changedProperties.some(function(a){a=b.PhysicalType.memberDefinitions.getMember(a.name);if(a.kind==$data.MemberTypes.navProperty){a=b.Associations[a.association];a=a.FromMultiplicity+a.ToMultiplicity;return a=="*0..1"||a=="0..11"}return true})){a.skipSave=
true;i.push(a.data)}b.PhysicalType.memberDefinitions.asArray().filter(function(a){return a.kind==$data.MemberTypes.navProperty}).forEach(function(c){var d=b.Associations[c.name],e=d.ToPropertyName;[].concat(a.data[c.name]).forEach(function(b){if(b){var c=b[e],i=d.FromMultiplicity+d.ToMultiplicity;if(d.FromMultiplicity==="$$unbound")if(b instanceof $data.Array){a.dependentOn=a.dependentOn||[];b.forEach(function(){a.dependentOn.indexOf(b)<0&&b.skipSave!==true&&a.dependentOn.push(b)},this)}else{a.dependentOn=
a.dependentOn||[];a.dependentOn.indexOf(b)<0&&b.skipSave!==true&&a.dependentOn.push(b)}else{switch(i){case "*0..1":c?c instanceof Array?c.indexOf(a.data)==-1&&c.push(a.data):typeof intellisense==="undefined"&&Guard.raise("Item must be array or subtype of array"):b[e]=[a.data];break;default:c?c!==a.data&&typeof intellisense==="undefined"&&Guard.raise("Integrity check error! Item assigned to another entity!"):b[e]=a.data}switch(i){case "*0..1":case "0..11":a.dependentOn=a.dependentOn||[];a.dependentOn.indexOf(b)<
0&&b.skipSave!==true&&a.dependentOn.push(b)}}if(!b.entityState)b.entityState=$data.EntityState.Added;g.indexOf(b)==-1&&g.push(b)}},this)},this)},this);c.forEach(function(a){a.skipSave!==true&&b.push(a)});c=[];g.forEach(function(a){i.some(function(b){return b==a})||b.some(function(b){return b.data==a})||c.push({data:a,entitySet:this.getEntitySetFromElementType(a.getType().name)})},this)}b.forEach(function(a){if(a.dependentOn){for(var b=[],c=0;c<a.dependentOn.length;c++)i.indexOf(a.dependentOn[c])<
0&&b.push(a.dependentOn[c]);a.dependentOn=b}});var i=null,j=this;if(b.length==0){e.success(0);return a}var m=[];b.forEach(function(a){a.data.entityState===$data.EntityState.Added&&a.data.getType().memberDefinitions.getPublicMappedProperties().forEach(function(b){b.required&&!b.computed&&!a.data[b.name]&&(a.data[b.name]=Container.getDefault(b.dataType))},this);(a.data.entityState!=$data.EntityState.Added||a.data.entityState!=$data.EntityState.Modified)&&!a.data.isValid()&&m.push({item:a.data,errors:a.data.ValidationErrors})});
if(m.length>0){e.error(m);return a}for(var r={},o=0;o<b.length;o++){var d=b[o],z=d.entitySet.elementType.name,C=this._entitySetReferences[z];if(C.beforeCreate||C.beforeUpdate||C.beforeDelete){r[z]||(r[z]={});switch(d.data.entityState){case $data.EntityState.Added:if(C.beforeCreate){if(!r[z].createAll)r[z].createAll=[];r[z].createAll.push(d)}break;case $data.EntityState.Modified:if(C.beforeUpdate){if(!r[z].modifyAll)r[z].modifyAll=[];r[z].modifyAll.push(d)}break;case $data.EntityState.Deleted:if(C.beforeDelete){if(!r[z].deleteAll)r[z].deleteAll=
[];r[z].deleteAll.push(d)}}}}var s=function(a){if(a){l="async";b.length=0}b.length?j.storageProvider.saveChanges({success:function(){j._postProcessSavedItems(e,b)},error:e.error},b):e.success(0)},l,h=Object.getOwnPropertyNames(r),o=0,fa=["beforeUpdate","beforeDelete","beforeCreate"],ga={beforeCreate:"createAll",beforeDelete:"deleteAll",beforeUpdate:"modifyAll"},x=function(a){if(a){l="async";b.length=0}var a=j._entitySetReferences[h[o]],c=fa.pop(),d=r[h[o]][ga[c]];if(d){var e=d.map(function(a){return a.data});
if(!fa.length){fa=["beforeUpdate","beforeDelete","beforeCreate"];o++}var g=a[c].call(j,e);if(typeof g==="function")g.call(j,o<h.length&&!l?x:s,e);else if(g===false){l=a.name+"."+c;d.forEach(function(a){a=b.indexOf(a);b.splice(a,1)});s()}else o<h.length&&!l?x():s()}else{if(!fa.length){fa=["beforeUpdate","beforeDelete","beforeCreate"];o++}o<h.length&&!l?x():s()}};o<h.length?x():s();return a},prepareRequest:function(){},_postProcessSavedItems:function(a,b){this.ChangeCollector&&this.ChangeCollector instanceof
$data.Notifications.ChangeCollectorBase&&this.ChangeCollector.processChangedData(b);var c={},d=this;b.forEach(function(a){var b=a.data.entityState;a.data.entityState=$data.EntityState.Unchanged;a.data.changedProperties=[];a.physicalData=void 0;var e=a.entitySet.elementType.name,g=d._entitySetReferences[e];if(g.afterCreate||g.afterUpdate||g.afterDelete){c[e]||(c[e]={});switch(b){case $data.EntityState.Added:if(g.afterCreate){if(!c[e].createAll)c[e].createAll=[];c[e].createAll.push(a)}break;case $data.EntityState.Modified:if(g.afterUpdate){if(!c[e].modifyAll)c[e].modifyAll=
[];c[e].modifyAll.push(a)}break;case $data.EntityState.Deleted:if(g.afterDelete){if(!c[e].deleteAll)c[e].deleteAll=[];c[e].deleteAll.push(a)}}}});var e=Object.getOwnPropertyNames(c),i=0,d=this,g=["afterUpdate","afterDelete","afterCreate"],j={afterCreate:"createAll",afterDelete:"deleteAll",afterUpdate:"modifyAll"},m=function(){d.trackChanges||d.stateManager.reset();a.success(b.length)},r=function(){var a=d._entitySetReferences[e[i]],b=g.pop(),C=c[e[i]][j[b]];if(C){C=C.map(function(a){return a.data});
if(!g.length){g=["afterUpdate","afterDelete","afterCreate"];i++}a=a[b].call(d,C);typeof a==="function"?a.call(d,i<e.length?r:m,C):i<e.length?r():m()}else{if(!g.length){g=["afterUpdate","afterDelete","afterCreate"];i++}i<e.length?r():m()}};i<e.length?r():m()},forEachEntitySet:function(a,b){for(var c in this._entitySetReferences)a.call(b,this._entitySetReferences[c])},loadItemProperty:function(a,b,c){Guard.requireType("entity",a,$data.Entity);var d=typeof b==="string"?a.getType().memberDefinitions.getMember(b):
b;if(a[d.name]!=void 0){b=new $data.PromiseHandler;callBack=b.createCallback(c);c.success(a[d.name]);return b.getPromise()}var b=true,e=this._storageModel.getStorageModel(a.getType().fullName),i=Container.resolveType(d.dataType);if(i===$data.Array||i.isAssignableTo&&i.isAssignableTo($data.EntitySet)){i=Container.resolveType(d.elementType);b=false}else{var g=e.Associations.filter(function(a){return a.FromPropertyName==d.name})[0];g&&g.FromMultiplicity==="0..1"&&g.ToMultiplicity==="1"&&(b=false)}if(b===
true){var j="function (e) { return",m={};e.LogicalType.memberDefinitions.getKeyProperties().forEach(function(b,c){c>0&&(j=j+" &&");j=j+(" e."+b.name+" == this.key"+c);m["key"+c]=a[b.name]});j=j+"; }";return e.EntitySetReference.map("function (e) { return e."+d.name+" }").single(j,m,c)}j="function (e) { return";m={};e.LogicalType.memberDefinitions.getKeyProperties().forEach(function(b,c){c>0&&(j=j+" &&");j=j+(" e."+d.inverseProperty+"."+b.name+" == this.key"+c);m["key"+c]=a[b.name]});j=j+"; }";return this.getEntitySetFromElementType(i).filter(j,
m).toArray(c)},getTraceString:function(a){return this.storageProvider.getTraceString(new $data.Query(a.expression,a.defaultType,this))},log:function(){},resolveBinaryOperator:function(a,b,c){return this.storageProvider.resolveBinaryOperator(a,b,c)},resolveUnaryOperator:function(a,b,c){return this.storageProvider.resolveUnaryOperator(a,b,c)},resolveFieldOperation:function(a,b,c){return this.storageProvider.resolveFieldOperation(a,b,c)},resolveSetOperations:function(a,b,c){return this.storageProvider.resolveSetOperations(a,
b,c)},_generateServiceOperationQueryable:function(a,b,c,d){typeof console!=="undefined"&&console.log&&console.log("Obsolate: _generateServiceOperationQueryable, $data.EntityContext");for(var e=[],i=0;i<d.length;i++){var g={};g[d[i]]=Container.resolveType(Container.getTypeName(c[i]));e.push(g)}return $data.EntityContext.generateServiceOperation({serviceName:a,returnType:$data.Queryable,elementType:this[b].elementType,params:e}).apply(this,c)},attach:function(a){a instanceof $data.EntityWrapper&&(a=
a.getEntity());return this.getEntitySetFromElementType(a.getType()).attach(a)},attachOrGet:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).attachOrGet(a)},add:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).add(a)},remove:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).remove(a)}},{generateServiceOperation:function(a){var b;
if(a.serviceMethod){b=a.returnType?Container.resolveType(a.returnType):{};b=b.isAssignableTo&&b.isAssignableTo($data.Queryable)?a.serviceMethod:function(){var b=arguments[arguments.length-1],c=new $data.PromiseHandler;if(typeof b==="function"){b=c.createCallback(b);arguments[arguments.length-1]=b}else{b=c.createCallback();arguments.push(b)}try{var d=a.serviceMethod.apply(this,arguments);d!==void 0&&b.success(d)}catch(e){b.error(e)}return c.getPromise()}}else b=function(){var b=a.elementType?this.getEntitySetFromElementType(Container.resolveType(a.elementType)):
null,c=null;if(a.params)for(var c=[],d=0;d<a.params.length;d++)for(var e in a.params[d])c.push(Container.createConstantExpression(arguments[d],Container.resolveType(a.params[d][e]),e));d=Container.createEntityContextExpression(this);e=this.getType().getMemberDefinition(a.serviceName);c=Container.createServiceOperationExpression(d,Container.createMemberInfoExpression(e),c,a);d=arguments[arguments.length-1];typeof d!=="function"&&(d=void 0);if(b){b=Container.createQueryable(b,c);if(d){c.isTerminated=
true;return b._runQuery(d)}return b}e=Container.resolveType(a.returnType);b=Container.createQueryable(this,c);b.defaultType=e;if(e===$data.Queryable){b.defaultType=Container.resolveType(a.elementType);if(d){c.isTerminated=true;return b._runQuery(d)}return b}c.isTerminated=true;return b._runQuery(d)};var c=[];if(a.params)for(var d=0;d<a.params.length;d++){var e=a.params[d],i;for(i in e)c.push({name:i,type:e[i]})}$data.typeSystem.extend(b,a,{params:c});return b},_convertLogicalTypeNameToPhysical:function(a){return a+
"_$db$"},_storageModelCache:{get:function(){if(!this.__storageModelCache)this.__storageModelCache={};return this.__storageModelCache},set:function(){}}});$data.Class.define("$data.QueryProvider",null,null,{constructor:function(){this.requiresExpressions=false},executeQuery:function(){},getTraceString:function(){}},null);
$data.Class.define("$data.ModelBinder",null,null,{constructor:function(a){this.context=a;this.cache={}},call:function(a,b){if(!Object.getOwnPropertyNames(b).length)return a;if(b.$type)var c=Container.resolveName(b.$type),d=this.context.storageProvider.fieldConverter.fromDb[c],e=d?d():Container["create"+Container.resolveType(b.$type).name]();if(b.$selector){var i=b.$selector;i instanceof Array||(i=[i]);for(var d=0,g;d<i.length;){g=a;c=i[d].split(":");switch(c[0]){case "json":for(c=c[1].split(".");c.length;)if(typeof g[c[0]]===
"undefined"||g[c[0]]===null){if(d===i.length)return;if(c.length)break}else{g=g[c[0]];c=c.slice(1);if(g===null)return g}if(!c.length)d=i.length;break;case "css":case "xml":if(g.querySelector)g=g[b.$item?"querySelectorAll":"querySelector"](c[1]);else{g=$(g).find(c[1]);b.$item||(g=g[0])}}d++}a=g;if(!a)return a}if(b.$value)if(typeof b.$value==="function")e=b.$value.call(b,b,a);else if(b.$type){c=Container.resolveName(b.$type);e=(d=this.context.storageProvider.fieldConverter.fromDb[c])?d(b.$value):Container["create"+
Container.resolveType(b.$type).name](b.$value)}else e=b.$value;else if(b.$source)if(b.$type){c=Container.resolveName(b.$type);e=(d=this.context.storageProvider.fieldConverter.fromDb[c])?d(a[b.$source]):Container["create"+Container.resolveType(b.$type).name](a[b.$source])}else e=b.$source.split(":")[0]=="attr"&&a.getAttribute?a.getAttribute(b.$source.split(":")[1]):b.$source=="textContent"&&!a[b.$source]?$(a).text():a[b.$source];else if(b.$item)for(d=0;d<a.length;d++){var j=this.call(a[d],b.$item);
e.push(j)}else{g="";if(b.$keys){for(j=0;j<b.$keys.length;j++)g=g+(b.$type+"_"+b.$keys[j]+"#"+a[b.$keys[j]]);if(this.cache[g]){e=this.cache[g];for(j in b)j.indexOf("$")<0&&b[j].$item&&e[j].push(this.call(a,b[j].$item))}else{for(j in b)if(j.indexOf("$")<0)if(b[j].$item)e[j]=this.call(a,b[j]);else if(b[j].$type||b[j].$source)e[j]=this.call(a,b[j]);else if(b.$type){c=Container.resolveName(b.$type.memberDefinitions.getMember(j).type);d=this.context.storageProvider.fieldConverter.fromDb[c];e[j]=d?d(a[b[j]]):
Container["create"+Container.resolveType(b.$type.memberDefinitions.getMember(j).type).name](a[b[j]])}else e[j]=b[j].$source?a[b[j].$source]:a[b[j]];this.cache[g]=e}}else for(j in b)if(j.indexOf("$")<0)if(b[j].$item)e[j]=this.call(a,b[j]);else if(b[j].$type||b[j].$source)e[j]=this.call(a,b[j]);else if(b.$type){c=Container.resolveName(Container.resolveType(b.$type).memberDefinitions.getMember(j).type);d=this.context.storageProvider.fieldConverter.fromDb[c];e[j]=d?d(a[b[j]]):Container["create"+Container.resolveType(b.$type.memberDefinitions.getMember(j).type).name](a[b[j]])}else e[j]=
b[j].$source?a[b[j].$source]:a[b[j]]}return e}});
$C("$data.queryBuilder",null,null,{constructor:function(){this._fragments={};this.selectedFragment=null;this.modelBinderConfig=this._binderConfig={};this._binderConfigPropertyStack=[]},selectTextPart:function(a){this._fragments[a]||(this._fragments[a]={text:"",params:[]});this.selectedFragment=this._fragments[a]},getTextPart:function(a){return this._fragments[a]},addText:function(a){this.selectedFragment.text=this.selectedFragment.text+a},addParameter:function(a){this.selectedFragment.params.push(a)},selectModelBinderProperty:function(a){this._binderConfigPropertyStack.push(this.modelBinderConfig);
a in this.modelBinderConfig||(this.modelBinderConfig[a]={});this.modelBinderConfig=this.modelBinderConfig[a]},popModelBinderProperty:function(){this.modelBinderConfig=this._binderConfigPropertyStack.length===0?this._binderConfig():this._binderConfigPropertyStack.pop()},resetModelBinderProperty:function(){this._binderConfigPropertyStack=[];this.modelBinderConfig=this._binderConfig},addKeyField:function(a){this.modelBinderConfig.$keys||(this.modelBinderConfig.$keys=[]);this.modelBinderConfig.$keys.push(a)}});
$C("$data.Query",null,null,{constructor:function(a,b,c){Object.defineProperty(this,"expression",{value:a,enumerable:true});Object.defineProperty(this,"context",{value:c,enumerable:true});this.expressions=a;this.defaultType=b;this.result=[];this.rawDataList=[];this.modelBinderConfig={};this.context=c},rawDataList:{dataType:"Array"},result:{dataType:"Array"},resultType:{},buildResultSet:function(){this.result=(new $data.ModelBinder(this.context)).call(this.rawDataList,this.modelBinderConfig)},getEntitySets:function(){var a=
[],b=this.context,c=function(d){d instanceof $data.Expressions.EntitySetExpression&&a.indexOf(b._entitySetReferences[d.elementType.name])<0&&a.push(b._entitySetReferences[d.elementType.name]);d.source&&c(d.source)};c(this.expression);return a}},null);
$data.Class.define("$data.Queryable",null,null,{constructor:function(a,b){var c=a instanceof $data.EntityContext?a:a.entityContext;this.defaultType=a instanceof $data.EntityContext?null:a.defaultType;Object.defineProperty(this,"entityContext",{value:c,writable:false,enumerable:true});this.expression=b},filter:function(a,b){this._checkOperation("filter");var c=Container.createCodeExpression(a,b),d=this.expression;if(this.expression instanceof $data.Expressions.FilterExpression)var d=this.expression.source,
e=this.entityContext.storageProvider.resolveBinaryOperator("and"),c=Container.createSimpleBinaryExpression(this.expression.selector,c,"and","filter","boolean",e);c=Container.createFilterExpression(d,c);return Container.createQueryable(this,c)},where:function(a,b){return this.filter(a,b)},map:function(a,b){this._checkOperation("map");var c=Container.createCodeExpression(a,b),c=Container.createProjectionExpression(this.expression,c);return Container.createQueryable(this,c)},select:function(a,b){return this.map(a,
b)},length:function(a){this._checkOperation("length");var b=new $data.PromiseHandler,a=b.createCallback(a),c=Container.createCountExpression(this.expression),d=Container.createQueryExpressionCreator(this.entityContext);try{var e=d.Visit(c);this.entityContext.log({event:"EntityExpression",data:e});this.entityContext.executeQuery(Container.createQueryable(this,e),a)}catch(i){a.error(i)}return b.getPromise()},count:function(a){return this.length(a)},forEach:function(a){this._checkOperation("forEach");
var b=new $data.PromiseHandler,c=b.createCallback(function(b){b.forEach(a)}),d=Container.createForEachExpression(this.expression),e=Container.createQueryExpressionCreator(this.entityContext);try{var i=e.Visit(d);this.entityContext.log({event:"EntityExpression",data:i});this.entityContext.executeQuery(Container.createQueryable(this,i),c)}catch(g){c.error(g)}return b.getPromise()},toArray:function(a){if(a instanceof $data.Array)return this.toArray(function(b){a.length=0;b.forEach(function(b){a.push(b)})});
this._checkOperation("toArray");var b=new $data.PromiseHandler,c=b.createCallback(a),d=Container.createToArrayExpression(this.expression),e=Container.createQueryExpressionCreator(this.entityContext);try{var i=e.Visit(d);this.entityContext.log({event:"EntityExpression",data:i});this.entityContext.executeQuery(Container.createQueryable(this,i),c)}catch(g){c.error(g)}return b.getPromise()},single:function(a,b,c){this._checkOperation("single");var d=this;a&&(d=this.filter(a,b));var d=d.take(2),a=new $data.PromiseHandler,
c=a.createCallback(c),b=Container.createSingleExpression(d.expression),e=Container.createQueryExpressionCreator(d.entityContext);try{var i=e.Visit(b);this.entityContext.log({event:"EntityExpression",data:i});d.entityContext.executeQuery(Container.createQueryable(d,i),c)}catch(g){c.error(g)}return a.getPromise()},some:function(a,b,c){this._checkOperation("some");var d=this;a&&(d=this.filter(a,b));var d=d.take(1),a=new $data.PromiseHandler,c=a.createCallback(c),b=Container.createSomeExpression(d.expression),
e=Container.createQueryExpressionCreator(d.entityContext);try{var i=e.Visit(b);this.entityContext.log({event:"EntityExpression",data:i});d.entityContext.executeQuery(Container.createQueryable(d,i),c)}catch(g){c.error(g)}return a.getPromise()},every:function(a,b,c){this._checkOperation("every");var d=this;a&&(d=this.filter(a,b));var d=d.take(1),a=new $data.PromiseHandler,c=a.createCallback(c),b=Container.createEveryExpression(d.expression),e=Container.createQueryExpressionCreator(d.entityContext);
try{var i=e.Visit(b);this.entityContext.log({event:"EntityExpression",data:i});d.entityContext.executeQuery(Container.createQueryable(d,i),c)}catch(g){c.error(g)}return a.getPromise()},take:function(a){this._checkOperation("take");a=Container.createConstantExpression(a,"number");a=Container.createPagingExpression(this.expression,a,$data.Expressions.ExpressionType.Take);return Container.createQueryable(this,a)},skip:function(a){this._checkOperation("skip");a=Container.createConstantExpression(a,"number");
a=Container.createPagingExpression(this.expression,a,$data.Expressions.ExpressionType.Skip);return Container.createQueryable(this,a)},orderBy:function(a,b){this._checkOperation("orderBy");var c=Container.createCodeExpression(a,b),c=Container.createOrderExpression(this.expression,c,$data.Expressions.ExpressionType.OrderBy);return Container.createQueryable(this,c)},orderByDescending:function(a,b){this._checkOperation("orderByDescending");var c=Container.createCodeExpression(a,b),c=Container.createOrderExpression(this.expression,
c,$data.Expressions.ExpressionType.OrderByDescending);return Container.createQueryable(this,c)},first:function(a,b,c){this._checkOperation("first");var d=this;a&&(d=this.filter(a,b));var d=d.take(1),a=new $data.PromiseHandler,c=a.createCallback(c),b=Container.createFirstExpression(d.expression),e=Container.createQueryExpressionCreator(d.entityContext);try{var i=e.Visit(b);d.entityContext.log({event:"EntityExpression",data:i});d.entityContext.executeQuery(Container.createQueryable(d,i),c)}catch(g){c.error(g)}return a.getPromise()},
include:function(a){this._checkOperation("include");a=Container.createConstantExpression(a,"string");a=Container.createIncludeExpression(this.expression,a);return Container.createQueryable(this,a)},_runQuery:function(a){var b=new $data.PromiseHandler,a=b.createCallback(a),c=Container.createQueryExpressionCreator(this.entityContext);try{var d=c.Visit(this.expression);this.entityContext.log({event:"EntityExpression",data:d});this.entityContext.executeQuery(Container.createQueryable(this,d),a)}catch(e){a.error(e)}return b.getPromise()},
toTraceString:function(a){var b=this.expression,b=a?Container["create"+a+"Expression"](b):Container.createToArrayExpression(b),b=Container.createQueryExpressionCreator(this.entityContext).Visit(b),a=Container.createQueryable(this,b);return a.entityContext.getTraceString(a)},_checkOperation:function(a){var b=this.entityContext.resolveSetOperations(a);b.invokable!=void 0&&!b.invokable&&Guard.raise(new Exception("Operation '"+a+"' is not invokable with the provider"))},defaultType:{}},null);
$data.EntitySchemaConfig=function(){this.Name=""};$data.entitySetState={created:0,defined:1,active:2};
$data.Class.defineEx("$data.EntitySet",[{type:$data.Queryable,params:[new ConstructorParameter(1)]}],null,{constructor:function(a,b,c,d,e){this.createNew=this[a.name]=a;this.stateManager=new $data.EntityStateManager(this);Object.defineProperty(this,"elementType",{value:a,enumerable:true});Object.defineProperty(this,"collectionName",{value:c,enumerable:true});Object.defineProperty(this,"roles",{value:e,enumerable:true});for(var i in d)this[i]=d[i];this._checkRootExpression()},executeQuery:function(a,
b){var c=$data.typeSystem.createCallbackSetting(b);this.entityContext.executeQuery(a,c)},getTraceString:function(a){return this.entityContext.getTraceString(a)},setContext:function(a){this.entitySetState=$data.entitySetState.active;this.entityContext=a;this.entityContext[this.schema.name]=this[this.schema.name]},_trackEntity:function(a){for(var b=this.entityContext.stateManager.trackedEntities,c=0;c<b.length;c++)if(b[c].data===a)return;b.push({entitySet:this,data:a})},add:function(a){var b=a;a instanceof
$data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));b.entityState=$data.EntityState.Added;b.changedProperties=void 0;b.context=this.entityContext;this._trackEntity(b)},remove:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));b.entityState=$data.EntityState.Deleted;b.changedProperties=void 0;this._trackEntity(b)},attach:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():
a instanceof this.createNew||(b=new this.createNew(a));for(a=0;a<this.entityContext.stateManager.trackedEntities.length;a++){var c=this.entityContext.stateManager.trackedEntities[a];if(c.data===b)break;c.data.equals(b)&&Guard.raise(new Exception("Context already contains this entity!!!"))}b.entityState=$data.EntityState.Unchanged;b.changedProperties=void 0;b.context=this.entityContext;this._trackEntity(b)},detach:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||
(b=new this.createNew(a));var c=this.entityContext.stateManager.trackedEntities.filter(function(a){return a.data.equals(b)}).pop();if(c){c=this.entityContext.stateManager.trackedEntities.indexOf(c);a.entityState=$data.EntityState.Detached;this.entityContext.stateManager.trackedEntities.splice(c,1)}},attachOrGet:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));if(a=this.entityContext.stateManager.trackedEntities.filter(function(a){return a.data.equals(b)}).pop())return a.data;
b.entityState=$data.EntityState.Unchanged;b.changedProperties=void 0;b.context=this.entityContext;this._trackEntity(b);return b},loadItemProperty:function(a,b,c){return this.entityContext.loadItemProperty(a,b,c)},_checkRootExpression:function(){if(!this.expression){var a=Container.createEntityContextExpression(this.entityContext),b=this.entityContext.getType().getMemberDefinition(this.collectionName);this.expression=Container.createEntitySetExpression(a,Container.createMemberInfoExpression(b),null,
this);this.defaultType=this.elementType}}},null);$data.EntityState={Detached:0,Unchanged:10,Added:20,Modified:30,Deleted:40};$data.Class.define("$data.EntityStateManager",null,null,{constructor:function(a){this.entityContext=null;this.trackedEntities=[];this.init(a)},init:function(a){this.entityContext=a},reset:function(){this.trackedEntities=[]}},null);
Exception=function(a,b,c){Error.call(this);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);this.name=b||"Exception";this.message=a;this.data=c};Exception.prototype.__proto__=Error.prototype;Exception.prototype._getStackTrace=function(){};Function.prototype.extend=function(a){for(var b in a)this[b]=a[b];return this};
$data.ServiceOperation=function(){var a=arguments.callee,b=a.elementType?this.getEntitySetFromElementType(Container.resolveType(a.elementType)):null,c=null;if(a.params)for(var c=[],d=0;d<a.params.length;d++)for(var e in a.params[d])c.push(Container.createConstantExpression(arguments[d],Container.resolveType(a.params[d][e]),e));d=Container.createEntityContextExpression(this);e=this.getType().getMemberDefinition(a.serviceName);c=Container.createServiceOperationExpression(d,Container.createMemberInfoExpression(e),
c,a);d=arguments[arguments.length-1];typeof d!=="function"&&(d=void 0);if(b){b=Container.createQueryable(b,c);if(d){c.isTerminated=true;return b._runQuery(d)}return b}e=Container.resolveType(a.returnType);b=Container.createQueryable(this,c);b.defaultType=e;if(e===$data.Queryable){b.defaultType=Container.resolveType(a.elementType);if(d){c.isTerminated=true;return b._runQuery(d)}return b}c.isTerminated=true;return b._runQuery(d)};
Function.prototype.chain=function(a,b){var c=function(){var a=arguments.callee.chainFn,b=[];if(arguments.length)for(var c=0;c<arguments.length;c++)b.push(arguments[c]);var g=b.length,c=0,j=function(){if(b[b.length-1]&&b[b.length-1].success&&typeof b[b.length-1].success==="function")b[b.length-1].success.apply(this,arguments);else return arguments.length?arguments[0]:void 0},m=function(){var r=a[c];c++;r=r.apply(this,b);if(typeof r==="function"){var o=arguments;b[g]=c<a.length?function(){return m.apply(this,
o)}:function(){return j.apply(this,o)};r.apply(this,b)}else c<a.length?m.apply(this,arguments):j(this,arguments)};m()};if(!c.chainFn)c.chainFn=(a||[]).concat([this].concat(b||[]));return c};Function.prototype.before=function(a){var b=this;this.chainFn||(b=b.chain());b.chainFn.unshift(a);return b};Function.prototype.after=function(a){var b=this;this.chainFn||(b=b.chain());b.chainFn.push(a);return b};Function.prototype.contentType=function(a){return this.extend({contentType:a})};
Function.prototype.returns=function(a,b){typeof a==="string"&&(a=Container.resolveType(a));typeof b==="string"&&(b=Container.resolveType(b));return this.extend({returnType:a,elementType:b})};Function.prototype.params=function(a){return this.extend({params:a})};Function.prototype.serviceName=function(a){return this.extend({serviceName:a})};Function.prototype.method=function(a){return this.extend({method:a})};Function.prototype.webGet=function(){return this.method("GET")};
Function.prototype.webInvoke=function(){return this.method("POST")};Function.prototype.authorize=function(a,b){var c={};if(a instanceof Array)for(var d=0;d<a.length;d++)typeof a[d]==="string"&&(c[a[d]]=true);else c=a;this.roles=c;var e=this;return ret=function(){var a=new $data.PromiseHandler,c=a.createCallback(b),a=a.getPromise(),d=arguments;c.success=c.success.after(function(){e.apply(this,d)});$data.Access.isAuthorized($data.Access.Execute,this.user,e.roles,c);return a}};
Function.prototype.promise=function(a){var b=this;return function(){var c=new $data.PromiseHandler,d=c.createCallback(a),c=c.getPromise();arguments[arguments.length++]=d;b.apply(this,arguments);return c}};
$data.StorageProviderLoader={isSupported:function(a){switch(a){case "indexedDb":return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB;case "storm":return"XMLHttpRequest"in window;case "webSql":case "sqLite":return"openDatabase"in window;default:return true}},load:function(a,b){var c=a.shift();if($data.RegisteredStorageProviders){var d=$data.RegisteredStorageProviders[c];if(d){b.success(d);return}}this.isSupported(d)?function(a,b){a||b(false);var c;c=window.XMLHttpRequest?
new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("MsXml2.XmlHttp"):void 0;c.onreadystatechange=function(){if(c.readyState==4)if(c.status==200||c.status==304){eval.call(window,c.responseText);typeof b==="function"&&b(true)}else typeof b==="function"&&b(false)};c.open("GET",a,true);c.send(null)}(function(a){switch(a){case "storm":a="Storm"}var b=document.querySelector('script[src*="jaydata"]');return b?b.src.substring(0,b.src.lastIndexOf("/")+1)+a+"Provider.js":"providers/"+a+"Provider.js"}(c),
function(d){var i=$data.RegisteredStorageProviders[c];if(d&&i){i=$data.RegisteredStorageProviders[c];b.success(i)}else a.length>0?this.load(a,b):b.error()}):this.load(a,b)}};$data.storageProviders={DbCreationType:{Merge:10,DropTableIfChanged:20,DropAllExistingTables:30}};$data.ConcurrencyMode={Fixed:"fixed",None:"nonde"};
$data.Class.define("$data.StorageProviderBase",null,null,{constructor:function(a){this.providerConfiguration=a||{}},providers:{},supportedDataTypes:{value:[],writable:!1},initializeStore:function(){Guard.raise("Pure class")},executeQuery:function(){Guard.raise("Pure class")},buildIndependentBlocks:function(a){for(var b=[],c=[],d=0;d<a.length;d++){var e=a[d];if(e.dependentOn&&e.dependentOn.length!=0){for(var i=null,g=0;g<e.dependentOn.length;g++){var j=e.dependentOn[g];if(j.entityState!=$data.EntityState.Unchanged){for(var i=
i||{},m=-1,r=0;r<a.length;r++)if(a[r].data==j){m=r;break}m==-1&&Guard.raise(new Exception("Dependent object not found","ObjectNotFound",e.dependentOn[g]));i[m]=true;from=c[m]||{};from[d]=true;c[m]=from}}i!==null&&(b[d]=i)}}d=[];e=[];for(i=0;i<a.length;i++)b.hasOwnProperty(i)||e.push(i);for(;e.length>0;){i=[].concat(e);e=[];for(g=0;g<i.length;g++){j=c[i[g]];if(typeof j!=="undefined")for(var o in j){delete b[o][i[g]];a:{m=b[o];r=void 0;for(r in m)if(m.hasOwnProperty(r)){m=true;break a}m=false}if(!m){delete b[o];
e.push(o)}}delete c[i[g]]}g=[];for(j=0;j<i.length;j++){m=a[i[j]];m.data.entityState!=$data.EntityState.Unchanged&&g.push(m)}g.length>0&&d.push(g)}return d},getTraceString:function(){Guard.raise("Pure class")},setContext:function(a){this.context=a},supportedFieldOperations:{value:{length:{dataType:"number",allowedIn:"filter, map"},substr:{dataType:"string",allowedIn:"filter",parameters:[{name:"startFrom",dataType:"number"},{name:"length",dataType:"number"}]},toLowerCase:{dataType:"string"}},enumerable:!0,
writable:!0},resolveFieldOperation:function(a,b,c){(b=this.supportedFieldOperations[a])||Guard.raise(new Exception("Field operation '"+a+"' is not supported by the provider"));c&&b.allowedIn&&(b.allowedIn instanceof Array&&!b.allowedIn.some(function(a){return c===Container.resolveType(a)})||!(b.allowedIn instanceof Array)&&c!==Container.resolveType(b.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+c.name));b.name=a;return b},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean"}},
enumerable:!0,writable:!0},resolveBinaryOperator:function(a,b,c){(b=this.supportedBinaryOperators[a])||Guard.raise(new Exception("Binary operator '"+a+"' is not supported by the provider"));c&&b.allowedIn&&(b.allowedIn instanceof Array&&!b.allowedIn.some(function(a){return c===Container.resolveType(a)})||!(b.allowedIn instanceof Array)&&c!==Container.resolveType(b.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+c.name));b.name=a;return b},supportedUnaryOperators:{value:{not:{mapTo:"not"}},
enumerable:!0,writable:!0},resolveUnaryOperator:function(a,b,c){(b=this.supportedUnaryOperators[a])||Guard.raise(new Exception("Unary operator '"+a+"' is not supported by the provider"));c&&b.allowedIn&&(b.allowedIn instanceof Array&&!b.allowedIn.some(function(a){return c===Container.resolveType(a)})||!(b.allowedIn instanceof Array)&&c!==Container.resolveType(b.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+c.name));b.name=a;return b},supportedSetOperations:{value:{toArray:{invokable:!0,
allowedIn:[]}},enumerable:!0,writable:!0},resolveSetOperations:function(a,b,c){(b=this.supportedSetOperations[a])||Guard.raise(new Exception("Operation '"+a+"' is not supported by the provider"));var d=b.allowedIn||[];c&&d&&(d instanceof Array&&!d.some(function(a){return c===Container.resolveType(a)})||!(d instanceof Array)&&c!==Container.resolveType(d))&&Guard.raise(new Exception(a+" not supported in: "+c.name));return b},makePhysicalTypeDefinition:function(){}},{registerProvider:function(a,b){$data.RegisteredStorageProviders=
$data.RegisteredStorageProviders||[];$data.RegisteredStorageProviders[a]=b},getProvider:function(a){var b=$data.RegisteredStorageProviders[a];b||console.warn("Provider not found: '"+a+"'");return b},isSupported:{get:function(){return true},set:function(){}}});$data.Base.extend("$data.EntityWrapper",{getEntity:function(){Guard.raise("pure object")}});"undefined"!==typeof jQuery&&jQuery.ajax&&($data.ajax=$data.ajax||jQuery.ajax);
"undefined"!==typeof WinJS&&WinJS.xhr&&($data.ajax=$data.ajax||function(a){$data.typeSystem.extend(a,{dataType:"json",headers:{}});var b={json:{accept:"application/json, text/javascript",convert:JSON.parse},text:{accept:"text/plain",convert:function(a){return a}},html:{accept:"text/html",convert:function(a){return a}},xml:{accept:"application/xml, text/xml",convert:function(a){return a}}}[a.dataType.toLowerCase()];a.headers.Accept=b.accept;var c=a.success||$data.defaultSuccessCallback,d=a.error||
$data.defaultErrorCallback,e=a.progress;WinJS.xhr(a).done(function(a){a=b.convert(a.responseText);c(a)},function(a){a=b.convert(a.responseText);d(a)},e)});"undefined"!==typeof Ext&&typeof Ext.Ajax&&($data.ajax=$data.ajax||function(a){Ext.Ajax.request(a)});$data.ajax=$data.ajax||function(){$data.typeSystem.createCallbackSetting(arguments[arguments.length-1]).error("Not implemented")};
$data.Class.define("$data.dbClient.DbCommand",null,null,{connection:{},parameters:{},execute:function(){Guard.raise("Pure class")}},null);$data.Class.define("$data.dbClient.DbConnection",null,null,{connectionParams:{},database:{},isOpen:function(){Guard.raise("Pure class")},open:function(){Guard.raise("Pure class")},close:function(){Guard.raise("Pure class")},createCommand:function(){Guard.raise("Pure class")}},null);
$data.Class.define("$data.dbClient.openDatabaseClient.OpenDbCommand",$data.dbClient.DbCommand,null,{constructor:function(a,b,c){this.query=b;this.connection=a;this.parameters=c},executeNonQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},executeQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},exec:function(a,b,c,d){this.connection.open({success:function(e){function i(){--m==
0&&c(g?j[0]:j)}var g=false;if(!(a instanceof Array)){g=true;a=[a];b=[b]}var j=[],m=0;a.forEach(function(c,g){m++;if(c)e.executeSql(a[g],b[g],function(a,b){var c={rows:[]};try{c.insertId=b.insertId}catch(d){c.rowsAffected=b.rowsAffected;for(var e=b.rows.length,m=0;m<e;m++)c.rows.push(b.rows.item(m))}j[g]=c;i()},function(a,b){d&&d(b)});else{j[g]=null;i()}})}})}},null);
$data.Class.define("$data.dbClient.openDatabaseClient.OpenDbConnection",$data.dbClient.DbConnection,null,{constructor:function(a){this.connectionParams=a},isOpen:function(){return this.database!==null&&this.database!==void 0&&this.transaction!==null&&this.transaction!==void 0},open:function(a){if(this.database)this.database.transaction(function(b){a.success(b)});else{var b=this.connectionParams;this.database=openDatabase(b.fileName,b.version,b.displayName,b.maxSize);this.database.transaction(function(b){a.success(b)})}},
close:function(){this.database=this.transaction=void 0},createCommand:function(a,b){return new $data.dbClient.openDatabaseClient.OpenDbCommand(this,a,b)}},null);
$data.Class.define("$data.dbClient.jayStorageClient.JayStorageCommand",$data.dbClient.DbCommand,null,{constructor:function(a,b,c){this.query=b;this.connection=a;this.parameters=c},executeNonQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},executeQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},exec:function(a,b,c,d){if(b==null||b==void 0)b={};var e=false;if(!(a instanceof
Array)){e=true;a=[a];b=[b]}var i=[],g=a.length,j=function(){--g==0&&c(e?i[0]:i)};a.forEach(function(a,c){if(a)$data.ajax({url:"http"+(this.connection.connectionParams.storage.ssl?"s":"")+"://"+this.connection.connectionParams.storage.src.replace("http://","").replace("https://","")+"?db="+this.connection.connectionParams.storage.key,type:"POST",headers:{"X-PINGOTHER":"pingpong"},data:{query:a,parameters:b[c]},dataType:"json",contentType:"application/json;charset=UTF-8",success:function(a){if(a&&a.error){console.log("JayStorage error",
a.error);d(a.error)}else{i[c]=this.lastID?{insertId:this.lastID,rows:(a||{rows:[]}).rows}:{rows:(a||{rows:[]}).rows};j()}}});else{i[c]=null;j()}},this)}},null);$data.Class.define("$data.dbClient.jayStorageClient.JayStorageConnection",$data.dbClient.DbConnection,null,{constructor:function(a){this.connectionParams=a},isOpen:function(){return true},open:function(){},close:function(){},createCommand:function(a,b){return new $data.dbClient.jayStorageClient.JayStorageCommand(this,a,b)}},null);
$data.Class.define("$data.dbClient.sqLiteNJClient.SqLiteNjCommand",$data.dbClient.DbCommand,null,{constructor:function(a,b,c){this.query=b;this.connection=a;this.parameters=c},executeNonQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},executeQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},exec:function(a,b,c,d){this.connection.isOpen()||this.connection.open();
if(b==null||b==void 0)b={};var e=false;if(!(a instanceof Array)){e=true;a=[a];b=[b]}var i=this,g=[],j=0,m=function(){if(--j==0){i.connection.database.exec("COMMIT");c(e?g[0]:g)}};i.connection.database.exec("BEGIN");a.forEach(function(a,c){j++;if(a){var e=function(a,b){if(a!=null)d(a);else{g[c]=this.lastID?{insertId:this.lastID,rows:[]}:{rows:b};m()}},C=i.connection.database.prepare(a,b[c]);a.indexOf("SELECT")==0?C.all(e):C.run(e);C.finalize()}else{g[c]=null;m()}},this)}},null);
$data.Class.define("$data.dbClient.sqLiteNJClient.SqLiteNjConnection",$data.dbClient.DbConnection,null,{constructor:function(a){this.connectionParams=a},isOpen:function(){return this.database!==null&&this.database!==void 0},open:function(){if(this.database==null)this.database=new sqLiteModule.Database(this.connectionParams.fileName)},close:function(){},createCommand:function(a,b){return new $data.dbClient.sqLiteNJClient.SqLiteNjCommand(this,a,b)}},null);
$C("$data.modelBinder.FindProjectionVisitor",$data.Expressions.EntityExpressionVisitor,null,{VisitProjectionExpression:function(a){this.projectionExpression=a}});
$C("$data.modelBinder.ModelBinderConfigCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a,b,c){this._query=a;this._includes=b;this._isoDataProvider=c||false},VisitSingleExpression:function(a){this._defaultModelBinder(a)},VisitSomeExpression:function(a){this._defaultModelBinder(a)},VisitEveryExpression:function(a){this._defaultModelBinder(a)},VisitToArrayExpression:function(a){this._defaultModelBinder(a)},VisitFirstExpression:function(a){this._defaultModelBinder(a)},VisitForEachExpression:function(a){this._defaultModelBinder(a)},
VisitServiceOperationExpression:function(a){var b=Container.resolveType(a.cfg.returnType);if(typeof b.isAssignableTo==="function"&&b.isAssignableTo($data.Queryable)||b===$data.Array)this._defaultModelBinder(a);else{var c=Container.createqueryBuilder();c.modelBinderConfig.$type=b;typeof b.isAssignableTo==="function"&&b.isAssignableTo($data.Entity)?c.modelBinderConfig.$selector=["json:"+a.cfg.serviceName]:c.modelBinderConfig.$source=a.cfg.serviceName;this.VisitExpression(a,c);c.resetModelBinderProperty();
this._query.modelBinderConfig=c.modelBinderConfig}},VisitCountExpression:function(){var a=Container.createqueryBuilder();a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");a.modelBinderConfig.$type=$data.Integer;a.modelBinderConfig.$source="cnt";a.resetModelBinderProperty();this._query.modelBinderConfig=a.modelBinderConfig},VisitConstantExpression:function(a,b){b.modelBinderConfig.$type=a.type;b.modelBinderConfig.$value=a.value},VisitExpression:function(a,b){var c=Container.createFindProjectionVisitor();
c.Visit(a);c.projectionExpression?this.Visit(c.projectionExpression,b):this.DefaultSelection(b)},_defaultModelBinder:function(a){var b=Container.createqueryBuilder();b.modelBinderConfig.$type=$data.Array;this._isoDataProvider&&(b.modelBinderConfig.$selector=["json:d.results","json:d","json:results"]);b.modelBinderConfig.$item={};b.selectModelBinderProperty("$item");this.VisitExpression(a,b);b.resetModelBinderProperty();this._query.modelBinderConfig=b.modelBinderConfig},_addPropertyToModelBinderConfig:function(a,
b){var c=this._query.context._storageModel.getStorageModel(a);if(a.memberDefinitions)a.memberDefinitions.getPublicMappedProperties().forEach(function(a){if(!c||c&&!c.Associations[a.name]&&!c.ComplexTypes[a.name])if(!c&&this._query.context.storageProvider.supportedDataTypes.indexOf(Container.resolveType(a.dataType))<0){b.selectModelBinderProperty(a.name);b.modelBinderConfig.$type=Container.resolveType(a.dataType);b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.name+".results","json:"+
a.name]:"json:"+a.name;this._addPropertyToModelBinderConfig(Container.resolveType(a.dataType),b);b.popModelBinderProperty()}else{a.key&&b.addKeyField(a.name);b.modelBinderConfig[a.name]=a.concurrencyMode===$data.ConcurrencyMode.Fixed?{$selector:"json:__metadata",$source:"etag"}:a.name}},this);else{b._binderConfig.$item={};b.modelBinderConfig=b._binderConfig.$item}c&&this._addComplexTypeProperties(c.ComplexTypes,b)},_addComplexTypeProperties:function(a,b){a.forEach(function(a){b.selectModelBinderProperty(a.FromPropertyName);
b.modelBinderConfig.$type=a.ToType;b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.FromPropertyName+".results","json:"+a.FromPropertyName]:"json:"+a.FromPropertyName;this._addPropertyToModelBinderConfig(a.ToType,b);b.popModelBinderProperty()},this)},DefaultSelection:function(a){a.modelBinderConfig.$type=this._query.defaultType;var b=this._query.context._storageModel.getStorageModel(this._query.defaultType);this._addPropertyToModelBinderConfig(this._query.defaultType,a);this._includes&&
this._includes.forEach(function(c){for(var d=c.name.split("."),e=null,i=b,g=0;g<d.length;g++){a.modelBinderConfig.$item&&a.selectModelBinderProperty("$item");a.selectModelBinderProperty(d[g]);e=i.Associations[d[g]];i=this._query.context._storageModel.getStorageModel(e.ToType)}a.modelBinderConfig.$selector=this._isoDataProvider?["json:"+d[d.length-1]+".results","json:"+d[d.length-1]]:"json:"+d[d.length-1];if(e.ToMultiplicity==="*"){a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");
a.modelBinderConfig.$type=c.type;this._addPropertyToModelBinderConfig(c.type,a);a.popModelBinderProperty()}else{a.modelBinderConfig.$type=c.type;this._addPropertyToModelBinderConfig(c.type,a)}for(g=0;g<d.length;g++)a.popModelBinderProperty()},this)},VisitProjectionExpression:function(a,b){this.hasProjection=true;this.Visit(a.selector,b)},VisitParametricQueryExpression:function(a,b){a.expression instanceof $data.Expressions.EntityExpression?this.VisitEntityAsProjection(a.expression,b):this.Visit(a.expression,
b)},VisitEntityAsProjection:function(a,b){this.Visit(a.source,b);b.modelBinderConfig.$type=a.entityType;this._addPropertyToModelBinderConfig(a.entityType,b)},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitMemberInfoExpression:function(a,b){b.modelBinderConfig.$type=a.memberDefinition.type;a.memberDefinition.storageModel&&a.memberName in a.memberDefinition.storageModel.ComplexTypes?this._addPropertyToModelBinderConfig(Container.resolveType(a.memberDefinition.type),
b):b.modelBinderConfig.$source=a.memberName},VisitEntitySetExpression:function(a,b){if(a.source instanceof $data.Expressions.EntityExpression){this.Visit(a.source,b);this.Visit(a.selector,b)}},VisitComplexTypeExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b);if("$selector"in b.modelBinderConfig&&b.modelBinderConfig.$selector.length>0)if(b.modelBinderConfig.$selector instanceof $data.Array){var c=b.modelBinderConfig.$selector[1];b.modelBinderConfig.$selector[0]=c+"."+a.selector.memberName+
".results";b.modelBinderConfig.$selector[1]=c+"."+a.selector.memberName}else b.modelBinderConfig.$selector=b.modelBinderConfig.$selector+("."+a.selector.memberName);else b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.selector.memberName+".results","json:"+a.selector.memberName]:"json:"+a.selector.memberName},VisitEntityExpression:function(a,b){this.Visit(a.source,b)},VisitAssociationInfoExpression:function(a,b){if("$selector"in b.modelBinderConfig&&b.modelBinderConfig.$selector.length>
0)if(b.modelBinderConfig.$selector instanceof $data.Array){var c=b.modelBinderConfig.$selector[1];b.modelBinderConfig.$selector[0]=c+"."+a.associationInfo.FromPropertyName+".results";b.modelBinderConfig.$selector[1]=c+"."+a.associationInfo.FromPropertyName}else b.modelBinderConfig.$selector=b.modelBinderConfig.$selector+("."+a.associationInfo.FromPropertyName);else b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.associationInfo.FromPropertyName+".results","json:"+a.associationInfo.FromPropertyName]:
"json:"+a.associationInfo.FromPropertyName},VisitObjectLiteralExpression:function(a,b){b.modelBinderConfig.$type=$data.Object;a.members.forEach(function(a){this.Visit(a,b)},this)},VisitObjectFieldExpression:function(a,b){b.selectModelBinderProperty(a.fieldName);a.expression instanceof $data.Expressions.EntityExpression?this.VisitEntityAsProjection(a.expression,b):this.Visit(a.expression,b);b.popModelBinderProperty()}});
$data.Class.define("$data.Authentication.AuthenticationBase",null,null,{constructor:function(a){this.configuration=a||{};this.Authenticated=false},Login:function(){Guard.raise("Pure class")},Logout:function(){Guard.raise("Pure class")},CreateRequest:function(){Guard.raise("Pure class")}},null);
$data.Class.define("$data.Authentication.Anonymous",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=a||{};this.Authenticated=false},Login:function(){},Logout:function(){},CreateRequest:function(a){$data.ajax(a)}},null);
$data.Class.define("$data.Authentication.FacebookAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=$data.typeSystem.extend({Url_code:"",type_code:"",scope:"",Url_token:"",type_token:"",access_token:"",app_id:""},a)},Login:function(a){if(!this.Authenticated){var b=this;b.configuration.stateCallbacks=a||{};$data.ajax({url:this.configuration.Url_code,data:"type="+b.configuration.type_code+"&client_id="+b.configuration.app_id+"&scope="+b.configuration.scope,
type:"POST",dataType:"json",success:function(a){typeof b.configuration.stateCallbacks.pending=="function"&&b.configuration.stateCallbacks.pending(a);b._processRequestToken(a);b.Authenticated=true},error:function(){typeof b.configuration.stateCallbacks.error=="function"&&b.configuration.stateCallbacks.error(arguments)}})}},Logout:function(){this.Authenticated=false},CreateRequest:function(a){if(a){if(a.url&&this.Authenticated){var b="?";a.url.indexOf(b)>0&&(b="&");if(this.configuration.access_token)a.url=
a.url+b+"access_token="+this.configuration.access_token}$data.ajax(a)}},_processRequestToken:function(a){var b=this;$data.ajax({url:b.configuration.Url_token,data:"type="+b.configuration.type_token+"&client_id="+b.configuration.app_id+"&code="+a.code,type:"POST",dataType:"json",success:function(a){b.configuration.access_token=a.access_token;typeof b.configuration.stateCallbacks.success=="function"&&b.configuration.stateCallbacks.success(a)},error:function(c){var d=eval("("+c.responseText+")");d.error&&
(d.error.message=="authorization_pending"?setTimeout(function(){b._processRequestToken(a)},2E3):typeof b.configuration.stateCallbacks.abort=="function"&&b.configuration.stateCallbacks.abort(arguments))}})}},null);
$data.Class.define("$data.Authentication.BasicAuth.BasicAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=$data.typeSystem.extend({Username:"",Password:""},a)},Login:function(a){a&&typeof a.pending=="function"&&a.pending()},Logout:function(){},CreateRequest:function(a){if(a){var b=this,c=a.beforeSend;a.beforeSend=function(a){a.setRequestHeader("Authorization","Basic  "+b.__encodeBase64(b.configuration.Username+":"+b.configuration.Password));typeof c=="function"&&
c(a)};$data.ajax(a)}},__encodeBase64:function(a){input=a;var a="",b,c,d="",e,i,g="",j=0;do{b=input.charCodeAt(j++);c=input.charCodeAt(j++);d=input.charCodeAt(j++);e=b>>2;b=(b&3)<<4|c>>4;i=(c&15)<<2|d>>6;g=d&63;isNaN(c)?i=g=64:isNaN(d)&&(g=64);a=a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(i)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)}while(j<
input.length);return a}},null);
