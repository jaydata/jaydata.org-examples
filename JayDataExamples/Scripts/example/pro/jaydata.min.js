// JayData 1.2.7.1 Pro - Trial License
// Copyright JayStack Technologies (http://jaydata.org/licensing)
// Support: http://jaystack.com
(function(){"undefined"===typeof window&&(window=this);$data=window.$data||(window.$data=function b(){return this instanceof b?new (b.implementation.apply(this,arguments))(arguments[1]):b.implementation.apply(this,arguments)})})(this);"undefined"===typeof console&&(console={warn:function(){},error:function(){},log:function(){},dir:function(){},time:function(){},timeEnd:function(){}});console.warn||(console.warn=function(){});console.error||(console.error=function(){});
(function(a){a.__namespace=true;a.version="JayData 1.2.7.1";a.versionNumber="1.2.7.1";a.root={}})($data);
Guard={requireValue:function(a,b){(typeof b==="undefined"||b===null)&&Guard.raise(a+" requires a value other than undefined or null")},requireType:function(a,b,c){return(c instanceof Array?c:[c]).some(function(c){switch(typeof c){case "string":return typeof b===c;case "function":return b instanceof c;default:Guard.raise("Unknown type format : "+typeof c+" for: "+a)}})},raise:function(a){if(typeof intellisense==="undefined"){a instanceof Exception?console.error(a.name+":",a.message+"\n",a):console.error(a);
throw a;}}};Object.isNullOrUndefined=function(a){return a===void 0||a===null};
(function(){if(!Object.getOwnPropertyNames)Object.getOwnPropertyNames=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b};if(!Object.create)Object.create=function(a){function b(){}arguments.length>1&&Guard.raise(Error("Object.create implementation only accepts the first parameter."));b.prototype=a;return new b};if(!Object.keys){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty",
"isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;Object.keys=function(e){(typeof e!=="object"&&typeof e!=="function"||e===null)&&Guard.raise(new TypeError("Object.keys called on non-object"));var g=[],f;for(f in e)a.call(e,f)&&g.push(f);if(b)for(f=0;f<d;f++)a.call(e,c[f])&&g.push(c[f]);return g}}if(!Object.defineProperty)Object.defineProperty=function(a,b,c){a[b]=c.value||{}};if(!Object.defineProperties)Object.defineProperties=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=
b[c].value||{})};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;c<d;c++)b?a.call(b,this[c],c,this):a(this[c],c,this)};if(!Array.prototype.filter)Array.prototype.filter=function(a,b){for(var c=[],d=0,j=this.length;d<j;d++)(b?a.call(b,this[d],d,this):a(this[d],d,this))===true&&c.push(this[d]);return c};if(!Array.prototype.map)Array.prototype.map=function(a,b){for(var c=[],d=0,j=this.length;d<j;d++){var m=b?a.call(b,this[d],d,this):a(this[d],d,this);c.push(m)}return c};
if(!Array.prototype.some)Array.prototype.some=function(a,b){for(var c=0,d=this.length;c<d;c++)if(b?a.call(b,this[c],c,this):a(this[c],c,this))return true;return false};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};if(!String.prototype.trimLeft)String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")};if(!String.prototype.trimRight)String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}})();
JAYLINT=function(){function a(){return this}function b(){}function c(a){return Db[a]||"\\u"+("0000"+a.charCodeAt().toString(16)).slice(-4)}function d(a){Object.keys(a).forEach(function(b){V[b]=a[b]})}function e(){if(!l.safe){if(l.rhino){d(Eb);l.rhino=false}if(l.devel){d(Fb);l.devel=false}if(l.browser){d(Gb);l.browser=false}if(l.windows){d(Hb);l.windows=false}if(l.node){d(Ib);l.node=false;Ma=true}if(l.widget){d(Jb);l.widget=false}}}function g(a,b,c){throw{name:"JSLintError",line:b,character:c,message:K.scanned_a_b.supplant({a:a,
b:Math.floor(b/Aa.length*100)})};}function f(a,b,c,d,e,f){var m,k,b=b||h;k=b.line||0;m=b.from||0;a={id:"(error)",raw:K[a]||a,evidence:Aa[k-1]||"",line:k,character:m,a:c||b.value,b:d,c:e,d:f};a.reason=a.raw.supplant(a);JAYLINT.errors.push(a);l.passfail&&g(K.stopping,k,m);Na=Na+1;Na>=l.maxerr&&g(K.too_many,k,m);return a}function k(a,b,c,d,e,g,h){return f(a,{line:b,from:c},d,e,g,h)}function j(a,b,c,d,e,h){a=f(a,b,c,d,e,h);g(K.stopping,a.line,a.character)}function m(a,b,c,d,e,f,g){return j(a,{line:b,
from:c},d,e,f,g)}function q(a){!l.white&&h.from!==a&&f("expected_a_at_b_c",h,h.value,a,h.from)}function y(a,b,c){if(a[b]!==c){f("expected_a_b",a,c,a[b]);return true}return false}function o(a,b,c){c=c||a.value;if(r===aa){l.safe&&f("adsafe_a",a,c);if(typeof aa[c]!=="string"){a.writeable=typeof V[c]==="boolean"?V[c]:true;a.funct=r;Ba[c]=a}b==="becoming"&&(b="var")}else if(typeof r[c]==="string")if(r[c]==="undef"){l.undef||f("used_before_a",a,c);b="var"}else f("already_defined",a,c);else{a.funct=r;a.writeable=
true;H[c]=a}r[c]=b}function t(a){for(var b,c=0,a=a||0;c<=a;){(b=Ca[c])||(b=Ca[c]=Da.token());c=c+1}return b}function s(a){a=a||n;if(a.comments){for(var b=a.prev;b.comments===null;)b=b.prev;b.comments=b.comments?b.comments.concat(a.comments):a.comments}a.comments=null}function i(a,b){if(A){if(ha&&h.line!==n.line){if((ha!==A||!h.edge)&&h.from===A.at-(h.edge?l.indent:0)){for(var c=A;;){c.at=c.at-l.indent;if(c===ha)break;c=c.was}c.open=false}ha=null}if(A.open)if(h.edge)h.edge==="label"?q(1):h.edge===
"case"?q(A.at-l.indent):(A.mode!=="array"||h.line!==n.line)&&q(A.at);else{if(h.line!==n.line){h.from<A.at+(A.mode==="expression"?0:l.indent)&&q(A.at+l.indent);A.wrap=true}}else if(h.line!==n.line)if(h.edge)q(A.at);else{A.wrap=true;A.mode==="statement"||A.mode==="var"?q(A.at+l.indent):h.from<A.at+(A.mode==="expression"?0:l.indent)&&q(A.at+l.indent)}}switch(n.id){case "(number)":h.id==="."&&f("trailing_decimal_a");break;case "-":(h.id==="-"||h.id==="--")&&f("confusing_a");break;case "+":(h.id==="+"||
h.id==="++")&&f("confusing_a")}if(n.id==="(string)"||n.identifier)$a=n.value;a&&h.id!==a&&(b?f("expected_a_b_from_c_d",h,a,b.id,b.line,h.value):(!h.identifier||h.value!==a)&&f("expected_a_b",h,a,h.value));Y=n;n=h;h=Ca.shift()||Da.token();n.id==="(end)"&&s()}function T(){if(l.adsafe)l.safe=true;if(l.safe){l.browser=l["continue"]=l.css=l.debug=l.devel=l.evil=l.forin=l.newcap=l.nomen=l.on=l.rhino=l.sloppy=l.sub=l.undef=l.widget=l.windows=false;delete V.Array;delete V.Date;delete V.Function;delete V.Object;
delete V.eval;d({ADSAFE:false,lib:false})}}function G(){var a=this.id,b=Ea;h.line===n.line&&h.from===n.thru&&f("missing_space_a_b",h,n.value,h.value);Ea=true;l.white=true;(Ca.length>0||h.comments)&&f("unexpected_a",this);switch(a){case "/*properties":case "/*property":case "/*members":case "/*member":a:for(ia||(ia={});;){if(h.id!=="(string)"&&!h.identifier)break a;ia[h.value]=true;i();if(h.id!==",")break a;i(",")}break;case "/*jslint":for(l.safe&&f("adsafe_a",this);h.id==="(string)"||h.identifier;){a=
h.value;i();h.id!==":"&&j("expected_a_b",h,":",h.value);i(":");switch(a){case "indent":a=+h.value;(typeof a!=="number"||!isFinite(a)||a<0||Math.floor(a)!==a)&&j("expected_small_a");l.indent=a;break;case "maxerr":a=+h.value;(typeof a!=="number"||!isFinite(a)||a<=0||Math.floor(a)!==a)&&j("expected_small_a",h);l.maxerr=a;break;case "maxlen":a=+h.value;(typeof a!=="number"||!isFinite(a)||a<0||Math.floor(a)!==a)&&j("expected_small_a");l.maxlen=a;break;default:h.id==="true"?l[a]=true:h.id==="false"?l[a]=
false:j("unexpected_a");if(a==="adsafe"){l.adsafe=l.safe=true;T()}else a==="safe"&&T()}i();h.id===","&&i(",")}e();break;case "/*globals":case "/*global":l.safe&&f("adsafe_a",this);a:for(var c;;){if(h.id!=="(string)"&&!h.identifier)break a;a=h.value;i();c=false;if(h.id===":"){i(":");switch(h.id){case "true":c=V[a]!==false;i("true");break;case "false":i("false");break;default:j("unexpected_a")}}V[a]=c;if(h.id!==",")break a;i(",")}break;default:j("unpexpected_a",this)}Ea=b;i("*/")}function x(a){h.edge=
!A||A.open&&(a||true)}function F(a){var b,c;if(typeof a==="number")A={at:a,open:true,was:c};else if(A){c=A;b=a==="var"||h.line!==n.line&&a!=="statement";A={at:(b||a==="control"?c.at+l.indent:c.at)+(c.wrap?l.indent:0),mode:a,open:b,was:c};a==="var"&&b&&(ha=A)}else A={at:1,mode:"statement",open:true}}function E(a,b){if(a){if(A&&A.open){A.at=A.at-l.indent;x()}i(a,b)}if(A)A=A.was}function u(a,b){b=b||h;b.id!=="(end)"&&!l.white&&(n.line!==b.line||n.thru+1!==b.from)&&f("expected_space_a_b",b,n.value,b.value)}
function J(a,b){a=a||n;b=b||h;b.id!=="(end)"&&(a.line!==b.line||!l.white&&a.thru+1!==b.from)&&f("expected_space_a_b",b,a.value,b.value)}function v(a,b){a=a||n;b=b||h;(!l.white||z==="styleproperty"||z==="style")&&a.thru!==b.from&&a.line===b.line&&f("unexpected_space_a_b",b,a.value,b.value)}function C(a,b){a=a||n;b=b||h;b.id!=="(end)"&&(a.line!==b.line||!l.white&&a.thru!==b.from)&&f("unexpected_space_a_b",b,a.value,b.value)}function B(a,b){if(!l.white){a=a||n;b=b||h;a.thru===b.from&&a.line===b.line&&
f("missing_space_a_b",b,a.value,b.value)}}function D(){if(h.id!==",")k("expected_a_b",n.line,n.thru,",",h.value);else{l.white||C();i(",");s();B()}}function O(){if(h.id!==";")k("expected_a_b",n.line,n.thru,";",h.value);else{l.white||C();i(";");s();Kb[h.id]!==true&&B()}}function ja(){if(h.value==="use strict"){pa&&f("unnecessary_use");x();i();O();pa=true;l.newcap=false;l.undef=false;return true}return false}function P(a,b){if(a===b)return true;if(Array.isArray(a)){if(Array.isArray(b)&&a.length===b.length){var c;
for(c=0;c<a.length;c=c+1)if(!P(a[c],b[c]))return false;return true}return false}if(Array.isArray(b))return false;if(a.arity===b.arity&&a.value===b.value)switch(a.arity){case "prefix":case "suffix":case void 0:return a.id===b.id&&P(a.first,b.first);case "infix":return P(a.first,b.first)&&P(a.second,b.second);case "ternary":return P(a.first,b.first)&&P(a.second,b.second)&&P(a.third,b.third);case "function":case "regexp":break;default:return true}else{if(a.id==="."&&b.id==="["&&b.arity==="infix")return a.second.value===
b.second.value&&b.second.id==="(string)";if(a.id==="["&&a.arity==="infix"&&b.id===".")return a.second.value===b.second.value&&a.second.id==="(string)"}return false}function w(a,b){var c;h.id==="(end)"&&j("unexpected_a",n,h.id);i();l.safe&&H[n.value]&&H[n.value]===Ba[n.value]&&h.id!=="("&&h.id!=="."&&f("adsafe",n);if(b){$a="anonymous";r["(verb)"]=n.value}if(b===true&&n.fud)c=n.fud();else{if(n.nud)c=n.nud();else{if(h.id==="(number)"&&n.id==="."){f("leading_decimal_a",n,h.value);i();return n}j("expected_identifier_a",
n,n.id)}for(;a<h.lbp;){i();n.led?c=n.led(c):j("expected_operator_a",n,n.id)}}return c}function Fa(a,b){var c=ba[a];if(!c||typeof c!=="object")ba[a]=c={id:a,lbp:b,value:a};return c}function M(a){return Fa(a,0)}function qa(a){a.postscript=true;return a}function ab(a){var b=Fa(a,0);b.from=1;b.thru=1;b.line=0;b.edge=true;b.value=a;return qa(b)}function W(a,b){var c=M(a);c.identifier=c.reserved=true;c.fud=b;return c}function Oa(a,b){W(a,b).labeled=true}function Pa(a,b){W(a,b).disrupt=true}function rb(a){var b=
a.id.charAt(0);if(b>="a"&&b<="z"||b>="A"&&b<="Z")a.identifier=a.reserved=true;return a}function U(a,b,c){var d=Fa(a,150);rb(d);d.nud=typeof b==="function"?b:function(){a==="typeof"?u():C();this.first=w(150);this.arity="prefix";if(this.id==="++"||this.id==="--")l.plusplus?(!this.first.identifier||this.first.reserved)&&this.first.id!=="."&&this.first.id!=="["&&f("bad_operand",this):f("unexpected_a",this);this.type=c;return this};return d}function ka(a,b,c){a=M(a);a.arity=a.type=b;if(c)a.nud=c;return a}
function bb(a){return(a=a.identifier&&H[a.value]||a)&&a.type}function Q(a,b,c){var d="",e,g,h;if(typeof a!=="string"){g=a.identifier&&H[a.value]||a;a=g.type}h=b.identifier&&H[b.value]||b;e=h.type;if(a)e?a===e?d=a:l.type||f("type_inconsistency_a_b",c||b,a,e):h.type=d=a;else if(e){if(g)g.type=e;d=e}return d}function L(a,b){var c=M(a);c.identifier=c.reserved=true;if(typeof b==="function")c.nud=b;return c}function wa(b,c,d){b=L(b);b.type=c;b.value=d;b.nud=a;return b}function cb(a,b){return L(a,function(){typeof b===
"function"&&b(this);return this})}function R(a,b,c,d,e){a=Fa(a,b);rb(a);a.led=function(a){this.arity="infix";if(!e){B(Y,n);B()}!l.bitwise&&this.bitwise&&f("unexpected_a",this);if(typeof c==="function")return c(a,this);this.first=a;this.second=w(b);return this};if(d)a.type=d;return a}function da(a,b){a.assign&&f(b||K.conditional_assignment,a);return a}function ea(a,b){switch(a.id){case "[":case "-":a.arity!=="infix"&&f(b||K.weird_condition,a);break;case "false":case "function":case "Infinity":case "NaN":case "null":case "true":case "undefined":case "void":case "(number)":case "(regexp)":case "(string)":case "{":f(b||
K.weird_condition,a);break;case "(":a.first.id==="."&&Lb[a.first.second.value]===true&&f(b||K.weird_condition,a)}return a}function sb(a){switch(a.arity){case "prefix":switch(a.id){case "{":case "[":f("unexpected_a",a);break;case "!":f("confusing_a",a)}break;case "function":case "regexp":f("unexpected_a",a);break;default:a.id==="NaN"&&f("isnan",a)}return a}function ma(a,b){return R(a,100,function(a,c){sb(a);b&&!l.eqeq&&f("expected_a_b",c,b,c.id);var d=w(100);(P(a,d)||(a.id==="(string)"||a.id==="(number)")&&
(d.id==="(string)"||d.id==="(number)"))&&f("weird_relation",c);c.first=a;c.second=sb(d);Q(a,c.second,c);return c},"boolean")}function ca(a,b){var c=R(a,20,function(a,b){var c;b.first=a;if(a.identifier)H[a.value]?H[a.value].writeable===false&&f("read_only",a):j("read_only");else if(l.safe){c=a;do{typeof V[c.value]==="boolean"&&f("adsafe",c);c=c.first}while(c)}a===ba["function"]&&f("identifier_function",n);if(a.id==="."||a.id==="["){(!a.first||a.first.value==="arguments")&&f("bad_assignment",b);b.second=
w(19);b.id==="="&&P(b.first,b.second)&&f("weird_assignment",b)}else if(a.identifier&&!a.reserved){r[a.value]==="exception"&&f("assign_exception",a);b.second=w(19);b.id==="="&&P(b.first,b.second)&&f("weird_assignment",b);if(b.type){Q(a,b);Q(b,b.second,b)}else Q(a,b.second,b)}return b});c.assign=true;if(b){if(ba[b].type)c.type=ba[b].type;if(ba[b].bitwise)c.bitwise=true}return c}function xa(a,b){var c=R(a,b,"number");c.bitwise=true;return c}function tb(a){a=Fa(a,150);a.led=function(a){C(Y,n);l.plusplus?
(!a.identifier||a.reserved)&&a.id!=="."&&a.id!=="["&&f("bad_operand",this):f("unexpected_a",this);this.first=a;this.arity="suffix";return this};return a}function ra(){if(h.identifier){i();l.safe&&Qa[n.value]?f("adsafe_a",n):n.reserved&&!l.es5&&f("expected_identifier_a_reserved",n);return n.value}}function db(){var a,b=H;if(h.id===";"){f("unexpected_a");O()}else{if(h.identifier&&!h.reserved&&t().id===":"){x("label");a=h;i();s();i(":");s();H=Object.create(b);o(a,"label");h.labeled!==true?f("label_a_b",
h,a.value,h.value):eb.test(a.value+":")?f("url",a):r===aa&&j("unexpected_a",n);h.label=a}x();F("statement");if(a=w(0,true))if(a.arity==="statement")a.id==="switch"||a.block&&a.id!=="do"?B():O();else{a.id==="("?a.first.id==="new"&&f("bad_new"):!a.assign&&a.id!=="delete"&&a.id!=="++"&&a.id!=="--"&&f("assignment_function_expression",n);O()}E();H=b;return a}}function sa(){for(var a=[],b,c;h.postscript!==true;)if(h.id===";"){f("unexpected_a",h);O()}else{if(h.value==="use strict"){(!Ma||r!==aa||a.length>
0)&&f("function_strict");ja()}if(b){f("unreachable_a_b",h,h.value,b.value);b=null}if(c=db()){a.push(c);if(c.disrupt){b=c;a.disrupt=true}}}return a}function fa(a){var b,c=h,d=Ga,e=H,g=pa;Ga=a;H=Object.create(H);B();if(h.id==="{"){i("{");F();!a&&!ja()&&!g&&!l.sloppy&&r["(context)"]===aa&&f("missing_use_strict");b=sa();pa=g;E("}",c);s()}else if(a){f("expected_a_b",h,"{",h.value);b=[db()];b.disrupt=b[0].disrupt}else j("expected_a_b",h,"{",h.value);r["(verb)"]=null;H=e;Ga=d;a&&b.length===0&&f("empty_block");
return b}function Ra(a){ia&&typeof ia[a]!=="boolean"&&f("unexpected_property_a",n,a);ta[a]=typeof ta[a]==="number"?ta[a]+1:1}function fb(){var a=ra(true);if(!a)if(h.id==="(string)"){a=h.value;l.safe&&(Qa[a]?f("adsafe_a"):(a.charAt(0)==="_"||a.charAt(a.length-1)==="_")&&f("dangling_a"));i()}else if(h.id==="(number)"){a=h.value.toString();i()}return a}function N(a){var b=0;if(a)if(Array.isArray(a))a.forEach(function(a){b=b+N(a)});else switch(a.arity){case "statement":switch(a.id){case "if":b=b+(N(a.first)+
N(a.block)+N(a["else"])+1);break;case "while":case "do":a.first.id!=="true"&&a.first.value!==1&&(b=b+1);b=b+(N(a.first)+N(a.block));break;case "for":a.second!==void 0&&a.second.id!=="true"&&a.second.value!==1&&(b=b+1);b=b+(N(a.first)+N(a.second)+N(a.third)+N(a.block));break;case "switch":b=b+(N(a.first)+N(a.second)+a.second.length);a.second[a.second.length-1].id==="default"&&(b=b-1);break;case "try":a.second&&(b=b+1);a.third&&(b=b+1);b=b+(N(a.first)+N(a.second)+N(a.third)+N(a.block))}break;case "prefix":b=
b+N(a.first);break;case "case":case "infix":b=b+(N(a.first)+N(a.second));if(a.id==="&&"||a.id==="||")b=b+1;break;case "ternary":b=b+(N(a.first)+N(a.second)+N(a.third))}return b}function Sa(a,b){var d=r,e=l,f=ia,g=H;r={"(name)":b||"'"+($a||"").replace(ub,c)+"'","(line)":h.line,"(context)":d,"(breakage)":0,"(loopage)":0,"(scope)":H,"(token)":a};ia=f&&Object.create(f);l=Object.create(e);H=Object.create(g);Ta.push(r);(a.name=b)&&o(a,"function",b);a.writeable=false;var m=r,k;a:{var q=h,j=[];i("(");F();
s();v();if(h.id===")"){v();E(")",q);s();k=void 0}else for(;;){x();ra();j.push(n);o(n,l.unparam?"parameter":"unparam");if(h.id===",")D();else{v();E(")",q);s();k=j;break a}}}a.first=m["(params)"]=k;a.type="function";u();a.block=fa(false);r["(complexity)"]=N(a.block)+1;r=d;l=e;ia=f;H=g}function gb(){function a(){var b=h,c={};i("{");if(h.id!=="}")for(;h.id!=="(end)";){for(;h.id===",";){f("unexpected_a",h);D()}h.id!=="(string)"&&f("expected_string_a");c[h.value]===true?f("duplicate_a"):h.value==="__proto__"?
f("dangling_a"):c[h.value]=true;i();i(":");gb();if(h.id!==",")break;D();if(h.id==="}"){f("unexpected_a",n);break}}i("}",b)}function b(){var a=h;i("[");if(h.id!=="]")for(;h.id!=="(end)";){for(;h.id===",";){f("unexpected_a",h);D()}gb();if(h.id!==",")break;D();if(h.id==="]"){f("unexpected_a",n);break}}i("]",a)}switch(h.id){case "{":a();break;case "[":b();break;case "true":case "false":case "null":case "(number)":case "(string)":i();break;case "-":i("-");C();i("(number)");break;default:j("unexpected_a")}}
function hb(){if(h.identifier){i();return true}}function Ua(){if(h.id==="-"){i("-");C()}if(h.id==="(number)"){i("(number)");return true}}function ib(){if(h.id==="(string)"){i();return true}}function la(){var a,b,c,d;if(h.identifier){d=h.value;if(d==="rgb"||d==="rgba"){i();c=h;i("(");for(a=0;a<3;a=a+1){a&&D();b=h.value;if(h.id!=="(string)"||b<0){f("expected_positive_a",h);i()}else{i();if(h.id==="%"){i("%");b>100&&f("expected_percent_a",n,b)}else b>255&&f("expected_small_a",n,b)}}if(d==="rgba"){D();
b=+h.value;(h.id!=="(string)"||b<0||b>1)&&f("expected_fraction_a",h);i();if(h.id==="%"){f("unexpected_a");i("%")}}i(")",c);return true}if(Mb[h.value]===true){i();return true}}else if(h.id==="(color)"){i();return true}return false}function I(){if(h.id==="-"){i("-");C()}if(h.id==="(number)"){i();if(h.id!=="(string)"&&vb[h.value]===true){C();i()}else+n.value!==0&&f("expected_linear_a");return true}return false}function ya(){if(h.identifier)switch(h.value){case "thin":case "medium":case "thick":i();return true}else return I()}
function Ha(){if(h.identifier){if(h.value==="auto"){i();return true}}else return I()}function ua(){var a,b;if(h.identifier&&h.value==="url"){h=Da.range("(",")");b=h.value;a=b.charAt(0);if(a==='"'||a==="'")if(b.slice(-1)!==a)f("bad_url");else{b=b.slice(1,-1);b.indexOf(a)>=0&&f("bad_url")}b||f("missing_url");l.safe&&wb.test(b)&&j("adsafe_a",h,b);Ia.push(b);i();return true}return false}function jb(a){var b=0,c,d,e,f=0;switch(typeof a){case "function":return a();case "string":if(h.identifier&&h.value===
a){i();return true}return false}for(;;){if(b>=a.length)return false;e=a[b];b=b+1;if(typeof e==="boolean")break;else if(typeof e==="number"){c=e;e=a[b];b=b+1}else c=1;for(d=false;c>0;)if(jb(e)){d=true;c=c-1}else break;if(d)return true}f=b;for(c=[];;){e=false;for(b=f;b<a.length;b=b+1)if(!c[b]&&jb(Va[a[b]])){e=d=true;c[b]=true;break}if(!e)return d}}function xb(){for(var a;;){if(h.id==="}"||h.id==="(end)"||X&&h.id===X)break;for(;h.id===";";){f("unexpected_a");O()}for(a=void 0;h.id==="*"||h.id==="#"||
h.value==="_";){l.css||f("unexpected_a");i()}if(h.id==="-"){l.css||f("unexpected_a");i("-");h.identifier||f("expected_nonstandard_style_attribute");i();a=kb}else{if(h.identifier)if(Object.prototype.hasOwnProperty.call(Va,h.value))a=Va[h.value];else{a=kb;l.css||f("unrecognized_style_attribute_a")}else f("expected_style_attribute");i()}i(":");if(h.identifier&&h.value==="inherit")i();else if(!jb(a)){f("unexpected_a");i()}if(h.id==="!"){i("!");C();h.identifier&&h.value==="important"?i():f("expected_a_b",
h,"important",h.value)}h.id==="}"||h.id===X?f("expected_a_b",h,";",h.value):O()}}function lb(){if(h.identifier){Object.prototype.hasOwnProperty.call(mb,l.cap?h.value.toLowerCase():h.value)||f("expected_tagname_a");i()}else switch(h.id){case ">":case "+":i();lb();break;case ":":i(":");switch(h.value){case "active":case "after":case "before":case "checked":case "disabled":case "empty":case "enabled":case "first-child":case "first-letter":case "first-line":case "first-of-type":case "focus":case "hover":case "last-child":case "last-of-type":case "link":case "only-of-type":case "root":case "target":case "visited":i();
break;case "lang":i();i("(");h.identifier||f("expected_lang_a");i(")");break;case "nth-child":case "nth-last-child":case "nth-last-of-type":case "nth-of-type":i();i("(");if(h.id==="(number)"){i();if(h.value==="n"&&h.identifier){C();i();if(h.id==="+"){C();i("+");C();i("(number)")}}}else h.identifier&&(h.value==="odd"||h.value==="even")?i():f("unexpected_a");i(")");break;case "not":i();i("(");h.id===":"&&t(0).value==="not"&&f("not");lb();i(")");break;default:f("expected_pseudo_a")}break;case "#":i("#");
h.identifier||f("expected_id_a");i();break;case "*":i("*");break;case ".":i(".");h.identifier||f("expected_class_a");i();break;case "[":i("[");h.identifier||f("expected_attribute_a");i();if(h.id==="="||h.value==="~="||h.value==="$="||h.value==="|="||h.id==="*="||h.id==="^="){i();h.id!=="(string)"&&f("expected_string_a");i()}i("]");break;default:j("expected_selector_a")}}function yb(){for(;h.id!=="</"&&h.id!=="(end)";){a:for(h.id==="{"&&f("expected_style_pattern");;){lb();if(h.id==="</"||h.id==="{"||
h.id==="(end)")break a;h.id===","&&D()}z="styleproperty";if(h.id===";")O();else{i("{");xb();z="style";i("}")}}}function zb(){for(;h.id==="@";){t();i("@");if(h.identifier)switch(h.value){case "import":i();if(!ua()){f("expected_a_b",h,"url",h.value);i()}O();break;case "media":for(i();;){(!h.identifier||Ab[h.value]===true)&&j("expected_media_a");i();if(h.id!==",")break;D()}i("{");yb();i("}");break;default:f("expected_at_a")}else f("expected_at_a")}yb()}var Z,Ja,Ka,na,$a,Wa,Nb={"<":true,"<=":true,"==":true,
"===":true,"!==":true,"!=":true,">":true,">=":true,"+":true,"-":true,"*":true,"/":true,"%":true},Qa={arguments:true,callee:true,caller:true,constructor:true,eval:true,prototype:true,stack:true,unwatch:true,valueOf:true,watch:true},nb,Gb={clearInterval:false,clearTimeout:false,document:false,event:false,frames:false,history:false,Image:false,localStorage:false,location:false,name:false,navigator:false,Option:false,parent:false,screen:false,sessionStorage:false,setInterval:false,setTimeout:false,Storage:false,
window:false,XMLHttpRequest:false},K={a_label:"'{a}' is a statement label.",a_not_allowed:"'{a}' is not allowed.",a_not_defined:"'{a}' is not defined.",a_scope:"'{a}' used out of scope.",adsafe:"ADsafe violation.",adsafe_a:"ADsafe violation: '{a}'.",adsafe_autocomplete:"ADsafe autocomplete violation.",adsafe_bad_id:"ADSAFE violation: bad id.",adsafe_div:"ADsafe violation: Wrap the widget in a div.",adsafe_fragment:"ADSAFE: Use the fragment option.",adsafe_go:"ADsafe violation: Misformed ADSAFE.go.",
adsafe_html:"Currently, ADsafe does not operate on whole HTML documents. It operates on <div> fragments and .js files.",adsafe_id:"ADsafe violation: id does not match.",adsafe_id_go:"ADsafe violation: Missing ADSAFE.id or ADSAFE.go.",adsafe_lib:"ADsafe lib violation.",adsafe_lib_second:"ADsafe: The second argument to lib must be a function.",adsafe_missing_id:"ADSAFE violation: missing ID_.",adsafe_name_a:"ADsafe name violation: '{a}'.",adsafe_placement:"ADsafe script placement violation.",adsafe_prefix_a:"ADsafe violation: An id must have a '{a}' prefix",
adsafe_script:"ADsafe script violation.",adsafe_source:"ADsafe unapproved script source.",adsafe_subscript_a:"ADsafe subscript '{a}'.",adsafe_tag:"ADsafe violation: Disallowed tag '{a}'.",already_defined:"'{a}' is already defined.",and:"The '&&' subexpression should be wrapped in parens.",assign_exception:"Do not assign to the exception parameter.",assignment_function_expression:"Expected an assignment or function call and instead saw an expression.",attribute_case_a:"Attribute '{a}' not all lower case.",
avoid_a:"Avoid '{a}'.",bad_assignment:"Bad assignment.",bad_color_a:"Bad hex color '{a}'.",bad_constructor:"Bad constructor.",bad_entity:"Bad entity.",bad_html:"Bad HTML string",bad_id_a:"Bad id: '{a}'.",bad_in_a:"Bad for in variable '{a}'.",bad_invocation:"Bad invocation.",bad_name_a:"Bad name: '{a}'.",bad_new:"Do not use 'new' for side effects.",bad_number:"Bad number '{a}'.",bad_operand:"Bad operand.",bad_type:"Bad type.",bad_url:"Bad url string.",bad_wrap:"Do not wrap function literals in parens unless they are to be immediately invoked.",
combine_var:"Combine this with the previous 'var' statement.",conditional_assignment:"Expected a conditional expression and instead saw an assignment.",confusing_a:"Confusing use of '{a}'.",confusing_regexp:"Confusing regular expression.",constructor_name_a:"A constructor name '{a}' should start with an uppercase letter.",control_a:"Unexpected control character '{a}'.",css:"A css file should begin with @charset 'UTF-8';",dangling_a:"Unexpected dangling '_' in '{a}'.",dangerous_comment:"Dangerous comment.",
deleted:"Only properties should be deleted.",duplicate_a:"Duplicate '{a}'.",empty_block:"Empty block.",empty_case:"Empty case.",empty_class:"Empty class.",es5:"This is an ES5 feature.",evil:"eval is evil.",expected_a:"Expected '{a}'.",expected_a_b:"Expected '{a}' and instead saw '{b}'.",expected_a_b_from_c_d:"Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'.",expected_at_a:"Expected an at-rule, and instead saw @{a}.",expected_a_at_b_c:"Expected '{a}' at column {b}, not column {c}.",
expected_attribute_a:"Expected an attribute, and instead saw [{a}].",expected_attribute_value_a:"Expected an attribute value and instead saw '{a}'.",expected_class_a:"Expected a class, and instead saw .{a}.",expected_fraction_a:"Expected a number between 0 and 1 and instead saw '{a}'",expected_id_a:"Expected an id, and instead saw #{a}.",expected_identifier_a:"Expected an identifier and instead saw '{a}'.",expected_identifier_a_reserved:"Expected an identifier and instead saw '{a}' (a reserved word).",
expected_linear_a:"Expected a linear unit and instead saw '{a}'.",expected_lang_a:"Expected a lang code, and instead saw :{a}.",expected_media_a:"Expected a CSS media type, and instead saw '{a}'.",expected_name_a:"Expected a name and instead saw '{a}'.",expected_nonstandard_style_attribute:"Expected a non-standard style attribute and instead saw '{a}'.",expected_number_a:"Expected a number and instead saw '{a}'.",expected_operator_a:"Expected an operator and instead saw '{a}'.",expected_percent_a:"Expected a percentage and instead saw '{a}'",
expected_positive_a:"Expected a positive number and instead saw '{a}'",expected_pseudo_a:"Expected a pseudo, and instead saw :{a}.",expected_selector_a:"Expected a CSS selector, and instead saw {a}.",expected_small_a:"Expected a small number and instead saw '{a}'",expected_space_a_b:"Expected exactly one space between '{a}' and '{b}'.",expected_string_a:"Expected a string and instead saw {a}.",expected_style_attribute:"Excepted a style attribute, and instead saw '{a}'.",expected_style_pattern:"Expected a style pattern, and instead saw '{a}'.",
expected_tagname_a:"Expected a tagName, and instead saw {a}.",for_if:"The body of a for in should be wrapped in an if statement to filter unwanted properties from the prototype.",function_block:"Function statements should not be placed in blocks. Use a function expression or move the statement to the top of the outer function.",function_eval:"The Function constructor is eval.",function_loop:"Don't make functions within a loop.",function_statement:"Function statements are not invocable. Wrap the whole function invocation in parens.",
function_strict:"Use the function form of 'use strict'.",html_confusion_a:"HTML confusion in regular expression '<{a}'.",html_handlers:"Avoid HTML event handlers.",identifier_function:"Expected an identifier in an assignment and instead saw a function invocation.",implied_evil:"Implied eval is evil. Pass a function instead of a string.",infix_in:"Unexpected 'in'. Compare with undefined, or use the hasOwnProperty method instead.",insecure_a:"Insecure '{a}'.",isNaN:"Use the isNaN function to compare with NaN.",
label_a_b:"Label '{a}' on '{b}' statement.",lang:"lang is deprecated.",leading_decimal_a:"A leading decimal point can be confused with a dot: '.{a}'.",missing_a:"Missing '{a}'.",missing_a_after_b:"Missing '{a}' after '{b}'.",missing_option:"Missing option value.",missing_property:"Missing property name.",missing_space_a_b:"Missing space between '{a}' and '{b}'.",missing_url:"Missing url.",missing_use_strict:"Missing 'use strict' statement.",mixed:"Mixed spaces and tabs.",move_invocation:"Move the invocation into the parens that contain the function.",
move_var:"Move 'var' declarations to the top of the function.",name_function:"Missing name in function statement.",nested_comment:"Nested comment.",not:"Nested not.",not_a_constructor:"Do not use {a} as a constructor.",not_a_defined:"'{a}' has not been fully defined yet.",not_a_function:"'{a}' is not a function.",not_a_label:"'{a}' is not a label.",not_a_scope:"'{a}' is out of scope.",not_greater:"'{a}' should not be greater than '{b}'.",parameter_a_get_b:"Unexpected parameter '{a}' in get {b} function.",
parameter_set_a:"Expected parameter (value) in set {a} function.",radix:"Missing radix parameter.",read_only:"Read only.",redefinition_a:"Redefinition of '{a}'.",reserved_a:"Reserved name '{a}'.",scanned_a_b:"{a} ({b}% scanned).",slash_equal:"A regular expression literal can be confused with '/='.",statement_block:"Expected to see a statement and instead saw a block.",stopping:"Stopping. ",strange_loop:"Strange loop.",strict:"Strict violation.",subscript:"['{a}'] is better written in dot notation.",
tag_a_in_b:"A '<{a}>' must be within '<{b}>'.",too_long:"Line too long.",too_many:"Too many errors.",trailing_decimal_a:"A trailing decimal point can be confused with a dot: '.{a}'.",type:"type is unnecessary.",type_inconsistency_a_b:"Type inconsistency: {a} and {b}.",unclosed:"Unclosed string.",unclosed_comment:"Unclosed comment.",unclosed_regexp:"Unclosed regular expression.",unescaped_a:"Unescaped '{a}'.",unexpected_a:"Unexpected '{a}'.",unexpected_char_a_b:"Unexpected character '{a}' in {b}.",
unexpected_comment:"Unexpected comment.",unexpected_property_a:"Unexpected /*property*/ '{a}'.",unexpected_space_a_b:"Unexpected space between '{a}' and '{b}'.",unnecessary_initialize:"It is not necessary to initialize '{a}' to 'undefined'.",unnecessary_use:"Unnecessary 'use strict'.",unreachable_a_b:"Unreachable '{a}' after '{b}'.",unrecognized_style_attribute_a:"Unrecognized style attribute '{a}'.",unrecognized_tag_a:"Unrecognized tag '<{a}>'.",unsafe:"Unsafe character.",url:"JavaScript URL.",use_array:"Use the array literal notation [].",
use_braces:"Spaces are hard to count. Use {{a}}.",use_charAt:"Use the charAt method.",use_object:"Use the object literal notation {}.",use_or:"Use the || operator.",use_param:"Use a named parameter.",used_before_a:"'{a}' was used before it was defined.",var_a_not:"Variable {a} was not declared correctly.",weird_assignment:"Weird assignment.",weird_condition:"Weird condition.",weird_new:"Weird construction. Delete 'new'.",weird_program:"Weird program.",weird_relation:"Weird relation.",weird_ternary:"Weird ternary.",
wrap_immediate:"Wrap an immediate function invocation in parentheses to assist the reader in understanding that the expression is the result of a function, and not the function itself.",wrap_regexp:"Wrap the /regexp/ literal in parens to disambiguate the slash operator.",write_is_wrong:"document.write can be a form of eval."},Ea,Va,kb,Mb={aliceblue:true,antiquewhite:true,aqua:true,aquamarine:true,azure:true,beige:true,bisque:true,black:true,blanchedalmond:true,blue:true,blueviolet:true,brown:true,
burlywood:true,cadetblue:true,chartreuse:true,chocolate:true,coral:true,cornflowerblue:true,cornsilk:true,crimson:true,cyan:true,darkblue:true,darkcyan:true,darkgoldenrod:true,darkgray:true,darkgreen:true,darkkhaki:true,darkmagenta:true,darkolivegreen:true,darkorange:true,darkorchid:true,darkred:true,darksalmon:true,darkseagreen:true,darkslateblue:true,darkslategray:true,darkturquoise:true,darkviolet:true,deeppink:true,deepskyblue:true,dimgray:true,dodgerblue:true,firebrick:true,floralwhite:true,
forestgreen:true,fuchsia:true,gainsboro:true,ghostwhite:true,gold:true,goldenrod:true,gray:true,green:true,greenyellow:true,honeydew:true,hotpink:true,indianred:true,indigo:true,ivory:true,khaki:true,lavender:true,lavenderblush:true,lawngreen:true,lemonchiffon:true,lightblue:true,lightcoral:true,lightcyan:true,lightgoldenrodyellow:true,lightgreen:true,lightpink:true,lightsalmon:true,lightseagreen:true,lightskyblue:true,lightslategray:true,lightsteelblue:true,lightyellow:true,lime:true,limegreen:true,
linen:true,magenta:true,maroon:true,mediumaquamarine:true,mediumblue:true,mediumorchid:true,mediumpurple:true,mediumseagreen:true,mediumslateblue:true,mediumspringgreen:true,mediumturquoise:true,mediumvioletred:true,midnightblue:true,mintcream:true,mistyrose:true,moccasin:true,navajowhite:true,navy:true,oldlace:true,olive:true,olivedrab:true,orange:true,orangered:true,orchid:true,palegoldenrod:true,palegreen:true,paleturquoise:true,palevioletred:true,papayawhip:true,peachpuff:true,peru:true,pink:true,
plum:true,powderblue:true,purple:true,red:true,rosybrown:true,royalblue:true,saddlebrown:true,salmon:true,sandybrown:true,seagreen:true,seashell:true,sienna:true,silver:true,skyblue:true,slateblue:true,slategray:true,snow:true,springgreen:true,steelblue:true,tan:true,teal:true,thistle:true,tomato:true,turquoise:true,violet:true,wheat:true,white:true,whitesmoke:true,yellow:true,yellowgreen:true,activeborder:true,activecaption:true,appworkspace:true,background:true,buttonface:true,buttonhighlight:true,
buttonshadow:true,buttontext:true,captiontext:true,graytext:true,highlight:true,highlighttext:true,inactiveborder:true,inactivecaption:true,inactivecaptiontext:true,infobackground:true,infotext:true,menu:true,menutext:true,scrollbar:true,threeddarkshadow:true,threedface:true,threedhighlight:true,threedlightshadow:true,threedshadow:true,window:true,windowframe:true,windowtext:true},za,ob,vb={"%":true,cm:true,em:true,ex:true,"in":true,mm:true,pc:true,pt:true,px:true},Ab,Xa,Ob={b:"\u0008",t:"\t",n:"\n",
f:"\u000c",r:"\r",'"':'"',"/":"/","\\":"\\"},Fb={alert:false,confirm:false,console:false,Debug:false,opera:false,prompt:false},Db={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r","'":"\\'",'"':'\\"',"/":"\\/","\\":"\\\\"},r,La=["closure","exception","global","label","outer","undef","unused","var"],Ta,aa,Ba,mb={a:{},abbr:{},acronym:{},address:{},applet:{},area:{empty:true,parent:" map "},article:{},aside:{},audio:{},b:{},base:{empty:true,parent:" head "},bdo:{},big:{},blockquote:{},
body:{parent:" html noframes "},br:{empty:true},button:{},canvas:{parent:" body p div th td "},caption:{parent:" table "},center:{},cite:{},code:{},col:{empty:true,parent:" table colgroup "},colgroup:{parent:" table "},command:{parent:" menu "},datalist:{},dd:{parent:" dl "},del:{},details:{},dialog:{},dfn:{},dir:{},div:{},dl:{},dt:{parent:" dl "},em:{},embed:{},fieldset:{},figure:{},font:{},footer:{},form:{},frame:{empty:true,parent:" frameset "},frameset:{parent:" html frameset "},h1:{},h2:{},h3:{},
h4:{},h5:{},h6:{},head:{parent:" html "},header:{},hgroup:{},hr:{empty:true},"hta:application":{empty:true,parent:" head "},html:{parent:"*"},i:{},iframe:{},img:{empty:true},input:{empty:true},ins:{},kbd:{},keygen:{},label:{},legend:{parent:" details fieldset figure "},li:{parent:" dir menu ol ul "},link:{empty:true,parent:" head "},map:{},mark:{},menu:{},meta:{empty:true,parent:" head noframes noscript "},meter:{},nav:{},noframes:{parent:" html body "},noscript:{parent:" body head noframes "},object:{},
ol:{},optgroup:{parent:" select "},option:{parent:" optgroup select "},output:{},p:{},param:{empty:true,parent:" applet object "},pre:{},progress:{},q:{},rp:{},rt:{},ruby:{},samp:{},script:{empty:true,parent:" body div frame head iframe p pre span "},section:{},select:{},small:{},span:{},source:{},strong:{},style:{parent:" head ",empty:true},sub:{},sup:{},table:{},tbody:{parent:" table "},td:{parent:" tr "},textarea:{},tfoot:{parent:" table "},th:{parent:" tr "},thead:{parent:" table "},time:{},title:{parent:" head "},
tr:{parent:" table tbody thead tfoot "},tt:{},u:{},ul:{},"var":{},video:{}},Ya,Ga,A,ga,oa,Da,Aa,Ca,ta,Ib={Buffer:false,clearInterval:false,clearTimeout:false,console:false,exports:false,global:false,module:false,process:false,querystring:false,require:false,setInterval:false,setTimeout:false,__dirname:false,__filename:false},Ma,Lb={indexOf:true,lastIndexOf:true,search:true},h,va,l,V,pb,Y,ia,Pb={g:true,i:true,m:true},Eb={defineClass:false,deserialize:false,gc:false,help:false,load:false,loadClass:false,
print:false,quit:false,readFile:false,readUrl:false,runCommand:false,seal:false,serialize:false,spawn:false,sync:false,toint32:false,version:false},H,Kb={";":true,'"':true,"'":true,")":true},qb,S,Qb={Array:false,Boolean:false,Date:false,decodeURI:false,decodeURIComponent:false,encodeURI:false,encodeURIComponent:false,Error:false,eval:false,EvalError:false,Function:false,isFinite:false,isNaN:false,JSON:false,Math:false,Number:false,Object:false,parseInt:false,parseFloat:false,RangeError:false,ReferenceError:false,
RegExp:false,String:false,SyntaxError:false,TypeError:false,URIError:false},Rb={E:true,LN2:true,LN10:true,LOG2E:true,LOG10E:true,MAX_VALUE:true,MIN_VALUE:true,NEGATIVE_INFINITY:true,PI:true,POSITIVE_INFINITY:true,SQRT1_2:true,SQRT2:true},pa,ba={},Za,n,Ia,ha,Na,Jb={alert:true,animator:true,appleScript:true,beep:true,bytesToUIString:true,Canvas:true,chooseColor:true,chooseFile:true,chooseFolder:true,closeWidget:true,COM:true,convertPathToHFS:true,convertPathToPlatform:true,CustomAnimation:true,escape:true,
FadeAnimation:true,filesystem:true,Flash:true,focusWidget:true,form:true,FormField:true,Frame:true,HotKey:true,Image:true,include:true,isApplicationRunning:true,iTunes:true,konfabulatorVersion:true,log:true,md5:true,MenuItem:true,MoveAnimation:true,openURL:true,play:true,Point:true,popupMenu:true,preferenceGroups:true,preferences:true,print:true,prompt:true,random:true,Rectangle:true,reloadWidget:true,ResizeAnimation:true,resolvePath:true,resumeUpdates:true,RotateAnimation:true,runCommand:true,runCommandInBg:true,
saveAs:true,savePreferences:true,screen:true,ScrollBar:true,showWidgetPreferences:true,sleep:true,speak:true,Style:true,suppressUpdates:true,system:true,tellWidget:true,Text:true,TextArea:true,Timer:true,unescape:true,updateNow:true,URL:true,Web:true,widget:true,Window:true,XMLDOM:true,XMLHttpRequest:true,yahooCheckLogin:true,yahooLogin:true,yahooLogout:true},Hb={ActiveXObject:false,CScript:false,Debug:false,Enumerator:false,System:false,VBArray:false,WScript:false},z,X,Sb=/@cc|<\/?|script|\]\s*\]|<\s*!|&lt/i,
Tb=/\r/g,Ub=/\r\n/g,Vb=/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,Wb=/[\[\]\/\\"'*<>.&:(){}+=#]/,Bb=/^\s*(['"=>\/&#]|<(?:\/|\!(?:--)?)?|[a-zA-Z][a-zA-Z0-9_\-:]*|[0-9]+|--)/,Cb=/^([a-zA-Z_$][a-zA-Z0-9_$]*)$/,eb=/^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i,Xb=/\*\/|\/\*/,ub=/[\u0000-\u001f'\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
Yb=/[>&]|<[\/!]?|--/,Zb=/[^a-zA-Z0-9+\-_\/ ]/,$b=/^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jslint|properties|property|members?|globals?)?|=|\/)?|\*[\/=]?|\+(?:=|\++)?|-(?:=|-+)?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/,wb=/&|\+|\u00AD|\.\.|\/\*|%[^;]|base64|url|expression|data|mailto/i,ac={outer:Bb,html:Bb,style:/^\s*([{:#%.=,>+\[\]@()"';]|\*=?|\$=|\|=|\^=|~=|[a-zA-Z_][a-zA-Z0-9_\-]*|[0-9]+|<\/|\/\*)/,
styleproperty:/^\s*([@#!"'};:\-%.=,+\[\]()*_]|[a-zA-Z][a-zA-Z0-9._\-]*|\/\*?|\d+(?:\.\d+)?|<\/)/};if(typeof Array.prototype.filter!=="function")Array.prototype.filter=function(a){var b,c=this.length,d=[],e;for(b=0;b<c;b=b+1)try{e=this[b];a(e)&&d.push(e)}catch(f){}return d};if(typeof Array.prototype.forEach!=="function")Array.prototype.forEach=function(a){var b,c=this.length;for(b=0;b<c;b=b+1)try{a(this[b])}catch(d){}return[]};if(typeof Array.isArray!=="function")Array.isArray=function(a){return Object.prototype.toString.apply(a)===
"[object Array]"};if(!Object.prototype.hasOwnProperty.call(Object,"create"))Object.create=function(a){b.prototype=a;return new b};if(typeof Object.keys!=="function")Object.keys=function(a){var b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b};if(typeof String.prototype.entityify!=="function")String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};if(typeof String.prototype.isAlpha!=="function")String.prototype.isAlpha=
function(){return this>="a"&&this<="z\uffff"||this>="A"&&this<="Z\uffff"};if(typeof String.prototype.isDigit!=="function")String.prototype.isDigit=function(){return this>="0"&&this<="9"};if(typeof String.prototype.supplant!=="function")String.prototype.supplant=function(a){return this.replace(/\{([^{}]*)\}/g,function(b,c){var d=a[c];return typeof d==="string"||typeof d==="number"?d:b})};Da=function(){function a(b,c,d,e){c={comment:b,quote:c,at:e,line:d};Ea||qb||z&&z!=="script"&&z!=="style"&&z!=="styleproperty"?
k("unexpected_comment",d,f):z==="script"&&/<\//i.test(o)?k("unexpected_a",d,f,"</"):l.safe&&Sb.test(b)&&k("dangerous_comment",d,e);va.comments?va.comments.push(c):va.comments=[c];JAYLINT.comments.push(c)}function b(){var a;if(i>=Aa.length)return false;f=1;o=Aa[i];i=i+1;a=o.search(/ \t/);a>=0&&k("mixed",i,a+1);o=o.replace(/\t/g,Za);a=o.search(Vb);a>=0&&k("unsafe",i,a);l.maxlen&&l.maxlen<o.length&&k("too_long",i,o.length);return true}function c(a,b,d){var e;(a==="(string)"||a==="(range)")&&eb.test(b)&&
k("url",i,h);e=Object.create(ba[a==="(punctuator)"||a==="(identifier)"&&Object.prototype.hasOwnProperty.call(ba,b)?b:a]||ba["(error)"]);if(a==="(identifier)"){e.identifier=true;b==="__iterator__"||b==="__proto__"?m("reserved_a",i,h,b):!l.nomen&&(b.charAt(0)==="_"||b.charAt(b.length-1)==="_")&&k("dangling_a",i,h,b)}if(b!==void 0)e.value=b;if(d)e.quote=d;e.line=i;e.from=h;e.thru=f;e.prev=va;pb=(a=e.id)&&("(,=:[!&|?{};".indexOf(a.charAt(a.length-1))>=0||a==="return");return va=va.next=e}function d(a){function e(a){var b=
parseInt(o.substr(p+1,a),16);p=p+a;b>=32&&b<=126&&b!==34&&b!==92&&b!==39&&k("unexpected_a",i,f,"\\");f=f+a;g=String.fromCharCode(b)}var g,p,q="";oa&&a!=='"'&&k("expected_a",i,f,'"');if(X===a||z==="scriptstring"&&!X)return c("(punctuator)",a);for(p=0;;){for(;p>=o.length;){p=0;(z!=="html"||!b())&&m("unclosed",i,h)}g=o.charAt(p);if(g===a){f=f+1;o=o.slice(p+1);return c("(string)",q,a)}if(g<" "){if(g==="\n"||g==="\r")break;k("control_a",i,f+j,o.slice(0,j))}else if(g===X)k("bad_html",i,f+p);else if(g===
"<")l.safe&&z==="html"?k("adsafe_a",i,f+j,g):o.charAt(j+1)==="/"&&(z||l.safe)?k("expected_a_b",i,f,"<\\/","</"):o.charAt(j+1)==="!"&&(z||l.safe)&&k("unexpected_a",i,f,"<!");else if(g==="\\")if(z==="html")l.safe&&k("adsafe_a",i,f+j,g);else if(z==="styleproperty"){p=p+1;f=f+1;g=o.charAt(p);g!==a&&k("unexpected_a",i,f,"\\")}else{p=p+1;f=f+1;g=o.charAt(p);switch(g){case "":l.es5||k("es5",i,f);b();p=-1;break;case X:k("bad_html",i,f+p);break;case "'":oa&&k("unexpected_a",i,f,"\\'");break;case "u":e(4);
break;case "v":oa&&k("unexpected_a",i,f,"\\v");g="\v";break;case "x":oa&&k("unexpected_a",i,f,"\\x");e(2);break;default:g=Ob[g];typeof g!=="string"&&k("unexpected_a",i,f,"\\")}}q=q+g;f=f+1;p=p+1}}function e(){for(var a,b,d=0,p=0;;){a=true;g=o.charAt(p);p=p+1;switch(g){case "":m("unclosed_regexp",i,h);return;case "/":d>0&&k("unescaped_a",i,h+p,"/");g=o.slice(0,p-1);for(d=Object.create(Pb);d[o.charAt(p)]===true;){d[o.charAt(p)]=false;p=p+1}o.charAt(p).isAlpha()&&m("unexpected_a",i,h,o.charAt(p));f=
f+p;o=o.slice(p);p=o.charAt(0);(p==="/"||p==="*")&&m("confusing_regexp",i,h);return c("(regexp)",g);case "\\":g=o.charAt(p);g<" "?k("control_a",i,h+p,""+g):g==="<"&&k(K.unexpected_a,i,h+p,"\\");p=p+1;break;case "(":d=d+1;a=false;if(o.charAt(p)==="?"){p=p+1;switch(o.charAt(p)){case ":":case "=":case "!":p=p+1;break;default:k(K.expected_a_b,i,h+p,":",o.charAt(p))}}break;case "|":a=false;break;case ")":d===0?k("unescaped_a",i,h+p,")"):d=d-1;break;case " ":for(j=1;o.charAt(p)===" ";){p=p+1;j=j+1}j>1&&
k("use_braces",i,h+p,j);break;case "[":g=o.charAt(p);if(g==="^"){p=p+1;l.regexp?o.charAt(p)==="]"&&m("unescaped_a",i,h+p,"^"):k("insecure_a",i,h+p,g)}b=false;if(g==="]"){k("empty_class",i,h+p-1);b=true}a:do{g=o.charAt(p);p=p+1;switch(g){case "[":case "^":k("unescaped_a",i,h+p,g);b=true;break;case "-":if(b)b=false;else{k("unescaped_a",i,h+p,"-");b=true}break;case "]":b||k("unescaped_a",i,h+p-1,"-");break a;case "\\":g=o.charAt(p);g<" "?k(K.control_a,i,h+p,""+g):g==="<"&&k(K.unexpected_a,i,h+p,"\\");
p=p+1;b=true;break;case "/":k("unescaped_a",i,h+p-1,"/");b=true;break;case "<":if(z==="script"){g=o.charAt(p);(g==="!"||g==="/")&&k(K.html_confusion_a,i,h+p,g)}b=true;break;default:b=true}}while(g);break;case ".":l.regexp||k("insecure_a",i,h+p,g);break;case "]":case "?":case "{":case "}":case "+":case "*":k("unescaped_a",i,h+p,g);break;case "<":if(z==="script"){g=o.charAt(p);(g==="!"||g==="/")&&k(K.html_confusion_a,i,h+p,g)}}if(a)switch(o.charAt(p)){case "?":case "+":case "*":p=p+1;o.charAt(p)===
"?"&&(p=p+1);break;case "{":p=p+1;g=o.charAt(p);(g<"0"||g>"9")&&k(K.expected_number_a,i,h+p,g);p=p+1;for(b=+g;;){g=o.charAt(p);if(g<"0"||g>"9")break;p=p+1;b=+g+b*10}a=b;if(g===","){p=p+1;a=Infinity;g=o.charAt(p);if(g>="0"&&g<="9"){p=p+1;for(a=+g;;){g=o.charAt(p);if(g<"0"||g>"9")break;p=p+1;a=+g+a*10}}}o.charAt(p)!=="}"?k(K.expected_a_b,i,h+p,"}",g):p=p+1;o.charAt(p)==="?"&&(p=p+1);b>a&&k(K.not_greater,i,h+p,b,a)}}g=o.slice(0,p-1);f=f+p;o=o.slice(p);return c("(regexp)",g)}var f,g,h,q,i,j,o;return{init:function(a){Aa=
typeof a==="string"?a.replace(Ub,"\n").replace(Tb,"\n").split("\n"):a;i=0;b();h=1},range:function(a,b){var d,e="";h=f;for(o.charAt(0)!==a&&m("expected_a_b",i,f,a,o.charAt(0));;){o=o.slice(1);f=f+1;d=o.charAt(0);switch(d){case "":m("missing_a",i,f,d);break;case b:o=o.slice(1);f=f+1;return c("(range)",e);case X:case "\\":k("unexpected_a",i,f,d)}e=e+d}},token:function(){for(var j,l,y;;){for(;!o;)if(!b())return c("(end)");for(;z==="outer";){l=o.search(Yb);if(l===0)break;else if(l>0){f=f+1;o=o.slice(l);
break}else if(!b())return c("(end)","")}j=(ac[z]||$b).exec(o);y=void 0;if(j){q=j[0].length;y=j[1];g=y.charAt(0);o=o.slice(q);h=f+q-y.length;f=f+q}else y=void 0;if(y){j=y.charAt(0);if(j.isAlpha()||j==="_"||j==="$")return c("(identifier)",y);if(j.isDigit()){l=y;j=void 0;z!=="style"&&z!=="styleproperty"&&o.charAt(0).isAlpha()&&k("expected_space_a_b",i,f,g,o.charAt(0));if(g==="0"){j=l.charAt(1);j.isDigit()?n.id!=="."&&z!=="styleproperty"&&k("unexpected_a",i,f,l):oa&&(j==="x"||j==="X")&&k("unexpected_a",
i,f,"0x")}l.slice(l.length-1)==="."&&k("trailing_decimal_a",i,f,l);if(z!=="style"){j=+l;isFinite(j)||k("bad_number",i,f,l);l=j}return c("(number)",l)}switch(y){case '"':case "'":return d(y);case "//":a(o,"//",i,f);o="";break;case "/*":for(j="/*";;){l=o.search(Xb);if(l>=0)break;a(o,j,i,f);j="";b()||m("unclosed_comment",i,f)}a(o.slice(0,l),j,f,i);f=f+(l+2);o.charAt(l)==="/"&&m("nested_comment",i,f);o=o.slice(l+2);break;case "":break;case "/":n.id==="/="&&m(K.slash_equal,i,h);return pb?e():c("(punctuator)",
y);case "<\!--":for(q=i;;){l=o.indexOf("--");if(l>=0)break;l=o.indexOf("<!");l>=0&&m("nested_comment",i,f+l);b()||m("unclosed_comment",q,j)}q=o.indexOf("<!");q>=0&&q<l&&m("nested_comment",i,f+q);f=f+l;o.charAt(l+2)!==">"&&m("expected_a",i,f,"--\>");f=f+3;o=o.slice(l+3);break;case "#":if(z==="html"||z==="styleproperty"){for(;;){j=o.charAt(0);if((j<"0"||j>"9")&&(j<"a"||j>"f")&&(j<"A"||j>"F"))break;f=f+1;o=o.slice(1);y=y+j}y.length!==4&&y.length!==7&&k("bad_color_a",i,h+q,y);return c("(color)",y)}return c("(punctuator)",
y);default:if(z==="outer"&&j==="&"){f=f+1;for(o=o.slice(1);;){j=o.charAt(0);f=f+1;o=o.slice(1);if(j===";")break;j>="0"&&j<="9"||j>="a"&&j<="z"||j==="#"||m("bad_entity",i,h+q,f)}break}return c("(punctuator)",y)}}else{for(;o&&o<"!";)o=o.slice(1);if(o){if(z==="html")return c("(error)",o.charAt(0));m("unexpected_a",i,f,o.charAt(0))}}}}}}();ba["(identifier)"]={lbp:0,identifier:true,nud:function(){var a=this.value,b=H[a];if(typeof b!=="object"){b=V[a];if(typeof b==="boolean"){Ba[a]=b={value:a,writeable:b,
funct:aa};aa[a]="var"}else{l.undef||f("used_before_a",n);H[a]=b={value:a,writeable:true,funct:r};r[a]="undef"}}b=b.funct;if(r===b)switch(r[a]){case "becoming":f("unexpected_a",n);r[a]="var";break;case "unused":r[a]="var";break;case "unparam":r[a]="parameter";break;case "unction":r[a]="function";break;case "label":f("a_label",n,a)}else switch(r[a]){case "closure":case "function":case "var":case "unused":f("a_scope",n,a);break;case "label":f("a_label",n,a);break;case "outer":case "global":break;default:switch(b[a]){case "function":case "unction":case "var":case "unused":case "becoming":case "closure":case "parameter":b[a]=
"closure";r[a]=b===aa?"global":"outer";break;case "unparam":b[a]="parameter";r[a]="outer";break;case "undef":r[a]="undef";break;case "label":f("a_label",n,a)}}return this},led:function(){j("expected_operator_a")}};ka("(array)","array");ka("(color)","color");ka("(function)","function");ka("(number)","number",a);ka("(object)","object");ka("(string)","string",a);ka("(boolean)","boolean",a);ka("(range)","range");ka("(regexp)","regexp",a);ab("(begin)");ab("(end)");ab("(error)");qa(M("</"));M("<!");M("<\!--");
M("--\>");qa(M("}"));M(")");M("]");qa(M('"'));qa(M("'"));M(";");M(":");M(",");M("#");M("@");M("*/");qa(L("case"));L("catch");qa(L("default"));L("else");L("finally");cb("arguments",function(a){pa&&r===aa?f("strict",a):l.safe&&f("adsafe",a)});cb("eval",function(a){l.safe&&f("adsafe",a)});wa("false","boolean",false);wa("Infinity","number",Infinity);wa("NaN","number",NaN);wa("null","",null);cb("this",function(a){pa&&(r["(statement)"]&&r["(name)"].charAt(0)>"Z"||r===aa)?f("strict",a):l.safe&&f("adsafe",
a)});wa("true","boolean",true);wa("undefined","",void 0);R("?",30,function(a,b){b.first=ea(da(a));b.second=w(0);B();var c=h;i(":");s();B();b.third=w(10);b.arity="ternary";b.type=Q(b.second,b.third);P(b.second,b.third)?f("weird_ternary",c):P(b.first,b.second)&&f("use_or",b);return b});R("||",40,function(a,b){function c(a){a.id==="&&"&&!a.paren&&f("and",a);return a}b.first=c(ea(da(a)));b.second=c(da(w(40)));P(b.first,b.second)&&f("weird_condition",b);return b});R("&&",50,function(a,b){b.first=ea(da(a));
b.second=da(w(50));P(b.first,b.second)&&f("weird_condition",b);return b});U("void",function(){this.first=w(0);if(this.first.id!=="(number)"||this.first.value){f("unexpected_a",this);return this}this.type="undefined";return this});xa("|",70);xa("^",80);xa("&",90);ma("==","===");ma("===");ma("!=","!==");ma("!==");ma("<");ma(">");ma("<=");ma(">=");xa("<<",120);xa(">>",120);xa(">>>",120);R("in",120,function(a,b){f("infix_in",b);b.left=a;b.right=w(130);return b},"boolean");R("instanceof",120,null,"boolean");
R("+",130,function(a,b){a.value||(a.id==="(number)"?f("unexpected_a",a):a.id==="(string)"&&f("expected_a_b",a,"String","''"));var c=w(130);c.value||(c.id==="(number)"?f("unexpected_a",c):c.id==="(string)"&&f("expected_a_b",c,"String","''"));if(a.id===c.id&&(a.id==="(string)"||a.id==="(number)")){a.value=a.value+c.value;a.thru=c.thru;a.id==="(string)"&&eb.test(a.value)&&f("url",a);s(c);s(b);return a}b.first=a;b.second=c;b.type=Q(a,c,b);return b});U("+","num");U("+++",function(){f("confusing_a",n);
this.first=w(150);this.arity="prefix";return this});R("+++",130,function(a){f("confusing_a",n);this.first=a;this.second=w(130);return this});R("-",130,function(a,b){(a.id==="(number)"&&a.value===0||a.id==="(string)")&&f("unexpected_a",a);var c=w(130);(c.id==="(number)"&&c.value===0||c.id==="(string)")&&f("unexpected_a",a);if(a.id===c.id&&a.id==="(number)"){a.value=a.value-c.value;a.thru=c.thru;s(c);s(b);return a}b.first=a;b.second=c;return b},"number");U("-");U("---",function(){f("confusing_a",n);
this.first=w(150);this.arity="prefix";return this});R("---",130,function(a){f("confusing_a",n);this.first=a;this.second=w(130);return this});R("*",140,function(a,b){(a.id==="(number)"&&(a.value===0||a.value===1)||a.id==="(string)")&&f("unexpected_a",a);var c=w(140);(c.id==="(number)"&&(c.value===0||c.value===1)||c.id==="(string)")&&f("unexpected_a",c);if(a.id===c.id&&a.id==="(number)"){a.value=a.value*c.value;a.thru=c.thru;s(c);s(b);return a}b.first=a;b.second=c;return b},"number");R("/",140,function(a,
b){(a.id==="(number)"&&a.value===0||a.id==="(string)")&&f("unexpected_a",a);var c=w(140);(c.id==="(number)"&&(c.value===0||c.value===1)||c.id==="(string)")&&f("unexpected_a",c);if(a.id===c.id&&a.id==="(number)"){a.value=a.value/c.value;a.thru=c.thru;s(c);s(b);return a}b.first=a;b.second=c;return b},"number");R("%",140,function(a,b){(a.id==="(number)"&&(a.value===0||a.value===1)||a.id==="(string)")&&f("unexpected_a",a);var c=w(140);(c.id==="(number)"&&c.value===0||c.id==="(string)")&&f("unexpected_a",
c);if(a.id===c.id&&a.id==="(number)"){a.value=a.value%c.value;a.thru=c.thru;s(c);s(b);return a}b.first=a;b.second=c;return b},"number");tb("++");U("++");tb("--");U("--");U("delete",function(){u();var a=w(0);(!a||a.id!=="."&&a.id!=="[")&&f("deleted");this.first=a;return this});U("~",function(){C();l.bitwise||f("unexpected_a",this);w(150);return this},"number");U("!",function(){C();this.first=ea(w(150));this.arity="prefix";Nb[this.first.id]===true&&f("confusing_a",this);return this},"boolean");U("typeof",
null,"string");U("new",function(){u();var a=w(160),b;this.first=a;if(a.id!=="function")if(a.identifier)switch(a.value){case "Object":f("use_object",n);break;case "Array":if(h.id==="("){b=h;b.first=this;i("(");if(h.id!==")"){b.second=w(0);if(b.second.id!=="(string)"||!b.second.value){ea(b.second,K.use_array);a=false}else a=true;for(;h.id!==")"&&h.id!=="(end)";){if(a){f("use_array",b);a=false}i()}}else f("use_array",n);i(")",b);s();return b}f("use_array",n);break;case "Number":case "String":case "Boolean":case "Math":case "JSON":f("not_a_constructor",
a);break;case "Function":l.evil||f("function_eval");break;case "Date":case "RegExp":break;default:if(a.id!=="function"){a=a.value.charAt(0);!l.newcap&&(a<"A"||a>"Z")&&f("constructor_name_a",n)}}else a.id!=="."&&a.id!=="["&&a.id!=="("&&f("bad_constructor",n);else f("weird_new",this);h.id!=="("&&f("missing_a",h,"()");return this});R("(",160,function(a,b){A&&A.mode==="expression"?v(Y,n):C(Y,n);!a.immed&&a.id==="function"&&f("wrap_immediate");var c=[];if(a){Q("function",a);a.identifier?a.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/)&&
a.value!=="Number"&&a.value!=="String"&&a.value!=="Boolean"&&a.value!=="Date"&&(a.value==="Math"||a.value==="JSON"?f("not_a_function",a):a.value==="Object"?f("use_object",n):(a.value==="Array"||!l.newcap)&&f("missing_a",a,"new")):a.id==="."&&(l.safe&&a.first.value==="Math"&&a.second==="random"?f("adsafe",a):a.second.value==="split"&&a.first.id==="(string)"&&f("use_array",a.second))}F();if(h.id!==")")for(v();;){x();c.push(w(10));if(h.id!==",")break;D()}v();E(")",b);if(typeof a==="object"){a.value===
"parseInt"&&c.length===1&&f("radix",a);l.evil||(a.value==="eval"||a.value==="Function"||a.value==="execScript"?f("evil",a):c[0]&&c[0].id==="(string)"&&(a.value==="setTimeout"||a.value==="setInterval")&&f("implied_evil",a));!a.identifier&&a.id!=="."&&a.id!=="["&&a.id!=="("&&a.id!=="&&"&&a.id!=="||"&&a.id!=="?"&&f("bad_invocation",a)}b.first=a;b.second=c;if(!l.type)if(a.id===".")if(a.second.value==="charAt"||a.second.value==="substring"){Q("string",b);Q("string",a.first);c.forEach(function(a){Q("number",
a)})}else(a.second.value==="toString"||a.second.value==="stringify")&&Q("string",b);else a.identifier&&a.value==="String"&&Q("string",b);return b},"",true);U("(",function(){F("expression");s();v();x();if(h.id==="function")h.immed=true;var a=w(0);a.paren=true;v();E(")",this);s();a.id==="function"&&(h.id==="("?f("move_invocation"):f("bad_wrap",this));return a});R(".",170,function(a,b){v(Y,n);v();var c=ra();typeof c==="string"&&Ra(c);b.first=a;b.second=n;if(a&&a.value==="arguments"&&(c==="callee"||c===
"caller"))f("avoid_a",a,"arguments."+c);else if(!l.evil&&a&&a.value==="document"&&(c==="write"||c==="writeln"))f("write_is_wrong",a);else if(l.adsafe){if(!Ka&&a.value==="ADSAFE")if(c==="id"||c==="lib")f("adsafe",b);else if(c==="go"){z!=="script"?f("adsafe",b):(na||h.id!=="("||t(0).id!=="(string)"||t(0).value!==Z||t(1).id!==",")&&j("adsafe_a",b,"go");na=true;Ja=false}Ka=false}if(!l.evil&&(c==="eval"||c==="execScript"))f("evil");else if(l.safe)for(;;){Qa[c]===true&&f("adsafe_a",n,c);if(typeof V[a.value]!==
"boolean"||h.id==="(")break;if(Rb[c]===true){h.id==="."&&f("adsafe",b);break}if(h.id!=="."){f("adsafe",b);break}i(".");n.first=b;n.second=c;b=n;c=ra();typeof c==="string"&&Ra(c)}c==="length"&&Q("number",b);return b},"",true);R("[",170,function(a,b){var c=bb(a),d;C(Y,n);v();F();x();d=w(0);switch(bb(d)){case "number":d.id==="(number)"&&a.id==="arguments"&&f("use_param",a);c||Q("array",a);break;case "string":if(d.id==="(string)"){if(l.safe&&(Qa[d.value]||d.value.charAt(0)==="_"||d.value.slice(-1)===
"_"))f("adsafe_subscript_a",d);else if(!l.evil&&(d.value==="eval"||d.value==="execScript"))f("evil",d);else if(!l.sub&&Cb.test(d.value)){c=ba[d.value];(!c||!c.reserved)&&f("subscript",d)}Ra(d.value)}else l.safe&&d.id!=="typeof"&&f("adsafe_subscript_a",d);Q("object",a);break;case void 0:switch(bb(a)){case "array":Q("number",d);break;case "object":Q("string",d);break;case "string":l.type||f("use_charAt",b);b.type="string"}l.safe&&f("adsafe_subscript_a",d);break;default:l.safe?f("adsafe_subscript_a",
d):f("bad_type")}E("]",b);s();v(Y,n);b.first=a;b.second=d;return b},"",true);U("[",function(){this.arity="prefix";this.first=[];this.type="array";for(F("array");h.id!=="(end)";){for(;h.id===",";){f("unexpected_a",h);i(",");s()}if(h.id==="]")break;A.wrap=false;x();this.first.push(w(10));if(h.id===","){D();if(h.id==="]"&&!l.es5){f("unexpected_a",n);break}}else break}E("]",this);s();return this},170);ca("=");ca("+=","+");ca("-=","-");ca("*=","*");ca("/=","/").nud=function(){j("slash_equal")};ca("%=",
"%");ca("&=","&");ca("|=","|");ca("^=","^");ca("<<=","<<");ca(">>=",">>");ca(">>>=",">>>");U("{",function(){var a,b,c,d,e,g={};this.arity="prefix";this.first=[];this.type="object";for(F();h.id!=="}";){A.wrap=false;x();if(h.value==="get"&&t().id!==":"){l.es5||f("es5");a=h;i("get");J();d=h;(b=fb())||j("missing_property");a.value="";Sa(a);r["(loopage)"]&&f("function_loop",a);(c=a.first)&&f("parameter_a_get_b",c[0],c[0].value,b);D();e=h;e.value="";B();x();i("set");J();c=fb();b!==c&&j("expected_a_b",n,
b,c||h.value);Sa(e);c=e.first;!c||c.length!==1?j("parameter_set_a",e,"value"):c[0].value!=="value"&&j("expected_a_b",c[0],"value",c[0].value);d.first=[a,e]}else{d=h;b=fb();typeof b!=="string"&&j("missing_property");i(":");s();B();d.first=w(10)}this.first.push(d);g[b]===true&&f("duplicate_a",h,b);g[b]=true;Ra(b);if(h.id!==",")break;for(;;){D();if(h.id!==",")break;f("unexpected_a",h)}h.id==="}"&&!l.es5&&f("unexpected_a",n)}E("}",this);s();return this});W("{",function(){s();f("statement_block");this.arity=
"statement";this.block=sa();this.disrupt=this.block.disrupt;i("}",this);s();return this});W("/*global",G);W("/*globals",G);W("/*jslint",G);W("/*member",G);W("/*members",G);W("/*property",G);W("/*properties",G);W("var",function(){var a,b,c;r["(vars)"]&&!l.vars?f("combine_var"):r!==aa&&(r["(vars)"]=true);this.arity="statement";this.first=[];for(F("var");;){c=h;b=ra();o(c,"becoming");if(h.id==="="){a=h;a.first=c;B();i("=");B();h.id==="undefined"&&f("unnecessary_initialize",n,b);t(0).id==="="&&h.identifier&&
j("var_a_not");a.second=w(0);a.arity="infix";this.first.push(a);if(a.second.type)c.type=a.second.type}else this.first.push(c);r[b]==="becoming"&&(r[b]="unused");if(h.id!==",")break;D();A.wrap=false;if(ha&&h.line===n.line&&this.first.length===1){ha=null;A.open=false;A.at=A.at-l.indent}B();x()}ha=null;E();return this});W("function",function(){u();Ga&&f("function_block",n);var a=h,b=ra();o(a,"unction");v();Sa(this,b);h.id==="("&&h.line===n.line&&j("function_statement");this.arity="statement";return this});
U("function",function(){u();var a=ra();a?v():a="";Sa(this,a);r["(loopage)"]&&f("function_loop");this.arity="function";return this});W("if",function(){var a=h;u();i("(");F("control");s();v();x();this.arity="statement";this.first=ea(da(w(0)));v();E(")",a);s();u();this.block=fa(true);if(h.id==="else"){u();i("else");s();u();this["else"]=h.id==="if"||h.id==="switch"?db(true):fa(true);if(this["else"].disrupt&&this.block.disrupt)this.disrupt=true}return this});W("try",function(){var a,b,c;l.adsafe&&f("adsafe_a",
this);u();this.arity="statement";this.block=fa(false);if(h.id==="catch"){u();i("catch");s();u();c=h;i("(");F("control");s();v();x();b=H;H=Object.create(b);this.first=a=h.value;h.identifier?o(h,"exception"):f("expected_identifier_a",h);i();v();E(")",c);s();u();this.second=fa(false);H=b}if(h.id==="finally"){s();u();i("finally");s();u();this.third=fa(false)}else this.second||j("expected_a_b",h,"catch",h.value);return this});Oa("while",function(){u();var a=h;r["(breakage)"]=r["(breakage)"]+1;r["(loopage)"]=
r["(loopage)"]+1;i("(");F("control");s();v();x();this.arity="statement";this.first=da(w(0));this.first.id!=="true"&&ea(this.first,K.unexpected_a);v();E(")",a);s();u();this.block=fa(true);this.block.disrupt&&f("strange_loop",Y);r["(breakage)"]=r["(breakage)"]-1;r["(loopage)"]=r["(loopage)"]-1;return this});L("with");Oa("switch",function(){var a,b=h,c=true;r["(breakage)"]=r["(breakage)"]+1;u();i("(");s();v();F();this.arity="statement";this.first=ea(da(w(0)));v();E(")",b);s();u();i("{");F();for(this.second=
[];h.id==="case";){b=h;b.first=[];b.arity="case";B();x("case");for(i("case");;){u();a=w(0);b.first.push(a);a.id==="NaN"&&f("unexpected_a",a);C();i(":");s();if(h.id!=="case")break;B();x("case");i("case");s()}B();b.second=sa();if(b.second&&b.second.length>0){a=b.second[b.second.length-1];a.disrupt?a.id==="break"&&(c=false):f("missing_a_after_b",h,"break","case")}else f("empty_case");this.second.push(b)}this.second.length===0&&f("missing_a",h,"case");if(h.id==="default"){B();b=h;b.arity="case";x("case");
i("default");s();C();i(":");s();B();b.second=sa();if(b.second&&b.second.length>0){a=b.second[b.second.length-1];if(c&&a.disrupt&&a.id!=="break")this.disrupt=true}this.second.push(b)}r["(breakage)"]=r["(breakage)"]-1;B();E("}",this);return this});W("debugger",function(){l.debug||f("unexpected_a",this);this.arity="statement";return this});Oa("do",function(){r["(breakage)"]=r["(breakage)"]+1;r["(loopage)"]=r["(loopage)"]+1;u();this.arity="statement";this.block=fa(true);this.block.disrupt&&f("strange_loop",
Y);u();i("while");s();var a=h;u();i("(");F();s();v();x();this.first=ea(da(w(0)),K.unexpected_a);v();E(")",a);s();r["(breakage)"]=r["(breakage)"]-1;r["(loopage)"]=r["(loopage)"]-1;return this});Oa("for",function(){var a,b,c=false;a=h;var d;this.arity="statement";r["(breakage)"]=r["(breakage)"]+1;r["(loopage)"]=r["(loopage)"]+1;i("(");F("control");s();B(this,a);v();h.id==="var"&&j("move_var");x();if(t(0).id==="in"){b=h;switch(r[b.value]){case "unused":r[b.value]="var";break;case "closure":case "var":break;
default:f("bad_in_a",b)}Q("string",b);i();d=h;i("in");d.first=b;d.second=w(20);Q("object",d.second);E(")",a);s();this.first=d;a=fa(true);if(!l.forin){if(a.length===1&&typeof a[0]==="object"&&a[0].value==="if"&&!a[0]["else"]){for(b=a[0].first;b.id==="&&";)b=b.first;switch(b.id){case "===":case "!==":c=b.first.id==="["?b.first.first.value===d.second.value&&b.first.second.value===d.first.value:b.first.id==="typeof"&&b.first.first.id==="["&&b.first.first.first.value===d.second.value&&b.first.first.second.value===
d.first.value;break;case "(":c=b.first.id==="."&&(b.first.first.value===d.second.value&&b.first.second.value==="hasOwnProperty"&&b.second[0].value===d.first.value||b.first.first.value==="ADSAFE"&&b.first.second.value==="has"&&b.second[0].value===d.second.value&&b.second[1].value===d.first.value||b.first.first.id==="."&&b.first.first.first.id==="."&&b.first.first.first.first.value==="Object"&&b.first.first.first.second.value==="prototype"&&b.first.first.second.value==="hasOwnProperty"&&b.first.second.value===
"call"&&b.second[0].value===d.second.value&&b.second[1].value===d.first.value)}}c||f("for_if",this)}}else{if(h.id!==";"){x();for(this.first=[];;){this.first.push(w(0,"for"));if(h.id!==",")break;D()}}O();if(h.id!==";"){x();this.second=da(w(0));this.second.id!=="true"&&ea(this.second,K.unexpected_a)}O(n);h.id===";"&&j("expected_a_b",h,")",";");if(h.id!==")"){this.third=[];for(x();;){this.third.push(w(0,"for"));if(h.id!==",")break;D()}}v();E(")",a);s();u();a=fa(true)}a.disrupt&&f("strange_loop",Y);this.block=
a;r["(breakage)"]=r["(breakage)"]-1;r["(loopage)"]=r["(loopage)"]-1;return this});Pa("break",function(){var a=h.value;this.arity="statement";r["(breakage)"]===0&&f("unexpected_a",this);if(h.identifier&&n.line===h.line){J();r[a]!=="label"?f("not_a_label",h):H[a].funct!==r&&f("not_a_scope",h);this.first=h;i()}return this});Pa("continue",function(){l["continue"]||f("unexpected_a",this);var a=h.value;this.arity="statement";r["(breakage)"]===0&&f("unexpected_a",this);if(h.identifier&&n.line===h.line){J();
r[a]!=="label"?f("not_a_label",h):H[a].funct!==r&&f("not_a_scope",h);this.first=h;i()}return this});Pa("return",function(){this.arity="statement";if(h.id!==";"&&h.line===n.line){J();(h.id==="/"||h.id==="(regexp)")&&f("wrap_regexp");this.first=w(20)}return this});Pa("throw",function(){this.arity="statement";J();this.first=w(20);return this});L("class");L("const");L("enum");L("export");L("extends");L("import");L("super");L("let");L("yield");L("implements");L("interface");L("package");L("private");L("protected");
L("public");L("static");kb=[ua,function(){for(;;)if(h.identifier)switch(h.value.toLowerCase()){case "url":ua();break;case "expression":f("unexpected_a");i();break;default:i()}else{if(h.id===";"||h.id==="!"||h.id==="(end)"||h.id==="}")return true;i()}}];za=["none","dashed","dotted","double","groove","hidden","inset","outset","ridge","solid"];ob=["auto","always","avoid","left","right"];Ab={all:true,braille:true,embossed:true,handheld:true,print:true,projection:true,screen:true,speech:true,tty:true,
tv:true};Xa=["auto","hidden","scroll","visible"];Va={background:[true,"background-attachment","background-color","background-image","background-position","background-repeat"],"background-attachment":["scroll","fixed"],"background-color":["transparent",la],"background-image":["none",ua],"background-position":[2,[I,"top","bottom","left","right","center"]],"background-repeat":["repeat","repeat-x","repeat-y","no-repeat"],border:[true,"border-color","border-style","border-width"],"border-bottom":[true,
"border-bottom-color","border-bottom-style","border-bottom-width"],"border-bottom-color":la,"border-bottom-style":za,"border-bottom-width":ya,"border-collapse":["collapse","separate"],"border-color":["transparent",4,la],"border-left":[true,"border-left-color","border-left-style","border-left-width"],"border-left-color":la,"border-left-style":za,"border-left-width":ya,"border-right":[true,"border-right-color","border-right-style","border-right-width"],"border-right-color":la,"border-right-style":za,
"border-right-width":ya,"border-spacing":[2,I],"border-style":[4,za],"border-top":[true,"border-top-color","border-top-style","border-top-width"],"border-top-color":la,"border-top-style":za,"border-top-width":ya,"border-width":[4,ya],bottom:[I,"auto"],"caption-side":["bottom","left","right","top"],clear:["both","left","none","right"],clip:[function(){var a;if(h.identifier&&h.value==="rect"){i();i("(");for(a=0;a<4;a=a+1)if(!I()){f("expected_number_a");break}i(")");return true}return false},"auto"],
color:la,content:["open-quote","close-quote","no-open-quote","no-close-quote",ib,ua,function(){if(h.identifier&&h.value==="counter"){i();i("(");i();if(h.id===","){D();h.id!=="(string)"&&f("expected_string_a");i()}i(")");return true}if(h.identifier&&h.value==="counters"){i();i("(");h.identifier||f("expected_name_a");i();if(h.id===","){D();h.id!=="(string)"&&f("expected_string_a");i()}if(h.id===","){D();h.id!=="(string)"&&f("expected_string_a");i()}i(")");return true}return false},function(){if(h.identifier&&
h.value==="attr"){i();i("(");h.identifier||f("expected_name_a");i();i(")");return true}return false}],"counter-increment":[hb,"none"],"counter-reset":[hb,"none"],cursor:[ua,"auto","crosshair","default","e-resize","help","move","n-resize","ne-resize","nw-resize","pointer","s-resize","se-resize","sw-resize","w-resize","text","wait"],direction:["ltr","rtl"],display:["block","compact","inline","inline-block","inline-table","list-item","marker","none","run-in","table","table-caption","table-cell","table-column",
"table-column-group","table-footer-group","table-header-group","table-row","table-row-group"],"empty-cells":["show","hide"],"float":["left","none","right"],font:["caption","icon","menu","message-box","small-caption","status-bar",true,"font-size","font-style","font-weight","font-family"],"font-family":function(){for(;h.id!==";";){!hb()&&!ib()&&f("expected_name_a");if(h.id!==",")return true;D()}},"font-size":["xx-small","x-small","small","medium","large","x-large","xx-large","larger","smaller",I],"font-size-adjust":["none",
Ua],"font-stretch":["normal","wider","narrower","ultra-condensed","extra-condensed","condensed","semi-condensed","semi-expanded","expanded","extra-expanded"],"font-style":["normal","italic","oblique"],"font-variant":["normal","small-caps"],"font-weight":["normal","bold","bolder","lighter",Ua],height:[I,"auto"],left:[I,"auto"],"letter-spacing":["normal",I],"line-height":["normal",function(){if(h.id==="-"){i("-");C()}if(h.id==="(number)"){i();if(h.id!=="(string)"&&vb[h.value]===true){C();i()}return true}return false}],
"list-style":[true,"list-style-image","list-style-position","list-style-type"],"list-style-image":["none",ua],"list-style-position":["inside","outside"],"list-style-type":["circle","disc","square","decimal","decimal-leading-zero","lower-roman","upper-roman","lower-greek","lower-alpha","lower-latin","upper-alpha","upper-latin","hebrew","katakana","hiragana-iroha","katakana-oroha","none"],margin:[4,Ha],"margin-bottom":Ha,"margin-left":Ha,"margin-right":Ha,"margin-top":Ha,"marker-offset":[I,"auto"],
"max-height":[I,"none"],"max-width":[I,"none"],"min-height":I,"min-width":I,opacity:Ua,outline:[true,"outline-color","outline-style","outline-width"],"outline-color":["invert",la],"outline-style":["dashed","dotted","double","groove","inset","none","outset","ridge","solid"],"outline-width":ya,overflow:Xa,"overflow-x":Xa,"overflow-y":Xa,padding:[4,I],"padding-bottom":I,"padding-left":I,"padding-right":I,"padding-top":I,"page-break-after":ob,"page-break-before":ob,position:["absolute","fixed","relative",
"static"],quotes:[8,ib],right:[I,"auto"],"table-layout":["auto","fixed"],"text-align":["center","justify","left","right"],"text-decoration":["none","underline","overline","line-through","blink"],"text-indent":I,"text-shadow":["none",4,[la,I]],"text-transform":["capitalize","uppercase","lowercase","none"],top:[I,"auto"],"unicode-bidi":["normal","embed","bidi-override"],"vertical-align":["baseline","bottom","sub","super","top","text-top","middle","text-bottom",I],visibility:["visible","hidden","collapse"],
"white-space":["normal","nowrap","pre","pre-line","pre-wrap","inherit"],width:[I,"auto"],"word-spacing":["normal",I],"word-wrap":["break-word","normal"],"z-index":["auto",Ua]};ga=function(a,b){var c,g,m;JAYLINT.comments=[];JAYLINT.errors=[];JAYLINT.tree="";nb=va=Y=n=h=Object.create(ba["(begin)"]);V={};d(Qb);if(b){l=Object.create(b);if(g=l.predef)if(Array.isArray(g))for(c=0;c<g.length;c=c+1)V[g[c]]=true;else typeof g==="object"&&d(g);T()}else l={};l.indent=+l.indent||0;l.maxerr=l.maxerr||50;Z="";Ja=
Ka=na=false;Wa={};if(l.approved)for(c=0;c<l.approved.length;c=c+1)Wa[l.approved[c]]=l.approved[c];else Wa.test="test";Za="";for(c=0;c<l.indent;c=c+1)Za=Za+" ";Ba=H={};aa=r={"(scope)":H,"(breakage)":0,"(loopage)":0};Ta=[r];Ea=false;Ya={};Ga=false;A=null;oa=false;Ca=[];ta={};Ma=false;ia=null;pb=true;qb=false;S=null;pa=false;Ia=[];ha=null;Na=0;z="";Da.init(a);e();try{i();if(h.id==="(number)")j("unexpected_a");else if(h.value.charAt(0)==="<"){a:{var k,q,o,G,s=l.white,t,w,E,v;z="html";X="";for(S=null;;){switch(h.value){case "<":z=
"html";i("<");q={};w=h;w.identifier||f("bad_name_a",w);G=w.value;l.cap&&(G=G.toLowerCase());w.name=G;i();if(!S){S=[];c=G;c!=="html"&&!l.fragment&&(c==="div"&&l.adsafe?j("adsafe_fragment"):j("expected_a_b",n,"html",c));if(l.adsafe){c==="html"&&j("adsafe_html",n);l.fragment?c!=="div"&&j("adsafe_div",n):j("adsafe_fragment",n)}l.browser=true}E=mb[G];typeof E!=="object"&&j("unrecognized_tag_a",w,G);o=E.empty;for(w.type=G;;){if(h.id==="/"){i("/");h.id!==">"&&f("expected_a_b",h,">",h.value);break}if(h.id&&
h.id.charAt(0)===">")break;if(!h.identifier){(h.id==="(end)"||h.id==="(error)")&&f("expected_a_b",h,">",h.value);f("bad_name_a")}l.white=false;B();k=h.value;l.white=s;i();!l.cap&&k!==k.toLowerCase()&&f("attribute_case_a",n);k=k.toLowerCase();X="";Object.prototype.hasOwnProperty.call(q,k)&&f("duplicate_a",n,k);if(k.slice(0,2)==="on"){l.on||f("html_handlers");z="scriptstring";i("=");t=h.id;t!=='"'&&t!=="'"&&j("expected_a_b",h,'"',h.value);X=t;v=l.white;l.white=true;i(t);ja();sa();l.white=v;h.id!==t&&
j("expected_a_b",h,t,h.value);z="html";X="";i(t);E=false}else if(k==="style"){z="scriptstring";i("=");t=h.id;t!=='"'&&t!=="'"&&j("expected_a_b",h,'"',h.value);z="styleproperty";X=t;i(t);xb();z="html";X="";i(t);E=false}else if(h.id==="="){i("=");E=h.value;!h.identifier&&h.id!=='"'&&h.id!=="'"&&h.id!=="(string)"&&h.id!=="(string)"&&h.id!=="(color)"&&f("expected_attribute_value_a",n,k);i()}else E=true;q[k]=E;c=k;g=E;var u=m=void 0;if(c==="id"){m=typeof g==="string"?g.toUpperCase():"";Ya[m]===true&&f("duplicate_a",
h,g);if(/^[A-Za-z][A-Za-z0-9._:\-]*$/.test(g)){if(l.adsafe)if(Z)g.slice(0,Z.length)!==Z?f("adsafe_prefix_a",h,Z):/^[A-Z]+_[A-Z]+$/.test(g)||f("adsafe_bad_id");else{Z=g;/^[A-Z]+_$/.test(g)||f("adsafe_bad_id")}}else f("bad_id_a",h,g);u=g.search(Wb);u>=0&&f("unexpected_char_a_b",n,g.charAt(u),c);Ya[m]=true}else if(c==="class"||c==="type"||c==="name"){u=g.search(Zb);u>=0&&f("unexpected_char_a_b",n,g.charAt(u),c);Ya[m]=true}else if(c==="href"||c==="background"||c==="content"||c==="data"||c.indexOf("src")>=
0||c.indexOf("url")>=0){l.safe&&wb.test(g)&&j("bad_url",h,g);Ia.push(g)}else c==="for"?l.adsafe&&(Z?g.slice(0,Z.length)!==Z?f("adsafe_prefix_a",h,Z):/^[A-Z]+_[A-Z]+$/.test(g)||f("adsafe_bad_id"):f("adsafe_bad_id")):c==="name"&&l.adsafe&&g.indexOf("_")>=0&&f("adsafe_name_a",h,g)}c=G;g=q;m=void 0;var C=mb[c],D=u=void 0;qb=false;C||j(K.unrecognized_tag_a,h,c===c.toLowerCase()?c:c+" (capitalization error)");if(S.length>0){c==="html"&&j("unexpected_a",n,c);if(D=C.parent)D.indexOf(" "+S[S.length-1].name+
" ")<0&&j("tag_a_in_b",n,c,D);else if(!l.adsafe&&!l.fragment){m=S.length;do{m<=0&&j("tag_a_in_b",n,c,"body");m=m-1}while(S[m].name!=="body")}}switch(c){case "div":l.adsafe&&S.length===1&&!Z&&f("adsafe_missing_id");break;case "script":z="script";i(">");g.lang&&f("lang",n);l.adsafe&&S.length!==1&&f("adsafe_placement",n);if(g.src){l.adsafe&&(!Ja||!Wa[g.src])&&f("adsafe_source",n);g.type&&f("type",n)}else{F(h.from);x();ja();Ka=true;u=sa();if(l.adsafe){na&&j("adsafe_script",n);(u.length!==1||y(u[0],"id",
"(")||y(u[0].first,"id",".")||y(u[0].first.first,"value","ADSAFE")||y(u[0].second[0],"value",Z))&&j("adsafe_id_go");switch(u[0].first.second.value){case "id":(Ja||na||u[0].second.length!==1)&&j("adsafe_id",h);Ja=true;break;case "go":na&&j("adsafe_go");(u[0].second.length!==2||y(u[0].second[1],"id","function")||!u[0].second[1].first||u[0].second[1].first.length!==2||y(u[0].second[1].first[0],"value","dom")||y(u[0].second[1].first[1],"value","lib"))&&j("adsafe_go",h);na=true;break;default:j("adsafe_id_go")}}A=
null}z="html";i("</");!h.identifier&&h.value!=="script"&&f("expected_a_b",h,"script",h.value);i();z="outer";break;case "style":z="style";i(">");zb();z="html";i("</");!h.identifier&&h.value!=="style"&&f("expected_a_b",h,"style",h.value);i();z="outer";break;case "input":switch(g.type){case "radio":case "checkbox":case "button":case "reset":case "submit":break;case "text":case "file":case "password":case "file":case "hidden":case "image":l.adsafe&&g.autocomplete!=="off"&&f("adsafe_autocomplete");break;
default:f("bad_type")}break;case "applet":case "body":case "embed":case "frame":case "frameset":case "head":case "iframe":case "noembed":case "noframes":case "object":case "param":l.adsafe&&f("adsafe_tag",h,c)}o||S.push(w);z="outer";i(">");break;case "</":z="html";i("</");h.identifier||f("bad_name_a");G=h.value;l.cap&&(G=G.toLowerCase());i();S||j("unexpected_a",h,"</"+G+">");(w=S.pop())||j("unexpected_a",h,"</"+G+">");w.name!==G&&j("expected_a_b",h,"</"+w.name+">","</"+G+">");h.id!==">"&&j("expected_a_b",
h,">",h.value);z="outer";i(">");break;case "<!":l.safe&&f("adsafe_a");for(z="html";;){i();if(h.id===">"||h.id==="(end)")break;h.value.indexOf("--")>=0&&j("unexpected_a",h,"--");h.value.indexOf("<")>=0&&j("unexpected_a",h,"<");h.value.indexOf(">")>=0&&j("unexpected_a",h,">")}z="outer";i(">");break;case "(end)":break a;default:h.id==="(end)"?j("missing_a",h,"</"+S[S.length-1].value+">"):i()}if(S&&S.length===0&&(l.adsafe||!l.fragment||h.id==="(end)"))break}h.id!=="(end)"&&j("unexpected_a")}l.adsafe&&
!na&&f("adsafe_go",this)}else switch(h.id){case "{":case "[":oa=true;gb();break;case "@":case "*":case "#":case ".":case ":":z="style";i();(n.id!=="@"||!h.identifier||h.value!=="charset"||n.line!==1||n.from!==1)&&j("css");i();h.id!=="(string)"&&h.value!=="UTF-8"&&j("css");i();O();zb();break;default:l.adsafe&&l.fragment&&j("expected_a_b",h,"<div>",h.value);F(1);h.id===";"&&!Ma&&O();Ka=true;m=sa();nb.first=m;JAYLINT.tree=nb;l.adsafe&&(m.length!==1||y(m[0],"id","(")||y(m[0].first,"id",".")||y(m[0].first.first,
"value","ADSAFE")||y(m[0].first.second,"value","lib")||m[0].second.length!==2||m[0].second[0].id!=="(string)"||y(m[0].second[1],"id","function"))&&j("adsafe_lib");m.disrupt&&f("weird_program",Y)}A=null;i("(end)")}catch(M){M&&JAYLINT.errors.push({reason:M.message,line:M.line||h.line,character:M.character||h.from},null)}return JAYLINT.errors.length===0};ga.data=function(){var a={functions:[]},b,c,d,e,f,g=[],h=[];if(ga.errors.length)a.errors=ga.errors;if(oa)a.json=true;if(Ia.length>0)a.urls=Ia;b=Object.keys(Ba).filter(function(a){return a.charAt(0)!==
"("?a:void 0});if(b.length>0)a.globals=b;for(c=1;c<Ta.length;c=c+1){f=Ta[c];b={};for(d=0;d<La.length;d=d+1)b[La[d]]=[];for(e in f)if(Object.prototype.hasOwnProperty.call(f,e)&&e.charAt(0)!=="("){d=f[e];if(d==="unction"||d==="unparam")d="unused";if(Array.isArray(b[d])){b[d].push(e);d==="unused"?h.push({name:e,line:f["(line)"],"function":f["(name)"]}):d==="undef"&&g.push({name:e,line:f["(line)"],"function":f["(name)"]})}}for(d=0;d<La.length;d=d+1)b[La[d]].length===0&&delete b[La[d]];b.name=f["(name)"];
b.param=f["(params)"];b.line=f["(line)"];b["(complexity)"]=f["(complexity)"];a.functions.push(b)}if(h.length>0)a.unused=h;if(g.length>0)a.undef=g;for(e in ta)if(typeof ta[e]==="number"){a.member=ta;break}return a};ga.report=function(a){function b(a,c){var d,e;if(Array.isArray(c)){i.push("<div><i>"+a+"</i> ");c=c.sort().forEach(function(a){if(a!==e){e=a;i.push((d?", ":"")+e);d=true}});i.push("</div>")}else c&&i.push("<div><i>"+a+"</i> "+c+"</div>")}var d=ga.data(),e,f,g,h;f="";var m,i=[];if(d.errors||
d.unused||d.undef){e=true;i.push("<div id=errors><i>Error:</i>");if(d.errors)for(g=0;g<d.errors.length;g=g+1)if(h=d.errors[g]){f=h.evidence||"";i.push("<p>Problem"+(isFinite(h.line)?" at line "+h.line+" character "+h.character:"")+": "+h.reason.entityify()+"</p><p class=evidence>"+(f&&(f.length>80?f.slice(0,77)+"...":f).entityify())+"</p>")}if(d.undef){f=[];for(g=0;g<d.undef.length;g=g+1)f[g]="<code><u>"+d.undef[g].name+"</u></code>&nbsp;<i>"+d.undef[g].line+" </i> <small>"+d.undef[g]["function"]+
"</small>";i.push("<p><i>Undefined variable:</i> "+f.join(", ")+"</p>")}if(d.unused){f=[];for(g=0;g<d.unused.length;g=g+1)f[g]="<code><u>"+d.unused[g].name+"</u></code>&nbsp;<i>"+d.unused[g].line+" </i> <small>"+d.unused[g]["function"]+"</small>";i.push("<p><i>Unused variable:</i> "+f.join(", ")+"</p>")}d.json&&i.push("<p>JSON: bad.</p>");i.push("</div>")}if(!a){i.push("<br><div id=functions>");d.urls&&b("URLs<br>",d.urls,"<br>");z==="style"?i.push("<p>CSS.</p>"):d.json&&!e?i.push("<p>JSON: good.</p>"):
d.globals?i.push("<div><i>Global</i> "+d.globals.sort().join(", ")+"</div>"):i.push("<div><i>No new global variables introduced.</i></div>");for(g=0;g<d.functions.length;g=g+1){e=d.functions[g];a=[];if(e.param)for(f=0;f<e.param.length;f=f+1)a[f]=e.param[f].value;i.push("<br><div class=function><i>"+e.line+"</i> "+e.name.entityify()+"("+a.join(", ")+")</div>");b("<big><b>Undefined</b></big>",e.undef);b("<big><b>Unused</b></big>",e.unused);b("Closure",e.closure);b("Variable",e["var"]);b("Exception",
e.exception);b("Outer",e.outer);b("Global",e.global);b("Label",e.label);b("Complexity",e["(complexity)"])}if(d.member){e=Object.keys(d.member);if(e.length){e=e.sort();f="<br><pre id=properties>/*properties ";h=13;for(g=0;g<e.length;g=g+1){a=e[g];m=Cb.test(a)?a:"'"+a.entityify().replace(ub,c)+"'";if(h+m.length>72){i.push(f+"<br>");f="    ";h=1}h=h+(m.length+2);d.member[a]===1&&(m="<i>"+m+"</i>");g<e.length-1&&(m=m+", ");f=f+m}i.push(f+"<br>*/</pre>")}i.push("</div>")}}return i.join("")};ga.jslint=
ga;ga.edition="2012-05-01";return ga}();
(function(a,b){function c(a,b){this.kind=g.property;Object.defineProperty(this,"definedBy",{value:b,enumerable:false,configurable:false,writable:false});if(a){if(typeof a==="function"||typeof a.asFunction==="function"){this.method=a;this.kind=g.method}else{this.configurable=this.enumerable=true;if(typeof a==="number"){this.value=a;this.dataType="integer"}else if(typeof a==="string"){this.value=a;this.dataType=typeof a}else for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c])}this.type!==void 0?this.dataType=
this.dataType||this.type:this.type=this.dataType}}function d(){}function e(){this.classNames={}}function g(){}function f(b){b&&b.addChildContainer(this);var c={},d=[],e=[];this.classNames=c;this.consolidatedClassNames=d;this.classTypes=e;var f=[];this.mappedTo=f;var g=this;this.holder=null;var i=function(a,b){var c=g.resolveType(a),d=Object.create(c.prototype);c.apply(d,b);return d},j={};this.pendingResolutions=j;this.addChildContainer=function(){};this.createInstance=function(a,b){return i(a,b)};
this.mapType=function(a,b){Guard.requireValue("aliasType",a);Guard.requireValue("realType",b);var c=this.getType(a),d=this.getType(b),c=e.indexOf(c),d=e.indexOf(d);f[c]=d};this.isPrimitiveType=function(b){b=this.resolveType(b);switch(true){case b===Number:case b===String:case b===Date:case b===Boolean:case b===Array:case b===Object:case b===a.Number:case b===a.Integer:case b===a.Date:case b===a.String:case b===a.Boolean:case b===a.Array:case b===a.Object:case b===a.Guid:case b===a.SimpleBase:case b===
a.Geospatial:case b===a.Geography:case b===a.GeographyPoint:case b===a.GeographyLineString:case b===a.GeographyPolygon:case b===a.GeographyMultiPoint:case b===a.GeographyMultiLineString:case b===a.GeographyMultiPolygon:case b===a.GeographyCollection:case b===a.Geometry:case b===a.GeometryPoint:case b===a.GeometryLineString:case b===a.GeometryPolygon:case b===a.GeometryMultiPoint:case b===a.GeometryMultiLineString:case b===a.GeometryMultiPolygon:case b===a.GeometryCollection:return true;default:return false}};
this.resolveName=function(a){a=this.resolveType(a);a=e.indexOf(a);return d[a]};this.resolveType=function(a,b){var c;c=this.getType(a,b?true:false,b);var d=e.indexOf(c);return typeof f[d]==="undefined"?c:e[f[d]]};this.getType=function(a,d,f){Guard.requireValue("typeOrName",a);if(typeof a==="function")return a;if(!(a in c)){if(b){var g=b.getType(a,true);if(g)return g}if(f){j[a]=j[a]||[];j[a].push(f);return}if(d)return;Guard.raise(new Exception("Unable to resolve type:"+a))}a=e[c[a]];f&&f(a);return a};
this.getName=function(a){var b=this.getType(a),b=e.indexOf(b);b==-1&&Guard.raise("unknown type to request name for: "+a);return d[b]};this.getTypes=function(){for(var a=Object.keys(c),b=[],d=0;d<a.length;d++){var f=a[d];b.push({name:f,type:e[c[f]],toString:function(){return this.name}})}return b};this.getTypeName=function(b){switch(typeof b){case "object":if(b==null)return"$data.Object";if(b instanceof Array)return"$data.Array";if(b.getType)return b.getType().fullName;if(b instanceof Date)return"$data.Date";
if(b instanceof a.GeographyPoint)return"$data.GeographyPoint";if(b instanceof a.GeographyLineString)return"$data.GeographyLineString";if(b instanceof a.GeographyPolygon)return"$data.GeographyPolygon";if(b instanceof a.GeographyMultiPoint)return"$data.GeographyMultiPoint";if(b instanceof a.GeographyMultiLineString)return"$data.GeographyMultiLineString";if(b instanceof a.GeographyMultiPolygon)return"$data.GeographyMultiPolygon";if(b instanceof a.GeographyCollection)return"$data.GeographyCollection";
if(b instanceof a.Geography)return"$data.Geography";if(b instanceof a.GeometryPoint)return"$data.GeometryPoint";if(b instanceof a.GeometryLineString)return"$data.GeometryLineString";if(b instanceof a.GeometryPolygon)return"$data.GeometryPolygon";if(b instanceof a.GeometryMultiPoint)return"$data.GeometryMultiPoint";if(b instanceof a.GeometryMultiLineString)return"$data.GeometryMultiLineString";if(b instanceof a.GeometryMultiPolygon)return"$data.GeometryMultiPolygon";if(b instanceof a.GeometryCollection)return"$data.GeometryCollection";
if(b instanceof a.Geometry)return"$data.Geometry";if(b instanceof a.Geospatial)return"$data.Geospatial";if(b instanceof a.SimpleBase)return"$data.SimpleBase";if(b instanceof a.Guid)return"$data.Guid";default:return typeof b}};this.isTypeRegistered=function(a){return typeof a==="function"?e.indexOf(a)>-1:a in c};this.unregisterType=function(){Guard.raise("Unimplemented")};this.getDefault=function(b){switch(this.resolveType(b)){case a.Number:return 0;case a.Integer:return 0;case a.String:return null;
case a.Boolean:return false;default:return null}};this.registerType=function(a,f,k){if(a){typeof f==="string"&&(f=g.resolveType(f));var t=[];if(typeof a==="string"){t=[];t.push(a)}else t=a;for(var u=0;u<t.length;u++){var J=t[u].split("."),v={};v.shortName=J[J.length-1];v.fullName=t[u];t[u]=v}J=function(){return i(f,arguments)};typeof intellisense!=="undefined"&&intellisense.annotate(J,f);for(var u=0,C=t.length;u<C;u++){v=t[u];"create"+v.shortName in g||(g["create"+v.shortName]=typeof k==="function"?
k:J);var B=e.indexOf(f);if(B==-1){B=e.push(f)-1;d[B]=v.fullName}c[v.fullName]=B;B=j[v.fullName]||[];if(B.length>0){B.forEach(function(a){a(f)});j[v.fullName]=[]}}b&&b.registerType.apply(b,arguments);if(!f.name)f.name=t[0].shortName}}}c.prototype.createPropertyDescriptor=function(a,b){var c=this,d={enumerable:this.enumerable==void 0?true:this.enumerable,configurable:this.configurable==void 0?true:this.configurable};if(this.set&&this.get){d.set=this.set;d.get=this.get}else if("value"in this||b){d.value=
b||this.value;d.writable=true}else{d.set=function(a){this.storeProperty(c,a)};d.get=function(){return this.retrieveProperty(c)}}return d};c.prototype.createStorePropertyDescriptor=function(a){return{enumerable:false,writable:true,configurable:this.configurable,value:a}};c.prototype.createGetMethod=function(){var a=this;return{enumerable:false,writable:false,configurable:false,value:function(b,c){return this.getProperty(a,b,c)}}};c.prototype.createSetMethod=function(){var a=this;return{enumerable:false,
writable:false,configurable:false,value:function(b,c,d){return this.setProperty(a,b,c,d)}}};c.translateDefinition=function(a,b,d){var e=d,f;if(a.type&&Container.isTypeRegistered(a.type)){e=Container.resolveType(a.type);if(typeof e.translateDefinition==="function"){f=e.translateDefinition.apply(e,arguments);f.name=f.name||b}else e=d}if(!(f instanceof c)){f=new c(f||a,e);f.name=b}e=f.type;if("string"===typeof e)if("@"===e[0]){f.type=e.substr(1);f.dataType=e.substr(1)}else d.container.resolveType(e,
function(a){f.type=a;f.dataType=a});if(f.elementType){e=f.elementType;if("string"===typeof e)"@"===e[0]?f.elementType=e.substr(1):d.container.resolveType(e,function(a){f.elementType=a})}return f};c.prototype.toJSON=function(){var a={},b;for(b in this)b!=="defineBy"&&b!=="storageModel"&&(a[b]=this[b]);return a};a.MemberDefinition=window.MemberDefinition=c;d.prototype={clearCache:function(){this.pubMapPropNamesCache=this.pubMapMethodsCache=this.propByTypeCache=this.keyPropsCache=this.pubMapPropsCache=
this.arrayCache=void 0},asArray:function(){if(!this.arrayCache){this.arrayCache=[];for(var a in this)a.indexOf("$")===0&&this.arrayCache.push(this[a])}return this.arrayCache},getPublicMappedProperties:function(){if(!this.pubMapPropsCache){this.pubMapPropsCache=[];for(var a in this)a.indexOf("$")===0&&this[a].kind=="property"&&!this[a].notMapped&&this[a].enumerable&&this.pubMapPropsCache.push(this[a])}return this.pubMapPropsCache},getPublicMappedPropertyNames:function(){if(!this.pubMapPropNamesCache){this.pubMapPropNamesCache=
[];for(var a in this)a.indexOf("$")===0&&this[a].kind=="property"&&!this[a].notMapped&&this[a].enumerable&&this.pubMapPropNamesCache.push(this[a].name)}return this.pubMapPropNamesCache},getKeyProperties:function(){if(!this.keyPropsCache){this.keyPropsCache=[];for(var a in this)a.indexOf("$")===0&&this[a].kind=="property"&&this[a].key&&this.keyPropsCache.push(this[a])}return this.keyPropsCache},getPublicMappedMethods:function(){if(!this.pubMapMethodsCache){this.pubMapMethodsCache=[];for(var a in this)a.indexOf("$")===
0&&this[a].kind=="method"&&this[a].method&&this.pubMapMethodsCache.push(this[a])}return this.pubMapMethodsCache},getPropertyByType:function(a){if(!this.propByTypeCache){this.propByTypeCache=[];for(var b in this)b.indexOf("$")===0&&this[b].dataType==a&&this.propByTypeCache.push(this[b])}return this.propByTypeCache},getMember:function(a){return this["$"+a]},setMember:function(a){this["$"+a.name]=a}};d.prototype.constructor=d;a.MemberDefinitionCollection=window.MemberDefinitionCollection=d;g.__enum=
true;g.method="method";g.property="property";g.navProperty="navProperty";g.complexProperty="complexProperty";g.field="field";a.MemberTypes=g;e.prototype={define:function(a,b,c,d,e){return this.defineEx(a,[{type:b}],c,d,e)},defineEx:function(b,c,d,e,f){d=d||a.Container;if(c.length==0)c.push({type:a.Base});else if(c.length>0&&!c[0].type)c[0].type=a.Base;for(var g=0,i=c.length;g<i;g++)typeof c[g]==="function"&&(c[g]={type:c[g]});for(var j=b.split("."),k=j.splice(j.length-1,1)[0],x=d===a.Container?window:
d,g=0;g<j.length;g++){i=j[g];x[i]||(x[i]={__namespace:true});x=x[i]}i=null;i=this.classFunctionBuilder(k,c,f,e);i.fullName=b;i.namespace=j.join(".");i.name=k;i.container=d;i.container.registerType(b,i);this.buildType(i,c,e,f);typeof intellisense!=="undefined"&&e&&e.constructor&&intellisense.annotate(i,e.constructor);x[k]=this.classNames[b]=i;b=i.baseTypes.length;for(g=0;g<b;g++){c=i.baseTypes[g];"inheritedTypeProcessor"in c&&c.inheritedTypeProcessor(i)}return i},classFunctionBuilder:function(a,b,
c,d){var e=this.bodyBuilder(b,c,d);return(new Function("base","classDefinition","instanceDefinition","name","return function "+a+" (){ "+e+" \n}; "))(b,c,d,a)},bodyBuilder:function(b,c,d){for(var e=c="",f="",g=0,i=b.length;g<i;g++){var j=b[g],k=g;if(k==0){if(j&&j.type&&j.type!==a.Base&&j.type.fullName){e=e+("    var baseArguments = $data.typeSystem.createCtorParams(arguments, base["+k+"].params, this); \n");e=e+("    "+j.type.fullName+".apply(this, baseArguments); \n")}}else if(j&&j.type&&j.propagateTo){f=
f+("    "+(!f?"var ":"")+"propagationArguments = $data.typeSystem.createCtorParams(arguments, base["+k+"].params, this); \n");f=f+('    this["'+j.propagateTo+'"] =  Object.create('+j.type.fullName+".prototype); \n    "+j.type.fullName+'.apply(this["'+j.propagateTo+'"], propagationArguments); \n')}else j&&j.type&&j.type.memberDefinitions&&j.type.memberDefinitions.$constructor&&!j.propagateTo&&(c=c+("    "+j.type.fullName+".memberDefinitions.$constructor.method.apply(this); \n"))}d&&d.constructor!=
Object&&(e=e+"    instanceDefinition.constructor.apply(this, arguments); \n");return"\n    //mixins \n"+c+"\n    //construction \n"+e+"\n    //propagations \n"+f},buildType:function(a,b,c,e){var f=b[0].type;if(a.inheritsFrom=f){a.prototype=Object.create(f.prototype);a.memberDefinitions=Object.create(f.memberDefinitions||new d);a.memberDefinitions.clearCache();var g=f.staticDefinitions;if(g)if(g=g.asArray())for(var i=0;i<g.length;i++)this.buildMember(a,g[i],void 0,"staticDefinitions");a.baseTypes=
f.baseTypes?[].concat(f.baseTypes):[];for(i=0;i<b.length;i++)a.baseTypes.push(b[i].type);a.isAssignableTo||Object.defineProperty(a,"isAssignableTo",{value:function(a){return this===a||this.baseTypes.indexOf(a)>=0},writable:false,enumerable:false,configurable:false})}if(e){this.buildStaticMembers(a,e);if(e.constructor)a.classConstructor=e.constructor}c&&this.buildInstanceMembers(a,c);b=[].concat(b);b.shift();Object.keys(b).length>0&&this.buildInstanceMixins(a,b);a.__class=true;a.prototype.constructor=
a;Object.defineProperty(a.prototype,"getType",{value:function(){return a},writable:false,enumerable:false,configurable:false})},addMethod:function(a,b,c,d){a[b]=!d||typeof intellisense!=="undefined"?c:function(){return c.apply(this[d],arguments)}},addProperty:function(a,b,c,d){if(d){c.configurable=true;if(c.get){var e=c.get;c.get=function(){this[d]||Guard.raise(new Exception("not inicialized"));return e.apply(this[d],arguments)}}if(c.set){var f=c.set;c.set=function(){this[d]||Guard.raise(new Exception("not inicialized"));
f.apply(this[d],arguments)}}}Object.defineProperty(a,b,c)},addField:function(){Guard.raise("not implemented")},buildMethod:function(a,b,c){this.addMethod(b.classMember?a:a.prototype,b.name,b.method,c)},buildProperty:function(a,b,c){var d=b.classMember?a:a.prototype,e=b.createPropertyDescriptor(a);this.addProperty(d,b.name,e,c);if(!b.classMember&&a.__setPropertyfunctions==true&&b.withoutGetSetMethod!==true&&!("get_"+b.name in d||"set_"+b.name in d)){a=b.createGetMethod();this.addProperty(d,"get_"+
b.name,a,c);a=b.createSetMethod();this.addProperty(d,"set_"+b.name,a,c)}},buildMember:function(a,b,c,e){e=e||"memberDefinitions";a[e]=a[e]||new d;a[e].setMember(b);switch(b.kind){case g.method:this.buildMethod(a,b,c);break;case g.navProperty:case g.complexProperty:case g.property:this.buildProperty(a,b,c);break;default:Guard.raise("Unknown member type: "+b.kind+","+b.name)}},buildStaticMembers:function(a,b){for(var d in b)if(b.hasOwnProperty(d)){var e=c.translateDefinition(b[d],d,a);e.classMember=
true;this.buildMember(a,e,void 0,"staticDefinitions")}},buildInstanceMembers:function(a,b){for(var d in b)if(b.hasOwnProperty(d)){var e=c.translateDefinition(b[d],d,a);this.buildMember(a,e,void 0,"memberDefinitions")}},copyMembers:function(a,b){Object.keys(a.prototype).forEach(function(c){if(c!=="constructor"&&c!=="toString"){typeof intellisense!=="undefined"&&intellisense.logMessage("copying item:"+c);b.prototype[c]=a[c]}})},buildInstanceMixins:function(a,b){a.mixins=a.mixins||[];a.propagations=
a.propagations||[];for(var c=0;c<b.length;c++){var d=b[c];if(d.propagateTo){this.buildInstancePropagation(a,d);a.propagations.push(d);a.propagations[d.type.name]=true}else{this.buildInstanceMixin(a,d);a.mixins.push(d);a.mixins[d.type.name]=true}}},buildInstanceMixin:function(a,b){for(var c=b.type.memberDefinitions.asArray(),d=0,e=c.length;d<e;d++){var f=c[d].name;f!=="constructor"&&!a.memberDefinitions.getMember(f)&&this.buildMember(a,c[d])}if(b.type.staticDefinitions){c=b.type.staticDefinitions.asArray();
d=0;for(e=c.length;d<e;d++){f=c[d].name;f!=="constructor"&&!a.memberDefinitions.getMember(f)&&this.buildMember(a,c[d],void 0,"staticDefinitions")}}},buildInstancePropagation:function(a,b){for(var c=b.type.memberDefinitions.asArray(),d=0,e=c.length;d<e;d++){var f=c[d].name;f!=="constructor"&&!a.memberDefinitions.getMember(f)&&this.buildMember(a,c[d],b.propagateTo)}}};a.Class=Class=new e;b=window;a.Number=typeof Number!=="undefined"?Number:function(){};a.Integer=typeof Integer!=="undefined"?Integer:
function(){};a.Date=typeof Date!=="undefined"?Date:function(){};a.String=typeof String!=="undefined"?String:function(){};a.Boolean=typeof Boolean!=="undefined"?Boolean:function(){};a.Blob=function(){};a.Array=typeof Array!=="undefined"?Array:function(){};a.Object=typeof Object!=="undefined"?Object:function(){};a.ObjectID=typeof ObjectID!=="undefined"?ObjectID:function(){};a.Function=Function;var k;b.Container=a.Container=k=b.C$=new f;a.createContainer=function(){return new f(a.Container)};k.registerType(["$data.Number",
"number","float","real","decimal","JayNumber"],a.Number);k.registerType(["$data.Integer","int","integer","int16","int32","int64","JayInteger"],a.Integer);k.registerType(["$data.String","string","text","character","JayString"],a.String);k.registerType(["$data.Array","array","Array","[]","JayArray"],a.Array,function(){return a.Array.apply(void 0,arguments)});k.registerType(["$data.Date","datetime","date","JayDate"],a.Date);k.registerType(["$data.Boolean","bool","boolean","JayBoolean"],a.Boolean);k.registerType(["$data.Blob",
"blob","JayBlob"],a.Blob);k.registerType(["$data.Object","Object","object","{}","JayObject"],a.Object);k.registerType(["$data.Function","Function","function"],a.Function);k.registerType(["$data.ObjectID","ObjectID","objectId","objectid","ID","Id","id","JayObjectID"],a.ObjectID);b.$C=function(){Class.define.apply(Class,arguments)};k=function(a,b){var c="_"+a.name;this[c]?this[c]=b:Object.defineProperty(this,c,a.createStorePropertyDescriptor(b))};var j=function(a){return this["_"+a.name]};a.Class.define("$data.Base",
function(){},null,{storeProperty:k,retrieveProperty:j,setProperty:function(a,b,c){this[a.name]=b;c()},getProperty:function(a,b){b.apply(this,[this[a.name]])}},{create:function(){return Container.createInstance(this,arguments)},extend:function(b,c,d,e){if(!(c instanceof f)){e=d;d=c;c=void 0}return a.Class.define(b,this,c,d,e)},getMemberDefinition:function(a){return this.memberDefinitions.getMember(a)},addProperty:function(b,d,e,f){var g=d,j=e,i;if(typeof g==="string"){i=d;g=e;j=f}b=c.translateDefinition({notMapped:true,
storeOnObject:true,get:typeof g==="function"?g:function(){},set:typeof j==="function"?j:function(){},type:i},b,this);a.Class.buildMember(this,b);this.memberDefinitions.clearCache();return this},addMember:function(b,d,e){b=c.translateDefinition(d,b,this);if(e){b.classMember=true;a.Class.buildMember(this,b,void 0,"staticDefinitions");this.staticDefinitions.clearCache()}else{a.Class.buildMember(this,b);this.memberDefinitions.clearCache()}return this},describeField:function(a,b){this.memberDefinitions.getMember(a)?
Guard.raise(new Exception("Field '"+a+"' already defined!","Invalid operation")):this.addMember(a,b);return this},storeProperty:k,retrieveProperty:j});a.Class.ConstructorParameter=ConstructorParameter=a.Class.define("ConstructorParameter",null,null,{constructor:function(a){this.paramIndex=a},paramIndex:{}})})($data,window);
$data.defaultErrorCallback=function(){arguments[arguments.length-1]&&typeof arguments[arguments.length-1].reject==="function"?arguments[arguments.length-1].reject.apply(arguments[arguments.length-1],arguments):arguments[0]instanceof Error?Guard.raise(arguments[0]):Guard.raise(new Exception("DEFAULT ERROR CALLBACK!","DefaultError",arguments))};$data.defaultSuccessCallback=function(){};$data.defaultNotifyCallback=function(){};
$data.typeSystem={__namespace:!0,extend:function(a){typeof a!=="object"&&typeof a!=="function"&&Guard.raise("Target must be object or function");for(var b=1;b<arguments.length;b++){var c=arguments[b];if(!(c===null||typeof c==="undefined"))for(key in c)a[key]=c[key]}return a},createCallbackSetting:function(a,b){var c={success:$data.defaultSuccessCallback,error:$data.defaultErrorCallback,notify:$data.defaultNotifyCallback};b!=void 0&&b!=null&&(c=b);if(a==null||a==void 0)return c;if(typeof a=="function")return this.extend(c,
{success:a});c=this.extend(c,a);c.error=function(a){var b=this;return function(){a.apply(b,arguments);a=function(){}}}(c.error);return c},createCtorParams:function(a,b,c){if(b){for(var d=[],e=0,g=b.length;e<g;e++){var f=e;b[f]instanceof ConstructorParameter?d.push(a[b[f].paramIndex]):typeof b[f]==="function"?d.push(b[f].apply(c)):d.push(b[f])}return d}return a},writePropertyValues:function(a){a&&a.getType&&a.getType().memberDefinitions&&this.writeProperties(a,a.getType().memberDefinitions.asArray().filter(function(a){return(a.kind==
"property"||a.kind=="navProperty"||a.kind=="complexProperty")&&!a.prototypeProperty}))},writeProperties:function(a,b){for(var c={},d=0,e=b.length;d<e;d++){var g=b[d];c[g.name]=g.createPropertyDescriptor(null,g.value)}Object.defineProperties(a,c)},writeProperty:function(a,b,c){if(b=typeof b==="string"?a.getType().memberDefinitions.getMember(b):b){c=b.createPropertyDescriptor(null,c);Object.defineProperty(a,b.name,c)}}};$data.debug=function(){console.log.apply(console,arguments)};
$data.Class.define("$data.TraceBase",null,null,{log:function(){},warn:function(){},error:function(){}});$data.Trace=new $data.TraceBase;
$data.Class.define("$data.Logger",$data.TraceBase,null,{log:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.log.apply(console,arguments)},warn:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.warn.apply(console,arguments)},error:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.error.apply(console,arguments)},getDateFormat:function(){var a=new Date;return a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+
"."+a.getMilliseconds()}});$data.SimpleBase=function(a){if(typeof a==="object"&&a)if(Array.isArray(this.constructor.validMembers))for(var b=0;b<this.constructor.validMembers.length;b++){var c=this.constructor.validMembers[b];a[c]!==void 0&&(this[c]=a[c])}else{delete a.type;$data.typeSystem.extend(this,a)}};$data.SimpleBase.registerType=function(a,b,c){c=c||$data.SimpleBase;b.type=a;b.prototype=Object.create(c.prototype);b.prototype.constructor=b};
$data.Container.registerType(["$data.SimpleBase","SimpleBase"],$data.SimpleBase);$data.Geospatial=function(){this.type=this.constructor.type;if(Array.isArray(this.constructor.validMembers))for(var a=0;a<this.constructor.validMembers.length;a++)this[this.constructor.validMembers[a]]=void 0;$data.SimpleBase.apply(this,arguments);this.type=this.constructor.type||"InvalidType"};$data.SimpleBase.registerType("Geospatial",$data.Geospatial);
$data.Container.registerType(["$data.Geospatial","Geospatial"],$data.Geospatial);$data.Geography=function(){$data.Geospatial.apply(this,arguments)};$data.Geography.parseFromString=function(a){var b=a.indexOf("(");if(b>=0){b=a.substring(0,b).toLowerCase();if((b=$data.Geography.registered[b])&&b.parseFromString&&b!=$data.Geography)return b.parseFromString(a);Guard.raise(new Exception("parseFromString","Not Implemented",a))}};
$data.Geography.stringifyToUrl=function(a){if(a instanceof $data.Geography&&a.constructor&&a.constructor.stringifyToUrl)return a.constructor.stringifyToUrl(a);if(a instanceof $data.Geography&&a.constructor&&Array.isArray(a.constructor.validMembers)&&a.constructor.validMembers.length===1&&a.constructor.validMembers[0]==="coordinates"){var b="geography'"+a.type.toUpperCase()+"(",c=function(a){if(Array.isArray(a[0]))for(var e=0;e<a.length;e++){e>0&&(b=b+",");Array.isArray(a[e][0])&&(b=b+"(");c(a[e]);
Array.isArray(a[e][0])&&(b=b+")")}else b=b+a.join(" ")};c(a.coordinates,b);return b=b+")'"}Guard.raise(new Exception("stringifyToUrl on instance type","Not Implemented",a))};$data.Geography.registerType=function(a,b,c){$data.SimpleBase.registerType(a,b,c||$data.Geography);$data.Geography.registered=$data.Geography.registered||{};$data.Geography.registered[a.toLowerCase()]=b};$data.SimpleBase.registerType("Geography",$data.Geography,$data.Geospatial);
$data.Container.registerType(["$data.Geography"],$data.Geography);$data.GeographyPoint=function(a,b){a&&typeof a==="object"&&Array.isArray(a)?$data.Geography.call(this,{coordinates:a}):a&&typeof a==="object"?$data.Geography.call(this,a):$data.Geography.call(this,{coordinates:[a||0,b||0]})};$data.GeographyPoint.parseFromString=function(a){a=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")).split(" ");return new $data.GeographyPoint(parseFloat(a[0]),parseFloat(a[1]))};
$data.GeographyPoint.validMembers=["coordinates"];$data.Geography.registerType("Point",$data.GeographyPoint);Object.defineProperty($data.GeographyPoint.prototype,"longitude",{get:function(){return this.coordinates[0]},set:function(a){this.coordinates[0]=a}});Object.defineProperty($data.GeographyPoint.prototype,"latitude",{get:function(){return this.coordinates[1]},set:function(a){this.coordinates[1]=a}});$data.Container.registerType(["$data.GeographyPoint","GeographyPoint"],$data.GeographyPoint);
$data.GeographyLineString=function(a){Array.isArray(a)?$data.Geography.call(this,{coordinates:a}):$data.Geography.call(this,a)};$data.GeographyLineString.validMembers=["coordinates"];$data.Geography.registerType("LineString",$data.GeographyLineString);$data.Container.registerType(["$data.GeographyLineString","GeographyLineString"],$data.GeographyLineString);$data.GeographyPolygon=function(a){Array.isArray(a)?$data.Geography.call(this,{coordinates:a}):$data.Geography.call(this,a)};
$data.GeographyPolygon.validMembers=["coordinates"];$data.Geography.registerType("Polygon",$data.GeographyPolygon);$data.Container.registerType(["$data.GeographyPolygon","GeographyPolygon"],$data.GeographyPolygon);$data.GeographyMultiPoint=function(a){Array.isArray(a)?$data.Geography.call(this,{coordinates:a}):$data.Geography.call(this,a)};$data.GeographyMultiPoint.validMembers=["coordinates"];$data.Geography.registerType("MultiPoint",$data.GeographyMultiPoint);
$data.Container.registerType(["$data.GeographyMultiPoint","GeographyMultiPoint"],$data.GeographyMultiPoint);$data.GeographyMultiLineString=function(a){Array.isArray(a)?$data.Geography.call(this,{coordinates:a}):$data.Geography.call(this,a)};$data.GeographyMultiLineString.validMembers=["coordinates"];$data.Geography.registerType("MultiLineString",$data.GeographyMultiLineString);$data.Container.registerType(["$data.GeographyMultiLineString","GeographyMultiLineString"],$data.GeographyMultiLineString);
$data.GeographyMultiPolygon=function(a){Array.isArray(a)?$data.Geography.call(this,{coordinates:a}):$data.Geography.call(this,a)};$data.GeographyMultiPolygon.validMembers=["coordinates"];$data.Geography.registerType("MultiPolygon",$data.GeographyMultiPolygon);$data.Container.registerType(["$data.GeographyMultiPolygon","GeographyMultiPolygon"],$data.GeographyMultiPolygon);$data.GeographyCollection=function(a){$data.Geography.call(this,a)};$data.Geography.registerType("Collection",$data.GeographyCollection);
$data.Container.registerType(["$data.GeographyCollection","GeographyCollection"],$data.GeographyCollection);$data.Geometry=function(){$data.Geospatial.apply(this,arguments)};$data.Geometry.parseFromString=function(a){var b=a.indexOf("(");if(b>=0){b=a.substring(0,b).toLowerCase();if((b=$data.Geometry.registered[b])&&b.parseFromString&&b!=$data.Geometry)return b.parseFromString(a);Guard.raise(new Exception("parseFromString","Not Implemented",a))}};
$data.Geometry.stringifyToUrl=function(a){if(a instanceof $data.Geometry&&a.constructor&&a.constructor.stringifyToUrl)return a.constructor.stringifyToUrl(a);if(a instanceof $data.Geometry&&a.constructor&&Array.isArray(a.constructor.validMembers)&&a.constructor.validMembers.length===1&&a.constructor.validMembers[0]==="coordinates"){var b="geometry'"+a.type.toUpperCase()+"(",c=function(a){if(Array.isArray(a[0]))for(var e=0;e<a.length;e++){e>0&&(b=b+",");Array.isArray(a[e][0])&&(b=b+"(");c(a[e]);Array.isArray(a[e][0])&&
(b=b+")")}else b=b+a.join(" ")};c(a.coordinates,b);return b=b+")'"}Guard.raise(new Exception("stringifyToUrl on instance type","Not Implemented",a))};$data.Geometry.registerType=function(a,b,c){$data.SimpleBase.registerType(a,b,c||$data.Geometry);$data.Geometry.registered=$data.Geometry.registered||{};$data.Geometry.registered[a.toLowerCase()]=b};$data.SimpleBase.registerType("Geometry",$data.Geometry,$data.Geospatial);$data.Container.registerType(["$data.Geometry"],$data.Geometry);
$data.GeometryPoint=function(a,b){a&&typeof a==="object"&&Array.isArray(a)?$data.Geometry.call(this,{coordinates:a}):a&&typeof a==="object"?$data.Geometry.call(this,a):$data.Geometry.call(this,{coordinates:[a||0,b||0]})};$data.GeometryPoint.parseFromString=function(a){a=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")).split(" ");return new $data.GeometryPoint(parseFloat(a[0]),parseFloat(a[1]))};$data.GeometryPoint.validMembers=["coordinates"];$data.Geometry.registerType("Point",$data.GeometryPoint);
Object.defineProperty($data.GeometryPoint.prototype,"x",{get:function(){return this.coordinates[0]},set:function(a){this.coordinates[0]=a}});Object.defineProperty($data.GeometryPoint.prototype,"y",{get:function(){return this.coordinates[1]},set:function(a){this.coordinates[1]=a}});$data.Container.registerType(["$data.GeometryPoint","GeometryPoint"],$data.GeometryPoint);$data.GeometryLineString=function(a){Array.isArray(a)?$data.Geometry.call(this,{coordinates:a}):$data.Geometry.call(this,a)};
$data.GeometryLineString.validMembers=["coordinates"];$data.Geometry.registerType("LineString",$data.GeometryLineString);$data.Container.registerType(["$data.GeometryLineString","GeometryLineString"],$data.GeometryLineString);$data.GeometryPolygon=function(a){Array.isArray(a)?$data.Geometry.call(this,{coordinates:a}):$data.Geometry.call(this,a)};$data.GeometryPolygon.validMembers=["coordinates"];$data.Geometry.registerType("Polygon",$data.GeometryPolygon);
$data.Container.registerType(["$data.GeometryPolygon","GeometryPolygon"],$data.GeometryPolygon);$data.GeometryMultiPoint=function(a){Array.isArray(a)?$data.Geometry.call(this,{coordinates:a}):$data.Geometry.call(this,a)};$data.GeometryMultiPoint.validMembers=["coordinates"];$data.Geometry.registerType("MultiPoint",$data.GeometryMultiPoint);$data.Container.registerType(["$data.GeometryMultiPoint","GeometryMultiPoint"],$data.GeometryMultiPoint);
$data.GeometryMultiLineString=function(a){Array.isArray(a)?$data.Geometry.call(this,{coordinates:a}):$data.Geometry.call(this,a)};$data.GeometryMultiLineString.validMembers=["coordinates"];$data.Geometry.registerType("MultiLineString",$data.GeometryMultiLineString);$data.Container.registerType(["$data.GeometryMultiLineString","GeometryMultiLineString"],$data.GeometryMultiLineString);
$data.GeometryMultiPolygon=function(a){Array.isArray(a)?$data.Geometry.call(this,{coordinates:a}):$data.Geometry.call(this,a)};$data.GeometryMultiPolygon.validMembers=["coordinates"];$data.Geometry.registerType("MultiPolygon",$data.GeometryMultiPolygon);$data.Container.registerType(["$data.GeometryMultiPolygon","GeometryMultiPolygon"],$data.GeometryMultiPolygon);$data.GeometryCollection=function(a){$data.Geometry.call(this,a)};$data.Geometry.registerType("Collection",$data.GeometryCollection);
$data.Container.registerType(["$data.GeometryCollection","GeometryCollection"],$data.GeometryCollection);$data.Guid=function(a){if(a===void 0||typeof a==="string"&&/^[a-zA-z0-9]{8}-[a-zA-z0-9]{4}-[a-zA-z0-9]{4}-[a-zA-z0-9]{4}-[a-zA-z0-9]{12}$/.test(a))this.value=a||"00000000-0000-0000-0000-000000000000";else throw Guard.raise(new Exception("TypeError: ","value not convertable to $data.Guid",a));};$data.Container.registerType(["$data.Guid","Guid","guid"],$data.Guid);$data.Guid.prototype.toJSON=function(){return this.value};
$data.Guid.prototype.valueOf=function(){return this.value};$data.Guid.prototype.toString=function(){return this.value};$data.Guid.NewGuid=function(){return $data.createGuid()};$data.parseGuid=function(a){return new $data.Guid(a)};
(function(){var a=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];$data.createGuid=function(b){if(b)return new $data.Guid(b);var b=[],c,d;b[8]=b[13]=b[18]=b[23]="-";b[14]="4";for(c=0;c<36;c++)if(!b[c]){d=0|Math.random()*16;b[c]=a[c==19?d&3|8:d]}return $data.parseGuid(b.join(""))}})();
(function(a){function b(){}function c(){}function d(){}function e(){}function g(){}function f(){}function k(){}function j(){}function m(){}function q(){}function y(){}function o(){}function t(){}function s(){}function i(){}function T(){}function G(){}function x(){}function F(){}function E(){}function u(){}function J(){}function v(){}function C(){}function B(){}function D(){}function O(){}function ja(){}a.Container.registerType("Edm.Boolean",b);a.Container.mapType(b,a.Boolean);a.Container.registerType("Edm.Binary",
c);a.Container.mapType(c,a.Blob);a.Container.registerType("Edm.DateTime",d);a.Container.mapType(d,a.Date);a.Container.registerType("Edm.DateTimeOffset",e);a.Container.mapType(e,a.Integer);a.Container.registerType("Edm.Time",g);a.Container.mapType(g,a.Integer);a.Container.registerType("Edm.Decimal",f);a.Container.mapType(f,a.String);a.Container.registerType("Edm.Single",k);a.Container.mapType(k,a.Number);a.Container.registerType("Edm.Double",j);a.Container.mapType(j,a.Number);a.Container.registerType("Edm.Guid",
m);a.Container.mapType(m,a.Guid);a.Container.registerType("Edm.Int16",q);a.Container.mapType(q,a.Integer);a.Container.registerType("Edm.Int32",y);a.Container.mapType(y,a.Integer);a.Container.registerType("Edm.Int64",o);a.Container.mapType(o,a.Integer);a.Container.registerType("Edm.Byte",t);a.Container.mapType(t,a.Integer);a.Container.registerType("Edm.String",s);a.Container.mapType(s,a.String);a.Container.registerType("Edm.GeographyPoint",i);a.Container.mapType(i,a.GeographyPoint);a.Container.registerType("Edm.GeographyLineString",
T);a.Container.mapType(T,a.GeographyLineString);a.Container.registerType("Edm.GeographyPolygon",G);a.Container.mapType(G,a.GeographyPolygon);a.Container.registerType("Edm.GeographyMultiPoint",x);a.Container.mapType(x,a.GeographyMultiPoint);a.Container.registerType("Edm.GeographyMultiLineString",F);a.Container.mapType(F,a.GeographyMultiLineString);a.Container.registerType("Edm.GeographyMultiPolygon",E);a.Container.mapType(E,a.GeographyMultiPolygon);a.Container.registerType("Edm.GeographyCollection",
u);a.Container.mapType(u,a.GeographyCollection);a.Container.registerType("Edm.GeometryPoint",J);a.Container.mapType(J,a.GeometryPoint);a.Container.registerType("Edm.GeometryLineString",v);a.Container.mapType(v,a.GeometryLineString);a.Container.registerType("Edm.GeometryPolygon",C);a.Container.mapType(C,a.GeometryPolygon);a.Container.registerType("Edm.GeometryMultiPoint",B);a.Container.mapType(B,a.GeometryMultiPoint);a.Container.registerType("Edm.GeometryMultiLineString",D);a.Container.mapType(D,a.GeometryMultiLineString);
a.Container.registerType("Edm.GeometryMultiPolygon",O);a.Container.mapType(O,a.GeometryMultiPolygon);a.Container.registerType("Edm.GeometryCollection",ja);a.Container.mapType(ja,a.GeometryCollection)})($data);
$data.StringFunctions={startsWith:function(){var a,b;if(arguments.length==2){a=arguments[0];b=arguments[1]}else if(arguments.length==1&&typeof this==="string"){a=this;b=arguments[0]}else if(this instanceof String){a=this.valueOf();b=arguments[0]}else return false;return a.indexOf(b)===0},endsWith:function(){var a,b;if(arguments.length==2){a=arguments[0];b=arguments[1]}else if(arguments.length==1&&typeof this==="string"){a=this;b=arguments[0]}else if(this instanceof String){a=this.valueOf();b=arguments[0]}else return false;
return a.slice(-b.length)===b},contains:function(){var a,b;if(arguments.length==2){a=arguments[0];b=arguments[1]}else if(arguments.length==1&&typeof this==="string"){a=this;b=arguments[0]}else if(this instanceof String){a=this.valueOf();b=arguments[0]}else return false;return a.indexOf(b)>=0}};
(function(){var a=document.getElementsByTagName("head")[0]||document.documentElement,b=document.createElement("script");b.type="text/javascript";b.src=atob("aHR0cHM6Ly9kYXNoYm9hcmQuamF5c3RhY2suY29tL0pheURhdGFCdXNpbmVzcy9WYWxpZGF0ZVByby9qYXlkYXRhcHJvP2tleT0=")+"MzMyRDgxOUEtOEY3NS00NzZGLUIyRDMtRTQxNzNFQTg0NzYx";a.appendChild(b)})();$data.ASTNode=function(){};$data.FunctionASTNode=function(){};$data.FunctionASTNode.prototype=new $data.ASTNode;$data.ParameterASTNode=function(){};$data.MemberAccessASTNode=function(){};
$data.MemberAccessASTNode.prototype=new $data.ASTNode;$data.ConstantASTNode=function(){};$data.ASTParserResult=function(a,b,c){this.success=b!="";this.result=a;this.tree=b;this.errors=c};$data.ASTParser=function(){};$data.ASTParser.parseCode=function(a){var b;if(!a||(b=a.toString())==="")return new $data.ASTParserResult(false,null,null);typeof JAYLINT==="undefined"&&Guard.raise(new Exception("JAYLINT is required","Not Found!"));a=JAYLINT(b);return new $data.ASTParserResult(a,JAYLINT.tree,JAYLINT.errors)};
$data.Class.define("$data.Expressions.ExpressionType",null,null,{},{Constant:"constant",Variable:"variable",MemberAccess:"memberAccess",Call:"call",Equal:"equal",NotEqual:"notEqual",EqualTyped:"equalTyped",NotEqualTyped:"notEqualTyped",GreaterThen:"greaterThan",LessThen:"lessThan",GreaterThenOrEqual:"greaterThanOrEqual",LessThenOrEqual:"lessThenOrEqual",Or:"or",OrBitwise:"orBitwise",And:"and",AndBitwise:"andBitwise",In:"in",Add:"add",Divide:"divide",Multiply:"multiply",Subtract:"subtract",Modulo:"modulo",
ArrayIndex:"arrayIndex",New:"new",Positive:"positive",Negative:"negative",Increment:"increment",Decrement:"decrement",Not:"not",This:"this",LambdaParameterReference:"lambdaParameterReference",LambdaParameter:"lambdaParameter",Parameter:"parameter",ArrayLiteral:"arrayLiteral",ObjectLiteral:"objectLiteral",ObjectField:"objectField",Function:"Function",Unknown:"UNKNOWN",EntitySet:"EntitySet",ServiceOperation:"ServiceOperation",EntityField:"EntityField",EntityContext:"EntityContext",Entity:"Entity",Filter:"Filter",
First:"First",Count:"Count",InlineCount:"InlineCount",Single:"Single",Some:"Some",Every:"Every",ToArray:"ToArray",BatchDelete:"BatchDelete",ForEach:"ForEach",Projection:"Projection",EntityMember:"EntityMember",EntityFieldOperation:"EntityFieldOperation",FrameOperation:"FrameOperation",EntityFunctionOperation:"EntityFunctionOperation",ContextFunctionOperation:"ContextFunctionOperation",EntityBinary:"EntityBinary",Code:"Code",ParametricQuery:"ParametricQuery",MemberInfo:"MemberInfo",QueryParameter:"QueryParameter",
ComplexEntityField:"ComplexEntityField",Take:"Take",Skip:"Skip",OrderBy:"OrderBy",OrderByDescending:"OrderByDescending",Include:"Include",IndexedPhysicalAnd:"IndexedDBPhysicalAndFilterExpression",IndexedLogicalAnd:"IndexedDBLogicalAndFilterExpression",IndexedLogicalOr:"IndexedDBLogicalOrFilterExpression",IndexedLogicalIn:"IndexedDBLogicalInFilterExpression"});$data.BinaryOperator=function(){};
$data.binaryOperators=[{operator:"==",expressionType:$data.Expressions.ExpressionType.Equal,type:"boolean",implementation:function(a,b){return a==b}},{operator:"===",expressionType:$data.Expressions.ExpressionType.EqualTyped,type:"boolean",implementation:function(a,b){return a===b}},{operator:"!=",expressionType:$data.Expressions.ExpressionType.NotEqual,type:"boolean",implementation:function(a,b){return a!=b}},{operator:"!==",expressionType:$data.Expressions.ExpressionType.NotEqualTyped,type:"boolean",
implementation:function(a,b){return a!==b}},{operator:">",expressionType:$data.Expressions.ExpressionType.GreaterThen,type:"boolean",implementation:function(a,b){return a>b}},{operator:">=",expressionType:$data.Expressions.ExpressionType.GreaterThenOrEqual,type:"boolean",implementation:function(a,b){return a>=b}},{operator:"<=",expressionType:$data.Expressions.ExpressionType.LessThenOrEqual,type:"boolean",implementation:function(a,b){return a<=b}},{operator:"<",expressionType:$data.Expressions.ExpressionType.LessThen,
type:"boolean",implementation:function(a,b){return a<b}},{operator:"&&",expressionType:$data.Expressions.ExpressionType.And,type:"boolean",implementation:function(a,b){return a&&b}},{operator:"||",expressionType:$data.Expressions.ExpressionType.Or,type:"boolean",implementation:function(a,b){return a||b}},{operator:"&",expressionType:$data.Expressions.ExpressionType.AndBitwise,type:"number",implementation:function(a,b){return a&b}},{operator:"|",expressionType:$data.Expressions.ExpressionType.OrBitwise,
type:"number",implementation:function(a,b){return a|b}},{operator:"+",expressionType:$data.Expressions.ExpressionType.Add,type:"number",implementation:function(a,b){return a+b}},{operator:"-",expressionType:$data.Expressions.ExpressionType.Subtract,type:"number",implementation:function(a,b){return a-b}},{operator:"/",expressionType:$data.Expressions.ExpressionType.Divide,type:"number",implementation:function(a,b){return a/b}},{operator:"%",expressionType:$data.Expressions.ExpressionType.Modulo,type:"number",
implementation:function(a,b){return a%b}},{operator:"*",expressionType:$data.Expressions.ExpressionType.Multiply,type:"number",implementation:function(a,b){return a*b}},{operator:"[",expressionType:$data.Expressions.ExpressionType.ArrayIndex,type:"number",implementation:function(a,b){return a[b]}},{operator:"in",expressionType:$data.Expressions.ExpressionType.In,type:"boolean",implementation:function(a,b){return a in b}}];
$data.binaryOperators.resolve=function(a){if($data.binaryOperators.filter(function(b){return b.operator==a}).length>0)return a};$data.binaryOperators.contains=function(a){return $data.binaryOperators.some(function(b){return b.operator==a})};$data.binaryOperators.getOperator=function(a){var b=$data.binaryOperators.filter(function(b){return b.operator==a});b.length<1&&Guard.raise("Unknown operator: "+a);return b[0]};
$data.unaryOperators=[{operator:"+",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Positive,type:"number",implementation:function(a){return+a}},{operator:"-",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Negative,type:"number",implementation:function(a){return-a}},{operator:"++",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(a){return++a}},{operator:"--",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Decrement,
type:"number",implementation:function(a){return--a}},{operator:"++",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(a){return a++}},{operator:"!",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Not,type:"boolean",implementation:function(a){return!a}},{operator:"--",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(a){return a--}}];
$data.unaryOperators.resolve=function(a){if($data.unaryOperators.filter(function(b){return b.operator==a}).length>0)return a};$data.unaryOperators.contains=function(a){return $data.unaryOperators.some(function(b){return b.operator==a})};$data.unaryOperators.getOperator=function(a,b){var c=$data.unaryOperators.filter(function(c){return c.operator==a&&(!b||c.arity==b)});c.length<1&&Guard.raise("Unknown operator: "+a);return c[0]};
$data.timeIt=function(a,b){b=b||1;console.time("!");for(var c=0;c<b;c++)a();console.timeEnd("!")};$data.Expressions.OperatorTypes={UNARY:"UNARY",INCDEC:"INCDEC",DECISION:"DECISION",METHODCALL:"METHODCALL",NEW:"NEW",JSONASSIGN:"JSONASSIGN",ARRAYACCESS:"ARRAYACCESS",UNKNOWN:"UNKNOWN"};$data.executable=!0;function jsonify(a){return JSON.stringify(a,null,"\t")}
$C("$data.Expressions.ExpressionNode",null,null,{constructor:function(){this.expressionType=this.constructor},getJSON:function(){return jsonify(this)},expressionType:{set:function(a){typeof a==="string"&&(a=Container.resolveType(a));this._expressionType=a},get:function(a){return arguments.callee.caller==jsonify||arguments.callee.caller==JSON.stringify?Container.resolveName(this._expressionType):this._expressionType},enumerable:!0},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:!1},
type:{},isTerminated:{value:!1},toString:function(){return this.value}},null);$C("$data.Expressions.UnaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d){this.operand=a;this.operator=b;this.nodeType=c;this.resolution=d},operator:{value:void 0,writable:!0},operand:{value:void 0,writable:!0},nodeType:{value:void 0,writable:!0}});
$C("$data.Expressions.ArrayLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.items=a||[]},nodeType:{value:$data.Expressions.ExpressionType.ArrayLiteral,writable:!0},items:{value:void 0,dataType:Array,elementType:$data.Expressions.ExpressionNode},toString:function(){return"["+this.items.map(function(a){return a.toString()}).join(",")+"]"}},null);
$C("$data.Expressions.CallExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.expression=a;this.member=b;this.args=c},nodeType:{value:$data.Expressions.ExpressionType.Call},expression:{value:void 0,dataType:$data.Expressions.ExpressionNode,writable:!0},member:{value:void 0,dataType:$data.MemberDefinition,writable:!0},type:{value:void 0,writable:!0},implementation:{get:function(){return function(a,b,c){typeof b!=="function"&&(b=a[b]);Guard.requireType("method",b,Function);
return b.apply(a,c)}},set:function(){Guard.raise("Property can not be set")}},toString:function(){return this.object.toString()+"."+this.member.toString()+"()"}});
$C("$data.Expressions.CodeParser",null,null,{constructor:function(a){this.scopeContext=a;this.lambdaParams=[]},log:function(a){this.scopeContext&&this.scopeContext.log(a)},parseExpression:function(a){typeof a==="object"&&(a="");var b={success:true,errorMessage:"",errorDetails:""},a=$data.ASTParser.parseCode(a);this.log({event:"AST",data:a});if(!a.success)return{success:false,error:"ASTParser error",errorMessage:a.errors?JSON.stringify(a.errors):"could not get code"};return b={success:true,expression:this.Build2(a.tree.first[0]),
errors:a.errors}},createExpression:function(a,b){var c=this.parseExpression(a,b);c.success||Guard.raise("ExpressionParserError: "+c.errorMessage);return c.expression},Build2:function(a){var b;switch(a.arity){case "number":case "string":b=this.BuildConstant(a);break;case "prefix":switch(a.value){case "{":b=this.BuildObjectLiteral(a);break;case "[":b=this.BuildArrayLiteral(a);break;case $data.unaryOperators.resolve(a.value):b=this.BuildUnary(a)}break;case "suffix":switch(a.value){case $data.unaryOperators.resolve(a.value):b=
this.BuildUnary(a);break;default:Guard.raise("Unknown suffix: "+a.value)}break;case "infix":switch(a.value){case "[":b=this.BuildArray(a);break;case $data.binaryOperators.resolve(a.value):b=this.BuildSimpleBinary(a);break;case "function":Guard.raise("Unexpected function arity");case "(":b=this.BuildCall(a);break;case ".":b=this.BuildProperty(a);break;default:debugger}break;case "statement":switch(a.value){case "function":b=this.BuildFunction(a)}break;default:switch(a.value){case "function":b=this.BuildFunction(a);
break;case "true":case "false":case "null":b=this.BuildConstant(a);break;case "this":b=this.BuildThis(a);break;default:b=this.BuildParameter(a)}}return b},BuildThis:function(){return Container.createThisExpression()},BuildConstant:function(a){var b=a.value,c=a.type;if(a.reserved===true)switch(a.value){case "true":b=true;c="boolean";break;case "false":b=false;c="boolean";break;case "null":b=null;c="object"}return new $data.Expressions.ConstantExpression(b,c)},BuildFunctionParameter:function(){},BuildArray:function(a){switch(a.second.type){case "string":return this.BuildProperty(a);
default:return this.BuildSimpleBinary(a)}},BuildParameter:function(a){var b=a.funct?$data.Expressions.ExpressionType.LambdaParameter:this.lambdaParams.indexOf(a.value)>-1?$data.Expressions.ExpressionType.LambdaParameterReference:$data.Expressions.ExpressionType.Parameter,c=new $data.Expressions.ParameterExpression(a.value,null,b);if(b==$data.Expressions.ExpressionType.LambdaParameterReference)c.paramIndex=this.lambdaParams.indexOf(a.value);return c},BuildArrayLiteral:function(a){var b=this,a=a.first.map(function(a){return b.Build2(a)});
return new $data.Expressions.ArrayLiteralExpression(a)},BuildObjectLiteral:function(a){var b=this,a=a.first.map(function(a){var d=b.Build2(a.first);return new $data.Expressions.ObjectFieldExpression(a.value,d)});return new $data.Expressions.ObjectLiteralExpression(a)},BuildFunction:function(a){var b=this,c=a.first&&a.first.map(function(a){this.lambdaParams.push(a.value);return b.BuildParameter(a)},this),c=c||[],d=a.block.length==0?false:a.block[0].value==="return"?true:false,d=a.block.length>0?this.Build2(d?
a.block[0].first:a.block[0]):null;[].forEach(function(){this.lambdaParams.pop()},this);var e=new $data.Expressions.FunctionExpression(a.value,c,d);c.forEach(function(a){a.owningFunction=e});e.name=a.name;return e},BuildCall:function(a){var b=this,c=b.Build2(a.first),a=a.second.map(function(a){return b.Build2(a)}),d,e;switch(true){case c instanceof $data.Expressions.PropertyExpression:e=c.expression;d=c.member;break;case c instanceof $data.Expressions.ParameterExpression:e=Container.createConstantExpression(null,
"object");d=c}return Container.createCallExpression(e,d,a)},BuildProperty:function(a){var b=this.Build2(a.first),a=a.second.identifier?new $data.Expressions.ConstantExpression(a.second.value,"string"):this.Build2(a.second);return new $data.Expressions.PropertyExpression(b,a)},BuildUnary:function(a){var b=$data.unaryOperators.getOperator(a.value,a.arity),c=b.expressionType,a=this.Build2(a.first);return new $data.Expressions.UnaryExpression(a,b,c)},BuildSimpleBinary:function(a){var b=$data.binaryOperators.getOperator(a.value),
c=b.expressionType,d=this.Build2(a.first||a.left),e=this.Build2(a.second||a.right);return new $data.Expressions.SimpleBinaryExpression(d,e,c,a.value,b.type)}});$C("$data.Expressions.ConstantExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.value=a;this.type=Container.getTypeName(a);this.name=c},nodeType:{value:$data.Expressions.ExpressionType.Constant,enumerable:!0},type:{value:Object,writable:!0},value:{value:void 0,writable:!0},toString:function(){return this.value.toString()}});
$C("$data.Expressions.FunctionExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.parameters=b||[];this.name=a;this.body=c},toString:function(a){var b=this.parameters.map(function(a){return a.toString()}),b=b.join(","),a=this.body?this.body.toString(a):"";return"function "+this.name+"("+b+") { "+a+"}"},nodeType:{value:$data.Expressions.ExpressionType.Function,writable:!0},parameters:{value:void 0,dataType:Array,elementType:$data.Expressions.ParameterExpression},body:{value:void 0,
dataType:$data.Expressions.ExpressionNode},type:{}},null);$C("$data.Expressions.ObjectFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.fieldName=a;this.expression=b},nodeType:{value:$data.Expressions.ExpressionType.ObjectField,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.ObjectLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.members=a},nodeType:{value:$data.Expressions.ExpressionType.ObjectLiteral,writable:!0},toString:function(){return"unimplemented"},implementation:{get:function(){return function(a){var b={};a.forEach(function(a){b[a.name]=a.value});return b}},set:function(){}}},null);
$C("$data.Expressions.PagingExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a;this.amount=b;this.nodeType=c},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.ParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.nodeType=c||$data.Expressions.ExpressionType.Parameter;this.name=a;this.type=b||"unknown"},owningFunction:{value:void 0,enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.Parameter,writable:!0},name:{value:void 0,dataType:String,writable:!0},type:{value:void 0,dataType:"object",writable:!0},toString:function(a){a=a?this.type+" ":"";return a=a+this.name}},null);
$C("$data.Expressions.PropertyExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.expression=a;this.member=b;this.type=b.dataType},nodeType:{value:$data.Expressions.ExpressionType.MemberAccess},expression:{value:void 0,dataType:$data.Expressions.ExpressionNode,writable:!0},implementation:{get:function(){return function(a,b){a[b]===void 0&&Guard.raise(new Exception("Parameter '"+b+"' not found in context","Property not found!"));return a[b]}},set:function(){}},member:{value:void 0,
dataType:$data.MemberDefinition,writable:!0},type:{value:void 0,writable:!0},toString:function(){return this.expression.toString()+"."+this.member.toString()}});
$C("$data.Expressions.SimpleBinaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d,e,g){this.left=a;this.right=b;this.nodeType=c;this.operator=d;this.type=e;this.resolution=g},implementation:{get:function(){return $data.binaryOperators.getOperator(this.operator).implementation},set:function(){}},type:{value:"number",writable:!0}});$C("$data.Expressions.ThisExpression",$data.Expressions.ExpressionNode,null,{nodeType:{value:$data.Expressions.ExpressionType.This}});
$C("$data.Expressions.ExpressionVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(a,b){if(!a)return a;var c=null;switch(a.expressionType){case $data.Expressions.ParameterExpression:c=this.VisitParameter(a,b);break;case $data.Expressions.ConstantExpression:c=this.VisitConstant(a,b);break;case $data.Expressions.FunctionExpression:c=this.VisitFunction(a,b);break;case $data.Expressions.CallExpression:c=this.VisitCall(a,b);break;case $data.Expressions.SimpleBinaryExpression:c=this.VisitBinary(a,
b);break;case $data.Expressions.PropertyExpression:c=this.VisitProperty(a,b);break;case $data.Expressions.ThisExpression:c=this.VisitThis(a,b);break;case $data.Expressions.ObjectLiteralExpression:c=this.VisitObjectLiteral(a,b);break;case $data.Expressions.ObjectFieldExpression:c=this.VisitObjectField(a,b);break;case $data.Expressions.ArrayLiteralExpression:c=this.VisitArrayLiteral(a,b);break;case $data.Expressions.UnaryExpression:c=this.VisitUnary(a,b);break;case $data.Expressions.EntityContextExpression:c=
this.VisitEntityContext(a,b);break;default:debugger}this._deep=this._deep-1;return c},VisitArrayLiteral:function(a,b){var c=this,d=a.items.map(function(a){return c.Visit(a,b)});return Container.createArrayLiteralExpression(d)},VisitObjectLiteral:function(a,b){var c=this,d=a.members.map(function(a){return c.Visit(a,b)});return Container.createObjectLiteralExpression(d)},VisitObjectField:function(a,b){var c=this.Visit(a.expression,b);return Container.createObjectFieldExpression(a.fieldName,c)},VisitThis:function(a){return a},
VisitCall:function(a,b){var c=a.args.map(function(a){return this.Visit(a,b)},this),d=this.Visit(a.expression,b),e=this.Visit(a.member,b);return new $data.Expressions.CallExpression(d,e,c)},VisitParameter:function(a){return a},VisitConstant:function(a){return a},VisitFunction:function(a,b){var c=this,d=a.parameters.map(function(a){return c.Visit(a,b)}),e=c.Visit(a.body,b);return new $data.Expressions.FunctionExpression(a.name,d,e)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,
b);return new $data.Expressions.SimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type)},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);return new $data.Expressions.PropertyExpression(c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:new $data.Expressions.UnaryExpression(c,a.operator,a.nodeType)},VisitEntityContext:function(a){return a},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,
b);return c===a.expression&&d===a.left&&e===a.right?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,c)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,c,d)},VisitArray:function(a,
b){for(var c=[],d=true,e=0;e<a.length;e++){c[e]=this.Visit(a[e],b);d=d&&c[e]===a[e]}return d?a:c},GetMemberChain:function(a,b){if(a.expression.type==MEMBERACCESS){var c=this.GetMemberChain(a.expression,b);c.push(a.member);return c}return[a.expression,a.member]}},{});
$C("$data.Expressions.ParameterProcessor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},Visit:function(a,b){if((a instanceof $data.Expressions.ParameterExpression||a instanceof $data.Expressions.ThisExpression)&&this.canResolve(a)){var c=this.resolve(a,b);if(c!==a)c.resolvedBy=this.constructor.name;return c}return a},canResolve:function(){Guard.raise("Pure method")},resolve:function(){Guard.raise("Pure method")}});
$C("$data.Expressions.GlobalContextProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(a){this.global=a},canResolve:function(a){return a.nodeType==$data.Expressions.ExpressionType.Parameter&&this.global&&typeof this.global==="object"&&a.name in this.global},resolve:function(a){var b=this.global[a.name];return Container.createConstantExpression(b,typeof b,a.name)}});
$C("$data.Expressions.ConstantValueResolver",$data.Expressions.ParameterProcessor,null,{constructor:function(a,b,c){this.globalResolver=Container.createGlobalContextProcessor(b);this.paramResolver=Container.createGlobalContextProcessor(a);this.paramsObject=a;this.scopeContext=c},canResolve:function(a){return a.name==="$context"||a.nodeType==$data.Expressions.ExpressionType.This&&this.paramsObject?true:this.paramResolver.canResolve(a)||this.globalResolver.canResolve(a)},resolve:function(a){return a.name===
"$context"?Container.createEntityContextExpression(this.scopeContext):a.nodeType==$data.Expressions.ExpressionType.This?Container.createConstantExpression(this.paramsObject,typeof this.paramsObject,"this"):this.paramResolver.canResolve(a)?this.paramResolver.resolve(a):this.globalResolver.resolve(a)}});
$C("$data.Expressions.LocalContextProcessor",$data.Expressions.GlobalContextProcessor,null,{constructor:function(a){this.canResolve=function(b){return b.nodeType==$data.Expressions.ExpressionType.Parameter&&a("typeof "+b.name)!=="undefined"};this.resolve=function(b){b=a(b.name);return Container.createConstantExpression(b,typeof b)}}});
$C("$data.Expressions.LambdaParameterProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(a){var b={};this.canResolve=function(c){if(c.nodeType==$data.Expressions.ExpressionType.LambdaParameter){var d=c.owningFunction.parameters;if(d.length==1&&c.name==d[0].name){b[c.name]=a[0];return true}for(var e=0;e<d.length;e++)if(d[e].name==c.name){b[c.name]=a[e];return true}}return false};this.resolve=function(a){var d=Container.createParameterExpression(a.name,b[a.name],$data.Expressions.ExpressionType.LambdaParameter);
d.owningFunction=a.owningFunction;return d}}});
$C("$data.Expressions.ParameterResolverVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){this.lambdaParamCache={}},Visit:function(a,b){return $data.Expressions.ExpressionVisitor.prototype.Visit.call(this,a,b)},VisitArrayLiteral:function(a,b){var c=this,d=a.items.map(function(a){return c.Visit(a,b)});if(d.every(function(a){return a instanceof $data.Expressions.ConstantExpression})){d=d.map(function(a){return a.value});return Container.createConstantExpression(d,"array")}return Container.createArrayLiteralExpression(d)},
VisitObjectLiteral:function(a,b){var c=this,d=a.members.map(function(a){return c.Visit(a,b)});if(d.every(function(a){return a.expression instanceof $data.Expressions.ConstantExpression})){d=d.map(function(a){return{name:a.fieldName,value:a.expression.value}});return Container.createConstantExpression(a.implementation(d))}return Container.createObjectLiteralExpression(d)},VisitThis:function(a,b){return b.Visit(a,b)},VisitParameter:function(a,b){var c;switch(a.nodeType){case $data.Expressions.ExpressionType.Parameter:case $data.Expressions.ExpressionType.LambdaParameter:c=
b.Visit(a,b);c.nodeType==$data.Expressions.ExpressionType.LambdaParameter&&(this.lambdaParamCache[c.name]=c);return c;case $data.Expressions.ExpressionType.LambdaParameterReference:if(c=this.lambdaParamCache[a.name]){c=Container.createParameterExpression(a.name,c.type,$data.Expressions.ExpressionType.LambdaParameterReference);c.paramIndex=a.paramIndex;return c}}return a},VisitConstant:function(a){return a},VisitFunction:function(a,b){var c=this,d=a.parameters.map(function(a){return c.Visit(a,b)}),
e=c.Visit(a.body,b);return new $data.Expressions.FunctionExpression(a.name,d,e)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b),e=$data.Expressions;if(c instanceof e.ConstantExpression&&d instanceof e.ConstantExpression){c=a.implementation(c.value,d.value);return Container.createConstantExpression(c)}return new Container.createSimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);if(c instanceof $data.Expressions.ConstantExpression){c=
a.operator.implementation(c.value);return Container.createConstantExpression(c)}return new Container.createUnaryExpression(c,a.operator,a.nodeType)},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b),e;if(c instanceof $data.Expressions.ConstantExpression&&d instanceof $data.Expressions.ConstantExpression){e=a.implementation(c.value,d.value);return Container.createConstantExpression(e,typeof e,c.name+"$"+d.value)}if(c===a.expression&&d===a.member)return a;return e=
Container.createPropertyExpression(c,d)},VisitCall:function(a,b){function c(a){return a instanceof $data.Expressions.ConstantExpression?a.value:a}var d=$data.Expressions.ExpressionVisitor.prototype.VisitCall.apply(this,arguments),e=d.expression,g=d.member,f=d.args;if(function(a,b,c){return b instanceof $data.Expressions.ConstantExpression&&(!c||c instanceof $data.Expressions.ConstantExpression)&&a.every(function(a){return a instanceof $data.Expressions.ConstantExpression})}(f,g,e)){d=g.value;typeof d===
"string"&&e.value&&(d=e.value[d]);typeof d!=="function"&&Guard.raise("Constant expression is not a method...");e=a.implementation(e.value,d,f.map(c));return new $data.Expressions.ConstantExpression(e)}return d}},{});$C("$data.Expressions.AggregatedVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(a){this.Visit=function(b,c){for(var d=0;d<a.length;d++){var e=a[d].Visit(b,c);if(e!==b)return e}return b}}});
$C("$data.Expressions.LogicalSchemaBinderVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b),e=b.memberResolver.resolve(c.type,d.value);d.type=e;return Container.createPropertyExpression(c,d)}},{});
$data.Class.define("$data.Expressions.ExpTreeVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(a,b){this._deep=this._deep+1;var c=null;switch(a.type){case LITERAL:c=this.VisitLiteral(a,b);break;case VARIABLE:c=this.VisitVariable(a,b);break;case MEMBERACCESS:c=this.VisitMember(a,b);break;case BINARY:c=this.VisitBinary(a,b);break;case UNARY:c=this.VisitUnary(a,b);break;case INCDEC:c=this.VisitIncDec(a,b);break;case EQUALITY:c=this.VisitEquality(a,b);break;case DECISION:c=this.VisitDecision(a,
b);break;case METHODCALL:c=this.VisitMethodCall(a,b);break;case NEW:c=this.VisitNew(a,b);break;case JSONASSIGN:c=this.VisitJsonAssign(a,b);break;case ARRAYACCESS:c=this.VisitArrayAccess(a,b);break;default:Guard.raise("Type isn't implemented: "+a.type)}this._deep=this._deep-1;return c},VisitLiteral:function(a){return a},VisitVariable:function(a){return a},VisitMember:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);return c===a.expression&&d===a.member?a:$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(a.executable,
c,d)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right?a:$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(a.executable,a.operator,c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(a.executable,a.operator,c)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(a.executable,
a.operator,c,a.suffix)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right?a:$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(a.executable,a.operator,c,d)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e)},VisitMethodCall:function(a,
b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);return c===a.object&&d===a.args?a:$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(a.executable,c,a.method,d)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,c)},VisitJsonAssign:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(c===a.left&&d===a.right)return a;c.JSONASSIGN=true;d.JSONASSIGN=
true;return $data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true,c,d)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,c,d)},VisitArray:function(a,b){for(var c=[],d=true,e=0;e<a.length;e++){c[e]=this.Visit(a[e],b);d=d&&c[e]===a[e]}return d?a:c},GetMemberChain:function(a,b){if(a.expression.type==MEMBERACCESS){var c=this.GetMemberChain(a.expression,
b);c.push(a.member);return c}return[a.expression,a.member]}},{});
$data.Class.define("$data.Expressions.SetExecutableVisitor",$data.Expressions.ExpTreeVisitor,null,{Visit:function(a,b){switch(a.type){case LITERAL:return this.VisitLiteral(a,b);case VARIABLE:return this.VisitVariable(a,b);case MEMBERACCESS:return this.VisitMember(a,b);case BINARY:return this.VisitBinary(a,b);case UNARY:return this.VisitUnary(a,b);case INCDEC:return this.VisitIncDec(a,b);case EQUALITY:return this.VisitEquality(a,b);case DECISION:return this.VisitDecision(a,b);case METHODCALL:return this.VisitMethodCall(a,
b);case NEW:return this.VisitNew(a,b);case JSONASSIGN:return this.VisitJsonAssign(a,b);case ARRAYACCESS:return this.VisitArrayAccess(a,b);default:Guard.raise("Type isn't implemented: "+a.type)}},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right&&c.executable&&d.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(c.executable&&d.executable,a.operator,c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,
b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(c.executable,a.operator,c)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(c.executable,a.operator,c,a.suffix)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right&&c.executable&&d.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(c.executable&&
d.executable,a.operator,c,d)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right&&d.executable&&e.executable&&c.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(d.executable&&e.executable&&c.executable,c,d,e)},VisitMethodCall:function(a,b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);return c===a.object&&d===a.args&&(c==null?
true:c.executable)==a.executable?a:$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(c==null?true:c.executable,c,a.method,d)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,c)},VisitJsonAssign:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(c===a.left&&d===a.right)return a;c.JSONASSIGN=true;d.JSONASSIGN=true;return $data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true,
c,d)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,c,d)},VisitArray:function(a,b){for(var c=[],d=true,e=0;e<a.length;e++){c[e]=this.Visit(a[e],b);d=d&&c[e]===a[e]}return d?a:c},VisitLiteral:function(a){return{type:a.type,executable:true,value:a.value,valueType:a.valueType}},VisitVariable:function(a,b){typeof b.paramContext[a.name]==void 0&&Guard.raise("Variable is not defined in the paramContext: "+
a.name);return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(true,"Math","GLOBALOBJECT")},VisitMember:function(a,b){var c=this.GetMemberChain(a)[0].name,d=b.lambdaParams.indexOf(c)>=0,e=c==b.paramsName;!e&&!d&&Guard.raise("Variable is not defined in the paramContext or the lambda parameters: "+c);return $data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(e,a.expression,a.member)}},null);
$data.Class.define("$data.Expressions.ExecutorVisitor",$data.Expressions.ExpTreeVisitor,null,{VisitVariable:function(a,b){if(!a.executable)return a;var c=a.name==b.paramsName?b.paramContext:window[a.name];typeof c=="undefined"&&Guard.raise(new Exception("Unknown variable in '"+b.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+a.name+"'.","InvalidOperation",{operationName:b.operation,missingParameterName:a.name}));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,
typeof c,c)},VisitMember:function(a,b){if(!a.executable)return a;for(var c=this.GetMemberChain(a),d,e=0;e<c.length;e++)d=e==0?b.paramContext:d[c[e].name];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof d,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);c!==a.operand&&(a=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(a.executable,a.operator,c));if(!a.executable)return a;eval("value = "+a.operator+" "+(c.valueType=="string"?"'"+c.value+
"'":c.value));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);c!==a.operand&&(a=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(a.executable,a.operator,c,a.suffix));if(!a.executable)return a;c=a.suffix?a.operator=="++"?c.value++:c.value--:a.operator=="++"?++c.value:--c.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof c,c)},VisitBinary:function(a,
b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(c!==a.left||d!==a.right)a=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(a.executable,a.operator,c,d);if(!a.executable)return a;eval("value = "+(c.valueType=="string"?"'"+c.value+"'":c.value)+" "+a.operator+" "+(d.valueType=="string"?"'"+d.value+"'":d.value));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,
b);if(c!==a.left||d!==a.right)a=$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(a.executable,a.operator,c,d);if(!a.executable)return a;eval("value = "+(c.valueType=="string"?"'"+c.value+"'":c.value)+" "+a.operator+" "+(d.valueType=="string"?"'"+d.value+"'":d.value));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);if(c!==
a.expression||d!==a.left||e!==a.right)a=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e);if(!a.executable)return a;c=c.value?d.value:e.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof c,c)},VisitMethodCall:function(a,b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);if(c!==a.object||d!=a.args)a=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(a.executable,c,a.method,d);if(!a.executable)return a;
for(var e=[],g=0;g<d.length;g++){var f=d[g];e.push(typeof f.value=="string"?"'"+f.value+"'":f.value)}c=c?"value = object.value[eNode.method]("+e.join(",")+");":"value = "+a.method+"("+e.join(",")+");";eval(c);return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b),c=c.value[d.value];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof c,c)}},
null);
$data.Class.define("$data.Expressions.ExpressionBuilder",null,null,{constructor:function(a){this.context=a},_isLambdaParam:function(a){for(var b=this.context.lambdaParams,c=0;c<b.length;c++)if(b[c]==a)return true;return false},_isParam:function(a){return this.context.paramContext[a]!=void 0},_isParamRoot:function(a){return this.context.paramsName==a},Build:function(a,b){var c;switch(a.arity){case "infix":"("==a.value?c=this.BuildMethodCall(a,b):"."==a.value?c=this.BuildMember(a,b):["===","==","!==",
"!=",">","<",">=","<="].indexOf(a.value)>=0?c=this.BuildEquality(a,b):["&&","||"].indexOf(a.value)>=0?c=this.BuildBinary(a,b):["+","-","*","/","%"].indexOf(a.value)>=0?c=this.BuildBinary(a,b):"["==a.value?c=this.BuildArrayAccess(a,b):Guard.raise("Value of infix node isn't implemented: "+a.value);break;case "prefix":["+","-","!"].indexOf(a.value)>=0?c=this.BuildUnary(a,b):["++","--"].indexOf(a.value)>=0?c=this.BuildIncDec(a,b):"{"==a.value?c=this.BuildNewExpression(a,b):Guard.raise("Value of prefix node isn't implemented: "+
a.value);break;case "suffix":["++","--"].indexOf(a.value)>=0?c=this.BuildIncDec(a,b):Guard.raise("Value of suffix node isn't implemented: "+a.value);break;case "string":case "number":c=this.BuildLiteral(a,b);break;case "ternary":a.value=="?"?c=this.BuildDecision(a,b):Guard.raise("Value of ternary node isn't implemented: "+a.value);break;case null:case void 0:c=a.type=="boolean"&&(a.value=="true"||a.value=="false")?this.BuildBoolLiteral(a,b):this.BuildVariable(a,b);break;default:Guard.raise("Arity isn't implemented: "+
a.arity)}return c},BuildNewExpression:function(a){for(var b=$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,[]),a=a.first,c=0;c<a.length;c++)b.values.push(this.Build(a[c],b));return b},BuildLiteral:function(a){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,a.arity,a.value)},BuildBoolLiteral:function(a){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,a.type,a.value=="true"?true:false)},BuildVariable:function(a,b){if(!a.first){if(b.type==
MEMBERACCESS){var c;c=this._isLambdaParam(a.value)?"LAMBDAPARAM":this._isParamRoot(a.value)?"PARAMETERROOT":this._isParam(a.value)?"PARAMETER":"PROPERTY"}else this._isLambdaParam(a.value)?c="LAMBDAPARAM":this._isParamRoot(a.value)?c="PARAMETERROOT":this._isParam(a.value)?c="PARAMETER":window[a.value]!=void 0?c="GLOBALOBJECT":Guard.raise(new Exception("Unknown variable in '"+this.context.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+
a.value+"'.","InvalidOperation",{operationName:this.context.operation,missingParameterName:a.value}));return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(true,a.value,c)}c=$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"name",a.value);var d=$data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true),e=this.Build(a.first,d);d.left=c;d.right=e;c.JSONASSIGN=true;e.JSONASSIGN=true;return d},BuildMember:function(a){if(a.value!="."||a.arity!=
"infix")return a.type=="string"?$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,a.arity,a.value):$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(true,null,a.value);var b=$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(true),c=this.Build(a.first,b),a=this.Build(a.second,b);b.expression=c;b.member=a;return b},BuildUnary:function(a){var b=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(true,a.value);b.operand=this.Build(a.first,
b);return b},BuildIncDec:function(a){var b=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(true,a.value,null,a.arity=="suffix");b.operand=this.Build(a.first,b);return b},BuildBinary:function(a){a.first||Guard.raise("Cannot build binary: node.first is null");a.second||Guard.raise("Cannot build binary: node.second is null");var b=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(true,a.value);b.left=this.Build(a.first,b);b.right=this.Build(a.second,b);return b},BuildEquality:function(a){var b=
$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(true,a.value);b.left=this.Build(a.first,b);b.right=this.Build(a.second,b);return b},BuildDecision:function(a){var b=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(true);b.expression=this.Build(a.first,b);b.left=this.Build(a.second,b);b.right=this.Build(a.third,b);return b},BuildMethodCall:function(a){var b=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(true);if(a.first.type=="function"){b.object=
this.Build(a.first.first,b);b.method=a.first.second.value}else{a.first.type!=null&&Guard.raise("Cannot build MethodCall because type is "+type);b.object=null;b.method=a.first.value}for(var a=a.second,c=[],d=0;d<a.length;d++)c[d]=this.Build(a[d],b);b.args=c;return b},BuildArrayAccess:function(a){var b=$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true);b.array=this.Build(a.first,b);b.index=this.Build(a.second,b);return b}},null);
$C("$data.Expressions.AssociationInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.associationInfo=a},nodeType:{value:$data.Expressions.ExpressionType.AssociationInfo,enumerable:!0}});
$C("$data.Expressions.CodeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Container.resolveType(Container.getTypeName(a))==$data.String&&a.replace(/^[\s\xA0]+/,"").match("^function")!="function"&&(a="function (it) { return "+a+"; }");this.source=a;this.parameters=b},nodeType:{value:$data.Expressions.ExpressionType.Code,enumerable:!0}});
$C("$data.Expressions.CodeToEntityConverter",$data.Expressions.ExpressionVisitor,null,{constructor:function(a){this.scopeContext=a;this.parameters=[]},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b),e=this.scopeContext.resolveBinaryOperator(a.nodeType,a,b.frameType);return Container.createSimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type,e)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b),d=this.scopeContext.resolveUnaryOperator(a.nodeType,a,b.frameType);
return Container.createUnaryExpression(c,a.operator,a.nodeType,d)},VisitParameter:function(a,b){Guard.requireValue("context",b);var c=$data.Expressions.ExpressionType;switch(a.nodeType){case c.LambdaParameterReference:return Container.createEntityExpression(b.lambdaParameters[a.paramIndex],{lambda:a.name});case c.LambdaParameter:break;default:Guard.raise("Global parameter "+a.name+" not found. For query parameters use 'this.field' notation")}},VisitThis:function(a,b){var c=this.parameters.push({name:"",
value:void 0})-1;return Container.createQueryParameterExpression("",c,b.queryParameters,void 0)},VisitFunction:function(a,b){return $data.Expressions.ExpressionVisitor.prototype.VisitFunction.apply(this,arguments).body},VisitCall:function(a,b){var c=this,d=this.Visit(a.expression,b),e=this.Visit(a.member,b),g=a.args.map(function(a){return c.Visit(a,b)});switch(true){case d instanceof $data.Expressions.QueryParameterExpression:g=g.map(function(a){return a.value});g=a.implementation(d.value,e.value,
g);return Container.createQueryParameterExpression(d.name+"$"+e.value,d.index,g,typeof g);case d instanceof $data.Expressions.EntityFieldExpression:case d instanceof $data.Expressions.EntityFieldOperationExpression:var f=this.scopeContext.resolveFieldOperation(e.value,d,b.frameType);f||Guard.raise("Unknown entity field operation: "+e.getJSON());e=Container.createMemberInfoExpression(f);return g=Container.createEntityFieldOperationExpression(d,e,g);case d instanceof $data.Expressions.EntitySetExpression:(f=
this.scopeContext.resolveSetOperations(e.value,d,b.frameType))||Guard.raise("Unknown entity field operation: "+e.getJSON());e=Container.createMemberInfoExpression(f);return g=Container.createFrameOperationExpression(d,e,g);case d instanceof $data.Expressions.EntityExpression:(f=this.scopeContext.resolveTypeOperations(e.value,d,b.frameType))||Guard.raise("Unknown entity function operation: "+e.getJSON());e=Container.createMemberInfoExpression(f);return g=Container.createEntityFunctionOperationExpression(d,
e,g);case d instanceof $data.Expressions.EntityContextExpression:(f=this.scopeContext.resolveContextOperations(e.value,d,b.frameType))||Guard.raise("Unknown entity function operation: "+e.getJSON());e=Container.createMemberInfoExpression(f);return g=Container.createContextFunctionOperationExpression(d,e,g);default:Guard.raise("VisitCall: Only fields can have operations: "+a.getType().name)}},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);Guard.requireType("member",
d,$data.Expressions.ConstantExpression);switch(c.expressionType){case $data.Expressions.EntityExpression:var e=c.getMemberDefinition(d.value);e||Guard.raise(new Exception("Unknown member: "+d.value,"MemberNotFound"));switch(e.storageModel.PhysicalType.memberDefinitions.getMember(e.name).kind){case "property":d=Container.createMemberInfoExpression(e);return c=Container.createEntityFieldExpression(c,d);case "navProperty":d=e.storageModel.Associations[e.name];c=Container.createEntitySetExpression(c,
Container.createAssociationInfoExpression(d));return d.ToMultiplicity!=="*"?Container.createEntityExpression(c,{}):c;case "complexProperty":d=Container.createMemberInfoExpression(e);return c=Container.createComplexTypeExpression(c,d)}case $data.Expressions.ComplexTypeExpression:(e=c.getMemberDefinition(d.value))||Guard.raise("Unknown member "+d.value+" on "+c.entityType.name);d=Container.createMemberInfoExpression(e);if(Container.isPrimitiveType(Container.resolveType(e.dataType)))return c=Container.createEntityFieldExpression(c,
d);return c=Container.createComplexTypeExpression(c,d);case $data.Expressions.QueryParameterExpression:e=a.implementation(c.value,d.value);this.parameters[c.index].name=this.parameters[c.index].name+("$"+d.value);this.parameters[c.index].value=e;return Container.createQueryParameterExpression(c.name+"$"+d.value,c.index,e,Container.getTypeName(e));case $data.Expressions.EntityFieldExpression:case $data.Expressions.EntityFieldOperationExpression:(e=this.scopeContext.resolveFieldOperation(d.value,c,
b.frameType))||Guard.raise("Unknown entity field operation: "+d.getJSON());d=Container.createMemberInfoExpression(e);return c=Container.createEntityFieldOperationExpression(c,d,[]);default:Guard.raise("Unknown expression type to handle: "+c.expressionType.name)}}});
$C("$data.Expressions.ComplexTypeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Guard.requireType("source",a,[$data.Expressions.EntityExpression,$data.Expressions.ComplexTypeExpression]);Guard.requireType("selector",b,[$data.Expressions.EntityExpression,$data.Expressions.MemberInfoExpression]);this.source=a;this.selector=b;var c=a.entityType.getMemberDefinition(b.memberName).dataType;this.entityType=Container.resolveType(c)},getMemberDefinition:function(a){return this.entityType.getMemberDefinition(a)},
nodeType:{value:$data.Expressions.ExpressionType.Com}});$C("$data.Expressions.EntityContextExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.instance=a},instance:{enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.EntityContext,enumerable:!0}});
$C("$data.Expressions.EntityExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Guard.requireValue("source",a);Guard.requireValue("selector",b);!(a instanceof $data.Expressions.EntitySetExpression)&&!(a instanceof $data.Expressions.ServiceOperationExpression)&&Guard.raise("Only EntitySetExpressions can be the source for an EntityExpression");this.source=a;this.selector=b;this.entityType=this.source.elementType;this.storageModel=this.source.storageModel;Guard.requireValue("entityType",
this.entityType);Guard.requireValue("storageModel",this.storageModel)},getMemberDefinition:function(a){var b=this.entityType.getMemberDefinition(a);b||Guard.raise(new Exception("Unknown member "+a+" on type "+this.entityType.name,"MemberNotFound"));b.storageModel=this.storageModel;return b},nodeType:{value:$data.Expressions.ExpressionType.Entity}});
$C("$data.Expressions.EntityExpressionVisitor",null,null,{constructor:function(){this.lambdaTypes=[]},canVisit:function(a){return a instanceof $data.Expressions.ExpressionNode},Visit:function(a,b){if(!this.canVisit(a))return a;var c="Visit"+a.getType().name;if(c in this){c=this[c].call(this,a,b);return typeof c==="undefined"?a:c}return a},VisitToArrayExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createToArrayExpression(c):a},VisitForEachExpression:function(a,
b){var c=this.Visit(a.source,b);return c!==a.source?Container.createForEachExpression(c):a},VisitMemberInfoExpression:function(a){return a},VisitSingleExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createSingleExpression(c):a},VisitFirstExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createFirstExpression(c):a},VisitSomeExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createSomeExpression(c):
a},VisitEveryExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createEveryExpression(c):a},VisitCountExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createCountExpression(c):a},VisitBatchDeleteExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createBatchDeleteExpression(c):a},VisitObjectLiteralExpression:function(a,b){for(var c=a.members.map(function(a){return this.Visit(a,b)},this),d=true,e=0;e<
a.members.length;e++)d=d&&a.members[e]===c[e];return!d?Container.createObjectLiteralExpression(c):a},VisitObjectFieldExpression:function(a,b){var c=this.Visit(a.expression,b);return a.expression!==c?Container.createObjectFieldExpression(a.fieldName,c):a},VisitIncludeExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createIncludeExpression(c,a.selector):a},VisitUnaryExpression:function(a,b){var c=this.Visit(a.operand,b);return a.operand!==c?Container.createUnaryExpression(c,
a.operator,a.nodeType,a.resolution):a},VisitSimpleBinaryExpression:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c!==a.left||d!==a.right?new $data.Expressions.SimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type,a.resolution):a},VisitEntityContextExpression:function(a){return a},VisitCodeExpression:function(a){return a},VisitComplexTypeExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createComplexTypeExpression(c,
d):a},VisitEntityExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createEntityExpression(c,d):a},VisitEntityFieldExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createEntityFieldExpression(c,d):a},VisitEntityFieldOperationExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.operation,b),e=a.parameters.map(function(a){return this.Visit(a)},
this);return Container.createEntityFieldOperationExpression(c,d,e)},VisitParametricQueryExpression:function(a,b){var c=this.Visit(a.expression,b),d=a.parameters.map(function(a){return this.Visit(a)},this);return Container.createParametricQueryExpression(c,d)},VisitEntitySetExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createEntitySetExpression(c,d,a.params,a.instance):a},VisitInlineCountExpression:function(a,b){var c=
this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createInlineCountExpression(c,d,a.params,a.instance):a},VisitFilterExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createFilterExpression(c,d,a.params,a.instance):a},VisitProjectionExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);if(c!==a.source||d!==a.selector){c=Container.createProjectionExpression(c,
d,a.params,a.instance);c.projectionAs=a.projectionAs;return c}return a},VisitOrderExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createOrderExpression(c,d,a.nodeType):a},VisitPagingExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.amount,b);return c!==a.source||d!==a.amount?Container.createPagingExpression(c,d,a.nodeType):a}});
$C("$data.Expressions.ExpressionMonitor",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.Visit=function(b,c){var d=b,e;if(this.canVisit(b)){a.VisitExpressionNode&&a.VisitExpressionNode.apply(a,arguments);e="Visit"+b.getType().name;e in a&&(d=a[e].apply(a,arguments))}var g=arguments;d!==b&&(g=[d,c]);d=$data.Expressions.EntityExpressionVisitor.prototype.Visit.apply(this,g);g=[d,c];if(this.canVisit(d)){var f=d.getType().name;a.MonitorExpressionNode&&a.MonitorExpressionNode.apply(a,
g);e="Monitor"+f;e in a&&a[e].apply(a,g);a.MutateExpressionNode&&a.MutateExpressionNode.apply(a,g);e="Mutate"+f;e in a&&(d=a[e].apply(a,g))}return d}}});$C("$data.Expressions.EntityFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.selector=b;this.source=a;if(this.selector instanceof $data.Expressions.MemberInfoExpression||this.selector.name)this.memberName=this.selector.name},nodeType:{value:$data.Expressions.ExpressionType.EntityField}});
$C("$data.Expressions.EntityFieldOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a;this.operation=b;this.parameters=c},nodeType:{value:$data.Expressions.ExpressionType.EntityFieldOperation}});
$C("$data.Expressions.EntitySetExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d){Guard.requireType("source",a,[$data.Expressions.EntityContextExpression,$data.Expressions.EntitySetExpression]);Guard.requireType("selector",a,[$data.Expressions.MemberInfoExpression,$data.Expressions.CodeExpression,$data.Expressions.ParametricQueryExpression]);this.source=a;this.selector=b;this.params=c;this.instance=d;this.storage_type={};a:{for(;a;){if(a instanceof $data.Expressions.EntityContextExpression)break a;
a=a.source}a=void 0}switch(true){case this.source instanceof $data.Expressions.EntityContextExpression:Guard.requireType("selector",b,$data.Expressions.MemberInfoExpression);this.elementType=b.memberDefinition.elementType;this.storageModel=a.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntityExpression:Guard.requireType("selector",b,$data.Expressions.AssociationInfoExpression);this.elementType=b.associationInfo.ToType;this.storageModel=
a.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntitySetExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;case this.source instanceof $data.Expressions.ServiceOperationExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;default:Guard.raise("take and skip must be the last expressions in the chain!")}},instance:{enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.EntitySet,
enumerable:!0}});$C("$data.Expressions.FrameOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a;this.operation=b;this.parameters=c},nodeType:{value:$data.Expressions.ExpressionType.FrameOperation}});$C("$data.Expressions.EntityFunctionOperationExpression",$data.Expressions.FrameOperationExpression,null,{nodeType:{value:$data.Expressions.ExpressionType.EntityFunctionOperation}});
$C("$data.Expressions.ContextFunctionOperationExpression",$data.Expressions.FrameOperationExpression,null,{nodeType:{value:$data.Expressions.ExpressionType.ContextFunctionOperation}});$C("$data.Expressions.FilterExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.Filter,enumerable:!0}});
$C("$data.Expressions.InlineCountExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.InlineCount,enumerable:!0}});$C("$data.Expressions.FrameOperator",$data.Expressions.ExpressionNode,null,{constructor:function(){this.isTerminated=true}});
$C("$data.Expressions.CountExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Integer},nodeType:{value:$data.Expressions.ExpressionType.Count,enumerable:!0}});$C("$data.Expressions.SingleExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Single,enumerable:!0}});
$C("$data.Expressions.FirstExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.First,enumerable:!0}});$C("$data.Expressions.ForEachExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ForEach,enumerable:!0}});
$C("$data.Expressions.ToArrayExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ToArray,enumerable:!0}});$C("$data.Expressions.SomeExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Some,enumerable:!0}});
$C("$data.Expressions.EveryExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Every,enumerable:!0}});$C("$data.Expressions.BatchDeleteExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Integer},nodeType:{value:$data.Expressions.ExpressionType.BatchDelete,enumerable:!0}});
$C("$data.Expressions.IncludeExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.Include,writable:!0},toString:function(){return"unimplemented"}},null);$C("$data.Expressions.MemberInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.memberDefinition=a;this.memberName=a.name},nodeType:{value:$data.Expressions.ExpressionType.MemberInfo,enumerable:!0}});
$C("$data.Expressions.OrderExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(a,b,c){this.nodeType=c},nodeType:{value:$data.Expressions.ExpressionType.OrderBy,writable:!0},toString:function(){return"unimplemented"}},null);$C("$data.Expressions.ParametricQueryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.expression=a;this.parameters=b},nodeType:{value:$data.Expressions.ExpressionType.ParametricQuery,enumerable:!0}});
$C("$data.Expressions.ProjectionExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.Projection,enumerable:!0}});
$C("$data.Expressions.QueryExpressionCreator",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){Guard.requireValue("scopeContext",a);this.scopeContext=a},VisitEntitySetExpression:function(a){a.source instanceof $data.Expressions.EntityContextExpression&&this.lambdaTypes.push(a);return a},VisitServiceOperationExpression:function(a){a.source instanceof $data.Expressions.EntityContextExpression&&this.lambdaTypes.push(a);return a},VisitCodeExpression:function(a,b){var c=a.source.toString(),
c=Container.createCodeParser(this.scopeContext).createExpression(c);this.scopeContext.log({event:"JSCodeExpression",data:c});var d=Container.createConstantValueResolver(a.parameters,window,this.scopeContext),c=Container.createParameterResolverVisitor().Visit(c,d);this.scopeContext.log({event:"JSCodeExpressionResolved",data:c});d=Container.createCodeToEntityConverter(this.scopeContext);c=d.Visit(c,{queryParameters:a.parameters,lambdaParameters:this.lambdaTypes,frameType:b.frameType});d=Container.createParametricQueryExpression(c,
d.parameters);this.scopeContext.log({event:"EntityExpression",data:c});return d},VisitFilterExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createFilterExpression(c,d,a.params,a.instance):a},VisitInlineCountExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createInlineCountExpression(c,
d,a.params,a.instance):a},VisitProjectionExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);if(c!==a.source||d!==a.selector){c=Container.createProjectionExpression(c,d,a.params,a.instance);c.projectionAs=a.projectionAs;return c}return a},VisitOrderExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createOrderExpression(c,
d,a.nodeType):a}});$C("$data.Expressions.QueryParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.name=a;this.index=b;this.value=c;this.type=Container.getTypeName(c)},nodeType:{value:$data.Expressions.ExpressionType.QueryParameter,writable:!1}});$C("$data.Expressions.RepresentationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(){},getMemberDefinition:function(a){return this.entityType.getMemberDefinition(a)},nodeType:{value:$data.Expressions.ExpressionType.Entity}});
$C("$data.Expressions.ServiceOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d,e){Guard.requireType("source",a,[$data.Expressions.EntityContextExpression]);Guard.requireType("selector",a,[$data.Expressions.MemberInfoExpression]);this.source=a;this.selector=b;this.params=c;this.cfg=d;this.bindedEntity=e;a:{for(;a;){if(a instanceof $data.Expressions.EntityContextExpression)break a;a=a.source}a=void 0}switch(true){case this.source instanceof $data.Expressions.EntityContextExpression:this.elementType=
d.elementType?Container.resolveType(d.elementType):this.elementType?Container.resolveType(d.returnType):null;this.storageModel=d.elementType?a.instance._storageModel.getStorageModel(Container.resolveType(d.elementType)):null;break;default:Guard.raise("Unknown source type for EntitySetExpression: "+this.source.getType().name)}},nodeType:{value:$data.Expressions.ExpressionType.ServiceOperation,enumerable:!0}});
$C("$data.Expressions.ContinuationExpressionBuilder",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.mode=a},compile:function(a){var b={mode:"find",skipExists:false};this.Visit(a.expression,b);var c={skip:b.skipSize,take:b.pageSize,message:""};if("pageSize"in b){var d,e={mode:this.mode,pageSize:b.pageSize};if(!b.skipExists&&b.pageSize){e.append=true;d=this.Visit(a.expression,e)}else b.skipExists&&(d=this.Visit(a.expression,e));if(e.abort){c.skip=(c.skip||0)-c.take;c.message=
"Invalid skip value!"}else c.expression=d}else c.message="take expression not defined in the chain!";return c},VisitPagingExpression:function(a,b){switch(b.mode){case "find":if(a.nodeType===$data.Expressions.ExpressionType.Take)b.pageSize=a.amount.value;else{b.skipSize=a.amount.value;b.skipExists=true}break;case "prev":if(a.nodeType===$data.Expressions.ExpressionType.Skip){var c=a.amount.value-b.pageSize;b.abort=c<0&&a.amount.value>=b.pageSize;c=Container.createConstantExpression(Math.max(c,0),"number");
return Container.createPagingExpression(a.source,c,a.nodeType)}if(b.append)b.abort=true;break;case "next":if(a.nodeType===$data.Expressions.ExpressionType.Skip){c=b.pageSize+a.amount.value;c=Container.createConstantExpression(c,"number");return Container.createPagingExpression(a.source,c,a.nodeType)}if(b.append){c=Container.createConstantExpression(b.pageSize,"number");return Container.createPagingExpression(a,c,$data.Expressions.ExpressionType.Skip)}}this.Visit(a.source,b)}});
$data.Class.define("$data.dbClient.DbCommand",null,null,{connection:{},parameters:{},execute:function(){Guard.raise("Pure class")}},null);$data.Class.define("$data.dbClient.DbConnection",null,null,{connectionParams:{},database:{},isOpen:function(){Guard.raise("Pure class")},open:function(){Guard.raise("Pure class")},close:function(){Guard.raise("Pure class")},createCommand:function(){Guard.raise("Pure class")}},null);
$data.Class.define("$data.dbClient.openDatabaseClient.OpenDbCommand",$data.dbClient.DbCommand,null,{constructor:function(a,b,c){this.query=b;this.connection=a;this.parameters=c},executeNonQuery:function(a,b,c){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error,b,c)},executeQuery:function(a,b,c){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error,b,c)},exec:function(a,b,c,d,e,g){this.connection.open({error:d,
success:function(f){function g(){--q==0&&c(j?m[0]:m,e)}var j=false;if(!(a instanceof Array)){j=true;a=[a];b=[b]}var m=[],q=0;a.forEach(function(c,e){q++;if(c)f.executeSql(a[e],b[e],function(a,b){var c={rows:[]};try{c.insertId=b.insertId}catch(d){c.rowsAffected=b.rowsAffected;for(var f=b.rows.length,j=0;j<f;j++)c.rows.push(b.rows.item(j))}m[e]=c;g(a)},function(a,b){d&&d(b);return true});else{m[e]=null;g()}})}},e,g)}},null);
$data.Class.define("$data.dbClient.openDatabaseClient.OpenDbConnection",$data.dbClient.DbConnection,null,{constructor:function(a){this.connectionParams=a},isOpen:function(){return this.database!==null&&this.database!==void 0&&this.transaction!==null&&this.transaction!==void 0},open:function(a,b,c){c===void 0&&(c=true);if(b)a.success(b.transaction);else if(this.database)c?this.database.transaction(function(b){a.success(b)},a.error,a.oncomplete):this.database.readTransaction(function(b){a.success(b)},
a.error,a.oncomplete);else{b=this.connectionParams;this.database=openDatabase(b.fileName,b.version,b.displayName,b.maxSize);c?this.database.transaction(function(b){a.success(b)},a.error,a.oncomplete):this.database.readTransaction(function(b){a.success(b)},a.error,a.oncomplete)}},close:function(){this.database=this.transaction=void 0},createCommand:function(a,b){return new $data.dbClient.openDatabaseClient.OpenDbCommand(this,a,b)}},null);
$data.Class.define("$data.dbClient.jayStorageClient.JayStorageCommand",$data.dbClient.DbCommand,null,{constructor:function(a,b,c){this.query=b;this.connection=a;this.parameters=c},executeNonQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},executeQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},exec:function(a,b,c,d){if(b==null||b==void 0)b={};var e=false;if(!(a instanceof
Array)){e=true;a=[a];b=[b]}var g=[],f=a.length,k=function(){--f==0&&c(e?g[0]:g)};a.forEach(function(a,c){if(a)$data.ajax({url:"http"+(this.connection.connectionParams.storage.ssl?"s":"")+"://"+this.connection.connectionParams.storage.src.replace("http://","").replace("https://","")+"?db="+this.connection.connectionParams.storage.key,type:"POST",headers:{"X-PINGOTHER":"pingpong"},data:{query:a,parameters:b[c]},dataType:"json",contentType:"application/json;charset=UTF-8",success:function(a){if(a&&a.error){console.log("JayStorage error",
a.error);d(a.error)}else{g[c]=this.lastID?{insertId:this.lastID,rows:(a||{rows:[]}).rows}:{rows:(a||{rows:[]}).rows};k()}}});else{g[c]=null;k()}},this)}},null);$data.Class.define("$data.dbClient.jayStorageClient.JayStorageConnection",$data.dbClient.DbConnection,null,{constructor:function(a){this.connectionParams=a},isOpen:function(){return true},open:function(){},close:function(){},createCommand:function(a,b){return new $data.dbClient.jayStorageClient.JayStorageCommand(this,a,b)}},null);
$data.Class.define("$data.dbClient.sqLiteNJClient.SqLiteNjCommand",$data.dbClient.DbCommand,null,{constructor:function(a,b,c){this.query=b;this.connection=a;this.parameters=c},executeNonQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},executeQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},exec:function(a,b,c,d){this.connection.isOpen()||this.connection.open();
if(b==null||b==void 0)b={};var e=false;if(!(a instanceof Array)){e=true;a=[a];b=[b]}var g=this,f=[],k=0,j=function(){if(--k==0){g.connection.database.exec("COMMIT");c(e?f[0]:f)}};g.connection.database.exec("BEGIN");a.forEach(function(a,c){k++;if(a){var e=function(a,b){if(a!=null)d(a);else{f[c]=this.lastID?{insertId:this.lastID,rows:[]}:{rows:b};j()}},o=g.connection.database.prepare(a,b[c]);a.indexOf("SELECT")==0?o.all(e):o.run(e);o.finalize()}else{f[c]=null;j()}},this)}},null);
$data.Class.define("$data.dbClient.sqLiteNJClient.SqLiteNjConnection",$data.dbClient.DbConnection,null,{constructor:function(a){this.connectionParams=a},isOpen:function(){return this.database!==null&&this.database!==void 0},open:function(){if(this.database==null)this.database=new sqLiteModule.Database(this.connectionParams.fileName)},close:function(){},createCommand:function(a,b){return new $data.dbClient.sqLiteNJClient.SqLiteNjCommand(this,a,b)}},null);
$data.Class.define("$data.Validation.ValidationError",null,null,{constructor:function(a,b,c){this.Message=a;this.PropertyDefinition=b;this.Type=c},Type:{dataType:"string"},Message:{dataType:"string"},PropertyDefinition:{dataType:$data.MemberDefinition}},null);
$data.Class.define("$data.Validation.EntityValidationBase",null,null,{ValidateEntity:function(){return[]},ValidateEntityField:function(){return[]},getValidationValue:function(){Guard.raise("Pure class")},getValidationMessage:function(){Guard.raise("Pure class")}},null);$data.Validation=$data.Validation||{};$data.Validation.Entity=new $data.Validation.EntityValidationBase;
$data.Class.define("$data.Validation.EntityValidation",$data.Validation.EntityValidationBase,null,{ValidateEntity:function(a){var b=[];a.getType().memberDefinitions.getPublicMappedProperties().forEach(function(c){b=b.concat(this.ValidateEntityField(a,c,void 0,true))},this);return b},ValidateEntityField:function(a,b,c,d){var e=[],g=Container.resolveName(Container.resolveType(b.dataType));this.fieldValidate(a,b,!d?c:a[b.name],e,g);return e},getValidationValue:function(a,b){return a[b]&&a[b].value?a[b].value:
a[b]},getValidationMessage:function(a,b,c){if(typeof a[b]=="object"&&a[b].message)c=a[b].message;else if(a.errorMessage)c=a.errorMessage;return c},createValidationError:function(a,b,c){return new $data.Validation.ValidationError(this.getValidationMessage(a,b,c),a,b)},supportedValidations:{value:{"$data.Number":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true},minValue:function(a,b){return Object.isNullOrUndefined(a)||
a>=b},maxValue:function(a,b){return Object.isNullOrUndefined(a)||a<=b}},"$data.Integer":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true},minValue:function(a,b){return Object.isNullOrUndefined(a)||a>=b},maxValue:function(a,b){return Object.isNullOrUndefined(a)||a<=b}},"$data.String":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||
typeof b=="function"?b(a):true},minLength:function(a,b){return Object.isNullOrUndefined(a)||a.length>=b},maxLength:function(a,b){return Object.isNullOrUndefined(a)||a.length<=b},length:function(a,b){return Object.isNullOrUndefined(a)||a.length==b},regex:function(a,b){return Object.isNullOrUndefined(a)||a.match(typeof b==="string"?RegExp(b.indexOf("/")===0&&b.lastIndexOf("/")===b.length-1?b.slice(1,-1):b):b)}},"$data.Date":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,
b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true},minValue:function(a,b){return Object.isNullOrUndefined(a)||a>=b},maxValue:function(a,b){return Object.isNullOrUndefined(a)||a<=b}},"$data.Boolean":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true}},"$data.Array":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||
typeof b=="function"?b(a):true},length:function(a,b){return Object.isNullOrUndefined(a)||a.length==b}},"$data.Object":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true}},"$data.Guid":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true}}}},fieldValidate:function(a,b,c,d,e){if(!(a.entityState==
$data.EntityState.Modified&&a[b.name]==void 0)){var g=this.supportedValidations[e];g&&Object.keys(g).forEach(function(e){b[e]&&g[e]&&!g[e].call(a,c,this.getValidationValue(b,e))&&d.push(this.createValidationError(b,e,"Validation error!"))},this)}}},null);$data.Validation.Entity=new $data.Validation.EntityValidation;$data.Class.define("$data.Notifications.ChangeDistributorBase",null,null,{distributeData:function(){Guard.raise("Pure class")}},null);
$data.Class.define("$data.Notifications.ChangeCollectorBase",null,null,{buildData:function(){Guard.raise("Pure class")},processChangedData:function(a){this.Distrbutor&&this.Distrbutor.distributeData&&this.Distrbutor.distributeData(this.buildData(a))},Distrbutor:{enumerable:!1,dataType:$data.Notifications.ChangeDistributorBase,storeOnObject:!0}},null);
$data.Class.define("$data.Notifications.ChangeDistributor",$data.Notifications.ChangeDistributorBase,null,{constructor:function(a){this.broadcastUrl=a},distributeData:function(a){$data.ajax({url:this.broadcastUrl,type:"POST",data:"data="+JSON.stringify(a),succes:this.success,error:this.error})},broadcastUrl:{dataType:"string"},success:function(){},error:function(){}},null);
$data.Class.define("$data.Notifications.ChangeCollector",$data.Notifications.ChangeCollectorBase,null,{buildData:function(a){var b=[];a.forEach(function(a){var d={entityState:a.data.entityState,typeName:a.data.getType().name},e=[];switch(a.data.entityState){case $data.EntityState.Added:e=a.data.getType().memberDefinitions.getPublicMappedProperties();break;case $data.EntityState.Modified:e=a.data.changedProperties;break;case $data.EntityState.Deleted:e=a.data.getType().memberDefinitions.getKeyProperties()}e.forEach(function(b){d[b.name]=
a.data[b.name]});b.push(d)});return b}},null);
$data.Class.define("$data.Transaction",null,null,{constructor:function(){this._objectId=(new Date).getTime();$data.Trace.log("create: ",this._objectId);this.oncomplete=new $data.Event("oncomplete",this);this.onerror=new $data.Event("onerror",this)},abort:function(){Guard.raise(new Exception("Not Implemented","Not Implemented",arguments))},_objectId:{type:$data.Integer},transaction:{type:$data.Object},oncomplete:{type:$data.Event},onerror:{type:$data.Event}},null);
$data.Class.define("$data.Access",null,null,{},{isAuthorized:function(a,b,c,d){a=new $data.PromiseHandler;d=a.createCallback(d);a=a.getPromise();d.success(true);return a},getAccessBitmaskFromPermission:function(a){var b=$data.Access.None;a.Create&&(b=b|$data.Access.Create);a.Read&&(b=b|$data.Access.Read);a.Update&&(b=b|$data.Access.Update);a.Delete&&(b=b|$data.Access.Delete);a.DeleteBatch&&(b=b|$data.Access.DeleteBatch);a.Execute&&(b=b|$data.Access.Execute);return b},None:{value:0},Create:{value:1},
Read:{value:2},Update:{value:4},Delete:{value:8},DeleteBatch:{value:16},Execute:{value:32}});
$data.Class.define("$data.Promise",null,null,{always:function(){Guard.raise(new Exception("$data.Promise.always","Not implemented!"))},done:function(){Guard.raise(new Exception("$data.Promise.done","Not implemented!"))},fail:function(){Guard.raise(new Exception("$data.Promise.fail","Not implemented!"))},isRejected:function(){Guard.raise(new Exception("$data.Promise.isRejected","Not implemented!"))},isResolved:function(){Guard.raise(new Exception("$data.Promise.isResolved","Not implemented!"))},pipe:function(){Guard.raise(new Exception("$data.Promise.pipe",
"Not implemented!"))},progress:function(){Guard.raise(new Exception("$data.Promise.progress","Not implemented!"))},promise:function(){Guard.raise(new Exception("$data.Promise.promise","Not implemented!"))},state:function(){Guard.raise(new Exception("$data.Promise.state","Not implemented!"))},then:function(){Guard.raise(new Exception("$data.Promise.then","Not implemented!"))}},null);
$data.Class.define("$data.PromiseHandlerBase",null,null,{constructor:function(){},createCallback:function(a){a=$data.typeSystem.createCallbackSetting(a);return cbWrapper={success:a.success,error:a.error,notify:a.notify}},getPromise:function(){return new $data.Promise}},null);$data.PromiseHandler=$data.PromiseHandlerBase;var EventSubscriber=$data.Class.define("EventSubscriber",null,null,{constructor:function(a,b,c){this.handler=a;this.state=b;this.thisArg=c},handler:{},state:{},thisArg:{}});
$data.Event=Event=$data.Class.define("$data.Event",null,null,{constructor:function(a,b){function c(a,b){a.forEach(function(c,d){c.handler==b&&a.splice(d,1)})}var d=null;this.attach=function(a,c,f){d||(d=[]);d.push(new EventSubscriber(a,c,f||b))};this.detach=function(a){c(d,a)};this.fire=function(a,c){var f=c||b||this;d&&d.forEach(function(b){try{b.handler.call(b.thisArg,f,a,b.state)}catch(c){console.log("unhandled exception in event handler. exception suppressed");console.dir(c)}})};this.fireCancelAble=
function(a,c){var f=c||b||this,k=true;d&&d.forEach(function(b){try{k=k&&(b.handler.call(b.thisArg,f,a,b.state)===false?false:true)}catch(c){console.log("unhandled exception in event handler. exception suppressed");console.dir(c)}});return k}}});
var eventData=$data.Class.define("EventData",null,null,{eventName:{}}),PropertyChangeEventData=$data.Class.define("PropertyChangeEventData",EventData,null,{constructor:function(a,b,c){this.propertyName=a;this.oldValue=b;this.newValue=c},propertyName:{},oldValue:{},newValue:{}}),PropertyValidationEventData=$data.Class.define("PropertyValidationEventData",EventData,null,{constructor:function(a,b,c,d){this.propertyName=a;this.oldValue=b;this.newValue=c;this.errors=d;this.cancel=false},propertyName:{},
oldValue:{},newValue:{},errors:{},cancel:{}});
$data.Entity=Entity=$data.Class.define("$data.Entity",null,null,{constructor:function(a,b){this.initData={};var c=this.getType();c.__copyPropertiesToInstance&&$data.typeSystem.writePropertyValues(this);this.context=null;if("setDefaultValues"in c&&(!b||b.setDefaultValues!==false))if(!a||Object.keys(a).length<1)a=c.setDefaultValues(a);if(typeof a==="object"){var d=c.memberDefinitions,e=d.getPublicMappedPropertyNames(),g;for(g in a)if(e.indexOf(g)>-1){var f=Container.resolveType(d.getMember(g).type);
this.initData[g]=Object.isNullOrUndefined(a[g])?a[g]:f===$data.Date&&typeof a[g]==="string"?new Date(a[g]):f===$data.GeographyPoint&&typeof a[g]==="object"&&!(a[g]instanceof $data.GeographyPoint)?new $data.GeographyPoint(a[g]):f===$data.GeographyLineString&&!(a[g]instanceof $data.GeographyLineString)?new $data.GeographyLineString(a[g]):f===$data.GeographyPolygon&&!(a[g]instanceof $data.GeographyPolygon)?new $data.GeographyPolygon(a[g]):f===$data.GeographyMultiPoint&&!(a[g]instanceof $data.GeographyMultiPoint)?
new $data.GeographyMultiPoint(a[g]):f===$data.GeographyMultiLineString&&!(a[g]instanceof $data.GeographyMultiLineString)?new $data.GeographyMultiLineString(a[g]):f===$data.GeographyMultiPolygon&&!(a[g]instanceof $data.GeographyMultiPolygon)?new $data.GeographyMultiPolygon(a[g]):f===$data.GeographyCollection&&!(a[g]instanceof $data.GeographyCollection)?new $data.GeographyCollection(a[g]):f===$data.GeometryPoint&&typeof a[g]==="object"&&!(a[g]instanceof $data.GeometryPoint)?new $data.GeometryPoint(a[g]):
f===$data.GeometryLineString&&!(a[g]instanceof $data.GeometryLineString)?new $data.GeometryLineString(a[g]):f===$data.GeometryPolygon&&!(a[g]instanceof $data.GeometryPolygon)?new $data.GeometryPolygon(a[g]):f===$data.GeometryMultiPoint&&!(a[g]instanceof $data.GeometryMultiPoint)?new $data.GeometryMultiPoint(a[g]):f===$data.GeometryMultiLineString&&!(a[g]instanceof $data.GeometryMultiLineString)?new $data.GeometryMultiLineString(a[g]):f===$data.GeometryMultiPolygon&&!(a[g]instanceof $data.GeometryMultiPolygon)?
new $data.GeometryMultiPolygon(a[g]):f===$data.GeometryCollection&&!(a[g]instanceof $data.GeometryCollection)?new $data.GeometryCollection(a[g]):f===$data.Guid&&!(a[g]instanceof $data.Guid)?a[g]?$data.parseGuid(a[g]):void 0:a[g]}}b&&b.entityBuilder&&b.entityBuilder(this,c.memberDefinitions.asArray(),c);this.entityState=this.changedProperties=void 0},toString:function(){return this.getType().fullName+"("+(this.Id||this.Name||"")+")"},toJSON:function(){var a={},b=this;this.getType().memberDefinitions.getPublicMappedProperties().forEach(function(c){a[c.name]=
b[c.name]});return a},equals:function(a){if(a.getType()!==this.getType())return false;for(var b=this.getType().memberDefinitions.getKeyProperties(),c=0;c<b.length;c++)if(this[b[c].name]==a[b[c].name])return true;return false},propertyChanging:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){if(!this._propertyChanging)this._propertyChanging=new Event("propertyChanging",this);return this._propertyChanging},set:function(a){this._propertyChanging=
a}},propertyChanged:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){if(!this._propertyChanged)this._propertyChanged=new Event("propertyChanged",this);return this._propertyChanged},set:function(a){this._propertyChanged=a}},propertyValidationError:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){if(!this._propertyValidationError)this._propertyValidationError=
new Event("propertyValidationError",this);return this._propertyValidationError},set:function(a){this._propertyValidationError=a}},storeProperty:function(a,b){var b=this.typeConversion(a,b),c=null;if(a.monitorChanges!=false&&(this._propertyChanging||this._propertyChanged||"instancePropertyChanged"in this.constructor)){var d=this[a.name],c=new PropertyChangeEventData(a.name,d,b);this._propertyChanging&&this.propertyChanging.fire(c)}if(a.monitorChanges!=false&&(this._propertyValidationError||"instancePropertyValidationError"in
this.constructor)){var e=$data.Validation.Entity.ValidateEntityField(this,a,b);if(e.length>0){d=this[a.name];d=new PropertyValidationEventData(a.name,d,b,e);this._propertyValidationError&&this.propertyValidationError.fire(d);"instancePropertyValidationError"in this.constructor&&this.constructor.instancePropertyValidationError.fire(d,this);if(d.cancel==true)return}}a.storeOnObject==true?this["_"+a.name]=b:this.initData[a.name]=b;this.isValidated=false;if(a.monitorChanges!=false&&this.entityState==
$data.EntityState.Unchanged)this.entityState=$data.EntityState.Modified;if(a.monitorChanges!=false){if(!this.changedProperties)this.changedProperties=[];this.changedProperties.some(function(b){return b.name==a.name})||this.changedProperties.push(a);this._propertyChanged&&this.propertyChanged.fire(c);"instancePropertyChanged"in this.constructor&&this.constructor.instancePropertyChanged.fire(c,this)}},typeConversion:function(a,b){var c=b;if(typeof b==="string"&&!a.concurrencyMode)switch(Container.resolveName(a.type)){case "$data.Guid":if(b===
"")return;c=$data.parseGuid(b);break;case "$data.Integer":if(b==="")return;c=parseInt(b);if(isNaN(c))throw Guard.raise(new Exception("TypeError: ","value not convertable to $data.Integer",[a,b]));break;case "$data.Number":if(b==="")return;c=parseFloat(b);if(isNaN(c))throw Guard.raise(new Exception("TypeError: ","value not convertable to $data.Number",[a,b]));break;case "$data.Date":if(b==="")return;c=new Date(b);if(isNaN(c.valueOf()))throw Guard.raise(new Exception("TypeError: ","value not convertable to $data.Date",
[a,b]));break;case "$data.Boolean":if(b==="")return;switch(b.toLowerCase()){case "true":c=true;break;case "false":c=false;break;default:throw Guard.raise(new Exception("TypeError: ","value not convertable to $data.Boolean",[a,b]));}break;case "$data.Object":if(b==="")return;try{c=JSON.parse(b)}catch(d){throw Guard.raise(new Exception("TypeError: ",d.toString(),[a,b]));}}return c},retrieveProperty:function(a){return a.storeOnObject==true?this["_"+a.name]:this.initData[a.name]},getProperty:function(a,
b,c){b=$data.typeSystem.createCallbackSetting(b);if(this[a.name]!=void 0)c instanceof $data.Transaction?b.success(this[a.name],c):b.success(this[a.name]);else{this.context||Guard.raise(new Exception("Entity not in context","Invalid operation"));return this.context.loadItemProperty(this,a,b,c)}},setProperty:function(a,b,c){this[a.name]=b;b=new $data.PromiseHandler;c=b.createCallback(c);c.success(this[a.name]);return b.getPromise()},isValid:function(){if(!this.isValidated){this.ValidationErrors=$data.Validation.Entity.ValidateEntity(this);
this.isValidated=true}return this.ValidationErrors.length==0},isValidated:{dataType:"bool",storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,value:!1},ValidationErrors:{dataType:Array,elementType:$data.Validation.ValidationError,storeOnObject:!0,monitorChanges:!0,notMapped:!0,enumerable:!1},resetChanges:function(){delete this._changedProperties},changedProperties:{dataType:Array,elementType:window.MemberDefinition,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1},entityState:{dataType:"integer",
storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1},remove:function(){if($data.ItemStore&&"EntityInstanceRemove"in $data.ItemStore)return $data.ItemStore.EntityInstanceRemove.apply(this,arguments);throw"not implemented";},save:function(){if($data.ItemStore&&"EntityInstanceSave"in $data.ItemStore)return $data.ItemStore.EntityInstanceSave.apply(this,arguments);throw"not implemented";},refresh:function(){if($data.ItemStore&&"EntityInstanceSave"in $data.ItemStore)return $data.ItemStore.EntityInstanceRefresh.apply(this,
arguments);throw"not implemented";},storeToken:{type:Object,monitorChanges:!1,notMapped:!0,storeOnObject:!0}},{__setPropertyfunctions:{value:!0,notMapped:!0,enumerable:!1,storeOnObject:!0},__copyPropertiesToInstance:{value:!1,notMapped:!0,enumerable:!1,storeOnObject:!0},inheritedTypeProcessor:function(a){$data.ItemStore&&"EntityInheritedTypeProcessor"in $data.ItemStore&&$data.ItemStore.EntityInheritedTypeProcessor.apply(this,arguments);a.defaultValues={};a.memberDefinitions.asArray().forEach(function(b){if(b.hasOwnProperty("defaultValue"))a.defaultValues[b.name]=
b.defaultValue});if(Object.keys(a.defaultValues).length>0)a.setDefaultValues=function(b,c){var b=b||{},d=a.defaultValues,e;for(e in d)e in b||(b[e]="function"===typeof d[e]?d[e](e,c):d[e]);console.log("ret init:",b);return b}},addEventListener:function(a,b){var c="on"+a;c in this||(this[c]=new $data.Event(a,this));this[c].attach(b)},removeEventListener:function(a,b){var c="on"+a;c in this&&this[c].detach(b)},raiseEvent:function(a,b){var c="on"+a;c in this&&this[c].fire(b)},getFieldNames:function(){return this.memberDefinitions.getPublicMappedPropertyNames()}});
$data.define=function(a,b){if(!b)throw Error("json object type is not supported yet");var c={},d=[];Object.keys(b).forEach(function(a){var e=b[a];if(typeof e==="object"&&("type"in e||"get"in e||"set"in e)){c[a]=e;e.key&&d.push(e);if(("get"in e||"set"in e)&&(!("notMapped"in e)||e.notMapped===true)){e.notMapped=true;e.storeOnObject=true}if("get"in e&&!("set"in e))e.set=function(){};else if("set"in e&&!("get"in e))e.get=function(){}}else c[a]={type:e}});if(d.length<1){var e;switch(true){case "id"in c:e=
"id";break;case "Id"in c:e="Id";break;case "ID"in c:e="ID"}if(e){c[e].key=true;$data.Container.resolveName(c[e].type);c[e].computed=true}else c.Id={type:"int",key:true,computed:true}}return $data.Entity.extend(a,c)};$data.implementation=function(a){return Container.resolveType(a)};
$data.Class.define("$data.StorageModel",null,null,{constructor:function(){this.ComplexTypes=[];this.Associations=[]},LogicalType:{},LogicalTypeName:{},PhysicalType:{},PhysicalTypeName:{},EventHandlers:{},TableName:{},TableOptions:{value:void 0},ComplexTypes:{},Associations:{},ContextType:{}},null);
$data.Class.define("$data.Association",null,null,{constructor:function(a){if(a){this.From=a.From;this.FromType=a.FromType;this.FromMultiplicity=a.FromMultiplicity;this.FromPropertyName=a.FromPropertyName;this.To=a.To;this.ToType=a.ToType;this.ToMultiplicity=a.ToMultiplicity;this.ToPropertyName=a.ToPropertyName}},From:{},FromType:{},FromMultiplicity:{},FromPropertyName:{},To:{},ToType:{},ToMultiplicity:{},ToPropertyName:{},ReferentialConstraint:{}},null);
$data.Class.define("$data.ComplexType",$data.Association,null,{},null);
$data.Class.define("$data.EntityContext",null,null,{constructor:function(a){$data.ItemStore&&"ContextRegister"in $data.ItemStore&&$data.ItemStore.ContextRegister.apply(this,arguments);"string"===typeof a&&(a=0===a.indexOf("http")?{name:"oData",oDataServiceHost:a}:{name:"local",databaseName:a});if("provider"in a)a.name=a.provider;this.trackChanges=this.lazyLoad=false;this._entitySetReferences={};this._storageModel=[];var b=this;b._isOK=false;var c=this._successInitProvider;this._successInitProvider=
function(a){a instanceof $data.EntityContext?c(b):c(b,a)};this._storageModel.getStorageModel=function(a){for(var a=Container.resolveType(a),c=0;c<b._storageModel.length;c++){var d=b._storageModel[c];if(d.LogicalType===a)return d}};if(typeof a.name==="string")a.name=[a.name];var d=[].concat(a.name),e=$data.typeSystem.createCallbackSetting({success:this._successInitProvider,error:this._successInitProvider});this._initStorageModelSync();b._initializeEntitySets(b.getType());$data.StorageProviderLoader.load(d,
{success:function(c){b.storageProvider=new c(a,b);b.storageProvider.setContext(b);b.stateManager=new $data.EntityStateManager(b);var d=b.getType();if(c.name in d._storageModelCache)b._storageModel=d._storageModelCache[c.name];else{b._initializeStorageModel();d._storageModelCache[c.name]=b._storageModel}a&&a.user&&Object.defineProperty(b,"user",{value:a.user,enumerable:true});a&&a.checkPermission&&Object.defineProperty(b,"checkPermission",{value:a.checkPermission,enumerable:true});b.storageProvider&&
b.storageProvider.initializeStore(e)},error:function(){e.error("Provider fallback failed!")}});this.addEventListener=function(a,b){var c="on"+a;c in this||(this[c]=new $data.Event(a,this));this[c].attach(b)};this.removeEventListener=function(a,b){var c="on"+a;c in this&&this[c].detach(b)};this.raiseEvent=function(a,b){var c="on"+a;c in this&&this[c].fire(b)}},beginTransaction:function(){var a=null,b=null,c=false;switch(arguments.length){case 3:a=arguments[0];c=arguments[1];b=arguments[2];break;case 2:arguments[0]instanceof
$data.Array?a=arguments[0]:c=arguments[0];b=arguments[1];break;case 1:b=arguments[0];break;case 0:break;default:throw new Exception("Begin tran is async function!");}var d=new $data.PromiseHandler,b=d.createCallback(b);this.storageProvider._beginTran(a,c,b);return d.getPromise()},_isReturnTransaction:function(a){return a instanceof $data.Base||a==="returnTransaction"},_applyTransaction:function(a,b,c,d,e){if(e===true)if(d instanceof $data.Transaction){Array.prototype.push.call(c,d);b.apply(a,c)}else this.beginTransaction(function(d){Array.prototype.push.call(c,
d);b.apply(a,c)});else b.apply(a,c)},getDataType:function(a){if(typeof a=="string"){var b=this[a];if(b===void 0||b===null)b=eval(a);return b}return a},_initializeEntitySets:function(a){for(var b=0,c=this._storageModel.length;b<c;b++){var d=this._storageModel[b];this[d.ItemName]=new $data.EntitySet(d.LogicalType,this,d.ItemName,d.EventHandlers);var e=this[d.ItemName];e.name=d.ItemName;e.tableName=d.TableName;e.tableOptions=d.TableOptions;e.eventHandlers=d.EventHandlers;this._entitySetReferences[d.LogicalType.name]=
e;this._initializeActions(e,a,a.getMemberDefinition(d.ItemName))}},_initStorageModelSync:function(){for(var a=this.getType().memberDefinitions.asArray(),b=0;b<a.length;b++){var c=a[b];if("dataType"in c){var d=Container.resolveType(c.dataType);if(d&&d.isAssignableTo&&d.isAssignableTo($data.EntitySet)){d=new $data.StorageModel;d.TableName=c.tableName||c.name;d.TableOptions=c.tableOptions;d.ItemName=c.name;d.LogicalType=Container.resolveType(c.elementType);d.LogicalTypeName=d.LogicalType.name;d.PhysicalTypeName=
$data.EntityContext._convertLogicalTypeNameToPhysical(d.LogicalTypeName);d.ContextType=this.getType();if(c.indices)d.indices=c.indices;if(c.beforeCreate){if(!d.EventHandlers)d.EventHandlers={};d.EventHandlers.beforeCreate=c.beforeCreate}if(c.beforeRead){if(!d.EventHandlers)d.EventHandlers={};d.EventHandlers.beforeRead=c.beforeRead}if(c.beforeUpdate){if(!d.EventHandlers)d.EventHandlers={};d.EventHandlers.beforeUpdate=c.beforeUpdate}if(c.beforeDelete){if(!d.EventHandlers)d.EventHandlers={};d.EventHandlers.beforeDelete=
c.beforeDelete}if(c.afterCreate){if(!d.EventHandlers)d.EventHandlers={};d.EventHandlers.afterCreate=c.afterCreate}if(c.afterRead){if(!d.EventHandlers)d.EventHandlers={};d.EventHandlers.afterRead=c.afterRead}if(c.afterUpdate){if(!d.EventHandlers)d.EventHandlers={};d.EventHandlers.afterUpdate=c.afterUpdate}if(c.afterDelete){if(!d.EventHandlers)d.EventHandlers={};d.EventHandlers.afterDelete=c.afterDelete}this._storageModel.push(d)}}}},_initializeStorageModel:function(){this.getType().memberDefinitions.asArray();
if(typeof intellisense==="undefined")for(var a=0;a<this._storageModel.length;a++){var b=this._storageModel[a],c={};b.Associations=b.Associations||[];b.ComplexTypes=b.ComplexTypes||[];for(var d=0;d<b.LogicalType.memberDefinitions.getPublicMappedProperties().length;d++){var e=b.LogicalType.memberDefinitions.getPublicMappedProperties()[d],g=Container.resolveType(e.dataType);if(this.storageProvider.supportedDataTypes.indexOf(g)>-1&&Object.isNullOrUndefined(e.inverseProperty)){var f=JSON.parse(JSON.stringify(e));
f.dataType=g;c[e.name]=f}else{this._buildDbType_navigationPropertyComplite(e,g,b);if((g===$data.Array||g.isAssignableTo&&g.isAssignableTo($data.EntitySet))&&e.inverseProperty&&e.inverseProperty!=="$$unbound")this._buildDbType_Collection_OneManyDefinition(c,b,g,e);else if(e.inverseProperty)if(e.inverseProperty==="$$unbound")g===$data.Array?this._buildDbType_Collection_OneManyDefinition(c,b,g,e):this._buildDbType_ElementType_OneManyDefinition(c,b,g,e);else(f=g.memberDefinitions.getMember(e.inverseProperty))?
f.elementType?Container.resolveType(f.elementType)===b.LogicalType?this._buildDbType_ElementType_OneManyDefinition(c,b,g,e):typeof intellisense==="undefined"&&Guard.raise(new Exception("Inverse property not valid, refereed item element type not match: "+b.LogicalTypeName,", property: "+e.name)):this._buildDbType_ElementType_OneOneDefinition(c,b,g,e):typeof intellisense==="undefined"&&Guard.raise(new Exception("Inverse property not valid"));else this._buildDbType_addComplexTypePropertyDefinition(c,
b,g,e)}}this._buildDbType_modifyInstanceDefinition(c,b,this);d={};d.convertTo=this._buildDbType_generateConvertToFunction(b,this);this._buildDbType_modifyClassDefinition(d,b,this);b.PhysicalType=$data.Class.define(b.PhysicalTypeName,$data.Entity,null,c,d)}},_initializeActions:function(a,b,c){if(c&&c.actions)for(var d=Object.keys(c.actions),e=0;e<d.length;e++){var g=d[e],f=c.actions[g];if(typeof f==="function")a[g]=f;else{f=$data.MemberDefinition.translateDefinition(f,g,b);if(f instanceof $data.MemberDefinition&&
f.kind===$data.MemberTypes.method)a[g]=f.method}}},_buildDbType_navigationPropertyComplite:function(a,b,c){if(a.inverseProperty){b=b===$data.Array||b.isAssignableTo&&b.isAssignableTo($data.EntitySet)?this._storageModel.getStorageModel(Container.resolveType(a.elementType)):this._storageModel.getStorageModel(b);if(c=b.LogicalType.memberDefinitions.getMember(a.inverseProperty))c.inverseProperty?c.inverseProperty!=a.name&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Inverse property mismatch")):
c.inverseProperty=a.name}else{var d=null;if(b===$data.Array||b.isAssignableTo&&b.isAssignableTo($data.EntitySet)){if(b=this._storageModel.getStorageModel(Container.resolveType(a.elementType)))for(var d=[],b=b.LogicalType.memberDefinitions.getPublicMappedProperties(),e=0;e<b.length;e++){var g=b[e];g.inverseProperty==a.name&&Container.resolveType(g.dataType)===Container.resolveType(c.LogicalType)&&d.push(g)}}else if(b=this._storageModel.getStorageModel(b)){d=[];b=b.LogicalType.memberDefinitions.getPublicMappedProperties();
for(e=0;e<b.length;e++){g=b[e];g.elementType&&g.inverseProperty==a.name&&Container.resolveType(g.elementType)===c.LogicalType?d.push(g):g.inverseProperty==a.name&&Container.resolveType(g.dataType)===c.LogicalType&&d.push(g)}}if(d){d.length>1&&typeof intellisense!=="undefined"&&Guard.raise(new Exception("More than one inverse property refer to this member definition: "+a.name+", type: "+Container.resolveName(c.LogicalType)));if(c=d.pop())a.inverseProperty=c.name}}},_buildDbType_generateConvertToFunction:function(){return function(a){return a}},
_buildDbType_modifyInstanceDefinition:function(){},_buildDbType_modifyClassDefinition:function(){},_buildDbType_addComplexTypePropertyDefinition:function(a,b,c,d){this._addNavigationPropertyDefinition(a,d,d.name,$data.MemberTypes.complexProperty);a=this._createComplexElement(b.LogicalType,"",d.name,c,"","");b.ComplexTypes[d.name]=a;b.ComplexTypes.push(a)},_buildDbType_Collection_OneManyDefinition:function(a,b,c,d){c=Container.resolveType(d.elementType);(c===void 0||c===null)&&typeof intellisense===
"undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",d));for(var e,g=0;g<this._storageModel.length;g++){var f=this._storageModel[g];if(f.LogicalType===c){e=f;break}}e||typeof intellisense==="undefined"&&Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",d));this._addNavigationPropertyDefinition(a,d,d.name);a=this._addAssociationElement(b.LogicalType,d.inverseProperty==="$$unbound"?"$$unbound":"0..1",d.name,e.LogicalType,
"*",d.inverseProperty);b.Associations[d.name]=a;b.Associations.push(a)},_buildDbType_ElementType_OneManyDefinition:function(a,b,c,d){c=Container.resolveType(d.dataType);(c===void 0||c===null)&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",d));for(var e,g=0;g<this._storageModel.length;g++){var f=this._storageModel[g];if(f.LogicalType===c){e=f;break}}e||typeof intellisense==="undefined"&&Guard.raise(new Exception("No EntitySet definition for the following element type",
"Field definition",d));this._addNavigationPropertyDefinition(a,d,d.name);a=this._addAssociationElement(b.LogicalType,d.inverseProperty==="$$unbound"?"$$unbound":"*",d.name,e.LogicalType,"0..1",d.inverseProperty);b.Associations[d.name]=a;b.Associations.push(a)},_buildDbType_ElementType_OneOneDefinition:function(a,b,c,d){c=Container.resolveType(d.dataType);(c===void 0||c===null)&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",d));for(var e,
g=0;g<this._storageModel.length;g++){var f=this._storageModel[g];if(f.LogicalType===c){e=f;break}}e||typeof intellisense==="undefined"&&Guard.raise(new Exception("No EntitySet definition following element type","Field definition",d));!e.LogicalType.memberDefinitions.getMember(d.inverseProperty).required&&!d.required&&typeof intellisense==="undefined"&&typeof intellisense==="undefined"&&Guard.raise(new Exception("In one to one connection, one side must required!","One to One connection",d));this._addNavigationPropertyDefinition(a,
d,d.name);a=this._addAssociationElement(b.LogicalType,d.required?"0..1":"1",d.name,e.LogicalType,d.required?"1":"0..1",d.inverseProperty);b.Associations[d.name]=a;b.Associations.push(a)},_addNavigationPropertyDefinition:function(a,b,c,d){var e=JSON.parse(JSON.stringify(b));e.dataType=$data.EntitySet;e.notMapped=true;e.kind=d?d:$data.MemberTypes.navProperty;e.association=c;a[b.name]=e},_addAssociationElement:function(a,b,c,d,e,g){return new $data.Association({From:a.name,FromType:a,FromMultiplicity:b,
FromPropertyName:c,To:d.name,ToType:d,ToMultiplicity:e,ReferentialConstraint:[],ToPropertyName:g})},_createComplexElement:function(a,b,c,d,e,g){return new $data.ComplexType({From:a.name,FromType:a,FromMultiplicity:b,FromPropertyName:c,To:d.name,ToType:d,ToMultiplicity:e,ReferentialConstraint:[],ToPropertyName:g})},_successInitProvider:function(a,b){if(a instanceof $data.EntityContext&&a._isOK!==void 0)if(b){a._isOK=b;if(a.onReadyFunction){for(c=0;c<a.onReadyFunction.length;c++)a.onReadyFunction[c].error(b);
a.onReadyFunction=void 0}}else{a._isOK=true;if(a.onReadyFunction){for(var c=0;c<a.onReadyFunction.length;c++)a.onReadyFunction[c].success(a);a.onReadyFunction=void 0}}},onReady:function(a){var b=new $data.PromiseHandler,a=b.createCallback(a);if(this._isOK===true)a.success(this);else if(this._isOK!==false)a.error(this._isOK);else{this.onReadyFunction=this.onReadyFunction||[];this.onReadyFunction.push(a)}return b.getPromise()},getEntitySetFromElementType:function(a){var b=this._entitySetReferences[a];
if(!b)try{b=this._entitySetReferences[eval(a).name]}catch(c){}return b},executeQuery:function(a,b,c){var d=new $data.Query(a.expression,a.defaultType,this);d.transaction=c instanceof $data.Transaction?c:void 0;var e=this._isReturnTransaction(c),b=$data.typeSystem.createCallbackSetting(b),g=this,f={success:function(a){a.buildResultSet(g);$data.ItemStore&&"QueryResultModifier"in $data.ItemStore&&$data.ItemStore.QueryResultModifier.call(g,a);var c;if(a.expression.nodeType===$data.Expressions.ExpressionType.Single||
a.expression.nodeType===$data.Expressions.ExpressionType.Count||a.expression.nodeType===$data.Expressions.ExpressionType.BatchDelete||a.expression.nodeType===$data.Expressions.ExpressionType.Some||a.expression.nodeType===$data.Expressions.ExpressionType.Every){if(a.result.length!==1){b.error(new Exception("result count failed"));return}c=a.result[0]}else if(a.expression.nodeType===$data.Expressions.ExpressionType.First){if(a.result.length===0){b.error(new Exception("result count failed"));return}c=
a.result[0]}else{if(typeof a.__count==="number"&&a.result)a.result.totalCount=a.__count;g.storageProvider._buildContinuationFunction(g,a);c=a.result}var d=function(){g._applyTransaction(b,b.success,[c],a.transaction,e)},f=0,k=a.getEntitySets(),t=function(){var b=k[f];if(b.afterRead){f++;b=b.afterRead.call(this,c,k,a);typeof b==="function"?b.call(this,f<k.length?t:d,c,k,a):f<k.length?t():d()}else d()};k.length?t():d()},error:function(){e?b.error.apply(this,arguments):b.error.apply(this,Array.prototype.filter.call(arguments,
function(a){return!(a instanceof $data.Transaction)}))}},k=d.getEntitySets(),a=function(){var a=true,b=function(b){b===false&&(a=false);if(a)d.transaction?g.storageProvider.executeQuery(d,f):g.beginTransaction(function(a){d.transaction=a;g.storageProvider.executeQuery(d,f)});else{d.rawDataList=[];d.result=[];f.success(d)}},c=0,e=function(f){f===false&&(a=false);f=k[c];if(f.beforeRead){c++;f=f.beforeRead.call(this,k,d);if(typeof f==="function")f.call(this,c<k.length&&a?e:b,k,d);else{f===false&&(a=
false);c<k.length&&a?e():b()}}else b()};k.length?e():b()};this.user&&this.checkPermission?this.checkPermission(d.expression.nodeType===$data.Expressions.ExpressionType.BatchDelete?$data.Access.DeleteBatch:$data.Access.Read,this.user,k,{success:a,error:f.error}):a()},saveChanges:function(a,b){for(var c=[],d=this.stateManager.trackedEntities,e=new $data.PromiseHandler,g=e.createCallback(a),e=e.getPromise(),f=this._isReturnTransaction(b),k=[];d.length>0;){for(var j=[],m=0;m<d.length;m++){var q=d[m],
y=this._storageModel.getStorageModel(q.data.getType());if(q.data.entityState==$data.EntityState.Unchanged){q.skipSave=true;k.push(q.data)}else if(q.data.entityState==$data.EntityState.Modified&&q.data.changedProperties&&!q.data.changedProperties.some(function(a){a=y.PhysicalType.memberDefinitions.getMember(a.name);if(a.kind==$data.MemberTypes.navProperty){a=y.Associations[a.association];a=a.FromMultiplicity+a.ToMultiplicity;return a=="*0..1"||a=="0..11"}return true})){q.skipSave=true;k.push(q.data)}this.processEntityTypeBeforeEventHandler(k,
q);for(var o=[],t=y.PhysicalType.memberDefinitions.asArray(),s=0;s<t.length;s++){var i=t[s];i.kind==$data.MemberTypes.navProperty&&o.push(i)}for(t=0;t<o.length;t++)for(var T=o[t],s=y.Associations[T.name],i=s.ToPropertyName,T=[].concat(q.data[T.name]),G=0;G<T.length;G++){var x=T[G];if(x){var F=x[i],E=s.FromMultiplicity+s.ToMultiplicity;if(s.FromMultiplicity==="$$unbound")if(x instanceof $data.Array){q.dependentOn=q.dependentOn||[];for(F=0;F<x.length;F++)q.dependentOn.indexOf(x)<0&&x.skipSave!==true&&
q.dependentOn.push(x)}else{q.dependentOn=q.dependentOn||[];q.dependentOn.indexOf(x)<0&&x.skipSave!==true&&q.dependentOn.push(x)}else{switch(E){case "*0..1":if(F)if(F instanceof Array){if(F.indexOf(q.data)==-1){F.push(q.data);x[i]=F}}else typeof intellisense==="undefined"&&Guard.raise("Item must be array or subtype of array");else x[i]=[q.data];break;default:F?F!==q.data&&typeof intellisense==="undefined"&&Guard.raise("Integrity check error! Item assigned to another entity!"):x[i]=q.data}switch(E){case "*0..1":case "0..11":q.dependentOn=
q.dependentOn||[];q.dependentOn.indexOf(x)<0&&x.skipSave!==true&&q.dependentOn.push(x)}}if(!x.entityState)x.entityState=$data.EntityState.Added;j.indexOf(x)==-1&&j.push(x)}}}for(m=0;m<d.length;m++){q=d[m];q.skipSave!==true&&c.push(q)}d=[];for(m=0;m<j.length;m++){var u=j[m];k.some(function(a){return a==u})||c.some(function(a){return a.data==u})||d.push({data:u,entitySet:this.getEntitySetFromElementType(u.getType().name)})}}for(t=0;t<c.length;t++){d=c[t];if(d.dependentOn){j=[];for(m=0;m<d.dependentOn.length;m++)k.indexOf(d.dependentOn[m])<
0&&j.push(d.dependentOn[m]);d.dependentOn=j}}var k=null,J=this;if(c.length==0){this.stateManager.trackedEntities.length=0;J._applyTransaction(g,g.success,[0],b,f);return e}k=[];for(m=0;m<c.length;m++){q=c[m];if(q.data.entityState===$data.EntityState.Added)for(t=0;t<q.data.getType().memberDefinitions.getPublicMappedProperties().length;t++){d=q.data.getType().memberDefinitions.getPublicMappedProperties()[t];j=Container.resolveType(d.type);if(d.required&&!d.computed&&!q.data[d.name])switch(j){case $data.String:case $data.Number:case $data.Integer:case $data.Date:case $data.Boolean:q.data[d.name]=
Container.getDefault(d.dataType)}}(q.data.entityState===$data.EntityState.Added||q.data.entityState===$data.EntityState.Modified)&&!q.data.isValid()&&k.push({item:q.data,errors:q.data.ValidationErrors})}if(k.length>0){g.error(k);return e}for(var k=$data.Access.None,v={},t=[],m=0;m<c.length;m++){d=c[m];j=d.entitySet.elementType.name;t.push(d.entitySet.name);q=this._entitySetReferences[j];if(q.beforeCreate||q.beforeUpdate||q.beforeDelete||this.user&&this.checkPermission){v[j]||(v[j]={});switch(d.data.entityState){case $data.EntityState.Added:k=
k|$data.Access.Create;if(q.beforeCreate){if(!v[j].createAll)v[j].createAll=[];v[j].createAll.push(d)}break;case $data.EntityState.Modified:k=k|$data.Access.Update;if(q.beforeUpdate){if(!v[j].modifyAll)v[j].modifyAll=[];v[j].modifyAll.push(d)}break;case $data.EntityState.Deleted:k=k|$data.Access.Delete;if(q.beforeDelete){if(!v[j].deleteAll)v[j].deleteAll=[];v[j].deleteAll.push(d)}}}}var C=function(a){if(a===false){B="async";c.length=0}if(c.length){var d={success:function(a){J._postProcessSavedItems(g,
c,a,f)},error:function(){f?g.error.apply(this,arguments):g.error.apply(this,Array.prototype.filter.call(arguments,function(a){return!(a instanceof $data.Transaction)}))}};b instanceof $data.Transaction?J.storageProvider.saveChanges(d,c,b):J.beginTransaction(true,function(a){J.storageProvider.saveChanges(d,c,a)})}else B?g.error(new Exception("Cancelled event in "+B,"CancelEvent")):J._applyTransaction(g,g.success,[0],b,f)},B,D=Object.getOwnPropertyNames(v),m=0,O=["beforeUpdate","beforeDelete","beforeCreate"],
ja={beforeCreate:"createAll",beforeDelete:"deleteAll",beforeUpdate:"modifyAll"},P=function(a){if(a===false){B="async";c.length=0;C(a)}else{var b=J._entitySetReferences[D[m]],d=O.pop();if(a=v[D[m]][ja[d]]){for(var e=[],f=0;f<a.length;f++)e.push(a[f].data);if(!O.length){O=["beforeUpdate","beforeDelete","beforeCreate"];m++}f=b[d].call(J,e);if(typeof f==="function")f.call(J,m<D.length&&!B?P:C,e);else if(f===false){B=b.name+"."+d;for(b=0;b<a.length;b++){d=c.indexOf(a[b]);c.splice(d,1)}C()}else m<D.length&&
!B?P():C()}else{if(!O.length){O=["beforeUpdate","beforeDelete","beforeCreate"];m++}m<D.length&&!B?P():C()}}};this.user&&this.checkPermission?this.checkPermission(k,this.user,t,{success:function(){m<D.length?P():C()},error:g.error}):m<D.length?P():C();return e},processEntityTypeBeforeEventHandler:function(a,b){if(!b.skipSave){var c=b.data,d=c.getType(),e=c.entityState;switch(true){case e===$data.EntityState.Added&&d.onbeforeCreate instanceof $data.Event:if(d.onbeforeCreate.fireCancelAble(c)===false){b.skipSave=
true;a.push(c)}break;case e===$data.EntityState.Modified&&d.onbeforeUpdate instanceof $data.Event:if(d.onbeforeUpdate.fireCancelAble(c)===false){b.skipSave=true;a.push(c)}break;case e===$data.EntityState.Deleted&&d.onbeforeDelete instanceof $data.Event:if(d.onbeforeDelete.fireCancelAble(c)===false){b.skipSave=true;a.push(c)}}}},processEntityTypeAfterEventHandler:function(a){var a=a.data,b=a.getType(),c=a.entityState;switch(true){case c===$data.EntityState.Added&&b.onafterCreate instanceof $data.Event:b.onafterCreate.fire(a);
break;case c===$data.EntityState.Modified&&b.onafterUpdate instanceof $data.Event:b.onafterUpdate.fire(a);break;case c===$data.EntityState.Deleted&&b.onafterDelete instanceof $data.Event:b.onafterDelete.fire(a)}},prepareRequest:function(){},_postProcessSavedItems:function(a,b,c,d){this.ChangeCollector&&this.ChangeCollector instanceof $data.Notifications.ChangeCollectorBase&&this.ChangeCollector.processChangedData(b);for(var e={},g=this,f=0;f<b.length;f++){var k=b[f];this.processEntityTypeAfterEventHandler(k);
var j=k.data.entityState;k.data.entityState=$data.EntityState.Unchanged;k.data.changedProperties=[];k.physicalData=void 0;var m=k.entitySet.elementType.name,q=g._entitySetReferences[m],y=void 0;switch(j){case $data.EntityState.Added:y="added";break;case $data.EntityState.Deleted:y="deleted";break;case $data.EntityState.Modified:y="updated"}y&&this.raiseEvent(y,k);if(q.afterCreate||q.afterUpdate||q.afterDelete){e[m]||(e[m]={});switch(j){case $data.EntityState.Added:if(q.afterCreate){if(!e[m].createAll)e[m].createAll=
[];e[m].createAll.push(k)}break;case $data.EntityState.Modified:if(q.afterUpdate){if(!e[m].modifyAll)e[m].modifyAll=[];e[m].modifyAll.push(k)}break;case $data.EntityState.Deleted:if(q.afterDelete){if(!e[m].deleteAll)e[m].deleteAll=[];e[m].deleteAll.push(k)}}}}var o=Object.getOwnPropertyNames(e),f=0,g=this,t=["afterUpdate","afterDelete","afterCreate"],s={afterCreate:"createAll",afterDelete:"deleteAll",afterUpdate:"modifyAll"},i=function(){g.trackChanges||g.stateManager.reset();g._applyTransaction(a,
a.success,[b.length],c,d)},T=function(){var a=g._entitySetReferences[o[f]],b=t.pop(),c=e[o[f]][s[b]];if(c){for(var d=[],j=0;j<c.length;j++)d.push(c[j].data);if(!t.length){t=["afterUpdate","afterDelete","afterCreate"];f++}a=a[b].call(g,d);typeof a==="function"?a.call(g,f<o.length?T:i,d):f<o.length?T():i()}else{if(!t.length){t=["afterUpdate","afterDelete","afterCreate"];f++}f<o.length?T():i()}};f<o.length?T():i()},forEachEntitySet:function(a,b){for(var c in this._entitySetReferences)a.call(b,this._entitySetReferences[c])},
loadItemProperty:function(a,b,c,d){Guard.requireType("entity",a,$data.Entity);var b=typeof b==="string"?a.getType().memberDefinitions.getMember(b):b,e=this._isReturnTransaction(d);if(a[b.name]!=void 0){var g=new $data.PromiseHandler;callBack=g.createCallback(c);this._applyTransaction(c,c.success,[a[b.name]],d,e);return g.getPromise()}var f=true,k=this._storageModel.getStorageModel(a.getType().fullName),e=Container.resolveType(b.dataType);if(e===$data.Array||e.isAssignableTo&&e.isAssignableTo($data.EntitySet)){e=
Container.resolveType(b.elementType);f=false}else{for(var j=0;j<k.Associations.length;j++){var m=k.Associations[j];if(m.FromPropertyName==b.name){g=m;break}}g&&g.FromMultiplicity==="0..1"&&g.ToMultiplicity==="1"&&(f=false)}g=k.LogicalType.memberDefinitions.getKeyProperties();if(f===true){f="function (e) { return";k={};for(j=0;j<g.length;j++){m=g[j];j>0&&(f=f+" &&");f=f+(" e."+m.name+" == this.key"+j);k["key"+j]=a[m.name]}f=f+"; }";a=this.getEntitySetFromElementType(a.getType());return a.map("function (e) { return e."+
b.name+" }").single(f,k,c,d)}f="function (e) { return";k={};for(j=0;j<g.length;j++){m=g[j];j>0&&(f=f+" &&");f=f+(" e."+b.inverseProperty+"."+m.name+" == this.key"+j);k["key"+j]=a[m.name]}f=f+"; }";a=this.getEntitySetFromElementType(e);return a.filter(f,k).toArray(c,d)},getTraceString:function(a){return this.storageProvider.getTraceString(new $data.Query(a.expression,a.defaultType,this))},log:function(){},resolveBinaryOperator:function(a,b,c){return this.storageProvider.resolveBinaryOperator(a,b,c)},
resolveUnaryOperator:function(a,b,c){return this.storageProvider.resolveUnaryOperator(a,b,c)},resolveFieldOperation:function(a,b,c){return this.storageProvider.resolveFieldOperation(a,b,c)},resolveSetOperations:function(a,b,c){return this.storageProvider.resolveSetOperations(a,b,c)},resolveTypeOperations:function(a,b,c){return this.storageProvider.resolveTypeOperations(a,b,c)},resolveContextOperations:function(a,b,c){return this.storageProvider.resolveContextOperations(a,b,c)},_generateServiceOperationQueryable:function(a,
b,c,d){typeof console!=="undefined"&&console.log&&console.log("Obsolate: _generateServiceOperationQueryable, $data.EntityContext");for(var e=[],g=0;g<d.length;g++){var f={};f[d[g]]=Container.resolveType(Container.getTypeName(c[g]));e.push(f)}return $data.EntityContext.generateServiceOperation({serviceName:a,returnType:$data.Queryable,elementType:this[b].elementType,params:e}).apply(this,c)},attach:function(a,b){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).attach(a,
b)},attachOrGet:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).attachOrGet(a)},addMany:function(a){var b=this;a.forEach(function(a){b.add(a)});return a},add:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).add(a)},remove:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).remove(a)},storeToken:{type:Object}},
{generateServiceOperation:function(a){var b;if(a.serviceMethod){b=a.returnType?Container.resolveType(a.returnType):{};b=b.isAssignableTo&&b.isAssignableTo($data.Queryable)?a.serviceMethod:function(){var b=arguments[arguments.length-1],c=new $data.PromiseHandler;if(typeof b==="function"){b=c.createCallback(b);arguments[arguments.length-1]=b}else{b=c.createCallback();arguments.push(b)}try{var d=a.serviceMethod.apply(this,arguments);d!==void 0&&b.success(d)}catch(e){b.error(e)}return c.getPromise()}}else b=
function(){var b=this,c;if(this instanceof $data.Entity){if(this.context)b=this.context;else{Guard.raise("entity not attached into context");return}c={data:this,entitySet:b.getEntitySetFromElementType(this.getType())}}var d=a.elementType?b.getEntitySetFromElementType(Container.resolveType(a.elementType)):null,e=null;if(a.params)for(var e=[],g=0;g<a.params.length;g++)for(var y in a.params[g])e.push(Container.createConstantExpression(arguments[g],Container.resolveType(a.params[g][y]),y));g=Container.createEntityContextExpression(b);
y=(c?c.data:b).getType().getMemberDefinition(a.serviceName);c=Container.createServiceOperationExpression(g,Container.createMemberInfoExpression(y),e,a,c);e=arguments[arguments.length-1];typeof e!=="function"&&(e=void 0);if(d){b=Container.createQueryable(d,c);if(e){c.isTerminated=true;return b._runQuery(e)}return b}d=a.returnType?Container.resolveType(a.returnType):null;b=Container.createQueryable(b,c);b.defaultType=d||$data.Object;if(d===$data.Queryable){b.defaultType=Container.resolveType(a.elementType);
if(e){c.isTerminated=true;return b._runQuery(e)}return b}c.isTerminated=true;return b._runQuery(e)};var c=[];if(a.params)for(var d=0;d<a.params.length;d++){var e=a.params[d],g;for(g in e)c.push({name:g,type:e[g]})}$data.typeSystem.extend(b,a,{params:c});return b},_convertLogicalTypeNameToPhysical:function(a){return a+"_$db$"},_storageModelCache:{get:function(){if(!this.__storageModelCache)this.__storageModelCache={};return this.__storageModelCache},set:function(){}}});
$data.Class.define("$data.QueryProvider",null,null,{constructor:function(){this.requiresExpressions=false},executeQuery:function(){},getTraceString:function(){}},null);
$data.Class.define("$data.ModelBinder",null,null,{constructor:function(a){this.context=a;this.providerName=null;if(this.context.storageProvider&&typeof this.context.storageProvider.getType==="function"){this.references=!this.context.storageProvider.providerConfiguration.modelBinderOptimization;for(var b in $data.RegisteredStorageProviders)if($data.RegisteredStorageProviders[b]===this.context.storageProvider.getType())this.providerName=b}},_deepExtend:function(a,b){if(a===null||a===void 0)return b;
for(var c in b)if(a.hasOwnProperty(c)){if(typeof b[c]==="object")if(Array.isArray(b[c]))for(var d=0;d<b[c].length;d++)a[c].indexOf(b[c][d])<0&&a[c].push(b[c][d]);else this._deepExtend(a[c],b[c])}else a[c]=b[c];if(a instanceof $data.Entity)a.changedProperties=void 0;return a},_buildSelector:function(a,b){if(a.$selector){if(!Array.isArray(a.$selector))a.$selector=[a.$selector];for(var c=0;c<a.$selector.length;c++){var d=a.$selector[c].replace("json:","");b.src=b.src+"if(";for(var e=d.split("."),g=0;g<
e.length;g++)b.src=b.src+("di."+e.slice(0,g+1).join(".")+(g<e.length-1?" && ":" !== undefined && typeof di."+d+' === "object"'));b.src=b.src+("){di = di."+d+";}"+(c<a.$selector.length-1?"else ":""))}b.src=b.src+"if (di === null){";if(b.iter)b.src=b.src+(b.iter+" = null;");b.src=b.src+"return null;";b.src=b.src+"}"}},_buildKey:function(a,b,c,d,e){if(c){b=Container.resolveType(b);b=b.fullName||b.name;d.src=d.src+("var "+a+"Fn = function(di){");if(!Array.isArray(c)||c.length==1){typeof c!=="string"&&
(c=c[0]);d.src=d.src+("if (typeof di."+c+' === "undefined") return undefined;');d.src=d.src+("if (di."+c+" === null) return null;");d.src=d.src+('var key = ("'+b+"_"+c+'#" + di.'+c+");")}else{d.src=d.src+'var key = "";';for(var g=0;g<c.length;g++){var f=typeof c[g]!=="object"?c[g]:c[g].$source;d.src=d.src+("if (typeof di."+f+' === "undefined") return undefined;');d.src=d.src+("if (di."+f+" === null) return null;");d.src=d.src+('key += ("'+b+"_"+f+'#" + di.'+f+");")}}d.src=d.src+"return key;};"}d.src=
d.src+("var "+a+" = "+(c?a+"Fn("+(e||"di")+")":"undefined")+";")},build:function(a,b){if(a.$selector){if(!Array.isArray(a.$selector))a.$selector=[a.$selector];for(var c=0;c<a.$selector.length;c++)a.$selector[c]=a.$selector[c].replace("json:","")}if(a.$value)if(typeof a.$value==="function"){b.src=b.src+("var fn = function(){ return meta"+(b.meta.length?"."+b.meta.join("."):"")+".$value.call(self, meta"+(b.meta.length?"."+b.meta.join("."):"")+", di); };");b.item="fn()"}else if(a.$type){var d=Container.resolveName(Container.resolveType(a.$type)),
e=this.context.storageProvider.fieldConverter.fromDb[d];b.item=e?'self.context.storageProvider.fieldConverter.fromDb["'+d+'"]('+a.$value+")":"new "+d+"("+a.$value+")"}else b.item=a.$value;else if(a.$source){var d=Container.resolveName(Container.resolveType(a.$type)),e=this.context.storageProvider.fieldConverter.fromDb[d],g="_"+d.replace(/\./gi,"_")+"_";if(!b.forEach)b.src=b.src+"var di = data;";b.item=g;this._buildSelector(a,b);b.src=e?b.src+("var "+g+' = self.context.storageProvider.fieldConverter.fromDb["'+
d+'"](di.'+a.$source+");"):b.src+("var "+g+" = new "+d+"(di."+a.$source+");")}else if(a.$item){b.meta.push("$item");c=b.item&&b.current?b.item+"."+b.current:b.item?b.item:"result";if(c.indexOf(".")<0)b.src=b.src+("var "+c+";");b.src=b.src+"var fn = function(di){";if(a.$selector){b.src=b.src+'if (typeof di !== "undefined" && !(Array.isArray(di))){';this._buildSelector(a,b);b.src=b.src+"}"}this.references&&a.$keys&&this._buildKey("forKey",a.$type,a.$keys,b);b.src=b.src+(c+" = typeof "+c+' == "undefined" ? [] : '+
c+";");b.iter=c;if(this.references&&a.$item.$keys){g="keycache_"+c.replace(/\./gi,"_");b.src=b.src+("var "+g+";");b.src=b.src+("var kci = keycacheIter.indexOf("+c+");");b.src=b.src+"if (kci < 0){";b.src=b.src+(g+" = [];");b.src=b.src+("keycache.push("+g+");");b.src=b.src+("keycacheIter.push("+c+");");b.src=b.src+"}else{";b.src=b.src+(g+" = keycache[kci];");b.src=b.src+"}"}b.iter=void 0;b.forEach=true;d="itemForKey_"+c.replace(/\./gi,"_");b.src=b.src+"var forEachFn = function(di, i){";b.src=b.src+
"var diBackup = di;";this.providerName=="sqLite"&&this.references&&a.$item.$keys&&this._buildKey(d,a.$type,a.$item.$keys,b);g=b.item||"iter";b.item=g;a.$item.$source||this._buildSelector(a.$item,b);this.build(a.$item,b);if(this.references&&a.$keys){b.src=b.src+"if (forKey){";b.src=b.src+"if (cache[forKey]){";b.src=b.src+(c+" = cache[forKey];");b.src=b.src+("if ("+c+".indexOf("+(b.item||g)+") < 0){");b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+"}}else{";b.src=b.src+("cache[forKey] = "+c+
";");b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+"}}else{";this.references&&a.$item.$keys&&this._buildKey("cacheKey",a.$type,a.$item.$keys,b,"diBackup");b.src=b.src+'if (typeof cacheKey != "undefined" && cacheKey !== null){';b.src=b.src+("if (keycache_"+c.replace(/\./gi,"_")+" && cacheKey){");b.src=b.src+("if (keycache_"+c.replace(/\./gi,"_")+".indexOf(cacheKey) < 0){");b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+("keycache_"+c.replace(/\./gi,"_")+".push(cacheKey);");b.src=b.src+
"}";b.src=b.src+"}else{";b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+"}";b.src=b.src+"}";b.src=b.src+"}"}else if(this.references&&a.$item.$keys){b.src=b.src+("if (typeof "+d+' !== "undefined" && '+d+" !== null){");b.src=b.src+("if (typeof keycache_"+c.replace(/\./gi,"_")+' !== "undefined" && '+d+"){");b.src=b.src+("if (keycache_"+c.replace(/\./gi,"_")+".indexOf("+d+") < 0){");b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+("keycache_"+c.replace(/\./gi,"_")+".push("+d+");");b.src=
b.src+"}}else{";b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+"}}else{";b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+"}"}else b.src=b.src+(c+".push("+(b.item||g)+");");b.src=b.src+"};";b.src=b.src+"if (Array.isArray(di)) di.forEach(forEachFn);";b.src=b.src+"else forEachFn(di, 0);";b.forEach=false;b.item=null;b.src=b.src+'};fn(typeof di === "undefined" ? data : di);';b.meta.pop()}else if(a.$type){if(!b.forEach){b.src=b.src+'if (typeof di === "undefined"){';b.src=b.src+"var di = data;";
this._buildSelector(a,b);b.src=b.src+"}"}var f=Container.resolveType(a.$type),d=Container.resolveName(f),e=f.isAssignableTo&&f.isAssignableTo($data.Entity),g="_"+d.replace(/\./gi,"_")+"_";b.item==g&&(g=g+"new_");b.item=g;var k=false;!a.$source&&!a.$value&&f!==$data.Array&&f!==$data.Object&&!f.isAssignableTo&&(k=true);if(f===$data.Object||f===$data.Array){f=Object.keys(a);if(f.length==1||f.length==2&&a.$selector)k=true}if(k){e=this.context.storageProvider.fieldConverter.fromDb[d];b.src=e?b.src+("var "+
g+' = di != undefined ? self.context.storageProvider.fieldConverter.fromDb["'+d+'"](di) : di;'):b.src+("var "+g+" = di;")}else if(this.references&&a.$keys){this._buildKey("itemKey",a.$type,a.$keys,b);b.src=b.src+"if (itemKey === null) return null;";b.src=b.src+("var "+g+";");b.src=b.src+"if (itemKey && cache[itemKey]){";b.src=b.src+(g+" = cache[itemKey];");b.src=b.src+"}else{";b.src=e?b.src+(g+" = new "+d+"(undefined, { setDefaultValues: false });"):b.src+(g+" = new "+d+"();");b.src=b.src+"if (itemKey){";
b.src=b.src+("cache[itemKey] = "+g+";");b.src=b.src+"}";b.src=b.src+"}"}else b.src=e?b.src+("var "+g+" = new "+d+"(undefined, { setDefaultValues: false });"):b.src+("var "+g+" = new "+d+"();");for(c in a)if(c.indexOf("$")<0){b.current=c;if(a[c].$item){b.meta.push(c);this.build(a[c],b);b.item=g;b.meta.pop()}else if(a[c].$value){b.meta.push(c);g=b.item;this.build(a[c],b);b.src=b.src+(g+"."+c+" = "+b.item+";");b.item=g;b.meta.pop()}else if(a[c].$source){b.src=b.src+"var fn = function(di){";this._buildSelector(a[c],
b);if(a[c].$type){d=Container.resolveName(Container.resolveType(a[c].$type));e=this.context.storageProvider.fieldConverter.fromDb[d];b.src=e?b.src+('return self.context.storageProvider.fieldConverter.fromDb["'+d+'"](di.'+a[c].$source+");"):b.src+("return new "+d+"(di."+a[c].$source+");")}else b.src=b.src+(g+"."+c+" = di."+a[c].$source+";");b.src=b.src+"};";b.src=a[c].$type?b.src+(g+"."+c+" = fn(di);"):b.src+"fn(di);"}else if(a[c].$type){b.meta.push(c);b.src=b.src+"var fn = function(di){";this._buildSelector(a[c],
b);this.build(a[c],b);b.src=b.src+("return "+b.item+";};");b.src=a[c].$type===$data.Object?b.src+(g+"."+c+" = self._deepExtend("+g+"."+c+", fn(di));"):b.src+(g+"."+c+" = fn(di);");b.item=g;b.meta.pop()}else if(a.$type){k=Container.resolveType(a.$type).memberDefinitions.getMember(c);d=Container.resolveName(k.type);f=Container.resolveName(Container.resolveType(a.$type));e=this.context.storageProvider.fieldConverter.fromDb[d];if(this.providerName&&k&&k.converter&&k.converter[this.providerName]&&typeof k.converter[this.providerName].fromDb==
"function")b.src=b.src+(g+"."+c+' = Container.resolveType("'+f+'").memberDefinitions.getMember("'+c+'").converter.'+this.providerName+".fromDb(di."+a[c]+', Container.resolveType("'+f+'").memberDefinitions.getMember("'+c+'"), self.context, Container.resolveType("'+f+'"));');else if(e)b.src=b.src+(g+"."+c+' = self.context.storageProvider.fieldConverter.fromDb["'+d+'"](di.'+a[c]+");");else{d=Container.resolveName(Container.resolveType(d.memberDefinitions.getMember(c).type));b.src=b.src+(g+"."+c+" = new "+
d+"(di."+a[c]+");")}}}b.src=b.src+("if ("+g+" instanceof $data.Entity){"+g+".changedProperties = undefined;}")}},call:function(a,b){if(!Object.getOwnPropertyNames(b).length)return a;var c={src:"",meta:[]};c.src=c.src+"var self = this;";c.src=c.src+"var result;";c.src=c.src+"var cache = {};";c.src=c.src+"var keycache = [];";c.src=c.src+"var keycacheIter = [];";this.build(b,c);if(c.item)c.src=c.src+("if (!result) result = "+c.item+";");c.src=c.src+"return result;";return(new Function("meta","data",
c.src)).bind(this)(b,a)}});
$C("$data.queryBuilder",null,null,{constructor:function(){this._fragments={};this.selectedFragment=null;this.modelBinderConfig=this._binderConfig={};this._binderConfigPropertyStack=[]},selectTextPart:function(a){this._fragments[a]||(this._fragments[a]={text:"",params:[]});this.selectedFragment=this._fragments[a]},getTextPart:function(a){return this._fragments[a]},addText:function(a){this.selectedFragment.text=this.selectedFragment.text+a},addParameter:function(a){this.selectedFragment.params.push(a)},selectModelBinderProperty:function(a){this._binderConfigPropertyStack.push(this.modelBinderConfig);
a in this.modelBinderConfig||(this.modelBinderConfig[a]={});this.modelBinderConfig=this.modelBinderConfig[a]},popModelBinderProperty:function(){this.modelBinderConfig=this._binderConfigPropertyStack.length===0?this._binderConfig():this._binderConfigPropertyStack.pop()},resetModelBinderProperty:function(){this._binderConfigPropertyStack=[];this.modelBinderConfig=this._binderConfig},addKeyField:function(a){this.modelBinderConfig.$keys||(this.modelBinderConfig.$keys=[]);this.modelBinderConfig.$keys.push(a)}});
$C("$data.Query",null,null,{constructor:function(a,b,c){this.expression=a;this.context=c;this.expressions=a;this.defaultType=b;this.result=[];this.rawDataList=[];this.modelBinderConfig={};this.context=c},rawDataList:{dataType:"Array"},result:{dataType:"Array"},resultType:{},buildResultSet:function(){this.result=(new $data.ModelBinder(this.context)).call(this.rawDataList,this.modelBinderConfig)},getEntitySets:function(){var a=[],b=this.context,c=function(d){d instanceof $data.Expressions.EntitySetExpression&&
a.indexOf(b._entitySetReferences[d.elementType.name])<0&&a.push(b._entitySetReferences[d.elementType.name]);d.source&&c(d.source)};c(this.expression);return a}},null);
$data.Class.define("$data.Queryable",null,null,{constructor:function(a,b){var c=a instanceof $data.EntityContext?a:a.entityContext;this.defaultType=a instanceof $data.EntityContext?null:a.defaultType;this.entityContext=c;this.expression=b},filter:function(a,b){this._checkOperation("filter");var c=Container.createCodeExpression(a,b),d=this.expression;if(this.expression instanceof $data.Expressions.FilterExpression)var d=this.expression.source,e=this.entityContext.storageProvider.resolveBinaryOperator("and"),
c=Container.createSimpleBinaryExpression(this.expression.selector,c,"and","filter","boolean",e);c=Container.createFilterExpression(d,c);return Container.createQueryable(this,c)},where:function(a,b){return this.filter(a,b)},map:function(a,b,c){this._checkOperation("map");a=Container.createCodeExpression(a,b);a=Container.createProjectionExpression(this.expression,a);a.projectionAs=c==="default"?this.defaultType:c?Container.resolveType(c):$data.Object;return Container.createQueryable(this,a)},select:function(a,
b,c){return this.map(a,b,c)},length:function(a,b){this._checkOperation("length");var c=new $data.PromiseHandler,d=c.createCallback(a),e=Container.createCountExpression(this.expression),g=Container.createQueryExpressionCreator(this.entityContext);try{var f=g.Visit(e);this.entityContext.log({event:"EntityExpression",data:f});this.entityContext.executeQuery(Container.createQueryable(this,f),d,b)}catch(k){d.error(k)}return c.getPromise()},count:function(a,b){return this.length(a,b)},forEach:function(a,
b){this._checkOperation("forEach");var c=new $data.PromiseHandler,d=c.createCallback(function(b){b.forEach(a)}),e=Container.createForEachExpression(this.expression),g=Container.createQueryExpressionCreator(this.entityContext);try{var f=g.Visit(e);this.entityContext.log({event:"EntityExpression",data:f});this.entityContext.executeQuery(Container.createQueryable(this,f),d,b)}catch(k){d.error(k)}return c.getPromise()},toArray:function(a,b){if(a instanceof $data.Array)return this.toArray(function(b){a.length=
0;b.forEach(function(b){a.push(b)})});this._checkOperation("toArray");var c=new $data.PromiseHandler,d=c.createCallback(a),e=Container.createToArrayExpression(this.expression),g=Container.createQueryExpressionCreator(this.entityContext);try{var f=g.Visit(e);this.entityContext.log({event:"EntityExpression",data:f});this.entityContext.executeQuery(Container.createQueryable(this,f),d,b)}catch(k){d.error(k)}return c.getPromise()},single:function(a,b,c,d){this._checkOperation("single");var e=this;a&&(e=
this.filter(a,b));var e=e.take(2),a=new $data.PromiseHandler,c=a.createCallback(c),b=Container.createSingleExpression(e.expression),g=Container.createQueryExpressionCreator(e.entityContext);try{var f=g.Visit(b);this.entityContext.log({event:"EntityExpression",data:f});e.entityContext.executeQuery(Container.createQueryable(e,f),c,d)}catch(k){c.error(k)}return a.getPromise()},some:function(a,b,c,d){this._checkOperation("some");var e=this;a&&(e=this.filter(a,b));var e=e.take(1),a=new $data.PromiseHandler,
c=a.createCallback(c),b=Container.createSomeExpression(e.expression),g=Container.createQueryExpressionCreator(e.entityContext);try{var f=g.Visit(b);this.entityContext.log({event:"EntityExpression",data:f});e.entityContext.executeQuery(Container.createQueryable(e,f),c,d)}catch(k){c.error(k)}return a.getPromise()},every:function(a,b,c,d){this._checkOperation("every");var e=this;a&&(e=this.filter(a,b));var e=e.take(1),a=new $data.PromiseHandler,c=a.createCallback(c),b=Container.createEveryExpression(e.expression),
g=Container.createQueryExpressionCreator(e.entityContext);try{var f=g.Visit(b);this.entityContext.log({event:"EntityExpression",data:f});e.entityContext.executeQuery(Container.createQueryable(e,f),c,d)}catch(k){c.error(k)}return a.getPromise()},take:function(a){this._checkOperation("take");a=Container.createConstantExpression(a,"number");a=Container.createPagingExpression(this.expression,a,$data.Expressions.ExpressionType.Take);return Container.createQueryable(this,a)},skip:function(a){this._checkOperation("skip");
a=Container.createConstantExpression(a,"number");a=Container.createPagingExpression(this.expression,a,$data.Expressions.ExpressionType.Skip);return Container.createQueryable(this,a)},order:function(a){return a===""||a===void 0||a===null?this:a[0]==="-"?this.orderByDescending("it."+a.replace("-","")):this.orderBy("it."+a)},orderBy:function(a,b){this._checkOperation("orderBy");var c=Container.createCodeExpression(a,b),c=Container.createOrderExpression(this.expression,c,$data.Expressions.ExpressionType.OrderBy);
return Container.createQueryable(this,c)},orderByDescending:function(a,b){this._checkOperation("orderByDescending");var c=Container.createCodeExpression(a,b),c=Container.createOrderExpression(this.expression,c,$data.Expressions.ExpressionType.OrderByDescending);return Container.createQueryable(this,c)},first:function(a,b,c,d){this._checkOperation("first");var e=this;a&&(e=this.filter(a,b));var e=e.take(1),a=new $data.PromiseHandler,c=a.createCallback(c),b=Container.createFirstExpression(e.expression),
g=Container.createQueryExpressionCreator(e.entityContext);try{var f=g.Visit(b);e.entityContext.log({event:"EntityExpression",data:f});e.entityContext.executeQuery(Container.createQueryable(e,f),c,d)}catch(k){c.error(k)}return a.getPromise()},include:function(a){this._checkOperation("include");a=Container.createConstantExpression(a,"string");a=Container.createIncludeExpression(this.expression,a);return Container.createQueryable(this,a)},withInlineCount:function(a){this._checkOperation("withInlineCount");
a=Container.createConstantExpression(a||"allpages","string");a=Container.createInlineCountExpression(this.expression,a);return Container.createQueryable(this,a)},removeAll:function(a,b){this._checkOperation("batchDelete");var c=new $data.PromiseHandler,d=c.createCallback(a),e=Container.createBatchDeleteExpression(this.expression),g=Container.createQueryExpressionCreator(this.entityContext);try{var f=g.Visit(e);this.entityContext.log({event:"EntityExpression",data:f});this.entityContext.executeQuery(Container.createQueryable(this,
f),d,b)}catch(k){d.error(k)}return c.getPromise()},_runQuery:function(a,b){var c=new $data.PromiseHandler,d=c.createCallback(a),e=Container.createQueryExpressionCreator(this.entityContext);try{var g=e.Visit(this.expression);this.entityContext.log({event:"EntityExpression",data:g});this.entityContext.executeQuery(Container.createQueryable(this,g),d,b)}catch(f){d.error(f)}return c.getPromise()},toTraceString:function(a){var b=this.expression,b=a?Container["create"+a+"Expression"](b):Container.createToArrayExpression(b),
b=Container.createQueryExpressionCreator(this.entityContext).Visit(b),a=Container.createQueryable(this,b);return a.entityContext.getTraceString(a)},_checkOperation:function(a){var b=this.entityContext.resolveSetOperations(a);b.invokable!=void 0&&!b.invokable&&Guard.raise(new Exception("Operation '"+a+"' is not invokable with the provider"))},defaultType:{}},null);$data.EntitySchemaConfig=function(){this.Name=""};$data.entitySetState={created:0,defined:1,active:2};
$data.Class.defineEx("$data.EntitySet",[{type:$data.Queryable,params:[new ConstructorParameter(1)]}],null,{constructor:function(a,b,c,d,e){this.createNew=this[a.name]=this.elementType=this.defaultType=a;var g=this;b["createAdd"+a.name]=function(b){b=new a(b);return g.add(b)};this.stateManager=new $data.EntityStateManager(this);this.collectionName=c;this.roles=e;for(var f in d)this[f]=d[f]},find:function(a,b){return this.single("it."+this.defaultType.memberDefinitions.getKeyProperties()[0].name+" == this.value",
{value:a},b)},addNew:function(a,b){$data.typeSystem.createCallbackSetting(b);var c=new this.createNew(a);this.entityContext.saveChanges(b);return c},executeQuery:function(a,b){var c=$data.typeSystem.createCallbackSetting(b);this.entityContext.executeQuery(a,c)},getTraceString:function(a){return this.entityContext.getTraceString(a)},setContext:function(a){this.entitySetState=$data.entitySetState.active;this.entityContext=a;this.entityContext[this.schema.name]=this[this.schema.name]},_trackEntity:function(a){for(var b=
this.entityContext.stateManager.trackedEntities,c=0;c<b.length;c++)if(b[c].data===a)return;b.push({entitySet:this,data:a})},add:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));b.entityState=$data.EntityState.Added;b.changedProperties=void 0;b.context=this.entityContext;this._trackEntity(b);return b},addMany:function(a){var b=[],c=this;a.forEach(function(a){b.push(c.add(a))});return b},remove:function(a){var b=a;a instanceof
$data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));b.entityState=$data.EntityState.Deleted;b.changedProperties=void 0;this._trackEntity(b)},attach:function(a,b){var c=a;a instanceof $data.EntityWrapper?c=a.getEntity():a instanceof this.createNew||(c=new this.createNew(a));for(var d=0;d<this.entityContext.stateManager.trackedEntities.length;d++){var e=this.entityContext.stateManager.trackedEntities[d];if(e.data===c)break;e.data.equals(c)&&Guard.raise(new Exception("Context already contains this entity!!!"))}if(!b){c.entityState=
$data.EntityState.Unchanged;c.changedProperties=void 0}c.context=this.entityContext;this._trackEntity(c)},detach:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));for(var c,d=this.entityContext.stateManager.trackedEntities,e=0;e<d.length;e++)d[e].data.equals(b)&&(c=d[e]);if(c){b=this.entityContext.stateManager.trackedEntities.indexOf(c);a.entityState=$data.EntityState.Detached;this.entityContext.stateManager.trackedEntities.splice(b,
1)}},attachOrGet:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));for(var c,a=this.entityContext.stateManager.trackedEntities,d=0;d<a.length;d++)a[d].data.equals(b)&&(c=a[d]);if(c)return c.data;b.entityState=$data.EntityState.Unchanged;b.changedProperties=void 0;b.context=this.entityContext;this._trackEntity(b);return b},loadItemProperty:function(a,b,c){return this.entityContext.loadItemProperty(a,b,c)},saveChanges:function(){return this.entityContext.saveChanges.apply(this.entityContext,
arguments)},addProperty:function(a,b,c){return this.elementType.addProperty.apply(this.elementType,arguments)},expression:{get:function(){if(!this._expression){var a=Container.createEntityContextExpression(this.entityContext),b=this.entityContext.getType().getMemberDefinition(this.collectionName);this._expression=Container.createEntitySetExpression(a,Container.createMemberInfoExpression(b),null,this)}return this._expression},set:function(a){this._expression=a}}},null);
$data.EntityState={Detached:0,Unchanged:10,Added:20,Modified:30,Deleted:40};$data.Class.define("$data.EntityStateManager",null,null,{constructor:function(a){this.entityContext=null;this.trackedEntities=[];this.init(a)},init:function(a){this.entityContext=a},reset:function(){this.trackedEntities=[]}},null);
$data.Class.define("$data.ItemStoreClass",null,null,{constructor:function(){var a=this;a.itemStoreConfig={aliases:{},contextTypes:{}};a.resetStoreToDefault("local",true);$data.addStore=function(){return a.addItemStoreAlias.apply(a,arguments)};$data.implementation=a.implementation;$data.Entity.addMember("storeToken",{get:function(){if(this.storeConfigs&&this.storeConfigs["default"])return this.storeConfigs.stores[this.storeConfigs["default"]]},set:function(b){a._setTypeStoreConfig(this,"default",b)}},
true)},itemStoreConfig:{},addItemStoreAlias:function(a,b,c){var d=this,e=new $data.PromiseHandler,g=e.createCallback();if("string"===typeof a){if("object"===typeof b&&"factory"in b){var f=Container.resolveType(b.typeName);d.itemStoreConfig.aliases[a]=b.factory;d.itemStoreConfig.contextTypes[a]=f;c&&(d.itemStoreConfig["default"]=a);g.success();return e.getPromise()}if("function"===typeof b){if((f=b())&&f instanceof $data.EntityContext){g.success(f);f=e.getPromise()}return f.then(function(f){if(typeof f===
"function")return d.addItemStoreAlias(a,f,c);if(f instanceof $data.EntityContext)return f.onReady().then(function(e){d.itemStoreConfig.aliases[a]=b;d.itemStoreConfig.contextTypes[a]=e.getType();c&&(d.itemStoreConfig["default"]=a);return e});e=new $data.PromiseHandler;g=e.createCallback();g.error(new Exception("factory dont have context instance","Invalid arguments"));return e.getPromise()})}}g.error(new Exception("Name or factory missing","Invalid arguments"));return e.getPromise()},resetStoreToDefault:function(a,
b){this.itemStoreConfig.aliases[a]=this._getDefaultItemStoreFactory;delete this.itemStoreConfig.contextTypes[a];b&&(this.itemStoreConfig["default"]=a)},_setStoreAlias:function(a,b){if("object"===typeof b&&!a.storeToken)a.storeToken=b;return a},_getStoreAlias:function(a,b){var c;if(a instanceof $data.Entity){if(c=b||a.storeToken)return c;c=a.getType()}else c=a;return b||(c.storeConfigs?c.storeConfigs["default"]:void 0)||c.storeToken},_getStoreContext:function(a,b,c){a=this._getContextPromise(a,b);
if(!a||a instanceof $data.EntityContext){b=new $data.PromiseHandler;b.createCallback().success(a);a=b.getPromise()}return a.then(function(a){if(a instanceof $data.EntityContext)return a.onReady();if(c)return null;a=new $data.PromiseHandler;a.createCallback().error(new Exception("factory return type error","Error"));return a.getPromise()})},_getContextPromise:function(a,b){if(a&&"object"===typeof a&&"function"===typeof a.factory)return a.factory(b);if(a&&"object"===typeof a&&"object"===typeof a.args&&
"string"===typeof a.typeName){b=Container.resolveType(a.typeName);return new b(JSON.parse(JSON.stringify(a.args)))}return a&&"string"===typeof a&&b.storeConfigs&&b.storeConfigs.stores[a]&&typeof b.storeConfigs.stores[a].factory==="function"?b.storeConfigs.stores[a].factory():a&&"string"===typeof a&&b.storeConfigs&&b.storeConfigs.stores[a]?this._getDefaultItemStoreFactory(b,b.storeConfigs.stores[a]):a&&"string"===typeof a&&this.itemStoreConfig.aliases[a]?this.itemStoreConfig.aliases[a](b):a&&"function"===
typeof a?a():this.itemStoreConfig.aliases[this.itemStoreConfig["default"]](b)},_getStoreEntitySet:function(a,b){var c=this._getStoreAlias(b,a),d="function"===typeof b?b:b.getType();return this._getStoreContext(c,d).then(function(a){a=a.getEntitySetFromElementType(d);if(!a){a=new $data.PromiseHandler;a.createCallback().error("EntitySet not exist for "+d.fullName);return a.getPromise()}return a})},_getDefaultItemStoreFactory:function(a,b){if(a){var c="function"===typeof a?a:a.getType(),d=$data.Container.resolveName(c)+
"_items",d=d.replace(/\./g,"_"),b=$data.typeSystem.extend({collectionName:"Items",tableName:d,initParam:{provider:"local",databaseName:d}},b);if(b.tableName&&!b.collectionName)b.collectionName=b.tableName;var e={};e[b.collectionName]={type:$data.EntitySet,elementType:c};if(b.tableName)e[b.collectionName].tableName=b.tableName;return new ($data.EntityContext.extend(d,e))(b.initParam)}},implementation:function(a,b){var c=$data.ItemStore,d;typeof b==="string"?b=c.itemStoreConfig.contextTypes[b]:b instanceof
$data.EntityContext?b=b.getType():typeof b==="function"&&b.isAssignableTo||(b=c.itemStoreConfig.contextTypes[c.itemStoreConfig["default"]]);b&&(d=c._resolveFromContext(b,a));d||(d=Container.resolveType(a));return d},_resolveFromContext:function(a,b){for(var c=a.memberDefinitions.getPublicMappedProperties(),d=0;d<c.length;d++){var e=c[d],g=Container.resolveType(e.type);if(g.isAssignableTo&&g.isAssignableTo($data.EntitySet)){e=Container.resolveType(e.elementType);if(e.name===b)return e}}return null},
EntityInstanceSave:function(a,b){var c=$data.ItemStore,d=this;return c._getStoreEntitySet(a,d).then(function(e){return c._getSaveMode(d,e,b,a).then(function(a){a=a||"add";switch(a){case "add":e.add(d);break;case "attach":e.attach(d,true);d.entityState=$data.EntityState.Modified;break;default:var b=new $data.PromiseHandler;b.createCallback().error("save mode not supported: "+a);return b.getPromise()}return e.entityContext.saveChanges().then(function(){c._setStoreAlias(d,e.entityContext.storeToken);
return d})})})},EntityInstanceRemove:function(a){var b=this;return $data.ItemStore._getStoreEntitySet(a,b).then(function(a){a.remove(b);return a.entityContext.saveChanges().then(function(){return b})})},EntityInstanceRefresh:function(a,b){var c=$data.ItemStore,d=this,e=d.getType(),c=c._getKeyObjectFromEntity(d,e);return e.read(c,a).then(function(a){e.memberDefinitions.getPublicMappedProperties().forEach(function(b){d[b.name]=a[b.name]});d.storeToken=(b?d.storeToken:void 0)||a.storeToken;d.changedProperties=
void 0;return d})},EntityInheritedTypeProcessor:function(a){var b=$data.ItemStore;a.readAll=b.EntityTypeReadAll(a);a.read=b.EntityTypeRead(a);a.removeAll=b.EntityTypeRemoveAll(a);a.remove=b.EntityTypeRemove(a);a.get=b.EntityTypeGet(a);a.save=b.EntityTypeSave(a);a.addMany=b.EntityTypeAddMany(a);a.itemCount=b.EntityTypeItemCount(a);a.query=b.EntityTypeQuery(a);a.takeFirst=b.EntityTypeTakeFirst(a);a.setStore=b.EntityTypeSetStore(a)},EntityTypeReadAll:function(a){return function(b){var c=$data.ItemStore;
return c._getStoreEntitySet(b,a).then(function(a){return a.forEach(function(b){c._setStoreAlias(b,a.entityContext.storeToken)})})}},EntityTypeRemoveAll:function(a){return function(b){return $data.ItemStore._getStoreEntitySet(b,a).then(function(a){return a.toArray().then(function(b){b.forEach(function(b){a.remove(b)});return a.entityContext.saveChanges().then(function(){return b})})})}},EntityTypeRead:function(a){return function(b,c){var d=$data.ItemStore;return d._getStoreEntitySet(c,a).then(function(a){try{var c=
d._findByIdQueryable(a,b);return a.single(c.predicate,c.thisArgs).then(function(b){return d._setStoreAlias(b,a.entityContext.storeToken)})}catch(f){c=new $data.PromiseHandler;c.createCallback().error(f);return c.getPromise()}})}},EntityTypeGet:function(a){return function(b,c){var d=new a($data.ItemStore._getKeyObjectFromEntity(b));d.refresh(c);return d}},EntityTypeSave:function(a){return function(b,c,d){return(new a(b)).save(c,d)}},EntityTypeAddMany:function(a){return function(b,c){return $data.ItemStore._getStoreEntitySet(c,
a).then(function(a){var c=a.addMany(b);return a.entityContext.saveChanges().then(function(){return c})})}},EntityTypeRemove:function(a){return function(b,c){var d=a.memberDefinitions.getKeyProperties();if(d.length===1){var e={};e[d[0].name]=b;d=new a(e)}else d=new a(b);return d.remove(c)}},EntityTypeItemCount:function(a){return function(b){return $data.ItemStore._getStoreEntitySet(b,a).then(function(a){return a.length()})}},EntityTypeQuery:function(a){return function(b,c,d){var e=$data.ItemStore;
return e._getStoreEntitySet(d,a).then(function(a){return a.filter(b,c).forEach(function(b){e._setStoreAlias(b,a.entityContext.storeToken)})})}},EntityTypeTakeFirst:function(a){return function(b,c,d){var e=$data.ItemStore;return e._getStoreEntitySet(d,a).then(function(a){return a.first(b,c).then(function(b){return e._setStoreAlias(b,a.entityContext.storeToken)})})}},EntityTypeSetStore:function(a){return function(b,c){if(typeof b==="object"&&typeof c==="undefined"){c=b;b="default"}var d=$data.ItemStore,
e={};if(c){if(c.tableName){e.tableName=c.tableName;delete c.tableName}if(c.collectionName){e.collectionName=c.collectionName;delete c.collectionName}if(typeof c.dataSource==="string"){var g=c.dataSource;g.lastIndexOf("/")===g.length-1&&(g=g.substring(0,g.lastIndexOf("/")));var f=g.substring(0,g.lastIndexOf("/"));if(!e.tableName)e.tableName=g.substring(g.lastIndexOf("/")+1);switch(c.provider||c.name){case "oData":c.oDataServiceHost=c.oDataServiceHost||f;break;case "webApi":c.apiUrl=c.apiUrl||f}}}else c=
{name:"local"};e.initParam=c;d._setTypeStoreConfig(a,b,e);return a}},_setTypeStoreConfig:function(a,b,c){if(!a.storeConfigs)a.storeConfigs={stores:{}};a.storeConfigs.stores[b]=c;b==="default"&&(a.storeConfigs["default"]=b)},_findByIdQueryable:function(a,b){var c=a.defaultType.memberDefinitions.getKeyProperties();if(c.length>1&&b&&"object"===typeof b){for(var d="",e={},g=0;g<c.length;g++){g>0&&(d=d+" && ");var f=c[g],d=d+("it."+f.name+" == this."+f.name);e[f.name]=b[f.name]}return{predicate:d,thisArgs:e}}if(c.length===
1)return{predicate:"it."+c[0].name+" == this.value",thisArgs:{value:b}};throw"invalid keys";},_getKeyObjectFromEntity:function(a,b){var c,d=b.memberDefinitions.getKeyProperties();if(d.length===1)c=a&&typeof a==="object"?a[d[0].name]:a;else{c={};for(var e=0;e<d.length;e++)c[d[0].name]=a?a[d[0].name]:a}return c},_getSaveMode:function(a,b,c,d){var b=new $data.PromiseHandler,e=b.createCallback(),g=a.getType();switch(true){case c==="update":e.success("attach");break;case c==="new":e.success("add");break;
case false===g.memberDefinitions.getKeyProperties().every(function(b){return a[b.name]}):e.success("add");break;case !!a.storeToken:e.success("attach");break;default:d=this._getStoreAlias(a,d);g.read(this._getKeyObjectFromEntity(a,g),d).then(function(){e.success("attach")}).fail(function(){e.success("add")})}return b.getPromise()},ContextRegister:function(a){var b=this,c=JSON.parse(JSON.stringify(a));this.storeToken={typeName:this.getType().fullName,args:c,factory:function(){return new (b.getType())(c)}};
for(var a=this.getType().memberDefinitions.getPublicMappedProperties(),d=0;d<a.length;d++){var e=a[d];if(e.type){var g=Container.resolveType(e.type);if(g&&g.isAssignableTo&&g.isAssignableTo($data.EntitySet)){e=Container.resolveType(e.elementType);if(!e.storeToken)e.storeToken=e.storeToken||this.storeToken}}}},QueryResultModifier:function(a){var b=$data.ItemStore,c=a.context,d=a.modelBinderConfig.$type;"string"===typeof d&&(d=Container.resolveType(d));if(d===$data.Array&&a.modelBinderConfig.$item&&
a.modelBinderConfig.$item.$type)d=a.modelBinderConfig.$item.$type;if(d&&d.isAssignableTo&&d.isAssignableTo($data.Entity)||typeof d==="undefined"&&a.result&&a.result[0]instanceof $data.Entity)for(d=0;d<a.result.length;d++)b._setStoreAlias(a.result[d],c.storeToken)}});$data.ItemStore=new $data.ItemStoreClass;
$data.Entity.addMember("field",function(a){var b=this.memberDefinitions.getMember(a);if(b){if(b.definedBy===this)return new $data.MemberWrapper(b);Guard.raise(new Exception("Member '"+a+"' defined on '"+b.definedBy.fullName+"'!","Invalid Operation"))}else Guard.raise(new Exception("Member '"+a+"' not exists!","Invalid Operation"));return this},!0);
$data.Class.define("$data.MemberWrapper",null,null,{constructor:function(a){this.memberDefinition=a},setKey:function(a){this.memberDefinition.key=a||true;return this},setComputed:function(a){this.memberDefinition.computed=a||true;return this},setRequired:function(a){this.memberDefinition.required=a||true;return this},setNullable:function(a){this.memberDefinition.nullable=a||true;return this},changeDefinition:function(a,b){this.memberDefinition[a]=b;return this}});
Exception=function(a,b,c){Error.call(this);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);this.name=b||"Exception";this.message=a;this.data=c};Exception.prototype.__proto__=Error.prototype;Exception.prototype._getStackTrace=function(){};
$data.Class.define("$data.StorageProviderLoaderBase",null,null,{isSupported:function(a){$data.Trace.log("Detecting "+a+" provider support");var b=true;switch(a){case "indexedDb":b=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB&&!/^file:/.test(window.location.href);break;case "storm":b="XMLHttpRequest"in window;break;case "webSql":case "sqLite":b="openDatabase"in window;break;case "LocalStore":b="localStorage"in window&&window.localStorage?true:false;break;case "sqLite":b=
"openDatabase"in window;break;case "mongoDB":b=$data.mongoDBDriver}$data.Trace.log(a+" provider is "+(b?"":"not")+" supported");return b},scriptLoadTimeout:{type:"int",value:1E3},scriptLoadInterval:{type:"int",value:50},npmModules:{value:{indexedDb:"jaydata-indexeddb",InMemory:"jaydata-inmemory",LocalStore:"jaydata-inmemory",mongoDB:"jaydata-mongodb",oData:"jaydata-odata",webApi:"jaydata-webapi",sqLite:"jaydata-sqlite",webSql:"jaydata-sqlite",storm:"jaydata-storm"}},ProviderNames:{value:{indexedDb:"IndexedDb",
InMemory:"InMemory",LocalStore:"InMemory",oData:"oData",webApi:"WebApi",sqLite:"SqLite",webSql:"SqLite",storm:"Storm"}},load:function(a,b){$data.Trace.log("Loading provider(s): "+a);for(var b=$data.typeSystem.createCallbackSetting(b),c=a.shift();c&&!this.isSupported(c);)c=a.shift();$data.Trace.log("First supported provider is "+c);if(!c){$data.Trace.log("Provider fallback failed");b.error()}if($data.RegisteredStorageProviders){$data.Trace.log("Is the "+c+" provider already registered?");var d=$data.RegisteredStorageProviders[c];
if(d){$data.Trace.log(c+" provider registered");b.success(d);return}$data.Trace.log(c+" provider not registered")}if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){$data.Trace.log("node.js detected trying to load NPM module");this.loadNpmModule(c,a,b)}else{$data.Trace.log("Browser detected trying to load provider");this.loadProvider(c,a,b)}},loadProvider:function(a,b,c){var d=this,e=$data.StorageProviderLoader.ProviderNames[a]||a;$data.Trace.log(a+" provider is mapped to name "+
e+"Provider");if(e){e=this.getUrl(e);$data.Trace.log(a+" provider from URL: "+e);var g=this.loadScript;if(document&&document.createElement){$data.Trace.log("document and document.createElement detected, using script element loader method");g=this.loadScriptElement}g.call(this,e,a,function(e){var g=$data.RegisteredStorageProviders[a];if(e&&g){$data.Trace.log(a+" provider successfully registered");c.success(g)}else if(b.length>0){$data.Trace.log(a+" provider failed to load, trying to fallback to "+
b+" provider(s)");d.load(b,c)}else{$data.Trace.log(a+" provider failed to load");c.error()}})}},getUrl:function(a){var b=document.querySelector('script[src$="jaydata.min.js"]'),c=document.querySelector('script[src$="jaydata.js"]');return b?b.src.substring(0,b.src.lastIndexOf("/")+1)+"jaydataproviders/"+a+"Provider.min.js":c?c.src.substring(0,c.src.lastIndexOf("/")+1)+"jaydataproviders/"+a+"Provider.js":"jaydataproviders/"+a+"Provider.js"},loadScript:function(a,b,c){if(a){var d;if(window.XMLHttpRequest)d=
new XMLHttpRequest;else if(window.ActiveXObject)d=new ActiveXObject("MsXml2.XmlHttp");else{$data.Trace.log("XMLHttpRequest or MsXml2.XmlHttp ActiveXObject not found");c(false);d=void 0}d.onreadystatechange=function(){$data.Trace.log("HTTP request is in state: "+d.readyState);if(d.readyState==4)if(d.status==200||d.status==304){$data.Trace.log("HTTP request succeeded");$data.Trace.log("HTTP request response text: "+d.responseText);eval.call(window,d.responseText);typeof c==="function"?c(true):$data.Trace.log("Callback function is undefined")}else{$data.Trace.log("HTTP request status: ",
d.status);typeof c==="function"?c(false):$data.Trace.log("Callback function is undefined")}};d.open("GET",a,true);d.send(null)}else c(false)},loadScriptElement:function(a,b,c){function d(){$data.Trace.log("Script element watcher iteration "+k);if($data.RegisteredStorageProviders[b]){$data.Trace.log(b+" provider registered");c(true)}else{k--;if(k>0){$data.Trace.log("Script element watcher next iteration");setTimeout(d,f)}else{$data.Trace.log("Script element loader failed");c(false)}}}var e=document.getElementsByTagName("head")[0]||
document.documentElement,g=document.createElement("script");g.type="text/javascript";g.src=a;$data.Trace.log("Appending child "+g+" to "+e);e.appendChild(g);var f=this.scriptLoadInterval||50,k=Math.ceil(this.scriptLoadTimeout/f);$data.Trace.log("Script element watcher iterating "+k+" times");setTimeout(d,f)},loadNpmModule:function(a,b,c){var d=null;try{require(this.npmModules[a]);d=$data.RegisteredStorageProviders[a];$data.Trace.log("NPM module loader successfully registered "+a+" provider")}catch(e){$data.Trace.log("NPM module loader failed for "+
a+" provider")}d?c.success(d):b.length>0?this.load(b,c):c.error()}});$data.StorageProviderLoader=new $data.StorageProviderLoaderBase;$data.storageProviders={DbCreationType:{Merge:10,DropTableIfChanged:20,DropTableIfChange:20,DropAllExistingTables:30,ErrorIfChange:40,DropDbIfChange:50}};$data.ConcurrencyMode={Fixed:"fixed",None:"none"};
$data.Class.define("$data.StorageProviderBase",null,null,{constructor:function(a){this.providerConfiguration=a||{}},providers:{},supportedDataTypes:{value:[],writable:!1},initializeStore:function(){Guard.raise("Pure class")},executeQuery:function(){Guard.raise("Pure class")},buildIndependentBlocks:function(a){for(var b=[],c=[],d=0;d<a.length;d++){var e=a[d];if(e.dependentOn&&e.dependentOn.length!=0){for(var g=null,f=0;f<e.dependentOn.length;f++){var k=e.dependentOn[f];if(k.entityState!=$data.EntityState.Unchanged){for(var g=
g||{},j=-1,m=0;m<a.length;m++)if(a[m].data==k){j=m;break}j==-1&&Guard.raise(new Exception("Dependent object not found","ObjectNotFound",e.dependentOn[f]));g[j]=true;from=c[j]||{};from[d]=true;c[j]=from}}g!==null&&(b[d]=g)}}d=[];e=[];for(g=0;g<a.length;g++)b.hasOwnProperty(g)||e.push(g);for(;e.length>0;){g=[].concat(e);e=[];for(f=0;f<g.length;f++){k=c[g[f]];if(typeof k!=="undefined")for(var q in k){delete b[q][g[f]];a:{j=b[q];m=void 0;for(m in j)if(j.hasOwnProperty(m)){j=true;break a}j=false}if(!j){delete b[q];
e.push(q)}}delete c[g[f]]}f=[];for(k=0;k<g.length;k++){j=a[g[k]];j.data.entityState!=$data.EntityState.Unchanged&&f.push(j)}f.length>0&&d.push(f)}return d},getTraceString:function(){Guard.raise("Pure class")},setContext:function(a){this.context=a},_buildContinuationFunction:function(a,b){if(Array.isArray(b.result)){b.result.next=this._buildPagingMethod(a,b,"next");b.result.prev=this._buildPagingMethod(a,b,"prev")}},_buildPagingMethod:function(a,b,c){return function(d){var e=new $data.PromiseHandler,
d=e.createCallback(d),g=(new $data.Expressions.ContinuationExpressionBuilder(c)).compile(b);if(g.expression){g=Container.createQueryable(a,g.expression);g.defaultType=b.defaultType;a.executeQuery(g,d)}else d.error(new Exception(g.message,"Invalid Operation",g));return e.getPromise()}},buildDbType_modifyInstanceDefinition:function(a,b){var c=function(b,c){var d;if(c){d=JSON.parse(JSON.stringify(a[c]));d.kind=b.kind;d.name=b.name;d.notMapped=false}else d=JSON.parse(JSON.stringify(b));d.dataType=Container.resolveType(b.dataType);
d.type=d.dataType;d.key=false;d.computed=false;return d},d=function(a,b,c,d){var j={};j[a.name]=c;j[b.name]=d+"__"+c;return j};b.Associations&&b.Associations.forEach(function(b){var g=false,f=b.FromType,k=b.ToType,j=b.ToPropertyName;b.ReferentialConstraint=b.ReferentialConstraint||[];if(b.FromMultiplicity=="*"&&b.ToMultiplicity=="0..1"||b.FromMultiplicity=="0..1"&&b.ToMultiplicity=="1"){f=b.ToType;k=b.FromType;j=b.FromPropertyName;g=true}f.memberDefinitions.getPublicMappedProperties().filter(function(a){return a.key}).forEach(function(m){g&&
(a[j+"__"+m.name]=c(m,j));b.ReferentialConstraint.push(d(f,k,m.name,j))},this)},this);b.ComplexTypes&&b.ComplexTypes.forEach(function(b){b.ReferentialConstraint=b.ReferentialConstraint||[];b.ToType.memberDefinitions.getPublicMappedProperties().forEach(function(g){a[b.FromPropertyName+"__"+g.name]=c(g);b.ReferentialConstraint.push(d(b.ToType,b.FromType,g.name,b.FromPropertyName))},this)},this)},buildDbType_generateConvertToFunction:function(a){return function(b){var c=new a.PhysicalType;c.entityState=
b.entityState;a.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a){b[a.name]!==void 0&&(c[a.name]=b[a.name])},this);a.Associations&&a.Associations.forEach(function(a){if(a.FromMultiplicity=="*"&&a.ToMultiplicity=="0..1"||a.FromMultiplicity=="0..1"&&a.ToMultiplicity=="1"){var e=b[a.FromPropertyName];e!==void 0&&a.ReferentialConstraint.forEach(function(b){c[b[a.From]]=e!==null?e[b[a.To]]:null},this)}},this);a.ComplexTypes&&a.ComplexTypes.forEach(function(a){var e=b[a.FromPropertyName];
e!==void 0&&a.ReferentialConstraint.forEach(function(b){c[b[a.From]]=e!==null?e[b[a.To]]:null},this)},this);return c}},supportedFieldOperations:{value:{length:{dataType:"number",allowedIn:"filter, map"},substr:{dataType:"string",allowedIn:"filter",parameters:[{name:"startFrom",dataType:"number"},{name:"length",dataType:"number"}]},toLowerCase:{dataType:"string"}},enumerable:!0,writable:!0},resolveFieldOperation:function(a,b,c){var d=this.supportedFieldOperations[a];if(Array.isArray(d)){for(var e=
0;e<d.length;e++)if(d[e].allowedType==="default"||Container.resolveType(d[e].allowedType)===Container.resolveType(b.selector.memberDefinition.type)){d=d[e];break}e===d.length&&(d=void 0)}d||Guard.raise(new Exception("Field operation '"+a+"' is not supported by the provider"));c&&d.allowedIn&&(d.allowedIn instanceof Array&&!d.allowedIn.some(function(a){return c===Container.resolveType(a)})||!(d.allowedIn instanceof Array)&&c!==Container.resolveType(d.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+
c.name));d.name=a;return d},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean"}},enumerable:!0,writable:!0},resolveBinaryOperator:function(a,b,c){(b=this.supportedBinaryOperators[a])||Guard.raise(new Exception("Binary operator '"+a+"' is not supported by the provider"));c&&b.allowedIn&&(b.allowedIn instanceof Array&&!b.allowedIn.some(function(a){return c===Container.resolveType(a)})||!(b.allowedIn instanceof Array)&&c!==Container.resolveType(b.allowedIn))&&Guard.raise(new Exception(a+
" not supported in: "+c.name));b.name=a;return b},supportedUnaryOperators:{value:{not:{mapTo:"not"}},enumerable:!0,writable:!0},resolveUnaryOperator:function(a,b,c){(b=this.supportedUnaryOperators[a])||Guard.raise(new Exception("Unary operator '"+a+"' is not supported by the provider"));c&&b.allowedIn&&(b.allowedIn instanceof Array&&!b.allowedIn.some(function(a){return c===Container.resolveType(a)})||!(b.allowedIn instanceof Array)&&c!==Container.resolveType(b.allowedIn))&&Guard.raise(new Exception(a+
" not supported in: "+c.name));b.name=a;return b},supportedSetOperations:{value:{toArray:{invokable:!0,allowedIn:[]}},enumerable:!0,writable:!0},resolveSetOperations:function(a,b,c){(b=this.supportedSetOperations[a])||Guard.raise(new Exception("Operation '"+a+"' is not supported by the provider"));var d=b.allowedIn||[];c&&d&&(d instanceof Array&&!d.some(function(a){return c===Container.resolveType(a)})||!(d instanceof Array)&&c!==Container.resolveType(d))&&Guard.raise(new Exception(a+" not supported in: "+
c.name));return b},resolveTypeOperations:function(a,b){Guard.raise(new Exception("Entity '"+b.entityType.name+"' Operation '"+a+"' is not supported by the provider"))},resolveContextOperations:function(a,b){Guard.raise(new Exception("Context '"+b.instance.getType().name+"' Operation '"+a+"' is not supported by the provider"))},makePhysicalTypeDefinition:function(){},_beginTran:function(a,b,c){c.success(new $data.Transaction)}},{onRegisterProvider:{value:new $data.Event},registerProvider:function(a,
b){this.onRegisterProvider.fire({name:a,provider:b},this);$data.RegisteredStorageProviders=$data.RegisteredStorageProviders||[];$data.RegisteredStorageProviders[a]=b},getProvider:function(a){var b=$data.RegisteredStorageProviders[a];b||console.warn("Provider not found: '"+a+"'");return b},isSupported:{get:function(){return true},set:function(){}}});
(function(){for(var a=["webSql","indexedDb","LocalStore"],b=0;b<a.length;b++){var c=a[b];if($data.StorageProviderLoader.isSupported(c)){$data.StorageProviderLoader.npmModules.local=$data.StorageProviderLoader.npmModules[c];$data.StorageProviderLoader.ProviderNames.local=$data.StorageProviderLoader.ProviderNames[c];$data.RegisteredStorageProviders=$data.RegisteredStorageProviders||[];(a=$data.RegisteredStorageProviders[c])?$data.StorageProviderBase.registerProvider("local",a):$data.StorageProviderBase.onRegisterProvider.attach(function(a,
b){b.name===c&&$data.StorageProviderBase.registerProvider("local",b.provider)});break}}})();
$data.Class.define("$data.ServiceOperation",null,null,{},{translateDefinition:function(a,b){a.serviceName=b;var c=new $data.MemberDefinition(this.generateServiceOperation(a),this);c.name=b;return c},generateServiceOperation:function(a){var b;if(a.serviceMethod){b=a.returnType?Container.resolveType(a.returnType):{};b=b.isAssignableTo&&b.isAssignableTo($data.Queryable)?a.serviceMethod:function(){var b=arguments[arguments.length-1],d=new $data.PromiseHandler;if(typeof b==="function"){b=d.createCallback(b);
arguments[arguments.length-1]=b}else{b=d.createCallback();arguments.push(b)}try{var e=a.serviceMethod.apply(this,arguments);e!==void 0&&b.success(e)}catch(g){b.error(g)}return d.getPromise()}}else b=function(){var b=this,d,e;if(this instanceof $data.Entity||this instanceof $data.EntitySet){var g;if(this instanceof $data.Entity)if(this.context){b=this.context;g=b.getEntitySetFromElementType(this.getType());if(!a.method&&a.IsSideEffecting!==false)a.method="POST"}else{Guard.raise("entity not attached into the context");
return}else if(this instanceof $data.EntitySet){b=this.entityContext;g=this;d=b.getType().getMemberDefinition(g.name);d=$data.MemberDefinition.translateDefinition(d.actions[a.serviceName],a.serviceName,g.getType())}e={data:this,entitySet:g}}g=a.elementType?b.getEntitySetFromElementType(Container.resolveType(a.elementType)):null;var f=null;if(a.params){f=[];if(arguments[0]&&typeof arguments[0]==="object"&&a.params&&a.params[0]&&(Container.resolveType(a.params[0].type)!==$data.Object||a.params[0].name in
arguments[0]))for(var k=arguments[0],j=0;j<a.params.length;j++){var m=a.params[j];m.name&&m.type&&m.name in k&&f.push(Container.createConstantExpression(k[m.name],Container.resolveType(m.type),m.name))}else for(j=0;j<a.params.length;j++){if(typeof arguments[j]=="function")break;m=a.params[j];m.name&&m.type&&arguments[j]!==void 0&&f.push(Container.createConstantExpression(arguments[j],Container.resolveType(m.type),m.name))}}k=Container.createEntityContextExpression(b);d||(d=e&&e.data?e.data.getType().getMemberDefinition(a.serviceName):
b.getType().getMemberDefinition(a.serviceName));d=Container.createServiceOperationExpression(k,Container.createMemberInfoExpression(d),f,a,e);e=arguments[arguments.length-1];typeof e!=="function"&&(e=void 0);if(g){b=Container.createQueryable(g,d);if(e){d.isTerminated=true;return b._runQuery(e)}return b}g=a.returnType?Container.resolveType(a.returnType):null;b=Container.createQueryable(b,d);b.defaultType=g||$data.Object;if(g===$data.Queryable){b.defaultType=Container.resolveType(a.elementType);if(e){d.isTerminated=
true;return b._runQuery(e)}return b}d.isTerminated=true;return b._runQuery(e)};$data.typeSystem.extend(b,a,{params:a.params||[]});return b}});$data.Class.define("$data.ServiceAction",$data.ServiceOperation,null,{},{});$data.Base.extend("$data.EntityWrapper",{getEntity:function(){Guard.raise("pure object")}});"undefined"!==typeof jQuery&&jQuery.ajax&&($data.ajax=$data.ajax||jQuery.ajax);
"undefined"!==typeof WinJS&&WinJS.xhr&&($data.ajax=$data.ajax||function(a){$data.typeSystem.extend(a,{dataType:"json",headers:{}});var b={json:{accept:"application/json, text/javascript",convert:JSON.parse},text:{accept:"text/plain",convert:function(a){return a}},html:{accept:"text/html",convert:function(a){return a}},xml:{accept:"application/xml, text/xml",convert:function(a){return a}}}[a.dataType.toLowerCase()];a.headers.Accept=b.accept;var c=a.success||$data.defaultSuccessCallback,d=a.error||
$data.defaultErrorCallback,e=a.progress;WinJS.xhr(a).done(function(a){a=b.convert(a.responseText);c(a)},function(a){a=b.convert(a.responseText);d(a)},e)});"undefined"!==typeof Ext&&typeof Ext.Ajax&&($data.ajax=$data.ajax||function(a){Ext.Ajax.request(a)});$data.ajax=$data.ajax||function(){$data.typeSystem.createCallbackSetting(arguments[arguments.length-1]).error("Not implemented")};
$C("$data.modelBinder.FindProjectionVisitor",$data.Expressions.EntityExpressionVisitor,null,{VisitProjectionExpression:function(a){this.projectionExpression=a}});
$C("$data.modelBinder.ModelBinderConfigCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a,b,c){this._query=a;this._includes=b;this._isoDataProvider=c||false},VisitSingleExpression:function(a){this._defaultModelBinder(a)},VisitSomeExpression:function(a){this._defaultModelBinder(a)},VisitEveryExpression:function(a){this._defaultModelBinder(a)},VisitToArrayExpression:function(a){this._defaultModelBinder(a)},VisitFirstExpression:function(a){this._defaultModelBinder(a)},VisitForEachExpression:function(a){this._defaultModelBinder(a)},
VisitServiceOperationExpression:function(a){if(a.cfg.returnType){var b=Container.resolveType(a.cfg.returnType);if(typeof b.isAssignableTo==="function"&&b.isAssignableTo($data.Queryable)||b===$data.Array)this._defaultModelBinder(a);else{var c=Container.createqueryBuilder();c.modelBinderConfig.$type=b;typeof b.isAssignableTo==="function"&&b.isAssignableTo($data.Entity)?c.modelBinderConfig.$selector=["json:"+a.cfg.serviceName]:c.modelBinderConfig.$source=a.cfg.serviceName;this.VisitExpression(a,c);c.resetModelBinderProperty();
this._query.modelBinderConfig=c.modelBinderConfig}}},VisitCountExpression:function(){var a=Container.createqueryBuilder();a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");a.modelBinderConfig.$type=$data.Integer;a.modelBinderConfig.$source="cnt";a.resetModelBinderProperty();this._query.modelBinderConfig=a.modelBinderConfig},VisitBatchDeleteExpression:function(){var a=Container.createqueryBuilder();a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");
a.modelBinderConfig.$type=$data.Integer;a.modelBinderConfig.$source="cnt";a.resetModelBinderProperty();this._query.modelBinderConfig=a.modelBinderConfig},VisitConstantExpression:function(a,b){b.modelBinderConfig.$type=a.type;b.modelBinderConfig.$value=a.value},VisitExpression:function(a,b){var c=Container.createFindProjectionVisitor();c.Visit(a);c.projectionExpression?this.Visit(c.projectionExpression,b):this.DefaultSelection(b,this._query.defaultType,this._includes)},_defaultModelBinder:function(a){var b=
Container.createqueryBuilder();b.modelBinderConfig.$type=$data.Array;this._isoDataProvider&&(b.modelBinderConfig.$selector=["json:d.results","json:d","json:results"]);b.modelBinderConfig.$item={};b.selectModelBinderProperty("$item");this.VisitExpression(a,b);b.resetModelBinderProperty();this._query.modelBinderConfig=b.modelBinderConfig},_addPropertyToModelBinderConfig:function(a,b){var c=this._query.context._storageModel.getStorageModel(a);if(a.memberDefinitions)a.memberDefinitions.getPublicMappedProperties().forEach(function(a){if(!c||
c&&!c.Associations[a.name]&&!c.ComplexTypes[a.name])if(!c&&this._query.context.storageProvider.supportedDataTypes.indexOf(Container.resolveType(a.dataType))<0){b.selectModelBinderProperty(a.name);var e=Container.resolveType(a.dataType);b.modelBinderConfig.$type=e;b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.name+".results","json:"+a.name]:"json:"+a.name;if(e===$data.Array&&a.elementType){b.selectModelBinderProperty("$item");a=Container.resolveType(a.elementType);b.modelBinderConfig.$type=
a;this._addPropertyToModelBinderConfig(a,b);b.popModelBinderProperty()}else this._addPropertyToModelBinderConfig(e,b);b.popModelBinderProperty()}else{a.key&&b.addKeyField(a.name);b.modelBinderConfig[a.name]=a.concurrencyMode===$data.ConcurrencyMode.Fixed?{$selector:"json:__metadata",$source:"etag"}:a.name}},this);else{b._binderConfig.$item=b._binderConfig.$item||{};b.modelBinderConfig=b._binderConfig.$item}c&&this._addComplexTypeProperties(c.ComplexTypes,b)},_addComplexTypeProperties:function(a,b){a.forEach(function(a){if(a.ToType!==
$data.Array){b.selectModelBinderProperty(a.FromPropertyName);b.modelBinderConfig.$type=a.ToType;b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.FromPropertyName+".results","json:"+a.FromPropertyName]:"json:"+a.FromPropertyName;this._addPropertyToModelBinderConfig(a.ToType,b);b.popModelBinderProperty()}else{var d=a.ToType,e=Container.resolveType(a.FromType.memberDefinitions.getMember(a.FromPropertyName).elementType);if(d===$data.Array&&e&&e.isAssignableTo&&e.isAssignableTo($data.Entity)){config=
{$type:$data.Array,$selector:"json:"+a.FromPropertyName,$item:{$type:e}};d=e.memberDefinitions.getPublicMappedProperties();for(e=0;e<d.length;e++)config.$item[d[e].name]={$type:d[e].type,$source:d[e].name};b.modelBinderConfig[a.FromPropertyName]=config}else b.modelBinderConfig[a.FromPropertyName]={$type:a.ToType,$source:a.FromPropertyName}}},this)},DefaultSelection:function(a,b,c){a.modelBinderConfig.$type=b;var d=this._query.context._storageModel.getStorageModel(b);this._addPropertyToModelBinderConfig(b,
a);c&&c.forEach(function(b){for(var c=b.name.split("."),f=null,k=d,j=0,m=0;m<c.length;m++){if(a.modelBinderConfig.$item){a.selectModelBinderProperty("$item");j++}a.selectModelBinderProperty(c[m]);f=k.Associations[c[m]];k=this._query.context._storageModel.getStorageModel(f.ToType)}a.modelBinderConfig.$selector=this._isoDataProvider?["json:"+c[c.length-1]+".results","json:"+c[c.length-1]]:"json:"+c[c.length-1];if(f.ToMultiplicity==="*"){a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");
a.modelBinderConfig.$type=b.type;this._addPropertyToModelBinderConfig(b.type,a);a.popModelBinderProperty()}else{a.modelBinderConfig.$type=b.type;this._addPropertyToModelBinderConfig(b.type,a)}for(m=0;m<c.length+j;m++)a.popModelBinderProperty()},this)},VisitProjectionExpression:function(a,b){this.hasProjection=true;this.Visit(a.selector,b);a.selector&&a.selector.expression instanceof $data.Expressions.ObjectLiteralExpression&&(b.modelBinderConfig.$type=a.projectionAs||b.modelBinderConfig.$type||$data.Object)},
VisitParametricQueryExpression:function(a,b){a.expression instanceof $data.Expressions.EntityExpression||a.expression instanceof $data.Expressions.EntitySetExpression?this.VisitEntityAsProjection(a,b):this.Visit(a.expression,b)},VisitEntityAsProjection:function(a,b){this.mapping="";this.Visit(a.expression,b);var c;if(this.mapping&&this._includes instanceof Array){c=this._includes.filter(function(a){return a.name.indexOf(this.mapping+".")===0},this);c=c.map(function(a){return{name:a.name.replace(this.mapping+
".",""),type:a.type}},this);c.length>0&&console.warn("WARN: include for mapped properties is not supported!")}if(a.expression instanceof $data.Expressions.EntityExpression)this.DefaultSelection(b,a.expression.entityType);else if(a.expression instanceof $data.Expressions.EntitySetExpression){b.modelBinderConfig.$type=$data.Array;b.modelBinderConfig.$item={};b.selectModelBinderProperty("$item");this.DefaultSelection(b,a.expression.elementType);b.popModelBinderProperty()}},VisitEntityFieldExpression:function(a,
b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitMemberInfoExpression:function(a,b){b.modelBinderConfig.$type=a.memberDefinition.type;if(a.memberDefinition.storageModel&&a.memberName in a.memberDefinition.storageModel.ComplexTypes)this._addPropertyToModelBinderConfig(Container.resolveType(a.memberDefinition.type),b);else if(!b.modelBinderConfig.$type||!Container.resolveType(b.modelBinderConfig.$type).isAssignableTo||!Container.resolveType(b.modelBinderConfig.$type).isAssignableTo($data.Entity))b.modelBinderConfig.$source=
a.memberName},VisitEntitySetExpression:function(a,b){if(a.source instanceof $data.Expressions.EntityExpression){this.Visit(a.source,b);this.Visit(a.selector,b)}},VisitComplexTypeExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b);if("$selector"in b.modelBinderConfig&&b.modelBinderConfig.$selector.length>0)if(b.modelBinderConfig.$selector instanceof $data.Array){var c=b.modelBinderConfig.$selector[1];b.modelBinderConfig.$selector[0]=c+"."+a.selector.memberName+".results";b.modelBinderConfig.$selector[1]=
c+"."+a.selector.memberName}else b.modelBinderConfig.$selector=b.modelBinderConfig.$selector+("."+a.selector.memberName);else b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.selector.memberName+".results","json:"+a.selector.memberName]:"json:"+a.selector.memberName},VisitEntityExpression:function(a,b){this.Visit(a.source,b)},VisitAssociationInfoExpression:function(a,b){if("$selector"in b.modelBinderConfig&&b.modelBinderConfig.$selector.length>0)if(b.modelBinderConfig.$selector instanceof
$data.Array){var c=b.modelBinderConfig.$selector[1];b.modelBinderConfig.$selector[0]=c+"."+a.associationInfo.FromPropertyName+".results";b.modelBinderConfig.$selector[1]=c+"."+a.associationInfo.FromPropertyName}else b.modelBinderConfig.$selector=b.modelBinderConfig.$selector+("."+a.associationInfo.FromPropertyName);else b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.associationInfo.FromPropertyName+".results","json:"+a.associationInfo.FromPropertyName]:"json:"+a.associationInfo.FromPropertyName;
if(this.mapping&&this.mapping.length>0)this.mapping=this.mapping+".";this.mapping=this.mapping+a.associationInfo.FromPropertyName},VisitObjectLiteralExpression:function(a,b){b.modelBinderConfig.$type=$data.Object;a.members.forEach(function(a){this.Visit(a,b)},this)},VisitObjectFieldExpression:function(a,b){b.selectModelBinderProperty(a.fieldName);a.expression instanceof $data.Expressions.EntityExpression||a.expression instanceof $data.Expressions.EntitySetExpression?this.VisitEntityAsProjection(a,
b):this.Visit(a.expression,b);b.popModelBinderProperty()}});$data.Class.define("$data.Authentication.AuthenticationBase",null,null,{constructor:function(a){this.configuration=a||{};this.Authenticated=false},Login:function(){Guard.raise("Pure class")},Logout:function(){Guard.raise("Pure class")},CreateRequest:function(){Guard.raise("Pure class")}},null);
$data.Class.define("$data.Authentication.Anonymous",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=a||{};this.Authenticated=false},Login:function(){},Logout:function(){},CreateRequest:function(a){$data.ajax(a)}},null);
$data.Class.define("$data.Authentication.FacebookAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=$data.typeSystem.extend({Url_code:"",type_code:"",scope:"",Url_token:"",type_token:"",access_token:"",app_id:""},a)},Login:function(a){if(!this.Authenticated){var b=this;b.configuration.stateCallbacks=a||{};$data.ajax({url:this.configuration.Url_code,data:"type="+b.configuration.type_code+"&client_id="+b.configuration.app_id+"&scope="+b.configuration.scope,
type:"POST",dataType:"json",success:function(a){typeof b.configuration.stateCallbacks.pending=="function"&&b.configuration.stateCallbacks.pending(a);b._processRequestToken(a);b.Authenticated=true},error:function(){typeof b.configuration.stateCallbacks.error=="function"&&b.configuration.stateCallbacks.error(arguments)}})}},Logout:function(){this.Authenticated=false},CreateRequest:function(a){if(a){if(a.url.indexOf("access_token=")===-1&&a.url&&this.Authenticated){var b="?";a.url.indexOf(b)>0&&(b="&");
if(this.configuration.access_token)a.url=a.url+b+"access_token="+this.configuration.access_token}$data.ajax(a)}},_processRequestToken:function(a){var b=this;$data.ajax({url:b.configuration.Url_token,data:"type="+b.configuration.type_token+"&client_id="+b.configuration.app_id+"&code="+a.code,type:"POST",dataType:"json",success:function(a){b.configuration.access_token=a.access_token;typeof b.configuration.stateCallbacks.success=="function"&&b.configuration.stateCallbacks.success(a)},error:function(c){var d=
eval("("+c.responseText+")");d.error&&(d.error.message=="authorization_pending"?setTimeout(function(){b._processRequestToken(a)},2E3):typeof b.configuration.stateCallbacks.abort=="function"&&b.configuration.stateCallbacks.abort(arguments))}})}},null);
$data.Class.define("$data.Authentication.BasicAuth.BasicAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=$data.typeSystem.extend({Username:"",Password:""},a)},Login:function(a){a&&typeof a.pending=="function"&&a.pending()},Logout:function(){},CreateRequest:function(a){if(a){var b=this,c=a.beforeSend;a.beforeSend=function(a){a.setRequestHeader("Authorization","Basic  "+b.__encodeBase64(b.configuration.Username+":"+b.configuration.Password));typeof c=="function"&&
c(a)};$data.ajax(a)}},__encodeBase64:function(a){input=a;var a="",b,c,d="",e,g,f="",k=0;do{b=input.charCodeAt(k++);c=input.charCodeAt(k++);d=input.charCodeAt(k++);e=b>>2;b=(b&3)<<4|c>>4;g=(c&15)<<2|d>>6;f=d&63;isNaN(c)?g=f=64:isNaN(d)&&(f=64);a=a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)}while(k<
input.length);return a}},null);
$data.Class.define("$data.MetadataLoaderClass",null,null,{load:function(a,b,c){var d={EntityBaseClass:"$data.Entity",ContextBaseClass:"$data.EntityContext",AutoCreateContext:false,DefaultNamespace:("ns"+Math.random()).replace(".","")+a.replace(/[^\w]/g,"_"),ContextInstanceName:"context",EntitySetBaseClass:"$data.EntitySet",CollectionBaseClass:"Array",url:a,user:void 0,password:void 0,withCredentials:void 0,httpHeaders:void 0};$data.typeSystem.extend(d,c||{});if(d.DefaultNamespace&&d.DefaultNamespace.lastIndexOf(".")!==
d.DefaultNamespace.length-1)d.DefaultNamespace=d.DefaultNamespace+".";this.factoryCache=this.factoryCache||{};b=$data.typeSystem.createCallbackSetting(b);if(a in this.factoryCache)b.success.apply({},this.factoryCache[a]);else{if(d.url){d.SerivceUri=d.url.replace("/$metadata","");d.metadataUri=d.url.indexOf("/$metadata")===-1?d.url.replace(/\/+$/,"")+"/$metadata":d.url}else b.error("metadata url is missing");var e=this;e._loadXMLDoc(d,function(a,c){if(c.statusCode<200||c.statusCode>299)b.error(c);
else{var k=e._findVersion(a);if(e.xsltRepoUrl){console.log("XSLT: "+e.xsltRepoUrl+e._supportedODataVersionXSLT);e._loadXMLDoc({metadataUri:e.xsltRepoUrl+e._supportedODataVersionXSLT,user:d.user,password:d.password,httpHeaders:d.httpHeaders},function(c,f){if(f.statusCode<200||f.statusCode>299)b.error(f);else{var q=f.responseText,q=q.replace('xmlns:edm="@@VERSIONNS@@"','xmlns:edm="'+k.ns+'"'),q=q.replace("@@VERSION@@",k.version);if(typeof ActiveXObject==="undefined")c=(new DOMParser).parseFromString(q,
"text/xml");else{c=new ActiveXObject("Microsoft.XMLDOM");c.async=false;c.loadXML(q)}e._transform(b,k,a,c,d)}})}else e._transform(b,k,a,void 0,d)}})}},debugMode:{type:"bool",value:!1},xsltRepoUrl:{type:"string",value:""},createFactoryFunc:function(a,b){return function(c){if(a){c=$data.typeSystem.extend({name:"oData",oDataServiceHost:b.SerivceUri,user:b.user,password:b.password,withCredentials:b.withCredentials},c);return new a(c)}return null}},_transform:function(a,b,c,d,e){b=this._processResults(e.url,
b,c,d,e);try{eval(b)}catch(g){a.error(new Exception("SyntaxError","Unexpected model",[g,b]));return}var f;if(!$data.generatedContexts||!(f=$data.generatedContexts.pop()))a.error(new Exception("No context found in service","Not found",[e,b]));else{c=this.createFactoryFunc(f,e);this.factoryCache[e.url]=[c,f];c.type=f;if(this.debugMode){c.codeText=b;a.success(c,f,b)}else a.success(c,f)}},_loadXMLDoc:function(a,b){var c=new XMLHttpRequest;c.open("GET",a.metadataUri,true);a.httpHeaders&&Object.keys(a.httpHeaders).forEach(function(b){c.setRequestHeader(b,
a.httpHeaders[b])});c.onreadystatechange=function(){c.readyState===4&&b(c.responseXML||c.responseText,{requestUri:a.metadataUri,statusCode:c.status,statusText:c.statusText,responseText:c.responseText})};a.user&&a.password&&(!a.httpHeaders||a.httpHeaders&&!a.httpHeaders.Authorization)&&c.setRequestHeader("Authorization","Basic "+this.__encodeBase64(a.user+":"+a.password));c.send("")},_processResults:function(a,b,c,d,e){b=this.getCurrentXSLTVersion(b,c);if(window.ActiveXObject){var a=new ActiveXObject("Msxml2.XSLTemplate.6.0"),
g=new ActiveXObject("Msxml2.FreeThreadedDOMDocument.6.0");g.async=false;d?g.load(d):g.loadXML(b);if(g.parseError.errorCode==0){a.stylesheet=g;d=new ActiveXObject("Msxml2.DOMDocument.6.0");d.async=false;d.load(c);if(d.parseError.errorCode==0){c=a.createProcessor();c.input=d;c.addParameter("SerivceUri",e.SerivceUri);c.addParameter("EntityBaseClass",e.EntityBaseClass);c.addParameter("ContextBaseClass",e.ContextBaseClass);c.addParameter("AutoCreateContext",e.AutoCreateContext);c.addParameter("ContextInstanceName",
e.ContextInstanceName);c.addParameter("EntitySetBaseClass",e.EntitySetBaseClass);c.addParameter("CollectionBaseClass",e.CollectionBaseClass);c.addParameter("DefaultNamespace",e.DefaultNamespace);c.transform();return c.output}}return""}if(typeof document!=="undefined"&&document.implementation&&document.implementation.createDocument){d=d?d:(new DOMParser).parseFromString(b,"text/xml");a=new XSLTProcessor;a.importStylesheet(d);a.setParameter(null,"SerivceUri",e.SerivceUri);a.setParameter(null,"EntityBaseClass",
e.EntityBaseClass);a.setParameter(null,"ContextBaseClass",e.ContextBaseClass);a.setParameter(null,"AutoCreateContext",e.AutoCreateContext);a.setParameter(null,"ContextInstanceName",e.ContextInstanceName);a.setParameter(null,"EntitySetBaseClass",e.EntitySetBaseClass);a.setParameter(null,"CollectionBaseClass",e.CollectionBaseClass);a.setParameter(null,"DefaultNamespace",e.DefaultNamespace);resultDocument=a.transformToFragment(c,document);return resultDocument.textContent}if(typeof module!=="undefined"&&
typeof require!=="undefined"){a=require("node_xslt");return a.transform(a.readXsltString(b),a.readXmlString(c),["SerivceUri","'"+e.SerivceUri+"'","EntityBaseClass","'"+e.EntityBaseClass+"'","ContextBaseClass","'"+e.ContextBaseClass+"'","AutoCreateContext","'"+e.AutoCreateContext+"'","ContextInstanceName","'"+e.ContextInstanceName+"'","EntitySetBaseClass","'"+e.EntitySetBaseClass+"'","CollectionBaseClass","'"+e.CollectionBaseClass+"'","DefaultNamespace","'"+e.DefaultNamespace+"'"])}},_findVersion:function(a){if(typeof a===
"object"&&"getElementsByTagName"in a){var b="http://schemas.microsoft.com/ado/2008/09/edm";(a=a.getElementsByTagName("Schema"))&&(a=a[0]);if(a)a=a.attributes;a&&(a=a.getNamedItem("xmlns"));if(a)b=a.value;return{ns:b,version:this._supportedODataVersions[b]||"unknown"}}if(typeof module!=="undefined"&&typeof require!=="undefined"){var c="http://schemas.microsoft.com/ado/2008/09/edm",b="nodejs",d;for(d in this._supportedODataVersions)if(a.search(RegExp('<Schema.+xmlns="'+d+'"',"gi"))>=0){c=d;b=this._supportedODataVersions[d];
break}return{ns:c,version:b}}},_supportedODataVersions:{value:{"http://schemas.microsoft.com/ado/2006/04/edm":"V1","http://schemas.microsoft.com/ado/2008/09/edm":"V2","http://schemas.microsoft.com/ado/2009/11/edm":"V3","http://schemas.microsoft.com/ado/2007/05/edm":"V11"}},_supportedODataVersionXSLT:{value:"JayDataContextGenerator.xslt"},getCurrentXSLTVersion:function(a){return this._metadataConverterXSLT.replace("@@VERSIONNS@@",a.ns).replace("@@VERSION@@",a.version)},__encodeBase64:function(a){var b=
"",c,d,e="",g,f,k="",j=0;do{c=a.charCodeAt(j++);d=a.charCodeAt(j++);e=a.charCodeAt(j++);g=c>>2;c=(c&3)<<4|d>>4;f=(d&15)<<2|e>>6;k=e&63;isNaN(d)?f=k=64:isNaN(e)&&(k=64);b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)}while(j<a.length);
return b},_metadataConverterXSLT:{type:"string",value:'<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" \r\n                xmlns:edm="@@VERSIONNS@@" \r\n                xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" \r\n                xmlns:metadata="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" \r\n                xmlns:annot="http://schemas.microsoft.com/ado/2009/02/edm/annotation" \r\n                xmlns:exsl="http://exslt.org/common" \r\n                xmlns:msxsl="urn:schemas-microsoft-com:xslt" exclude-result-prefixes="msxsl">\r\n\r\n  <xsl:key name="entityType" match="edm:EntityType" use="concat(string(../@Namespace),\'.\', string(@Name))"/>\r\n  <xsl:key name="associations" match="edm:Association" use="concat(string(../@Namespace),\'.\', string(@Name))"/>\r\n\r\n  <xsl:strip-space elements="property item unprocessed"/>\r\n  <xsl:output method="text" indent="no"  />\r\n  <xsl:param name="contextNamespace" />\r\n\r\n  <xsl:param name="SerivceUri" />\r\n  <xsl:param name="EntityBaseClass"/>\r\n  <xsl:param name="ContextBaseClass"/>\r\n  <xsl:param name="AutoCreateContext"/>\r\n  <xsl:param name="ContextInstanceName"/>\r\n  <xsl:param name="EntitySetBaseClass"/>\r\n  <xsl:param name="CollectionBaseClass"/>\r\n  <xsl:param name="DefaultNamespace"/>\r\n\r\n  <xsl:template match="/">\r\n\r\n/*//////////////////////////////////////////////////////////////////////////////////////\r\n////// Autogenerated by JaySvcUtil.exe http://JayData.org for more info        /////////\r\n//////                             oData @@VERSION@@                                    /////////\r\n//////////////////////////////////////////////////////////////////////////////////////*/\r\n(function(global, $data, undefined) {\r\n\r\n<xsl:for-each select="//edm:EntityType | //edm:ComplexType" xml:space="default">\r\n  <xsl:message terminate="no">Info: generating type <xsl:value-of select="concat(../@Namespace, \'.\', @Name)"/>\r\n</xsl:message>\r\n  <xsl:variable name="props">\r\n    <xsl:apply-templates select="*" />\r\n  </xsl:variable>\r\n  <xsl:text xml:space="preserve">  </xsl:text><xsl:value-of select="$EntityBaseClass"  />.extend(\'<xsl:value-of select="concat($DefaultNamespace,../@Namespace)"/>.<xsl:value-of select="@Name"/>\', {\r\n    <xsl:choose><xsl:when test="function-available(\'msxsl:node-set\')">\r\n    <xsl:for-each select="msxsl:node-set($props)/*">\r\n      <xsl:value-of select="."/><xsl:if test="position() != last()">,\r\n    </xsl:if></xsl:for-each>\r\n  </xsl:when>\r\n  <xsl:otherwise>\r\n    <xsl:for-each select="exsl:node-set($props)/*">\r\n      <xsl:value-of select="."/><xsl:if test="position() != last()">,\r\n    </xsl:if></xsl:for-each>\r\n    </xsl:otherwise>\r\n    </xsl:choose>\r\n    <xsl:variable name="currentName"><xsl:value-of select="concat(../@Namespace,\'.\',@Name)"/></xsl:variable>\r\n    <xsl:for-each select="//edm:FunctionImport[@IsBindable and edm:Parameter[1]/@Type = $currentName]"><xsl:if test="position() = 1">,\r\n    </xsl:if>\r\n      <xsl:apply-templates select="."></xsl:apply-templates><xsl:if test="position() != last()">,\r\n    </xsl:if>\r\n    </xsl:for-each>\r\n  });\r\n  \r\n</xsl:for-each>\r\n\r\n<xsl:for-each select="//edm:EntityContainer">\r\n  <xsl:text xml:space="preserve">  </xsl:text><xsl:value-of select="$ContextBaseClass"  />.extend(\'<xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)"/>\', {\r\n    <\!--or (@IsBindable = \'true\' and (@IsAlwaysBindable = \'false\' or @m:IsAlwaysBindable = \'false\' or @metadata:IsAlwaysBindable = \'false\'))--\>\r\n    <xsl:for-each select="edm:EntitySet | edm:FunctionImport[not(@IsBindable) or @IsBindable = \'false\']">\r\n      <xsl:apply-templates select="."></xsl:apply-templates><xsl:if test="position() != last()">,\r\n    </xsl:if>\r\n    </xsl:for-each>\r\n  });\r\n\r\n  $data.generatedContexts = $data.generatedContexts || [];\r\n  $data.generatedContexts.push(<xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)" />);\r\n  <xsl:if test="$AutoCreateContext = \'true\'">\r\n  /*Context Instance*/\r\n  <xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$ContextInstanceName" /> = new <xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)" />({ name:\'oData\', oDataServiceHost: \'<xsl:value-of select="$SerivceUri" />\' });\r\n</xsl:if>\r\n\r\n</xsl:for-each>\r\n      \r\n})(window, $data);\r\n      \r\n    </xsl:template>\r\n\r\n  <xsl:template match="edm:Key"></xsl:template>\r\n\r\n  <xsl:template match="edm:FunctionImport">\r\n    <xsl:text>\'</xsl:text>\r\n    <xsl:value-of select="@Name"/>\r\n    <xsl:text>\': { type: </xsl:text>\r\n    <xsl:choose>\r\n      <xsl:when test="@IsBindable = \'true\'">\r\n        <xsl:text>$data.ServiceAction</xsl:text>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:text>$data.ServiceOperation</xsl:text>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n\r\n    <xsl:apply-templates select="@*" mode="FunctionImport-mode"/>\r\n\r\n    <xsl:variable name="IsBindable">\r\n      <xsl:value-of select="@IsBindable"/>\r\n    </xsl:variable>\r\n    <xsl:text>, params: [</xsl:text>\r\n    <xsl:for-each select="edm:Parameter[($IsBindable = \'true\' and position() > 1) or (($IsBindable = \'false\' or $IsBindable = \'\') and position() > 0)]">\r\n      <xsl:text>{ name: \'</xsl:text>\r\n      <xsl:value-of select="@Name"/>\r\n      <xsl:text>\', type: \'</xsl:text>\r\n      <xsl:apply-templates select="@Type" mode="render-functionImport-type" />\r\n      <xsl:text>\' }</xsl:text>\r\n      <xsl:if test="position() != last()">, </xsl:if>\r\n    </xsl:for-each>    \r\n    <xsl:text>]</xsl:text>\r\n\r\n    <xsl:text> }</xsl:text>\r\n  </xsl:template>\r\n  \r\n  <xsl:template match="@ReturnType" mode="FunctionImport-mode">\r\n    <xsl:text>, returnType: </xsl:text>\r\n    <xsl:choose>\r\n      <xsl:when test="not(.)">null</xsl:when>\r\n      <xsl:when test="starts-with(., \'Collection\')">$data.Queryable</xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:text>\'</xsl:text>\r\n        <xsl:apply-templates select="." mode="render-functionImport-type" />\r\n        <xsl:text>\'</xsl:text>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n\r\n    <xsl:if test="starts-with(., \'Collection\')">\r\n      <xsl:variable name="len" select="string-length(.)-12"/>\r\n      <xsl:variable name="curr" select="substring(.,12,$len)"/>\r\n      <xsl:variable name="ElementType" >\r\n        <xsl:choose>\r\n          <xsl:when test="//edm:Schema[starts-with($curr, @Namespace)]">\r\n            <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n          </xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$curr" />\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:variable>\r\n      <xsl:text>, elementType: \'</xsl:text>\r\n      <xsl:value-of select="$ElementType"/>\r\n      <xsl:text>\'</xsl:text>\r\n    </xsl:if>\r\n  </xsl:template>\r\n  <xsl:template match="@Name" mode="FunctionImport-mode"></xsl:template>\r\n  <xsl:template match="@m:HttpMethod" mode="FunctionImport-mode">\r\n    <xsl:text>, method: \'</xsl:text>\r\n    <xsl:value-of select="."/>\r\n    <xsl:text>\'</xsl:text>\r\n  </xsl:template>\r\n  <xsl:template match="@IsBindable | @IsSideEffecting | @IsAlwaysBindable | @m:IsAlwaysBindable | @metadata:IsAlwaysBindable | @IsComposable" mode="FunctionImport-mode">\r\n    <xsl:text>, </xsl:text>\r\n    <xsl:call-template name="GetAttributeName">\r\n      <xsl:with-param name="Name" select="name()" />\r\n    </xsl:call-template>\r\n    <xsl:text>: </xsl:text>\r\n    <xsl:value-of select="."/>\r\n  </xsl:template>\r\n  <xsl:template match="@*" mode="FunctionImport-mode">\r\n    <xsl:text>, \'</xsl:text>\r\n    <xsl:call-template name="GetAttributeName">\r\n      <xsl:with-param name="Name" select="name()" />\r\n    </xsl:call-template>\r\n    <xsl:text>\': \'</xsl:text>\r\n    <xsl:value-of select="."/>        \r\n    <xsl:text>\'</xsl:text>\r\n  </xsl:template>\r\n  <xsl:template name="GetAttributeName">\r\n    <xsl:param name="Name" />\r\n    <xsl:choose>\r\n      <xsl:when test="contains($Name, \':\')">\r\n        <xsl:value-of select="substring-after($Name, \':\')"/>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:value-of select="$Name"/>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="edm:EntitySet">\'<xsl:value-of select="@Name"/>\': { type: <xsl:value-of select="$EntitySetBaseClass"  />, elementType: <xsl:value-of select="concat($DefaultNamespace,@EntityType)"/><xsl:text> </xsl:text><xsl:apply-templates select="." mode="Collection-Actions" />}</xsl:template>\r\n\r\n  <xsl:template match="edm:EntitySet" mode="Collection-Actions">\r\n    <xsl:variable name="CollectionType" select="concat(\'Collection(\', @EntityType, \')\')" />\r\n    <xsl:for-each select="//edm:FunctionImport[edm:Parameter[1]/@Type = $CollectionType]">\r\n      <xsl:if test="position() = 1">\r\n        <xsl:text>, actions: { \r\n        </xsl:text>\r\n      </xsl:if>\r\n        <xsl:apply-templates select="."></xsl:apply-templates><xsl:if test="position() != last()">,\r\n        </xsl:if>\r\n      <xsl:if test="position() = last()">\r\n        <xsl:text>\r\n      }</xsl:text>\r\n      </xsl:if>\r\n    </xsl:for-each>\r\n  </xsl:template>\r\n  \r\n  <xsl:template match="edm:Property | edm:NavigationProperty">\r\n    <property>\r\n    <xsl:variable name="memberDefinition">\r\n      <xsl:if test="parent::edm:EntityType/edm:Key/edm:PropertyRef[@Name = current()/@Name]"><attribute name="key">true</attribute></xsl:if>\r\n      <xsl:apply-templates select="@*[local-name() != \'Name\']" mode="render-field" />\r\n    </xsl:variable>\'<xsl:value-of select="@Name"/>\': { <xsl:choose><xsl:when test="function-available(\'msxsl:node-set\')"><xsl:for-each select="msxsl:node-set($memberDefinition)/*">\'<xsl:if test="@extended = \'true\'">$</xsl:if><xsl:value-of select="@name"/>\':<xsl:value-of select="."/>\r\n      <xsl:if test="position() != last()">,<xsl:text> </xsl:text>\r\n    </xsl:if> </xsl:for-each></xsl:when>\r\n  <xsl:otherwise><xsl:for-each select="exsl:node-set($memberDefinition)/*">\'<xsl:if test="@extended = \'true\'">$</xsl:if><xsl:value-of select="@name"/>\':<xsl:value-of select="."/>\r\n      <xsl:if test="position() != last()">,<xsl:text> </xsl:text>\r\n    </xsl:if> </xsl:for-each></xsl:otherwise>\r\n    </xsl:choose> }</property>\r\n</xsl:template>\r\n  \r\n  <xsl:template match="@Name" mode="render-field">\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@Type" mode="render-field">\r\n    <xsl:choose>\r\n      <xsl:when test="starts-with(., \'Collection\')">\r\n        <attribute name="type">\'Array\'</attribute>\r\n        <xsl:variable name="len" select="string-length(.)-12"/>\r\n        <xsl:choose>\r\n          <xsl:when test="starts-with(., ../../../@Namespace)">\r\n            <attribute name="elementType">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="substring(.,12,$len)" />\'</attribute>\r\n          </xsl:when>\r\n          <xsl:otherwise>\r\n            <attribute name="elementType">\'<xsl:value-of select="substring(.,12,$len)" />\'</attribute>\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:when>\r\n      <xsl:when test="starts-with(., ../../../@Namespace)">\r\n        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="."/>\'</attribute>\r\n      </xsl:when>\r\n      <xsl:otherwise>\r\n        <attribute name="type">\'<xsl:value-of select="."/>\'</attribute>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@ConcurrencyMode" mode="render-field">\r\n    <attribute name="concurrencyMode">$data.ConcurrencyMode.<xsl:value-of select="."/></attribute>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@Nullable" mode="render-field">\r\n    <attribute name="nullable"><xsl:value-of select="."/></attribute>\r\n    \r\n    <xsl:if test=". = \'false\'">\r\n      <xsl:choose>\r\n        <xsl:when test="parent::edm:Property/@annot:StoreGeneratedPattern = \'Identity\' or parent::edm:Property/@annot:StoreGeneratedPattern = \'Computed\'"></xsl:when>\r\n        <xsl:otherwise><attribute name="required">true</attribute></xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:if>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@annot:StoreGeneratedPattern" mode="render-field">\r\n    <xsl:if test=". != \'None\'"><attribute name="computed">true</attribute></xsl:if>    \r\n  </xsl:template>\r\n\r\n  <xsl:template match="@MaxLength" mode="render-field">\r\n    <attribute name="maxLength">\r\n      <xsl:choose>\r\n        <xsl:when test="string(.) = \'Max\'">Number.POSITIVE_INFINITY</xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="."/>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </attribute>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@FixedLength | @Unicode | @Precision | @Scale" mode="render-field">\r\n  </xsl:template>\r\n  <xsl:template match="@*" mode="render-field">\r\n    <xsl:variable name="nameProp">\r\n      <xsl:choose>\r\n        <xsl:when test="substring-after(name(), \':\') != \'\'">\r\n          <xsl:value-of select="substring-after(name(), \':\')"/>\r\n        </xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="name()"/>\r\n        </xsl:otherwise>\r\n      </xsl:choose>\r\n    </xsl:variable>\r\n    <xsl:element name="attribute"><xsl:attribute name="extended">true</xsl:attribute><xsl:attribute name="name"><xsl:value-of select="$nameProp"/></xsl:attribute>\'<xsl:value-of select="."/>\'</xsl:element>\r\n  </xsl:template>\r\n\r\n  <xsl:template match="@Relationship" mode="render-field">\r\n    <xsl:variable name="relationName" select="string(../@ToRole)"/>\r\n    <xsl:variable name="relationshipName" select="string(.)" />\r\n    <xsl:variable name="relation" select="key(\'associations\',string(.))/edm:End[@Role = $relationName]" />\r\n    <xsl:variable name="otherName" select="../@FromRole" />\r\n    <xsl:variable name="otherProp" select="//edm:NavigationProperty[@ToRole = $otherName and @Relationship = $relationshipName]" />\r\n    <xsl:variable name="m" select="$relation/@Multiplicity" />\r\n    <xsl:choose>\r\n      <xsl:when test="$m = \'*\'">\r\n        <attribute name="type">\'<xsl:value-of select="$CollectionBaseClass"/>\'</attribute>\r\n        <attribute name="elementType">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'</attribute>\r\n        <xsl:if test="not($otherProp/@Name)">\r\n          <attribute name="inverseProperty">\'$$unbound\'</attribute></xsl:if>\r\n        <xsl:if test="$otherProp/@Name">\r\n          <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'</attribute></xsl:if>\r\n      </xsl:when>\r\n      <xsl:when test="$m = \'0..1\'">\r\n        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'</attribute>\r\n        <xsl:choose>\r\n          <xsl:when test="$otherProp">\r\n            <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'</attribute>\r\n          </xsl:when >\r\n          <xsl:otherwise>\r\n            <attribute name="inverseProperty">\'$$unbound\'</attribute>\r\n            <xsl:message terminate="no">  Warning: inverseProperty other side missing: <xsl:value-of select="."/>\r\n          </xsl:message>\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:when>\r\n      <xsl:when test="$m = \'1\'">\r\n        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'</attribute>\r\n        <attribute name="required">true</attribute>\r\n        <xsl:choose>\r\n          <xsl:when test="$otherProp">\r\n            <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'</attribute>\r\n          </xsl:when >\r\n          <xsl:otherwise>\r\n            <attribute name="inverseProperty">\'$$unbound\'</attribute>\r\n            <xsl:message terminate="no">\r\n              Warning: inverseProperty other side missing: <xsl:value-of select="."/>\r\n            </xsl:message>\r\n          </xsl:otherwise>\r\n        </xsl:choose>\r\n      </xsl:when>\r\n    </xsl:choose>\r\n  </xsl:template>\r\n\r\n\r\n  <xsl:template match="@FromRole | @ToRole" mode="render-field"></xsl:template>\r\n\r\n  <xsl:template match="*" mode="render-field">\r\n    <\!--<unprocessed>!!<xsl:value-of select="name()"/>!!</unprocessed>--\>\r\n    <xsl:message terminate="no">  Warning: <xsl:value-of select="../../@Name"/>.<xsl:value-of select="../@Name"/>:<xsl:value-of select="name()"/> is an unknown/unprocessed attribued</xsl:message>\r\n  </xsl:template>\r\n  <\!--<xsl:template match="*">\r\n    !<xsl:value-of select="name()"/>!\r\n  </xsl:template>--\>\r\n</xsl:stylesheet>\r\n'}});
$data.MetadataLoader=new $data.MetadataLoaderClass;
$data.service=function(a,b,c){function d(a){switch(typeof a){case "object":typeof a.success==="function"||typeof a.error==="function"?g=a:e=a;break;case "function":g=a}}var e,g;d(b);d(c);if(typeof a==="object"){e=$data.typeSystem.extend(a,e);a=a.url;delete e.url}b=new $data.PromiseHandler;g=b.createCallback(g);$data.MetadataLoader.load(a,{success:function(a){var b=a.type;if(e){var c=e.serviceName||e.storeAlias;c&&"addStore"in $data&&$data.addStore(c,a,e.isDefault===void 0||e.isDefault)}g.success(a,
b)},error:g.error},e);return b.getPromise()};
(function(a){if(typeof jQuery!=="undefined"){a.Class.define("$data.Deferred",a.PromiseHandlerBase,null,{constructor:function(){this.deferred=new $.Deferred},deferred:{},createCallback:function(b){var b=a.typeSystem.createCallbackSetting(b),c=this;return cbWrapper={success:function(){b.success.apply(c.deferred,arguments);c.deferred.resolve.apply(c.deferred,arguments)},error:function(){Array.prototype.push.call(arguments,c.deferred);b.error.apply(c.deferred,arguments)},notify:function(){b.notify.apply(c.deferred,
arguments);c.deferred.notify.apply(c.deferred,arguments)}}},getPromise:function(){return this.deferred.promise()}},null);a.PromiseHandler=a.Deferred}})($data);
(function(a){a.initService=function(b,c){var d=new a.PromiseHandler,e;if(typeof b==="object"){e=b;var g=e.isSSL||e.isSSL===void 0?"https":"http",f=e.port?":"+e.port:"",b=typeof e.license==="string"&&e.license.toLowerCase()==="business"?e.appId&&e.serviceName?g+"://"+e.appId+".jaystack.net"+f+"/"+e.serviceName:e.url:e.ownerId&&e.appId&&e.serviceName?g+"://open.jaystack.net/"+e.ownerId+"/"+e.appId+"/api/"+e.serviceName:e.url;delete e.url;e=a.typeSystem.extend(e,c)}else e=c;a.service(b,e).then(function(a){return a().onReady().then(function(b){b.serviceFactory=
a;d.deferred.resolve(b,a,a.type)}).fail(function(){d.deferred.reject.apply(d.deferred,arguments)})});return d.getPromise()}})($data);
